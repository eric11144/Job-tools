[
    {
        "id": "6635bf50.0f505",
        "type": "tab",
        "label": "Power ON",
        "disabled": false,
        "info": ""
    },
    {
        "id": "8520e616.90ab98",
        "type": "tab",
        "label": "Alarm",
        "disabled": false,
        "info": ""
    },
    {
        "id": "d01ff20d.5cea7",
        "type": "tab",
        "label": "Working",
        "disabled": false,
        "info": ""
    },
    {
        "id": "f9c24c90.68012",
        "type": "tab",
        "label": "Working Timestamp",
        "disabled": false,
        "info": ""
    },
    {
        "id": "5c6c983f.192a38",
        "type": "tab",
        "label": "Time Table Restful API",
        "disabled": true,
        "info": ""
    },
    {
        "id": "6a71a10d.27fa1",
        "type": "tab",
        "label": "CNC new data check",
        "disabled": false,
        "info": ""
    },
    {
        "id": "54efa582.10a04c",
        "type": "subflow",
        "name": "Tag Power ON OFF",
        "info": "Input:\n\n- `msg.params`\n    ```\n    {\n        DEVICE_ID: 'bender_event'\n    ]\n    ```\n- `msg.payload`\n\nOutput:\n\n- `msg.payload`",
        "category": "",
        "in": [
            {
                "x": 120,
                "y": 240,
                "wires": [
                    {
                        "id": "be62a48e.d4d718"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 900,
                "y": 280,
                "wires": [
                    {
                        "id": "1aa9e62.4003b1a",
                        "port": 0
                    }
                ]
            }
        ],
        "env": []
    },
    {
        "id": "1d3a3270.3d399e",
        "type": "subflow",
        "name": "Clear Microseconds",
        "info": "Clear msg.payload.at microseconds to `0`\n",
        "category": "",
        "in": [
            {
                "x": 240,
                "y": 160,
                "wires": [
                    {
                        "id": "cfe8ad2c.fd08c"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 540,
                "y": 160,
                "wires": [
                    {
                        "id": "cfe8ad2c.fd08c",
                        "port": 0
                    }
                ]
            }
        ],
        "env": []
    },
    {
        "id": "466fd2d0.e34c1c",
        "type": "subflow",
        "name": "Event",
        "info": "Input:\n\n- `msg.params.BASE_DEVICE_ID`\n- `msg.params.ZONE`\n- `msg.params.CHANNEL_ID`\n- `msg.params.EVENT_ID`\n- `msg.params.INIT_VALUE`\n- `msg.params.VALUE_TO_STATE`\n    ```\n    [\n        {\n            VALUE: 0\n            STATE: 0\n        },\n        {\n            VALUE: 1\n            STATE: 1\n        }\n    ]\n    ```\n- `msg.payload`\n\nOutput:\n\n- `msg.payload`\n",
        "category": "",
        "in": [
            {
                "x": 60,
                "y": 220,
                "wires": [
                    {
                        "id": "c43c0d75.f758f"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1000,
                "y": 300,
                "wires": [
                    {
                        "id": "3622bcff.2a3804",
                        "port": 0
                    }
                ]
            }
        ],
        "env": []
    },
    {
        "id": "82e4d436.d46858",
        "type": "subflow",
        "name": "Tag Working Stop",
        "info": "Input:\n\n- `msg.params.BASE_DEVICE_ID`\n- `msg.params.QUERY_SINCE`\n- `msg.params.CHANNEL_WORKING_CODE`\n    ```\n    {\n        Y0: [\n            {\n                VALUE: 1,\n                CODE: 1\n            },\n            {\n                VALUE: 0,\n                CODE: 2\n            }\n        ]\n    }\n    ```\n- `msg.params.PATTERNS`\n    ```\n    [15, 21, 31, 33, 32, 34, 16, 36, 20, 18, 14, 35]\n    ```\n\nOutput:\n\n- `msg.payload`",
        "category": "",
        "in": [
            {
                "x": 240,
                "y": 120,
                "wires": [
                    {
                        "id": "a35d3c59.a3b61"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 660,
                "y": 320,
                "wires": [
                    {
                        "id": "9360340a.6aaa78",
                        "port": 0
                    }
                ]
            }
        ],
        "env": []
    },
    {
        "id": "253eb64e.ce6faa",
        "type": "subflow",
        "name": "Bender Alarm",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 180,
                "y": 260,
                "wires": [
                    {
                        "id": "7667a581.6fb3fc"
                    },
                    {
                        "id": "6dfe4cae.6edd34"
                    },
                    {
                        "id": "452de280.d49a7c"
                    },
                    {
                        "id": "845e227b.24b9a"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 860,
                "y": 260,
                "wires": [
                    {
                        "id": "4d779976.fe98e8",
                        "port": 0
                    },
                    {
                        "id": "68df4891.443ad8",
                        "port": 0
                    },
                    {
                        "id": "fc2717a3.af2f98",
                        "port": 0
                    },
                    {
                        "id": "73985c18.4f1344",
                        "port": 0
                    }
                ]
            }
        ],
        "env": []
    },
    {
        "id": "245f9bbf.17fc44",
        "type": "subflow",
        "name": "Bender Working",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 160,
                "y": 380,
                "wires": [
                    {
                        "id": "aa120190.0aa9c"
                    },
                    {
                        "id": "8126101b.daa8d"
                    },
                    {
                        "id": "ae219a6f.9209f8"
                    },
                    {
                        "id": "60fbe8e.a40c418"
                    },
                    {
                        "id": "d37cbc8d.38f39"
                    },
                    {
                        "id": "8433afc.c6d745"
                    },
                    {
                        "id": "cbf5ec2.ed0fc1"
                    },
                    {
                        "id": "91a56943.3f8918"
                    },
                    {
                        "id": "8999acbe.58e16"
                    },
                    {
                        "id": "c197b1e3.eddbc"
                    },
                    {
                        "id": "278b3bd9.a4db14"
                    },
                    {
                        "id": "50033fbb.b06fc"
                    },
                    {
                        "id": "80a4921a.7a3b5"
                    },
                    {
                        "id": "c2adf2f4.1e611"
                    },
                    {
                        "id": "3970226c.90f0ee"
                    },
                    {
                        "id": "c2f94479.dcdd68"
                    },
                    {
                        "id": "6c15a001.fc15"
                    },
                    {
                        "id": "307aff6b.012c6"
                    },
                    {
                        "id": "8a7f48ab.fad948"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 860,
                "y": 380,
                "wires": [
                    {
                        "id": "2699b0af.8a95f",
                        "port": 0
                    },
                    {
                        "id": "18a7d37f.17988d",
                        "port": 0
                    },
                    {
                        "id": "eefb0ab1.0b3688",
                        "port": 0
                    },
                    {
                        "id": "93f570f6.6f6bf",
                        "port": 0
                    },
                    {
                        "id": "a6d831cc.fce35",
                        "port": 0
                    },
                    {
                        "id": "6400b595.d3d31c",
                        "port": 0
                    },
                    {
                        "id": "3c72b8aa.5e5c88",
                        "port": 0
                    },
                    {
                        "id": "46cd93d6.ed5c4c",
                        "port": 0
                    },
                    {
                        "id": "b9d9bced.61ee5",
                        "port": 0
                    },
                    {
                        "id": "a7adce5.5f6113",
                        "port": 0
                    },
                    {
                        "id": "aa087b10.490d08",
                        "port": 0
                    },
                    {
                        "id": "dc5a844c.c72148",
                        "port": 0
                    },
                    {
                        "id": "3bf9bace.d30bc6",
                        "port": 0
                    },
                    {
                        "id": "ce38e66f.0b6ca8",
                        "port": 0
                    },
                    {
                        "id": "c746f260.5554a",
                        "port": 0
                    },
                    {
                        "id": "ae58c758.208e78",
                        "port": 0
                    },
                    {
                        "id": "e977ce56.8c18a",
                        "port": 0
                    },
                    {
                        "id": "efc7746d.a48c38",
                        "port": 0
                    },
                    {
                        "id": "2b5dac9e.9fe794",
                        "port": 0
                    }
                ]
            }
        ],
        "env": []
    },
    {
        "id": "a473bc4c.73399",
        "type": "subflow",
        "name": "Welder Working",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 240,
                "y": 200,
                "wires": [
                    {
                        "id": "5aafd727.633be8"
                    },
                    {
                        "id": "9005c9bf.cc4ea8"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 780,
                "y": 200,
                "wires": [
                    {
                        "id": "15041376.72768d",
                        "port": 0
                    },
                    {
                        "id": "5cf16db4.84fa44",
                        "port": 0
                    }
                ]
            }
        ],
        "env": []
    },
    {
        "id": "d09079cb.f16838",
        "type": "subflow",
        "name": "Welder Alarm",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 180,
                "y": 280,
                "wires": [
                    {
                        "id": "a0f0081a.1325b8"
                    },
                    {
                        "id": "ddbd470c.e78008"
                    },
                    {
                        "id": "96dd17d6.8b8d18"
                    },
                    {
                        "id": "36bcd669.7ff67a"
                    },
                    {
                        "id": "5dd930b3.a6868"
                    },
                    {
                        "id": "a3d06343.e6b8b"
                    },
                    {
                        "id": "579cccae.8752b4"
                    },
                    {
                        "id": "87655783.adb5d8"
                    },
                    {
                        "id": "aa0af670.9f44c8"
                    },
                    {
                        "id": "a3f7a63d.72aee8"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 860,
                "y": 280,
                "wires": [
                    {
                        "id": "fb2ffc6f.c8542",
                        "port": 0
                    },
                    {
                        "id": "a0715b0e.2774c8",
                        "port": 0
                    },
                    {
                        "id": "943a9945.996338",
                        "port": 0
                    },
                    {
                        "id": "32e7cb21.90c2b4",
                        "port": 0
                    },
                    {
                        "id": "5fcc1662.85e8d8",
                        "port": 0
                    },
                    {
                        "id": "a2a3d8bd.dd0398",
                        "port": 0
                    },
                    {
                        "id": "116335c9.a7536a",
                        "port": 0
                    },
                    {
                        "id": "154b4f07.858181",
                        "port": 0
                    },
                    {
                        "id": "f67f4692.86c188",
                        "port": 0
                    },
                    {
                        "id": "7146a6bf.d9d9b8",
                        "port": 0
                    }
                ]
            }
        ],
        "env": []
    },
    {
        "id": "1bec181a.2f61b8",
        "type": "subflow",
        "name": "Manual Bender Alarm",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 260,
                "y": 280,
                "wires": [
                    {
                        "id": "a1cf6c73.4141e"
                    },
                    {
                        "id": "252ffc5d.3e07a4"
                    },
                    {
                        "id": "aa97ba19.b82168"
                    },
                    {
                        "id": "d86f80b7.287b6"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 920,
                "y": 280,
                "wires": [
                    {
                        "id": "aad10e5b.cf525",
                        "port": 0
                    },
                    {
                        "id": "9335b1b8.83128",
                        "port": 0
                    },
                    {
                        "id": "29780e22.8abae2",
                        "port": 0
                    },
                    {
                        "id": "81c660e2.21673",
                        "port": 0
                    }
                ]
            }
        ],
        "env": []
    },
    {
        "id": "8974067.04364f8",
        "type": "subflow",
        "name": "Manual Bender Working",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 320,
                "y": 240,
                "wires": [
                    {
                        "id": "84e8eeb2.d9b1"
                    },
                    {
                        "id": "c11d269d.8409d8"
                    },
                    {
                        "id": "df66e228.e0327"
                    },
                    {
                        "id": "606a48cf.7ad848"
                    },
                    {
                        "id": "9de5bf74.e3b94"
                    },
                    {
                        "id": "51798c8a.a6c9e4"
                    },
                    {
                        "id": "6441ab2c.82b594"
                    },
                    {
                        "id": "6212738b.b7982c"
                    },
                    {
                        "id": "eff7db6c.0f25d8"
                    },
                    {
                        "id": "2002bf05.ee4d5"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1000,
                "y": 240,
                "wires": [
                    {
                        "id": "b571c71.5c1f538",
                        "port": 0
                    },
                    {
                        "id": "a246d81.d240828",
                        "port": 0
                    },
                    {
                        "id": "d861081a.6f7938",
                        "port": 0
                    },
                    {
                        "id": "47cf2c00.409f34",
                        "port": 0
                    },
                    {
                        "id": "886018a5.0d6218",
                        "port": 0
                    },
                    {
                        "id": "a0cb24f4.04ed58",
                        "port": 0
                    },
                    {
                        "id": "c3df5e0e.e787b",
                        "port": 0
                    },
                    {
                        "id": "381a0b34.76d284",
                        "port": 0
                    },
                    {
                        "id": "4d721d35.f1db24",
                        "port": 0
                    },
                    {
                        "id": "87682dd4.aa0a7",
                        "port": 0
                    }
                ]
            }
        ],
        "env": []
    },
    {
        "id": "94b1b7f9.82aa68",
        "type": "subflow",
        "name": "Stamping Press Alarm",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 60,
                "y": 320,
                "wires": [
                    {
                        "id": "487db400.62350c"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 880,
                "y": 320,
                "wires": [
                    {
                        "id": "7677584.ddb02a8",
                        "port": 0
                    },
                    {
                        "id": "86259a64.f66d58",
                        "port": 0
                    },
                    {
                        "id": "ea9009bf.a85bc8",
                        "port": 0
                    },
                    {
                        "id": "41043533.b9035c",
                        "port": 0
                    },
                    {
                        "id": "a03a9b48.da2c08",
                        "port": 0
                    },
                    {
                        "id": "a77b7f68.6922b",
                        "port": 0
                    },
                    {
                        "id": "aeb4c244.e9958",
                        "port": 0
                    },
                    {
                        "id": "d6aea369.8f026",
                        "port": 0
                    },
                    {
                        "id": "2e51d2c8.6bdeae",
                        "port": 0
                    },
                    {
                        "id": "36c1ec18.38a454",
                        "port": 0
                    },
                    {
                        "id": "5cc514f1.29a47c",
                        "port": 0
                    },
                    {
                        "id": "9aca4923.907a68",
                        "port": 0
                    },
                    {
                        "id": "fd5679be.d18808",
                        "port": 0
                    }
                ]
            }
        ],
        "env": []
    },
    {
        "id": "e7e991f8.65c3f",
        "type": "subflow",
        "name": "Production Info Count",
        "info": "Input:\n\n- `msg.params.BASE_DEVICE_ID`\n- `msg.params.LAST_WORKING_STOP_AT`\n- `msg.params.CIRCLE_PRE_COUNT`\n\nOutput:\n\n- `msg.payload`",
        "category": "",
        "in": [
            {
                "x": 260,
                "y": 100,
                "wires": [
                    {
                        "id": "adb477fe.8a3a68"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 540,
                "y": 300,
                "wires": [
                    {
                        "id": "7a8d5a33.a3fab4",
                        "port": 0
                    }
                ]
            }
        ],
        "env": []
    },
    {
        "id": "144efb39.f5bc95",
        "type": "subflow",
        "name": "Production Info Utilization",
        "info": "Input:\n\n- `msg.params.BASE_DEVICE_ID`\n- `msg.params.LAST_WORKING_STOP_AT`\n\nOutput:\n\n- `msg.payload`",
        "category": "",
        "in": [
            {
                "x": 220,
                "y": 120,
                "wires": [
                    {
                        "id": "9bee6559.6b02e8"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 560,
                "y": 360,
                "wires": [
                    {
                        "id": "4c83c5f2.6f6e3c",
                        "port": 0
                    }
                ]
            }
        ],
        "env": []
    },
    {
        "id": "26e982ee.cf503e",
        "type": "subflow",
        "name": "operate detection",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 80,
                "y": 40,
                "wires": [
                    {
                        "id": "aa03a3f1.73ba8"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 760,
                "y": 220,
                "wires": [
                    {
                        "id": "a179d0c3.73008",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [
            {
                "name": "channel_id",
                "type": "str",
                "value": ""
            },
            {
                "name": "pre_processing_sec",
                "type": "num",
                "value": "0"
            },
            {
                "name": "post_processing_sec",
                "type": "num",
                "value": "0"
            }
        ]
    },
    {
        "id": "c396c221.180cf",
        "type": "subflow",
        "name": "query state changed",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 80,
                "y": 60,
                "wires": [
                    {
                        "id": "9af15d78.b670b"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 420,
                "y": 400,
                "wires": [
                    {
                        "id": "4c8694e9.fb006c",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [
            {
                "name": "device_id",
                "type": "str",
                "value": ""
            },
            {
                "name": "channel_id",
                "type": "str",
                "value": ""
            },
            {
                "name": "pretreatment_sec",
                "type": "num",
                "value": "0"
            },
            {
                "name": "post_processing_sec",
                "type": "num",
                "value": "0"
            }
        ]
    },
    {
        "id": "15296a9d.2cdf05",
        "type": "subflow",
        "name": "Stamping Press Production Info Count",
        "info": "Input:\n\n- `msg.params.BASE_DEVICE_ID`\n- `msg.params.CHANNEL_ID`\n- `msg.params.LAST_COUNT_CHANGED_AT`\n\n- `msg.payload`\n\nOutput:\n\n- `msg.payload`",
        "category": "",
        "in": [
            {
                "x": 360,
                "y": 60,
                "wires": [
                    {
                        "id": "eb0eaafd.bd4f58"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 760,
                "y": 260,
                "wires": [
                    {
                        "id": "a194247b.db6a18",
                        "port": 0
                    }
                ]
            }
        ],
        "env": []
    },
    {
        "id": "98f59ae.c156e68",
        "type": "qi-chameleon-source",
        "z": "6635bf50.0f505",
        "name": "",
        "deviceId": "bender",
        "x": 160,
        "y": 80,
        "wires": [
            [
                "f360ce28.2f811"
            ]
        ]
    },
    {
        "id": "724b182b.6b53e8",
        "type": "qi-chameleon-sink",
        "z": "6635bf50.0f505",
        "name": "",
        "x": 420,
        "y": 200,
        "wires": []
    },
    {
        "id": "a12c7db6.2ed71",
        "type": "trigger",
        "z": "54efa582.10a04c",
        "op1": "",
        "op2": "",
        "op1type": "nul",
        "op2type": "payl",
        "duration": "60",
        "extend": true,
        "units": "s",
        "reset": "",
        "bytopic": "all",
        "name": "",
        "x": 430,
        "y": 320,
        "wires": [
            [
                "84f91d20.c7531"
            ]
        ]
    },
    {
        "id": "b5f34ccd.728e4",
        "type": "function",
        "z": "54efa582.10a04c",
        "name": "on",
        "func": "const DEVICE_ID = flow.get('DEVICE_ID')\n\nconst at = msg.payload.at\n\nmsg.payload = {\n    \"deviceId\": DEVICE_ID,\n    \"at\": at,\n    \"channels\": {\n        \"power_on\": 1\n    }\n}\n\nreturn msg\n",
        "outputs": 1,
        "noerr": 0,
        "x": 590,
        "y": 240,
        "wires": [
            [
                "1aa9e62.4003b1a"
            ]
        ]
    },
    {
        "id": "84f91d20.c7531",
        "type": "function",
        "z": "54efa582.10a04c",
        "name": "off",
        "func": "const DEVICE_ID = flow.get('DEVICE_ID')\n\nconst at = msg.payload.at\n\nmsg.payload = {\n    \"deviceId\": DEVICE_ID,\n    \"at\": at,\n    \"channels\": {\n        \"power_on\": 0\n    }\n}\n\nreturn msg\n",
        "outputs": 1,
        "noerr": 0,
        "x": 590,
        "y": 320,
        "wires": [
            [
                "1aa9e62.4003b1a"
            ]
        ]
    },
    {
        "id": "1aa9e62.4003b1a",
        "type": "qi-forward-on-change",
        "z": "54efa582.10a04c",
        "name": "",
        "x": 770,
        "y": 280,
        "wires": [
            []
        ]
    },
    {
        "id": "1ec71938.0aea97",
        "type": "function",
        "z": "6635bf50.0f505",
        "name": "parameters",
        "func": "msg.params = {\n    DEVICE_ID: 'bender_event'\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 410,
        "y": 120,
        "wires": [
            [
                "e7ec5df1.1bbdc"
            ]
        ]
    },
    {
        "id": "e7ec5df1.1bbdc",
        "type": "subflow:54efa582.10a04c",
        "z": "6635bf50.0f505",
        "name": "",
        "x": 450,
        "y": 160,
        "wires": [
            [
                "724b182b.6b53e8"
            ]
        ]
    },
    {
        "id": "be62a48e.d4d718",
        "type": "function",
        "z": "54efa582.10a04c",
        "name": "flow.params",
        "func": "if (typeof msg.params.DEVICE_ID === 'undefined') {\n    node.error('illegal msg.params')\n    return\n}\n\nflow.set(\n    [\n        'DEVICE_ID'\n    ],\n    [\n        msg.params.DEVICE_ID\n    ]\n)\n\ndelete msg.params\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 270,
        "y": 240,
        "wires": [
            [
                "a12c7db6.2ed71",
                "b5f34ccd.728e4"
            ]
        ]
    },
    {
        "id": "cfe8ad2c.fd08c",
        "type": "function",
        "z": "1d3a3270.3d399e",
        "name": "clear us",
        "func": "const us = msg.payload.at.us\n\nmsg.payload.at.us = Math.floor(us / 1000) * 1000\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 380,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "b1095581.55c048",
        "type": "qi-forward-on-match",
        "z": "466fd2d0.e34c1c",
        "name": "filter channel",
        "schema": "schema",
        "schemaType": "msg",
        "removeAdditional": true,
        "x": 550,
        "y": 220,
        "wires": [
            [
                "76ca6f24.19954"
            ]
        ]
    },
    {
        "id": "c43c0d75.f758f",
        "type": "function",
        "z": "466fd2d0.e34c1c",
        "name": "flow.params",
        "func": "if (typeof msg.params.BASE_DEVICE_ID === 'undefined' ||\n        typeof msg.params.ZONE === 'undefined' ||\n        typeof msg.params.CHANNEL_ID === 'undefined' ||\n        typeof msg.params.EVENT_ID === 'undefined' ||\n        typeof msg.params.INIT_VALUE === 'undefined' ||\n        typeof msg.params.VALUE_TO_STATE === 'undefined') {\n    node.error('illegal msg.params')\n    return\n}\n\nflow.set(\n    [\n        'BASE_DEVICE_ID',\n        'ZONE',\n        'CHANNEL_ID',\n        'EVENT_ID',\n        'INIT_VALUE',\n        'VALUE_TO_STATE'\n    ],\n    [\n        msg.params.BASE_DEVICE_ID,\n        msg.params.ZONE,\n        msg.params.CHANNEL_ID,\n        msg.params.EVENT_ID,\n        msg.params.INIT_VALUE,\n        msg.params.VALUE_TO_STATE\n    ]\n)\n\ndelete msg.params\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 230,
        "y": 220,
        "wires": [
            [
                "45349a60.bebbd4",
                "47da2d8c.f9c1f4"
            ]
        ]
    },
    {
        "id": "45349a60.bebbd4",
        "type": "function",
        "z": "466fd2d0.e34c1c",
        "name": "schema",
        "func": "const CHANNEL_ID = flow.get('CHANNEL_ID')\n\nconst channels = [CHANNEL_ID]\nlet channel_properties = {}\n\nchannel_properties[CHANNEL_ID] = {type: 'number'}\n\nmsg.schema = {\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"type\": \"object\",\n    \"required\": [\n        \"deviceId\",\n        \"at\",\n        \"channels\"\n    ],\n    \"properties\": {\n        \"deviceId\": {\n            \"type\": \"string\"\n        },\n        \"at\": {\n            \"type\": \"object\",\n            \"required\": [\n                \"sec\",\n                \"us\"\n            ],\n            \"properties\": {\n                \"sec\": {\n                    \"type\": \"integer\",\n                    \"minimum\": 0\n                },\n                \"us\": {\n                    \"type\": \"integer\",\n                    \"minimum\": 0,\n                    \"maximum\": 999999\n                }\n            }\n        },\n        \"channels\": {\n            \"type\": \"object\",\n            \"required\": channels,\n            \"properties\": channel_properties\n        }\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 400,
        "y": 220,
        "wires": [
            [
                "b1095581.55c048"
            ]
        ]
    },
    {
        "id": "a97f9651.450408",
        "type": "qi-chameleon-source",
        "z": "8520e616.90ab98",
        "name": "",
        "deviceId": "bender",
        "x": 160,
        "y": 100,
        "wires": [
            [
                "d8dae95e.896978"
            ]
        ]
    },
    {
        "id": "808b3ed9.fffe8",
        "type": "qi-chameleon-sink",
        "z": "8520e616.90ab98",
        "name": "",
        "x": 900,
        "y": 160,
        "wires": []
    },
    {
        "id": "14c7ca7b.522486",
        "type": "qi-chameleon-source",
        "z": "d01ff20d.5cea7",
        "name": "",
        "deviceId": "bender",
        "x": 240,
        "y": 100,
        "wires": [
            [
                "3fd8da29.85f886"
            ]
        ]
    },
    {
        "id": "549d523.058d6ac",
        "type": "qi-chameleon-sink",
        "z": "d01ff20d.5cea7",
        "name": "",
        "x": 580,
        "y": 200,
        "wires": []
    },
    {
        "id": "8fff573d.5281e8",
        "type": "qi-chameleon-source",
        "z": "f9c24c90.68012",
        "name": "",
        "deviceId": "bender_working",
        "x": 240,
        "y": 80,
        "wires": [
            [
                "3a51eb8b.712da4"
            ]
        ]
    },
    {
        "id": "4ee5f1d.ac4291",
        "type": "qi-chameleon-sink",
        "z": "f9c24c90.68012",
        "name": "",
        "x": 800,
        "y": 120,
        "wires": []
    },
    {
        "id": "fbea74e1.fa8818",
        "type": "function",
        "z": "f9c24c90.68012",
        "name": "working start",
        "func": "// const DEVICE_ID = flow.get('DEVICE_ID')\nconst DEVICE_ID = 'bender_event'\n\nconst at = msg.payload.at\n\nmsg.payload = {\n    deviceId: DEVICE_ID,\n    at: at,\n    channels: {\n        working: 1\n    }\n}\n\nreturn msg\n",
        "outputs": 1,
        "noerr": 0,
        "x": 530,
        "y": 120,
        "wires": [
            [
                "4ee5f1d.ac4291",
                "b21d9a1.63d6768"
            ]
        ]
    },
    {
        "id": "3a51eb8b.712da4",
        "type": "switch",
        "z": "f9c24c90.68012",
        "name": "forward working start",
        "property": "payload.channels.Y01",
        "propertyType": "msg",
        "rules": [
            {
                "v": "1",
                "t": "eq",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 540,
        "y": 80,
        "wires": [
            [
                "fbea74e1.fa8818"
            ]
        ]
    },
    {
        "id": "e25d6a47.eace88",
        "type": "function",
        "z": "82e4d436.d46858",
        "name": "query not processed working",
        "func": "const QUERY_SINCE = flow.get('QUERY_SINCE')\n\nconst from = flow.get('BASE_DEVICE_ID') + '_working'\nconst since = QUERY_SINCE.toISOString()\n\nmsg.query = `\n    SELECT *\n    FROM ${from}\n    WHERE time >= '${since}'\n`\n\n// node.error(msg.query)\n\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "x": 460,
        "y": 160,
        "wires": [
            [
                "ef2e966e.55c898"
            ]
        ]
    },
    {
        "id": "ef2e966e.55c898",
        "type": "qi-query-history",
        "z": "82e4d436.d46858",
        "name": "",
        "query": "",
        "x": 440,
        "y": 200,
        "wires": [
            [
                "8adb7ae3.d89928"
            ]
        ]
    },
    {
        "id": "78b1ecec.0b7a94",
        "type": "function",
        "z": "82e4d436.d46858",
        "name": "match pattern",
        "func": "const PATTERNS = flow.get('PATTERNS')\nconst result = msg.working_code_list\n\n// match\nlet matched = []\nlet data_index = 0\nPATTERNS.forEach(\n    function(item)\n    {\n        while(data_index < result.length)\n        {\n            let data = result[data_index++]\n            if (data.code == item)\n            {\n                matched.push(data)\n                break\n            }\n        }\n    }\n)\n\nif (matched.length !== PATTERNS.length)\n{\n    return\n}\n\nlet tail = matched[matched.length - 1]\nif (tail.code !== PATTERNS[PATTERNS.length - 1])\n{\n    return\n}\n\nmsg.matched = matched\n\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "x": 460,
        "y": 280,
        "wires": [
            [
                "9360340a.6aaa78"
            ]
        ]
    },
    {
        "id": "9360340a.6aaa78",
        "type": "function",
        "z": "82e4d436.d46858",
        "name": "working stop",
        "func": "const matched = msg.matched\n\nconst device_id = flow.get('BASE_DEVICE_ID') + '_event'\nconst tail = matched[matched.length - 1]\n\nmsg.payload = {\n    \"deviceId\": device_id,\n    \"at\": _format_at(tail.time),\n    \"channels\": {\n        \"working\": 0\n    }\n}\n\nreturn msg\n\nfunction _format_at(epoch_milliseconds)\n{\n    return {\n        \"sec\": Math.floor(epoch_milliseconds / 1000),\n        \"us\": (epoch_milliseconds % 1000) * 1000\n    }\n}",
        "outputs": 1,
        "noerr": 0,
        "x": 450,
        "y": 320,
        "wires": [
            []
        ]
    },
    {
        "id": "a35d3c59.a3b61",
        "type": "function",
        "z": "82e4d436.d46858",
        "name": "flow.params",
        "func": "if (typeof msg.params.BASE_DEVICE_ID === 'undefined' ||\n        typeof msg.params.QUERY_SINCE === 'undefined'||\n        typeof msg.params.CHANNEL_WORKING_CODE === 'undefined' ||\n        typeof msg.params.PATTERNS === 'undefined') {\n    node.error('illegal msg.params')\n    return\n}\n\nflow.set(\n    [\n        'BASE_DEVICE_ID',\n        'QUERY_SINCE',\n        'CHANNEL_WORKING_CODE',\n        'PATTERNS'\n    ],\n    [\n        msg.params.BASE_DEVICE_ID,\n        msg.params.QUERY_SINCE,\n        msg.params.CHANNEL_WORKING_CODE,\n        msg.params.PATTERNS\n    ]\n)\n\ndelete msg.params\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 410,
        "y": 120,
        "wires": [
            [
                "e25d6a47.eace88"
            ]
        ]
    },
    {
        "id": "63faf3cb.ace6bc",
        "type": "function",
        "z": "f9c24c90.68012",
        "name": "parameters",
        "func": "const at = msg.payload.at\n\nconst since = new Date(at.sec * 1000 + at.us / 1000)\n\nmsg.params = {\n    BASE_DEVICE_ID: 'bender',\n    QUERY_SINCE: since,\n    CHANNEL_WORKING_CODE: {\n        Y0: [\n            {\n                VALUE: 1,\n                CODE: 1\n            },\n            {\n                VALUE: 0,\n                CODE: 2\n            }\n        ],\n        Y01: [\n            {\n                VALUE: 1,\n                CODE: 3\n            },\n            {\n                VALUE: 0,\n                CODE: 4\n            }\n        ],\n        Y02: [\n            {\n                VALUE: 1,\n                CODE: 5\n            },\n            {\n                VALUE: 0,\n                CODE: 6\n            }\n        ],\n        Y03: [\n            {\n                VALUE: 1,\n                CODE: 7\n            },\n            {\n                VALUE: 0,\n                CODE: 8\n            }\n        ],\n        Y04: [\n            {\n                VALUE: 1,\n                CODE: 9\n            },\n            {\n                VALUE: 0,\n                CODE: 10\n            }\n        ],\n        Y05: [\n            {\n                VALUE: 1,\n                CODE: 11\n            },\n            {\n                VALUE: 0,\n                CODE: 12\n            }\n        ],\n        Y10: [\n            {\n                VALUE: 1,\n                CODE: 13\n            },\n            {\n                VALUE: 0,\n                CODE: 14\n            }\n        ],\n        Y11: [\n            {\n                VALUE: 1,\n                CODE: 15\n            },\n            {\n                VALUE: 0,\n                CODE: 16\n            }\n        ],\n        Y12: [\n            {\n                VALUE: 1,\n                CODE: 17\n            },\n            {\n                VALUE: 0,\n                CODE: 18\n            }\n        ],\n        Y13: [\n            {\n                VALUE: 1,\n                CODE: 19\n            },\n            {\n                VALUE: 0,\n                CODE: 20\n            }\n        ],\n        Y14: [\n            {\n                VALUE: 1,\n                CODE: 21\n            },\n            {\n                VALUE: 0,\n                CODE: 22\n            }\n        ],\n        Y15: [\n            {\n                VALUE: 1,\n                CODE: 23\n            },\n            {\n                VALUE: 0,\n                CODE: 24\n            }\n        ],\n        Y20: [\n            {\n                VALUE: 1,\n                CODE: 25\n            },\n            {\n                VALUE: 0,\n                CODE: 26\n            }\n        ],\n        Y21: [\n            {\n                VALUE: 1,\n                CODE: 27\n            },\n            {\n                VALUE: 0,\n                CODE: 28\n            }\n        ],\n        Y26: [\n            {\n                VALUE: 1,\n                CODE: 29\n            },\n            {\n                VALUE: 0,\n                CODE: 30\n            }\n        ],\n        Y34: [\n            {\n                VALUE: 1,\n                CODE: 31\n            },\n            {\n                VALUE: 0,\n                CODE: 32\n            }\n        ],\n        Y35: [\n            {\n                VALUE: 1,\n                CODE: 33\n            },\n            {\n                VALUE: 0,\n                CODE: 34\n            }\n        ],\n        Y40: [\n            {\n                VALUE: 1,\n                CODE: 35\n            },\n            {\n                VALUE: 0,\n                CODE: 36\n            }\n        ],\n        Y41: [\n            {\n                VALUE: 1,\n                CODE: 37\n            },\n            {\n                VALUE: 0,\n                CODE: 38\n            }\n        ]\n    },\n    PATTERNS: [3, 9, 15, 21, 31, 33, 4, 10, 16, 9, 13, 21, 2, 10, 14, 35]\n}           //[15, 21, 31, 33, 32, 34, 16, 36, 20, 18, 14, 35]\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "x": 570,
        "y": 200,
        "wires": [
            [
                "848b3e88.d4976"
            ]
        ]
    },
    {
        "id": "848b3e88.d4976",
        "type": "subflow:82e4d436.d46858",
        "z": "f9c24c90.68012",
        "name": "",
        "x": 590,
        "y": 240,
        "wires": [
            [
                "4ee5f1d.ac4291",
                "80fb9dd3.b1106"
            ]
        ]
    },
    {
        "id": "f360ce28.2f811",
        "type": "subflow:1d3a3270.3d399e",
        "z": "6635bf50.0f505",
        "name": "",
        "x": 440,
        "y": 80,
        "wires": [
            [
                "1ec71938.0aea97"
            ]
        ]
    },
    {
        "id": "d8dae95e.896978",
        "type": "subflow:1d3a3270.3d399e",
        "z": "8520e616.90ab98",
        "name": "",
        "x": 440,
        "y": 100,
        "wires": [
            [
                "b61b7484.04c6a8"
            ]
        ]
    },
    {
        "id": "3fd8da29.85f886",
        "type": "subflow:1d3a3270.3d399e",
        "z": "d01ff20d.5cea7",
        "name": "",
        "x": 600,
        "y": 100,
        "wires": [
            [
                "f04b64a2.e354a8"
            ]
        ]
    },
    {
        "id": "76ca6f24.19954",
        "type": "qi-forward-on-change",
        "z": "466fd2d0.e34c1c",
        "name": "",
        "x": 910,
        "y": 220,
        "wires": [
            [
                "80364f82.3d41f"
            ]
        ]
    },
    {
        "id": "3622bcff.2a3804",
        "type": "function",
        "z": "466fd2d0.e34c1c",
        "name": "event",
        "func": "const DEVICE_ID = flow.get('BASE_DEVICE_ID') + '_' + flow.get('ZONE')\nconst CHANNEL_ID = flow.get('CHANNEL_ID')\nconst EVENT_ID = flow.get('EVENT_ID')\nconst VALUE_TO_STATE = flow.get('VALUE_TO_STATE')\n\nconst at = msg.payload.at\nconst value = msg.payload.channels[CHANNEL_ID]\n\nlet channel = {}\n\nVALUE_TO_STATE.forEach(\n    function(item)\n    {\n        if (value === item.VALUE)\n        {\n            channel[EVENT_ID] = item.STATE\n        }\n    }\n)\n\nif (!channel.hasOwnProperty(EVENT_ID))\n{\n    node.error(CHANNEL_ID + ': ' + value + ' undefined')\n    return\n}\n\nmsg.payload = {\n    deviceId: DEVICE_ID,\n    at: at,\n    channels: channel\n}\n\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "x": 890,
        "y": 300,
        "wires": [
            []
        ]
    },
    {
        "id": "80364f82.3d41f",
        "type": "function",
        "z": "466fd2d0.e34c1c",
        "name": "pass",
        "func": "const INIT_VALUE = flow.get('INIT_VALUE')\nconst CHANNEL_ID = flow.get('CHANNEL_ID')\nconst channels = msg.payload.channels\n\nconst initialized = context.get('initialized')\n\nif (initialized === undefined)\n{\n    context.set('initialized', true)\n    \n    if (INIT_VALUE !== undefined &&\n            channels[CHANNEL_ID] === INIT_VALUE)\n    {\n        return\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 890,
        "y": 260,
        "wires": [
            [
                "3622bcff.2a3804"
            ]
        ]
    },
    {
        "id": "7667a581.6fb3fc",
        "type": "function",
        "z": "253eb64e.ce6faa",
        "name": "X0 parameters",
        "func": "msg.params = {\n    BASE_DEVICE_ID: 'bender',\n    ZONE: 'event',\n    CHANNEL_ID: 'X0',\n    EVENT_ID: 'emergency_stop',\n    INIT_VALUE: 0,\n    VALUE_TO_STATE : [\n        {\n            VALUE: 0,\n            STATE: 0\n        },\n        {\n            VALUE: 1,\n            STATE: 1\n        }\n    ]\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 440,
        "y": 200,
        "wires": [
            [
                "4d779976.fe98e8"
            ]
        ]
    },
    {
        "id": "4d779976.fe98e8",
        "type": "subflow:466fd2d0.e34c1c",
        "z": "253eb64e.ce6faa",
        "name": "",
        "x": 610,
        "y": 200,
        "wires": [
            []
        ]
    },
    {
        "id": "6dfe4cae.6edd34",
        "type": "function",
        "z": "253eb64e.ce6faa",
        "name": "X40 parameters",
        "func": "msg.params = {\n    BASE_DEVICE_ID: 'bender',\n    ZONE: 'event',\n    CHANNEL_ID: 'X40',\n    EVENT_ID: 'oil_pressure_motor_1_alarm',\n    INIT_VALUE: 0,\n    VALUE_TO_STATE : [\n        {\n            VALUE: 0,\n            STATE: 0\n        },\n        {\n            VALUE: 1,\n            STATE: 1\n        }\n    ]\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 440,
        "y": 240,
        "wires": [
            [
                "68df4891.443ad8"
            ]
        ]
    },
    {
        "id": "68df4891.443ad8",
        "type": "subflow:466fd2d0.e34c1c",
        "z": "253eb64e.ce6faa",
        "name": "",
        "x": 610,
        "y": 240,
        "wires": [
            []
        ]
    },
    {
        "id": "452de280.d49a7c",
        "type": "function",
        "z": "253eb64e.ce6faa",
        "name": "X41 parameters",
        "func": "msg.params = {\n    BASE_DEVICE_ID: 'bender',\n    ZONE: 'event',\n    CHANNEL_ID: 'X41',\n    EVENT_ID: 'oil_pressure_motor_2_alarm',\n    INIT_VALUE: 0,\n    VALUE_TO_STATE : [\n        {\n            VALUE: 0,\n            STATE: 0\n        },\n        {\n            VALUE: 1,\n            STATE: 1\n        }\n    ]\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 440,
        "y": 280,
        "wires": [
            [
                "fc2717a3.af2f98"
            ]
        ]
    },
    {
        "id": "fc2717a3.af2f98",
        "type": "subflow:466fd2d0.e34c1c",
        "z": "253eb64e.ce6faa",
        "name": "",
        "x": 610,
        "y": 280,
        "wires": [
            []
        ]
    },
    {
        "id": "845e227b.24b9a",
        "type": "function",
        "z": "253eb64e.ce6faa",
        "name": "X42 parameters",
        "func": "msg.params = {\n    BASE_DEVICE_ID: 'bender',\n    ZONE: 'event',\n    CHANNEL_ID: 'X42',\n    EVENT_ID: 'server_motor_alarm',\n    INIT_VALUE: 0,\n    VALUE_TO_STATE : [\n        {\n            VALUE: 0,\n            STATE: 0\n        },\n        {\n            VALUE: 1,\n            STATE: 1\n        }\n    ]\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 440,
        "y": 320,
        "wires": [
            [
                "73985c18.4f1344"
            ]
        ]
    },
    {
        "id": "73985c18.4f1344",
        "type": "subflow:466fd2d0.e34c1c",
        "z": "253eb64e.ce6faa",
        "name": "",
        "x": 610,
        "y": 320,
        "wires": [
            []
        ]
    },
    {
        "id": "b61b7484.04c6a8",
        "type": "subflow:253eb64e.ce6faa",
        "z": "8520e616.90ab98",
        "name": "",
        "env": [],
        "x": 680,
        "y": 160,
        "wires": [
            [
                "808b3ed9.fffe8"
            ]
        ]
    },
    {
        "id": "dbd31e3c.c4d56",
        "type": "qi-chameleon-source",
        "z": "8520e616.90ab98",
        "name": "",
        "deviceId": "bender_event",
        "x": 180,
        "y": 160,
        "wires": [
            [
                "b61b7484.04c6a8"
            ]
        ]
    },
    {
        "id": "aa120190.0aa9c",
        "type": "function",
        "z": "245f9bbf.17fc44",
        "name": "Y0 parameters",
        "func": "msg.params = {\n    BASE_DEVICE_ID: 'bender',\n    ZONE: 'working',\n    CHANNEL_ID: 'Y0',\n    EVENT_ID: 'Y0',\n    INIT_VALUE: 0,\n    VALUE_TO_STATE : [\n        {\n            VALUE: 0,\n            STATE: 0\n        },\n        {\n            VALUE: 1,\n            STATE: 1\n        }\n    ]\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 440,
        "y": 40,
        "wires": [
            [
                "2699b0af.8a95f"
            ]
        ]
    },
    {
        "id": "2699b0af.8a95f",
        "type": "subflow:466fd2d0.e34c1c",
        "z": "245f9bbf.17fc44",
        "name": "",
        "x": 610,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "8126101b.daa8d",
        "type": "function",
        "z": "245f9bbf.17fc44",
        "name": "Y01 parameters",
        "func": "msg.params = {\n    BASE_DEVICE_ID: 'bender',\n    ZONE: 'working',\n    CHANNEL_ID: 'Y01',\n    EVENT_ID: 'Y01',\n    INIT_VALUE: 0,\n    VALUE_TO_STATE : [\n        {\n            VALUE: 0,\n            STATE: 0\n        },\n        {\n            VALUE: 1,\n            STATE: 1\n        }\n    ]\n}\n\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "x": 440,
        "y": 80,
        "wires": [
            [
                "18a7d37f.17988d"
            ]
        ]
    },
    {
        "id": "18a7d37f.17988d",
        "type": "subflow:466fd2d0.e34c1c",
        "z": "245f9bbf.17fc44",
        "name": "",
        "x": 610,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "ae219a6f.9209f8",
        "type": "function",
        "z": "245f9bbf.17fc44",
        "name": "Y02 parameters",
        "func": "msg.params = {\n    BASE_DEVICE_ID: 'bender',\n    ZONE: 'working',\n    CHANNEL_ID: 'Y02',\n    EVENT_ID: 'Y02',\n    INIT_VALUE: 0,\n    VALUE_TO_STATE : [\n        {\n            VALUE: 0,\n            STATE: 0\n        },\n        {\n            VALUE: 1,\n            STATE: 1\n        }\n    ]\n}\n\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "x": 440,
        "y": 120,
        "wires": [
            [
                "eefb0ab1.0b3688"
            ]
        ]
    },
    {
        "id": "eefb0ab1.0b3688",
        "type": "subflow:466fd2d0.e34c1c",
        "z": "245f9bbf.17fc44",
        "name": "",
        "x": 610,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "60fbe8e.a40c418",
        "type": "function",
        "z": "245f9bbf.17fc44",
        "name": "Y03 parameters",
        "func": "msg.params = {\n    BASE_DEVICE_ID: 'bender',\n    ZONE: 'working',\n    CHANNEL_ID: 'Y03',\n    EVENT_ID: 'Y03',\n    INIT_VALUE: 0,\n    VALUE_TO_STATE : [\n        {\n            VALUE: 0,\n            STATE: 0\n        },\n        {\n            VALUE: 1,\n            STATE: 1\n        }\n    ]\n}\n\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "x": 440,
        "y": 160,
        "wires": [
            [
                "93f570f6.6f6bf"
            ]
        ]
    },
    {
        "id": "93f570f6.6f6bf",
        "type": "subflow:466fd2d0.e34c1c",
        "z": "245f9bbf.17fc44",
        "name": "",
        "x": 610,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "d37cbc8d.38f39",
        "type": "function",
        "z": "245f9bbf.17fc44",
        "name": "Y04 parameters",
        "func": "msg.params = {\n    BASE_DEVICE_ID: 'bender',\n    ZONE: 'working',\n    CHANNEL_ID: 'Y04',\n    EVENT_ID: 'Y04',\n    INIT_VALUE: 0,\n    VALUE_TO_STATE : [\n        {\n            VALUE: 0,\n            STATE: 0\n        },\n        {\n            VALUE: 1,\n            STATE: 1\n        }\n    ]\n}\n\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "x": 440,
        "y": 200,
        "wires": [
            [
                "a6d831cc.fce35"
            ]
        ]
    },
    {
        "id": "a6d831cc.fce35",
        "type": "subflow:466fd2d0.e34c1c",
        "z": "245f9bbf.17fc44",
        "name": "",
        "x": 610,
        "y": 200,
        "wires": [
            []
        ]
    },
    {
        "id": "8433afc.c6d745",
        "type": "function",
        "z": "245f9bbf.17fc44",
        "name": "Y05 parameters",
        "func": "msg.params = {\n    BASE_DEVICE_ID: 'bender',\n    ZONE: 'working',\n    CHANNEL_ID: 'Y05',\n    EVENT_ID: 'Y05',\n    INIT_VALUE: 0,\n    VALUE_TO_STATE : [\n        {\n            VALUE: 0,\n            STATE: 0\n        },\n        {\n            VALUE: 1,\n            STATE: 1\n        }\n    ]\n}\n\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "x": 440,
        "y": 240,
        "wires": [
            [
                "6400b595.d3d31c"
            ]
        ]
    },
    {
        "id": "6400b595.d3d31c",
        "type": "subflow:466fd2d0.e34c1c",
        "z": "245f9bbf.17fc44",
        "name": "",
        "x": 610,
        "y": 240,
        "wires": [
            []
        ]
    },
    {
        "id": "cbf5ec2.ed0fc1",
        "type": "function",
        "z": "245f9bbf.17fc44",
        "name": "Y10 parameters",
        "func": "msg.params = {\n    BASE_DEVICE_ID: 'bender',\n    ZONE: 'working',\n    CHANNEL_ID: 'Y10',\n    EVENT_ID: 'Y10',\n    INIT_VALUE: 0,\n    VALUE_TO_STATE : [\n        {\n            VALUE: 0,\n            STATE: 0\n        },\n        {\n            VALUE: 1,\n            STATE: 1\n        }\n    ]\n}\n\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "x": 440,
        "y": 280,
        "wires": [
            [
                "3c72b8aa.5e5c88"
            ]
        ]
    },
    {
        "id": "3c72b8aa.5e5c88",
        "type": "subflow:466fd2d0.e34c1c",
        "z": "245f9bbf.17fc44",
        "name": "",
        "x": 610,
        "y": 280,
        "wires": [
            []
        ]
    },
    {
        "id": "91a56943.3f8918",
        "type": "function",
        "z": "245f9bbf.17fc44",
        "name": "Y11 parameters",
        "func": "msg.params = {\n    BASE_DEVICE_ID: 'bender',\n    ZONE: 'working',\n    CHANNEL_ID: 'Y11',\n    EVENT_ID: 'Y11',\n    INIT_VALUE: 0,\n    VALUE_TO_STATE : [\n        {\n            VALUE: 0,\n            STATE: 0\n        },\n        {\n            VALUE: 1,\n            STATE: 1\n        }\n    ]\n}\n\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "x": 440,
        "y": 320,
        "wires": [
            [
                "46cd93d6.ed5c4c"
            ]
        ]
    },
    {
        "id": "46cd93d6.ed5c4c",
        "type": "subflow:466fd2d0.e34c1c",
        "z": "245f9bbf.17fc44",
        "name": "",
        "x": 610,
        "y": 320,
        "wires": [
            []
        ]
    },
    {
        "id": "8999acbe.58e16",
        "type": "function",
        "z": "245f9bbf.17fc44",
        "name": "Y12 parameters",
        "func": "msg.params = {\n    BASE_DEVICE_ID: 'bender',\n    ZONE: 'working',\n    CHANNEL_ID: 'Y12',\n    EVENT_ID: 'Y12',\n    INIT_VALUE: 0,\n    VALUE_TO_STATE : [\n        {\n            VALUE: 0,\n            STATE: 0\n        },\n        {\n            VALUE: 1,\n            STATE: 1\n        }\n    ]\n}\n\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "x": 440,
        "y": 360,
        "wires": [
            [
                "b9d9bced.61ee5"
            ]
        ]
    },
    {
        "id": "b9d9bced.61ee5",
        "type": "subflow:466fd2d0.e34c1c",
        "z": "245f9bbf.17fc44",
        "name": "",
        "x": 610,
        "y": 360,
        "wires": [
            []
        ]
    },
    {
        "id": "c197b1e3.eddbc",
        "type": "function",
        "z": "245f9bbf.17fc44",
        "name": "Y13 parameters",
        "func": "msg.params = {\n    BASE_DEVICE_ID: 'bender',\n    ZONE: 'working',\n    CHANNEL_ID: 'Y13',\n    EVENT_ID: 'Y13',\n    INIT_VALUE: 0,\n    VALUE_TO_STATE : [\n        {\n            VALUE: 0,\n            STATE: 0\n        },\n        {\n            VALUE: 1,\n            STATE: 1\n        }\n    ]\n}\n\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "x": 440,
        "y": 400,
        "wires": [
            [
                "a7adce5.5f6113"
            ]
        ]
    },
    {
        "id": "a7adce5.5f6113",
        "type": "subflow:466fd2d0.e34c1c",
        "z": "245f9bbf.17fc44",
        "name": "",
        "x": 610,
        "y": 400,
        "wires": [
            []
        ]
    },
    {
        "id": "278b3bd9.a4db14",
        "type": "function",
        "z": "245f9bbf.17fc44",
        "name": "Y14 parameters",
        "func": "msg.params = {\n    BASE_DEVICE_ID: 'bender',\n    ZONE: 'working',\n    CHANNEL_ID: 'Y14',\n    EVENT_ID: 'Y14',\n    INIT_VALUE: 0,\n    VALUE_TO_STATE : [\n        {\n            VALUE: 0,\n            STATE: 0\n        },\n        {\n            VALUE: 1,\n            STATE: 1\n        }\n    ]\n}\n\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "x": 440,
        "y": 440,
        "wires": [
            [
                "aa087b10.490d08"
            ]
        ]
    },
    {
        "id": "aa087b10.490d08",
        "type": "subflow:466fd2d0.e34c1c",
        "z": "245f9bbf.17fc44",
        "name": "",
        "x": 610,
        "y": 440,
        "wires": [
            []
        ]
    },
    {
        "id": "50033fbb.b06fc",
        "type": "function",
        "z": "245f9bbf.17fc44",
        "name": "Y15 parameters",
        "func": "msg.params = {\n    BASE_DEVICE_ID: 'bender',\n    ZONE: 'working',\n    CHANNEL_ID: 'Y15',\n    EVENT_ID: 'Y15',\n    INIT_VALUE: 0,\n    VALUE_TO_STATE : [\n        {\n            VALUE: 0,\n            STATE: 0\n        },\n        {\n            VALUE: 1,\n            STATE: 1\n        }\n    ]\n}\n\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "x": 440,
        "y": 480,
        "wires": [
            [
                "dc5a844c.c72148"
            ]
        ]
    },
    {
        "id": "dc5a844c.c72148",
        "type": "subflow:466fd2d0.e34c1c",
        "z": "245f9bbf.17fc44",
        "name": "",
        "x": 610,
        "y": 480,
        "wires": [
            []
        ]
    },
    {
        "id": "80a4921a.7a3b5",
        "type": "function",
        "z": "245f9bbf.17fc44",
        "name": "Y20 parameters",
        "func": "msg.params = {\n    BASE_DEVICE_ID: 'bender',\n    ZONE: 'working',\n    CHANNEL_ID: 'Y20',\n    EVENT_ID: 'Y20',\n    INIT_VALUE: 0,\n    VALUE_TO_STATE : [\n        {\n            VALUE: 0,\n            STATE: 0\n        },\n        {\n            VALUE: 1,\n            STATE: 1\n        }\n    ]\n}\n\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "x": 440,
        "y": 520,
        "wires": [
            [
                "3bf9bace.d30bc6"
            ]
        ]
    },
    {
        "id": "3bf9bace.d30bc6",
        "type": "subflow:466fd2d0.e34c1c",
        "z": "245f9bbf.17fc44",
        "name": "",
        "x": 610,
        "y": 520,
        "wires": [
            []
        ]
    },
    {
        "id": "c2adf2f4.1e611",
        "type": "function",
        "z": "245f9bbf.17fc44",
        "name": "Y21 parameters",
        "func": "msg.params = {\n    BASE_DEVICE_ID: 'bender',\n    ZONE: 'working',\n    CHANNEL_ID: 'Y21',\n    EVENT_ID: 'Y21',\n    INIT_VALUE: 0,\n    VALUE_TO_STATE : [\n        {\n            VALUE: 0,\n            STATE: 0\n        },\n        {\n            VALUE: 1,\n            STATE: 1\n        }\n    ]\n}\n\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "x": 440,
        "y": 560,
        "wires": [
            [
                "ce38e66f.0b6ca8"
            ]
        ]
    },
    {
        "id": "ce38e66f.0b6ca8",
        "type": "subflow:466fd2d0.e34c1c",
        "z": "245f9bbf.17fc44",
        "name": "",
        "x": 610,
        "y": 560,
        "wires": [
            []
        ]
    },
    {
        "id": "3970226c.90f0ee",
        "type": "function",
        "z": "245f9bbf.17fc44",
        "name": "Y26 parameters",
        "func": "msg.params = {\n    BASE_DEVICE_ID: 'bender',\n    ZONE: 'working',\n    CHANNEL_ID: 'Y26',\n    EVENT_ID: 'Y26',\n    INIT_VALUE: 0,\n    VALUE_TO_STATE : [\n        {\n            VALUE: 0,\n            STATE: 0\n        },\n        {\n            VALUE: 1,\n            STATE: 1\n        }\n    ]\n}\n\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "x": 440,
        "y": 600,
        "wires": [
            [
                "c746f260.5554a"
            ]
        ]
    },
    {
        "id": "c746f260.5554a",
        "type": "subflow:466fd2d0.e34c1c",
        "z": "245f9bbf.17fc44",
        "name": "",
        "x": 610,
        "y": 600,
        "wires": [
            []
        ]
    },
    {
        "id": "c2f94479.dcdd68",
        "type": "function",
        "z": "245f9bbf.17fc44",
        "name": "Y34 parameters",
        "func": "msg.params = {\n    BASE_DEVICE_ID: 'bender',\n    ZONE: 'working',\n    CHANNEL_ID: 'Y34',\n    EVENT_ID: 'Y34',\n    INIT_VALUE: 0,\n    VALUE_TO_STATE : [\n        {\n            VALUE: 0,\n            STATE: 0\n        },\n        {\n            VALUE: 1,\n            STATE: 1\n        }\n    ]\n}\n\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "x": 440,
        "y": 640,
        "wires": [
            [
                "ae58c758.208e78"
            ]
        ]
    },
    {
        "id": "ae58c758.208e78",
        "type": "subflow:466fd2d0.e34c1c",
        "z": "245f9bbf.17fc44",
        "name": "",
        "x": 610,
        "y": 640,
        "wires": [
            []
        ]
    },
    {
        "id": "6c15a001.fc15",
        "type": "function",
        "z": "245f9bbf.17fc44",
        "name": "Y35 parameters",
        "func": "msg.params = {\n    BASE_DEVICE_ID: 'bender',\n    ZONE: 'working',\n    CHANNEL_ID: 'Y35',\n    EVENT_ID: 'Y35',\n    INIT_VALUE: 0,\n    VALUE_TO_STATE : [\n        {\n            VALUE: 0,\n            STATE: 0\n        },\n        {\n            VALUE: 1,\n            STATE: 1\n        }\n    ]\n}\n\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "x": 440,
        "y": 680,
        "wires": [
            [
                "e977ce56.8c18a"
            ]
        ]
    },
    {
        "id": "e977ce56.8c18a",
        "type": "subflow:466fd2d0.e34c1c",
        "z": "245f9bbf.17fc44",
        "name": "",
        "x": 610,
        "y": 680,
        "wires": [
            []
        ]
    },
    {
        "id": "307aff6b.012c6",
        "type": "function",
        "z": "245f9bbf.17fc44",
        "name": "Y40 parameters",
        "func": "msg.params = {\n    BASE_DEVICE_ID: 'bender',\n    ZONE: 'working',\n    CHANNEL_ID: 'Y40',\n    EVENT_ID: 'Y40',\n    INIT_VALUE: 0,\n    VALUE_TO_STATE : [\n        {\n            VALUE: 0,\n            STATE: 0\n        },\n        {\n            VALUE: 1,\n            STATE: 1\n        }\n    ]\n}\n\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "x": 440,
        "y": 720,
        "wires": [
            [
                "efc7746d.a48c38"
            ]
        ]
    },
    {
        "id": "efc7746d.a48c38",
        "type": "subflow:466fd2d0.e34c1c",
        "z": "245f9bbf.17fc44",
        "name": "",
        "x": 610,
        "y": 720,
        "wires": [
            []
        ]
    },
    {
        "id": "8a7f48ab.fad948",
        "type": "function",
        "z": "245f9bbf.17fc44",
        "name": "Y41 parameters",
        "func": "msg.params = {\n    BASE_DEVICE_ID: 'bender',\n    ZONE: 'working',\n    CHANNEL_ID: 'Y41',\n    EVENT_ID: 'Y41',\n    INIT_VALUE: 0,\n    VALUE_TO_STATE : [\n        {\n            VALUE: 0,\n            STATE: 0\n        },\n        {\n            VALUE: 1,\n            STATE: 1\n        }\n    ]\n}\n\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "x": 440,
        "y": 760,
        "wires": [
            [
                "2b5dac9e.9fe794"
            ]
        ]
    },
    {
        "id": "2b5dac9e.9fe794",
        "type": "subflow:466fd2d0.e34c1c",
        "z": "245f9bbf.17fc44",
        "name": "",
        "x": 610,
        "y": 760,
        "wires": [
            []
        ]
    },
    {
        "id": "f04b64a2.e354a8",
        "type": "subflow:245f9bbf.17fc44",
        "z": "d01ff20d.5cea7",
        "name": "",
        "x": 580,
        "y": 160,
        "wires": [
            [
                "549d523.058d6ac"
            ]
        ]
    },
    {
        "id": "b21d9a1.63d6768",
        "type": "delay",
        "z": "f9c24c90.68012",
        "name": "",
        "pauseType": "delay",
        "timeout": "40",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 540,
        "y": 160,
        "wires": [
            [
                "63faf3cb.ace6bc"
            ]
        ]
    },
    {
        "id": "8adb7ae3.d89928",
        "type": "function",
        "z": "82e4d436.d46858",
        "name": "generate working code",
        "func": "const CHANNEL_WORKING_CODE = flow.get('CHANNEL_WORKING_CODE')\n\nlet working_code_table = {}\nfor (var channel in CHANNEL_WORKING_CODE)\n{\n    const codes = CHANNEL_WORKING_CODE[channel]\n    \n    working_code_table[channel] = {}\n    for (var index in codes)\n    {\n        const value = codes[index].VALUE\n        const code = codes[index].CODE\n        \n        working_code_table[channel][value] = code\n    }\n}\n\nconst db_payload = msg.payload\n\nlet working_code_list = []\n\nfor (var i = 0; i < db_payload.length; ++i)\n{\n    row = db_payload[i]\n    \n    time = row.time\n    delete row.time\n    \n    for (var channel_ in row)\n    {\n        const channel_id = channel_\n        const value = row[channel_id]\n        \n        if (value === null)\n        {\n            continue\n        }\n        \n        if (!working_code_table.hasOwnProperty(channel_id))\n        {\n            node.error(channel_id + ' not defined')\n            continue\n        }\n        \n        const code = working_code_table[channel_id]\n        if (!code.hasOwnProperty(value))\n        {\n            node.error(channel_id + ': ' + value + ' not defined')\n            continue\n        }\n        \n        working_code_list.push(\n            {\n                time: time,\n                code: code[value]\n            }\n        )\n    }\n}\n\nmsg.working_code_list = working_code_list\n\nreturn msg;\n\n``` db\n[\n    {\n        time: xxxx,\n        Y0: 1,\n        Y01: 0,\n        ........\n    }\n]\n\n```\n\n\n``` params\n{\n  Y0: [\n      {\n          VALUE: 1,\n          CODE: 1\n      },\n      {\n          VALUE: 0,\n          CODE: 2\n      }\n  ]\n}\n```",
        "outputs": 1,
        "noerr": 0,
        "x": 480,
        "y": 240,
        "wires": [
            [
                "78b1ecec.0b7a94"
            ]
        ]
    },
    {
        "id": "47da2d8c.f9c1f4",
        "type": "qi-forward-on-match",
        "z": "466fd2d0.e34c1c",
        "name": "filter power_on channel",
        "schema": "{\"$schema\":\"http://json-schema.org/draft-07/schema#\",\"type\":\"object\",\"required\":[\"deviceId\",\"at\",\"channels\"],\"properties\":{\"deviceId\":{\"type\":\"string\"},\"at\":{\"type\":\"object\",\"required\":[\"sec\",\"us\"],\"properties\":{\"sec\":{\"type\":\"integer\",\"minimum\":0},\"us\":{\"type\":\"integer\",\"minimum\":0,\"maximum\":999999}}},\"channels\":{\"type\":\"object\",\"required\":[\"power_on\"],\"properties\":{\"power_on\":{\"type\":\"number\",\"minimum\":0,\"maximum\":0}}}}}",
        "schemaType": "json",
        "removeAdditional": true,
        "x": 450,
        "y": 300,
        "wires": [
            [
                "e7f9b.1e8e4066"
            ]
        ]
    },
    {
        "id": "e7f9b.1e8e4066",
        "type": "function",
        "z": "466fd2d0.e34c1c",
        "name": "clear",
        "func": "const DEVICE_ID = flow.get('BASE_DEVICE_ID')\nconst CHANNEL_ID = flow.get('CHANNEL_ID')\nconst INIT_VALUE = flow.get('INIT_VALUE')\n\nconst at = msg.payload.at\n\nlet channels = {}\nchannels[CHANNEL_ID] = INIT_VALUE\n\nmsg.payload = {\n    deviceId: DEVICE_ID,\n    at: at,\n    channels: channels\n}\n\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "x": 650,
        "y": 300,
        "wires": [
            [
                "76ca6f24.19954"
            ]
        ]
    },
    {
        "id": "f6a70162.f03a3",
        "type": "qi-chameleon-source",
        "z": "d01ff20d.5cea7",
        "name": "",
        "deviceId": "bender_event",
        "x": 260,
        "y": 160,
        "wires": [
            [
                "f04b64a2.e354a8"
            ]
        ]
    },
    {
        "id": "6f683f34.130d",
        "type": "qi-chameleon-source",
        "z": "6635bf50.0f505",
        "name": "",
        "deviceId": "welder",
        "x": 150,
        "y": 300,
        "wires": [
            [
                "6108b535.0ee71c"
            ]
        ]
    },
    {
        "id": "6108b535.0ee71c",
        "type": "subflow:1d3a3270.3d399e",
        "z": "6635bf50.0f505",
        "name": "",
        "x": 440,
        "y": 300,
        "wires": [
            [
                "c70a8fa.a1b647"
            ]
        ]
    },
    {
        "id": "c70a8fa.a1b647",
        "type": "function",
        "z": "6635bf50.0f505",
        "name": "parameters",
        "func": "msg.params = {\n    DEVICE_ID: 'welder_event'\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 410,
        "y": 340,
        "wires": [
            [
                "49b9464a.392128"
            ]
        ]
    },
    {
        "id": "49b9464a.392128",
        "type": "subflow:54efa582.10a04c",
        "z": "6635bf50.0f505",
        "name": "",
        "x": 450,
        "y": 380,
        "wires": [
            [
                "f5028b61.a18bb8"
            ]
        ]
    },
    {
        "id": "f5028b61.a18bb8",
        "type": "qi-chameleon-sink",
        "z": "6635bf50.0f505",
        "name": "",
        "x": 420,
        "y": 420,
        "wires": []
    },
    {
        "id": "b37a7a1f.d05828",
        "type": "qi-chameleon-source",
        "z": "d01ff20d.5cea7",
        "name": "",
        "deviceId": "welder",
        "x": 230,
        "y": 300,
        "wires": [
            [
                "3c9968f6.86dbc8"
            ]
        ]
    },
    {
        "id": "3c9968f6.86dbc8",
        "type": "subflow:1d3a3270.3d399e",
        "z": "d01ff20d.5cea7",
        "name": "",
        "x": 600,
        "y": 300,
        "wires": [
            [
                "ebb0e84e.9ca368"
            ]
        ]
    },
    {
        "id": "f5682ef5.218f9",
        "type": "qi-chameleon-source",
        "z": "d01ff20d.5cea7",
        "name": "",
        "deviceId": "welder_event",
        "x": 260,
        "y": 360,
        "wires": [
            [
                "ebb0e84e.9ca368"
            ]
        ]
    },
    {
        "id": "5aafd727.633be8",
        "type": "function",
        "z": "a473bc4c.73399",
        "name": "Y21 parameters",
        "func": "msg.params = {\n    BASE_DEVICE_ID: 'welder',\n    ZONE: 'working',\n    CHANNEL_ID: 'Y21',\n    EVENT_ID: 'Y21',\n    INIT_VALUE: 0,\n    VALUE_TO_STATE : [\n        {\n            VALUE: 0,\n            STATE: 0\n        },\n        {\n            VALUE: 1,\n            STATE: 1\n        }\n    ]\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 440,
        "y": 180,
        "wires": [
            [
                "15041376.72768d"
            ]
        ]
    },
    {
        "id": "15041376.72768d",
        "type": "subflow:466fd2d0.e34c1c",
        "z": "a473bc4c.73399",
        "name": "",
        "x": 610,
        "y": 180,
        "wires": [
            []
        ]
    },
    {
        "id": "9005c9bf.cc4ea8",
        "type": "function",
        "z": "a473bc4c.73399",
        "name": "D81 parameters",
        "func": "msg.params = {\n    BASE_DEVICE_ID: 'welder',\n    ZONE: 'working',\n    CHANNEL_ID: 'D81',\n    EVENT_ID: 'D81',\n    INIT_VALUE: 0,\n    VALUE_TO_STATE : [\n        {\n            VALUE: 11,\n            STATE: 0\n        },\n        {\n            VALUE: 1,\n            STATE: 1\n        }\n    ]\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 440,
        "y": 220,
        "wires": [
            [
                "5cf16db4.84fa44"
            ]
        ]
    },
    {
        "id": "5cf16db4.84fa44",
        "type": "subflow:466fd2d0.e34c1c",
        "z": "a473bc4c.73399",
        "name": "",
        "x": 610,
        "y": 220,
        "wires": [
            []
        ]
    },
    {
        "id": "ebb0e84e.9ca368",
        "type": "subflow:a473bc4c.73399",
        "z": "d01ff20d.5cea7",
        "name": "",
        "x": 580,
        "y": 360,
        "wires": [
            [
                "14054547.7530fb"
            ]
        ]
    },
    {
        "id": "14054547.7530fb",
        "type": "qi-chameleon-sink",
        "z": "d01ff20d.5cea7",
        "name": "",
        "x": 580,
        "y": 400,
        "wires": []
    },
    {
        "id": "ba477e8c.2b113",
        "type": "qi-chameleon-source",
        "z": "8520e616.90ab98",
        "name": "",
        "deviceId": "welder",
        "x": 150,
        "y": 280,
        "wires": [
            [
                "c01404dc.ecbc28"
            ]
        ]
    },
    {
        "id": "c01404dc.ecbc28",
        "type": "subflow:1d3a3270.3d399e",
        "z": "8520e616.90ab98",
        "name": "",
        "x": 440,
        "y": 280,
        "wires": [
            [
                "2fd448e8.13d7b8"
            ]
        ]
    },
    {
        "id": "6c3e502d.6df07",
        "type": "qi-chameleon-source",
        "z": "8520e616.90ab98",
        "name": "",
        "deviceId": "welder_event",
        "x": 180,
        "y": 340,
        "wires": [
            [
                "2fd448e8.13d7b8"
            ]
        ]
    },
    {
        "id": "a0f0081a.1325b8",
        "type": "function",
        "z": "d09079cb.f16838",
        "name": "X4 parameters",
        "func": "msg.params = {\n    BASE_DEVICE_ID: 'welder',\n    ZONE: 'event',\n    CHANNEL_ID: 'X4',\n    EVENT_ID: 'emergency_stop',\n    INIT_VALUE: 0,\n    VALUE_TO_STATE : [\n        {\n            VALUE: 0,\n            STATE: 0\n        },\n        {\n            VALUE: 1,\n            STATE: 1\n        }\n    ]\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 440,
        "y": 140,
        "wires": [
            [
                "fb2ffc6f.c8542"
            ]
        ]
    },
    {
        "id": "fb2ffc6f.c8542",
        "type": "subflow:466fd2d0.e34c1c",
        "z": "d09079cb.f16838",
        "name": "",
        "x": 630,
        "y": 140,
        "wires": [
            []
        ]
    },
    {
        "id": "ddbd470c.e78008",
        "type": "function",
        "z": "d09079cb.f16838",
        "name": "X24 parameters",
        "func": "msg.params = {\n    BASE_DEVICE_ID: 'welder',\n    ZONE: 'event',\n    CHANNEL_ID: 'X24',\n    EVENT_ID: 'x_axis_alarm',\n    INIT_VALUE: 0,\n    VALUE_TO_STATE : [\n        {\n            VALUE: 0,\n            STATE: 0\n        },\n        {\n            VALUE: 1,\n            STATE: 1\n        }\n    ]\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 440,
        "y": 180,
        "wires": [
            [
                "a0715b0e.2774c8"
            ]
        ]
    },
    {
        "id": "a0715b0e.2774c8",
        "type": "subflow:466fd2d0.e34c1c",
        "z": "d09079cb.f16838",
        "name": "",
        "x": 630,
        "y": 180,
        "wires": [
            []
        ]
    },
    {
        "id": "96dd17d6.8b8d18",
        "type": "function",
        "z": "d09079cb.f16838",
        "name": "X26 parameters",
        "func": "msg.params = {\n    BASE_DEVICE_ID: 'welder',\n    ZONE: 'event',\n    CHANNEL_ID: 'X26',\n    EVENT_ID: 'a_welder_alarm',\n    INIT_VALUE: 0,\n    VALUE_TO_STATE : [\n        {\n            VALUE: 0,\n            STATE: 0\n        },\n        {\n            VALUE: 1,\n            STATE: 1\n        }\n    ]\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 440,
        "y": 220,
        "wires": [
            [
                "943a9945.996338"
            ]
        ]
    },
    {
        "id": "943a9945.996338",
        "type": "subflow:466fd2d0.e34c1c",
        "z": "d09079cb.f16838",
        "name": "",
        "x": 630,
        "y": 220,
        "wires": [
            []
        ]
    },
    {
        "id": "36bcd669.7ff67a",
        "type": "function",
        "z": "d09079cb.f16838",
        "name": "X30 parameters",
        "func": "msg.params = {\n    BASE_DEVICE_ID: 'welder',\n    ZONE: 'event',\n    CHANNEL_ID: 'X30',\n    EVENT_ID: 'b_welder_alarm',\n    INIT_VALUE: 0,\n    VALUE_TO_STATE : [\n        {\n            VALUE: 0,\n            STATE: 0\n        },\n        {\n            VALUE: 1,\n            STATE: 1\n        }\n    ]\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 440,
        "y": 260,
        "wires": [
            [
                "32e7cb21.90c2b4"
            ]
        ]
    },
    {
        "id": "32e7cb21.90c2b4",
        "type": "subflow:466fd2d0.e34c1c",
        "z": "d09079cb.f16838",
        "name": "",
        "x": 630,
        "y": 260,
        "wires": [
            []
        ]
    },
    {
        "id": "5dd930b3.a6868",
        "type": "function",
        "z": "d09079cb.f16838",
        "name": "X32 parameters",
        "func": "msg.params = {\n    BASE_DEVICE_ID: 'welder',\n    ZONE: 'event',\n    CHANNEL_ID: 'X32',\n    EVENT_ID: 'c_welder_alarm',\n    INIT_VALUE: 0,\n    VALUE_TO_STATE : [\n        {\n            VALUE: 0,\n            STATE: 0\n        },\n        {\n            VALUE: 1,\n            STATE: 1\n        }\n    ]\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 440,
        "y": 300,
        "wires": [
            [
                "5fcc1662.85e8d8"
            ]
        ]
    },
    {
        "id": "5fcc1662.85e8d8",
        "type": "subflow:466fd2d0.e34c1c",
        "z": "d09079cb.f16838",
        "name": "",
        "x": 630,
        "y": 300,
        "wires": [
            []
        ]
    },
    {
        "id": "a3d06343.e6b8b",
        "type": "function",
        "z": "d09079cb.f16838",
        "name": "Y32 parameters",
        "func": "msg.params = {\n    BASE_DEVICE_ID: 'welder',\n    ZONE: 'event',\n    CHANNEL_ID: 'Y32',\n    EVENT_ID: 'gyr_r_light',\n    INIT_VALUE: 0,\n    VALUE_TO_STATE : [\n        {\n            VALUE: 0,\n            STATE: 0\n        },\n        {\n            VALUE: 1,\n            STATE: 1\n        }\n    ]\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 440,
        "y": 340,
        "wires": [
            [
                "a2a3d8bd.dd0398"
            ]
        ]
    },
    {
        "id": "a2a3d8bd.dd0398",
        "type": "subflow:466fd2d0.e34c1c",
        "z": "d09079cb.f16838",
        "name": "",
        "x": 630,
        "y": 340,
        "wires": [
            []
        ]
    },
    {
        "id": "579cccae.8752b4",
        "type": "function",
        "z": "d09079cb.f16838",
        "name": "Y33 parameters",
        "func": "msg.params = {\n    BASE_DEVICE_ID: 'welder',\n    ZONE: 'event',\n    CHANNEL_ID: 'Y33',\n    EVENT_ID: 'gyr_y_light',\n    INIT_VALUE: 0,\n    VALUE_TO_STATE : [\n        {\n            VALUE: 0,\n            STATE: 0\n        },\n        {\n            VALUE: 1,\n            STATE: 1\n        }\n    ]\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 440,
        "y": 380,
        "wires": [
            [
                "116335c9.a7536a"
            ]
        ]
    },
    {
        "id": "116335c9.a7536a",
        "type": "subflow:466fd2d0.e34c1c",
        "z": "d09079cb.f16838",
        "name": "",
        "x": 630,
        "y": 380,
        "wires": [
            []
        ]
    },
    {
        "id": "87655783.adb5d8",
        "type": "function",
        "z": "d09079cb.f16838",
        "name": "Y34 parameters",
        "func": "msg.params = {\n    BASE_DEVICE_ID: 'welder',\n    ZONE: 'event',\n    CHANNEL_ID: 'Y34',\n    EVENT_ID: 'gyr_g_light',\n    INIT_VALUE: 0,\n    VALUE_TO_STATE : [\n        {\n            VALUE: 0,\n            STATE: 0\n        },\n        {\n            VALUE: 1,\n            STATE: 1\n        }\n    ]\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 440,
        "y": 420,
        "wires": [
            [
                "154b4f07.858181"
            ]
        ]
    },
    {
        "id": "154b4f07.858181",
        "type": "subflow:466fd2d0.e34c1c",
        "z": "d09079cb.f16838",
        "name": "",
        "x": 630,
        "y": 420,
        "wires": [
            []
        ]
    },
    {
        "id": "aa0af670.9f44c8",
        "type": "function",
        "z": "d09079cb.f16838",
        "name": "Y37 parameters",
        "func": "msg.params = {\n    BASE_DEVICE_ID: 'welder',\n    ZONE: 'event',\n    CHANNEL_ID: 'Y37',\n    EVENT_ID: 'alarm_reset',\n    INIT_VALUE: 0,\n    VALUE_TO_STATE : [\n        {\n            VALUE: 0,\n            STATE: 0\n        },\n        {\n            VALUE: 1,\n            STATE: 1\n        }\n    ]\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 440,
        "y": 460,
        "wires": [
            [
                "f67f4692.86c188"
            ]
        ]
    },
    {
        "id": "f67f4692.86c188",
        "type": "subflow:466fd2d0.e34c1c",
        "z": "d09079cb.f16838",
        "name": "",
        "x": 630,
        "y": 460,
        "wires": [
            []
        ]
    },
    {
        "id": "2fd448e8.13d7b8",
        "type": "subflow:d09079cb.f16838",
        "z": "8520e616.90ab98",
        "name": "",
        "x": 670,
        "y": 340,
        "wires": [
            [
                "5b4b7706.64dfd8"
            ]
        ]
    },
    {
        "id": "5b4b7706.64dfd8",
        "type": "qi-chameleon-sink",
        "z": "8520e616.90ab98",
        "name": "",
        "x": 900,
        "y": 340,
        "wires": []
    },
    {
        "id": "7514c603.a272a8",
        "type": "qi-chameleon-source",
        "z": "f9c24c90.68012",
        "name": "",
        "deviceId": "welder_working",
        "x": 240,
        "y": 460,
        "wires": [
            [
                "d741a5f2.64c5d8",
                "5c73ccc5.67b6d4"
            ]
        ]
    },
    {
        "id": "d741a5f2.64c5d8",
        "type": "switch",
        "z": "f9c24c90.68012",
        "name": "forward working start",
        "property": "payload.channels.Y21",
        "propertyType": "msg",
        "rules": [
            {
                "v": "1",
                "t": "eq",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 540,
        "y": 460,
        "wires": [
            [
                "7948bdb6.c1d5f4"
            ]
        ]
    },
    {
        "id": "7948bdb6.c1d5f4",
        "type": "function",
        "z": "f9c24c90.68012",
        "name": "working start",
        "func": "const DEVICE_ID = 'welder_event'\n\nconst at = msg.payload.at\n\nmsg.payload = {\n    deviceId: DEVICE_ID,\n    at: at,\n    channels: {\n        working: 1\n    }\n}\n\nreturn msg\n",
        "outputs": 1,
        "noerr": 0,
        "x": 750,
        "y": 460,
        "wires": [
            [
                "4b5283cb.6c469c"
            ]
        ]
    },
    {
        "id": "4b5283cb.6c469c",
        "type": "qi-chameleon-sink",
        "z": "f9c24c90.68012",
        "name": "",
        "x": 980,
        "y": 600,
        "wires": []
    },
    {
        "id": "30682c05.b3ae94",
        "type": "function",
        "z": "f9c24c90.68012",
        "name": "parameters",
        "func": "const since = msg.args.lastWorkingStopAt\n\nmsg.params = {\n    BASE_DEVICE_ID: 'welder',\n    QUERY_SINCE: since,\n    CHANNEL_WORKING_CODE: {\n        Y21: [\n            {\n                VALUE: 1,\n                CODE: 1\n            },\n            {\n                VALUE: 0,\n                CODE: 2\n            }\n        ],\n        D81: [\n            {\n                VALUE: 1,\n                CODE: 3\n            },\n            {\n                VALUE: 0,\n                CODE: 4\n            }\n        ]\n    },\n    PATTERNS: [1, 3, 4, 2]\n}           \n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "x": 370,
        "y": 780,
        "wires": [
            [
                "8d1487ec.cf16d8"
            ]
        ]
    },
    {
        "id": "8d1487ec.cf16d8",
        "type": "subflow:82e4d436.d46858",
        "z": "f9c24c90.68012",
        "name": "",
        "x": 390,
        "y": 820,
        "wires": [
            [
                "4b5283cb.6c469c",
                "561cc2b9.14d6dc"
            ]
        ]
    },
    {
        "id": "a3f7a63d.72aee8",
        "type": "function",
        "z": "d09079cb.f16838",
        "name": "R401 parameters",
        "func": "msg.params = {\n    BASE_DEVICE_ID: 'welder',\n    ZONE: 'event',\n    CHANNEL_ID: 'R401',\n    EVENT_ID: 'part_no',\n    INIT_VALUE: 99, // For tag first data when power on\n    VALUE_TO_STATE : [\n        {\n            VALUE: 1,\n            STATE: 1\n        },\n        {\n            VALUE: 2,\n            STATE: 2\n        }\n    ]\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 450,
        "y": 100,
        "wires": [
            [
                "7146a6bf.d9d9b8"
            ]
        ]
    },
    {
        "id": "7146a6bf.d9d9b8",
        "type": "subflow:466fd2d0.e34c1c",
        "z": "d09079cb.f16838",
        "name": "",
        "x": 630,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "32fb0fc1.61d0f",
        "type": "inject",
        "z": "f9c24c90.68012",
        "name": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "60",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 190,
        "y": 580,
        "wires": [
            [
                "456cf40e.5d8c4c"
            ]
        ]
    },
    {
        "id": "456cf40e.5d8c4c",
        "type": "qi-interval-boundary",
        "z": "f9c24c90.68012",
        "name": "",
        "timezone": "local",
        "intervalDuration": "86400",
        "shiftInterval": "0",
        "x": 390,
        "y": 580,
        "wires": [
            [
                "9e3ec1d3.b3c4c"
            ]
        ]
    },
    {
        "id": "9e3ec1d3.b3c4c",
        "type": "function",
        "z": "f9c24c90.68012",
        "name": "args.since",
        "func": "msg.args = {\n    since: msg.payload.begin\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 390,
        "y": 620,
        "wires": [
            [
                "564ee91a.e313a8"
            ]
        ]
    },
    {
        "id": "564ee91a.e313a8",
        "type": "function",
        "z": "f9c24c90.68012",
        "name": "query last working stop timestamp",
        "func": "msg.query = `\n    SELECT working\n    FROM welder_event\n    WHERE working = 0\n    ORDER BY DESC\n    limit 1\n`\n\n// node.error(msg.query)\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "x": 440,
        "y": 660,
        "wires": [
            [
                "f733187e.8f7618"
            ]
        ]
    },
    {
        "id": "f733187e.8f7618",
        "type": "qi-query-history",
        "z": "f9c24c90.68012",
        "name": "",
        "query": "",
        "x": 400,
        "y": 700,
        "wires": [
            [
                "c922ded0.f5db8"
            ]
        ]
    },
    {
        "id": "c922ded0.f5db8",
        "type": "function",
        "z": "f9c24c90.68012",
        "name": "args.lastWorkingStopAt",
        "func": "const result = msg.payload\nconst since = msg.args.since\n\nlet lastWorkingStopAt = since\nif (result.length !== 0) {\n    lastWorkingStopAt = msg.payload[0].time\n    // lastWorkingStopAt.setMilliseconds(lastWorkingStopAt.getMilliseconds() + 1)\n}\n\nmsg.args.lastWorkingStopAt = lastWorkingStopAt\n\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "x": 430,
        "y": 740,
        "wires": [
            [
                "30682c05.b3ae94"
            ]
        ]
    },
    {
        "id": "5c73ccc5.67b6d4",
        "type": "switch",
        "z": "f9c24c90.68012",
        "name": "forward welding start",
        "property": "payload.channels.D81",
        "propertyType": "msg",
        "rules": [
            {
                "v": "1",
                "t": "eq",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 540,
        "y": 500,
        "wires": [
            [
                "4614e1a7.455d3"
            ]
        ]
    },
    {
        "id": "4614e1a7.455d3",
        "type": "function",
        "z": "f9c24c90.68012",
        "name": "welding start",
        "func": "const DEVICE_ID = 'welder_event'\n\nconst at = msg.payload.at\n\nmsg.payload = {\n    deviceId: DEVICE_ID,\n    at: at,\n    channels: {\n        welding_start: 1\n    }\n}\n\nreturn msg\n",
        "outputs": 1,
        "noerr": 0,
        "x": 750,
        "y": 500,
        "wires": [
            [
                "4b5283cb.6c469c"
            ]
        ]
    },
    {
        "id": "5e6003f.fc5aefc",
        "type": "qi-chameleon-source",
        "z": "6635bf50.0f505",
        "name": "",
        "deviceId": "manual_bender",
        "x": 180,
        "y": 520,
        "wires": [
            [
                "fbd64170.4d2be"
            ]
        ]
    },
    {
        "id": "fbd64170.4d2be",
        "type": "subflow:1d3a3270.3d399e",
        "z": "6635bf50.0f505",
        "name": "",
        "x": 460,
        "y": 520,
        "wires": [
            [
                "5e984d41.f24e04"
            ]
        ]
    },
    {
        "id": "5e984d41.f24e04",
        "type": "function",
        "z": "6635bf50.0f505",
        "name": "parameters",
        "func": "msg.params = {\n    DEVICE_ID: 'manual_bender_event'\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 430,
        "y": 560,
        "wires": [
            [
                "1f118575.a0a65b"
            ]
        ]
    },
    {
        "id": "1f118575.a0a65b",
        "type": "subflow:54efa582.10a04c",
        "z": "6635bf50.0f505",
        "name": "",
        "x": 470,
        "y": 600,
        "wires": [
            [
                "d8abcd32.6b9fb"
            ]
        ]
    },
    {
        "id": "d8abcd32.6b9fb",
        "type": "qi-chameleon-sink",
        "z": "6635bf50.0f505",
        "name": "",
        "x": 440,
        "y": 640,
        "wires": []
    },
    {
        "id": "623d074b.ac1cb8",
        "type": "qi-chameleon-source",
        "z": "8520e616.90ab98",
        "name": "",
        "deviceId": "manual_bender",
        "x": 180,
        "y": 480,
        "wires": [
            [
                "be1d988f.a59148"
            ]
        ]
    },
    {
        "id": "9b913442.73b598",
        "type": "qi-chameleon-source",
        "z": "8520e616.90ab98",
        "name": "",
        "deviceId": "manual_bender_event",
        "x": 200,
        "y": 540,
        "wires": [
            [
                "9c6acb8b.e9a388"
            ]
        ]
    },
    {
        "id": "be1d988f.a59148",
        "type": "subflow:1d3a3270.3d399e",
        "z": "8520e616.90ab98",
        "name": "",
        "x": 460,
        "y": 480,
        "wires": [
            [
                "9c6acb8b.e9a388"
            ]
        ]
    },
    {
        "id": "26a33007.38791",
        "type": "qi-chameleon-sink",
        "z": "8520e616.90ab98",
        "name": "",
        "x": 900,
        "y": 540,
        "wires": []
    },
    {
        "id": "a1cf6c73.4141e",
        "type": "function",
        "z": "1bec181a.2f61b8",
        "name": "X0 parameters",
        "func": "msg.params = {\n    BASE_DEVICE_ID: 'manual_bender',\n    ZONE: 'event',\n    CHANNEL_ID: 'X0',\n    EVENT_ID: 'emergency_stop',\n    INIT_VALUE: 0,\n    VALUE_TO_STATE : [\n        {\n            VALUE: 0,\n            STATE: 0\n        },\n        {\n            VALUE: 1,\n            STATE: 1\n        }\n    ]\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 520,
        "y": 220,
        "wires": [
            [
                "aad10e5b.cf525"
            ]
        ]
    },
    {
        "id": "aad10e5b.cf525",
        "type": "subflow:466fd2d0.e34c1c",
        "z": "1bec181a.2f61b8",
        "name": "",
        "x": 690,
        "y": 220,
        "wires": [
            []
        ]
    },
    {
        "id": "252ffc5d.3e07a4",
        "type": "function",
        "z": "1bec181a.2f61b8",
        "name": "X1 parameters",
        "func": "msg.params = {\n    BASE_DEVICE_ID: 'manual_bender',\n    ZONE: 'event',\n    CHANNEL_ID: 'X1',\n    EVENT_ID: 'manual_auto',\n    INIT_VALUE: 0,\n    VALUE_TO_STATE : [\n        {\n            VALUE: 0,\n            STATE: 0\n        },\n        {\n            VALUE: 1,\n            STATE: 1\n        }\n    ]\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 520,
        "y": 260,
        "wires": [
            [
                "9335b1b8.83128"
            ]
        ]
    },
    {
        "id": "9335b1b8.83128",
        "type": "subflow:466fd2d0.e34c1c",
        "z": "1bec181a.2f61b8",
        "name": "",
        "x": 690,
        "y": 260,
        "wires": [
            []
        ]
    },
    {
        "id": "aa97ba19.b82168",
        "type": "function",
        "z": "1bec181a.2f61b8",
        "name": "X25 parameters",
        "func": "msg.params = {\n    BASE_DEVICE_ID: 'manual_bender',\n    ZONE: 'event',\n    CHANNEL_ID: 'X25',\n    EVENT_ID: 'oil_pressure_motor_alarm',\n    INIT_VALUE: 0,\n    VALUE_TO_STATE : [\n        {\n            VALUE: 0,\n            STATE: 0\n        },\n        {\n            VALUE: 1,\n            STATE: 1\n        }\n    ]\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 520,
        "y": 300,
        "wires": [
            [
                "29780e22.8abae2"
            ]
        ]
    },
    {
        "id": "29780e22.8abae2",
        "type": "subflow:466fd2d0.e34c1c",
        "z": "1bec181a.2f61b8",
        "name": "",
        "x": 690,
        "y": 300,
        "wires": [
            []
        ]
    },
    {
        "id": "d86f80b7.287b6",
        "type": "function",
        "z": "1bec181a.2f61b8",
        "name": "X26 parameters",
        "func": "msg.params = {\n    BASE_DEVICE_ID: 'manual_bender',\n    ZONE: 'event',\n    CHANNEL_ID: 'X26',\n    EVENT_ID: 'server_motor_alarm',\n    INIT_VALUE: 0,\n    VALUE_TO_STATE : [\n        {\n            VALUE: 0,\n            STATE: 0\n        },\n        {\n            VALUE: 1,\n            STATE: 1\n        }\n    ]\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 520,
        "y": 340,
        "wires": [
            [
                "81c660e2.21673"
            ]
        ]
    },
    {
        "id": "81c660e2.21673",
        "type": "subflow:466fd2d0.e34c1c",
        "z": "1bec181a.2f61b8",
        "name": "",
        "x": 690,
        "y": 340,
        "wires": [
            []
        ]
    },
    {
        "id": "9c6acb8b.e9a388",
        "type": "subflow:1bec181a.2f61b8",
        "z": "8520e616.90ab98",
        "name": "",
        "x": 680,
        "y": 540,
        "wires": [
            [
                "26a33007.38791"
            ]
        ]
    },
    {
        "id": "f4ab4bd2.1b3148",
        "type": "qi-chameleon-source",
        "z": "d01ff20d.5cea7",
        "name": "",
        "deviceId": "manual_bender",
        "x": 260,
        "y": 500,
        "wires": [
            [
                "6a4b9ced.800c94"
            ]
        ]
    },
    {
        "id": "e895f500.bfec08",
        "type": "qi-chameleon-source",
        "z": "d01ff20d.5cea7",
        "name": "",
        "deviceId": "manual_bender_event",
        "x": 280,
        "y": 560,
        "wires": [
            [
                "c75384c0.ab3778"
            ]
        ]
    },
    {
        "id": "6a4b9ced.800c94",
        "type": "subflow:1d3a3270.3d399e",
        "z": "d01ff20d.5cea7",
        "name": "",
        "x": 600,
        "y": 500,
        "wires": [
            [
                "c75384c0.ab3778"
            ]
        ]
    },
    {
        "id": "b78c506a.ed659",
        "type": "qi-chameleon-sink",
        "z": "d01ff20d.5cea7",
        "name": "",
        "x": 580,
        "y": 600,
        "wires": []
    },
    {
        "id": "84e8eeb2.d9b1",
        "type": "function",
        "z": "8974067.04364f8",
        "name": "Y0 parameters",
        "func": "msg.params = {\n    BASE_DEVICE_ID: 'manual_bender',\n    ZONE: 'working',\n    CHANNEL_ID: 'Y0',\n    EVENT_ID: 'Y0',\n    INIT_VALUE: 0,\n    VALUE_TO_STATE : [\n        {\n            VALUE: 0,\n            STATE: 0\n        },\n        {\n            VALUE: 1,\n            STATE: 1\n        }\n    ]\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 600,
        "y": 80,
        "wires": [
            [
                "b571c71.5c1f538"
            ]
        ]
    },
    {
        "id": "b571c71.5c1f538",
        "type": "subflow:466fd2d0.e34c1c",
        "z": "8974067.04364f8",
        "name": "",
        "x": 770,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "c11d269d.8409d8",
        "type": "function",
        "z": "8974067.04364f8",
        "name": "Y1 parameters",
        "func": "msg.params = {\n    BASE_DEVICE_ID: 'manual_bender',\n    ZONE: 'working',\n    CHANNEL_ID: 'Y1',\n    EVENT_ID: 'Y1',\n    INIT_VALUE: 0,\n    VALUE_TO_STATE : [\n        {\n            VALUE: 0,\n            STATE: 0\n        },\n        {\n            VALUE: 1,\n            STATE: 1\n        }\n    ]\n}\n\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "x": 600,
        "y": 120,
        "wires": [
            [
                "a246d81.d240828"
            ]
        ]
    },
    {
        "id": "a246d81.d240828",
        "type": "subflow:466fd2d0.e34c1c",
        "z": "8974067.04364f8",
        "name": "",
        "x": 770,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "df66e228.e0327",
        "type": "function",
        "z": "8974067.04364f8",
        "name": "Y2 parameters",
        "func": "msg.params = {\n    BASE_DEVICE_ID: 'manual_bender',\n    ZONE: 'working',\n    CHANNEL_ID: 'Y2',\n    EVENT_ID: 'Y2',\n    INIT_VALUE: 0,\n    VALUE_TO_STATE : [\n        {\n            VALUE: 0,\n            STATE: 0\n        },\n        {\n            VALUE: 1,\n            STATE: 1\n        }\n    ]\n}\n\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "x": 600,
        "y": 160,
        "wires": [
            [
                "d861081a.6f7938"
            ]
        ]
    },
    {
        "id": "d861081a.6f7938",
        "type": "subflow:466fd2d0.e34c1c",
        "z": "8974067.04364f8",
        "name": "",
        "x": 770,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "606a48cf.7ad848",
        "type": "function",
        "z": "8974067.04364f8",
        "name": "Y3 parameters",
        "func": "msg.params = {\n    BASE_DEVICE_ID: 'manual_bender',\n    ZONE: 'working',\n    CHANNEL_ID: 'Y3',\n    EVENT_ID: 'Y3',\n    INIT_VALUE: 0,\n    VALUE_TO_STATE : [\n        {\n            VALUE: 0,\n            STATE: 0\n        },\n        {\n            VALUE: 1,\n            STATE: 1\n        }\n    ]\n}\n\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "x": 600,
        "y": 200,
        "wires": [
            [
                "47cf2c00.409f34"
            ]
        ]
    },
    {
        "id": "47cf2c00.409f34",
        "type": "subflow:466fd2d0.e34c1c",
        "z": "8974067.04364f8",
        "name": "",
        "x": 770,
        "y": 200,
        "wires": [
            []
        ]
    },
    {
        "id": "9de5bf74.e3b94",
        "type": "function",
        "z": "8974067.04364f8",
        "name": "Y4 parameters",
        "func": "msg.params = {\n    BASE_DEVICE_ID: 'manual_bender',\n    ZONE: 'working',\n    CHANNEL_ID: 'Y4',\n    EVENT_ID: 'Y4',\n    INIT_VALUE: 0,\n    VALUE_TO_STATE : [\n        {\n            VALUE: 0,\n            STATE: 0\n        },\n        {\n            VALUE: 1,\n            STATE: 1\n        }\n    ]\n}\n\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "x": 600,
        "y": 240,
        "wires": [
            [
                "886018a5.0d6218"
            ]
        ]
    },
    {
        "id": "886018a5.0d6218",
        "type": "subflow:466fd2d0.e34c1c",
        "z": "8974067.04364f8",
        "name": "",
        "x": 770,
        "y": 240,
        "wires": [
            []
        ]
    },
    {
        "id": "51798c8a.a6c9e4",
        "type": "function",
        "z": "8974067.04364f8",
        "name": "Y5 parameters",
        "func": "msg.params = {\n    BASE_DEVICE_ID: 'manual_bender',\n    ZONE: 'working',\n    CHANNEL_ID: 'Y5',\n    EVENT_ID: 'Y5',\n    INIT_VALUE: 0,\n    VALUE_TO_STATE : [\n        {\n            VALUE: 0,\n            STATE: 0\n        },\n        {\n            VALUE: 1,\n            STATE: 1\n        }\n    ]\n}\n\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "x": 600,
        "y": 280,
        "wires": [
            [
                "a0cb24f4.04ed58"
            ]
        ]
    },
    {
        "id": "a0cb24f4.04ed58",
        "type": "subflow:466fd2d0.e34c1c",
        "z": "8974067.04364f8",
        "name": "",
        "x": 770,
        "y": 280,
        "wires": [
            []
        ]
    },
    {
        "id": "6441ab2c.82b594",
        "type": "function",
        "z": "8974067.04364f8",
        "name": "Y6 parameters",
        "func": "msg.params = {\n    BASE_DEVICE_ID: 'manual_bender',\n    ZONE: 'working',\n    CHANNEL_ID: 'Y6',\n    EVENT_ID: 'Y6',\n    INIT_VALUE: 0,\n    VALUE_TO_STATE : [\n        {\n            VALUE: 0,\n            STATE: 0\n        },\n        {\n            VALUE: 1,\n            STATE: 1\n        }\n    ]\n}\n\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "x": 600,
        "y": 320,
        "wires": [
            [
                "c3df5e0e.e787b"
            ]
        ]
    },
    {
        "id": "c3df5e0e.e787b",
        "type": "subflow:466fd2d0.e34c1c",
        "z": "8974067.04364f8",
        "name": "",
        "x": 770,
        "y": 320,
        "wires": [
            []
        ]
    },
    {
        "id": "6212738b.b7982c",
        "type": "function",
        "z": "8974067.04364f8",
        "name": "Y20 parameters",
        "func": "msg.params = {\n    BASE_DEVICE_ID: 'manual_bender',\n    ZONE: 'working',\n    CHANNEL_ID: 'Y20',\n    EVENT_ID: 'Y20',\n    INIT_VALUE: 0,\n    VALUE_TO_STATE : [\n        {\n            VALUE: 0,\n            STATE: 0\n        },\n        {\n            VALUE: 1,\n            STATE: 1\n        }\n    ]\n}\n\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "x": 600,
        "y": 360,
        "wires": [
            [
                "381a0b34.76d284"
            ]
        ]
    },
    {
        "id": "381a0b34.76d284",
        "type": "subflow:466fd2d0.e34c1c",
        "z": "8974067.04364f8",
        "name": "",
        "x": 770,
        "y": 360,
        "wires": [
            []
        ]
    },
    {
        "id": "eff7db6c.0f25d8",
        "type": "function",
        "z": "8974067.04364f8",
        "name": "Y21 parameters",
        "func": "msg.params = {\n    BASE_DEVICE_ID: 'manual_bender',\n    ZONE: 'working',\n    CHANNEL_ID: 'Y21',\n    EVENT_ID: 'Y21',\n    INIT_VALUE: 0,\n    VALUE_TO_STATE : [\n        {\n            VALUE: 0,\n            STATE: 0\n        },\n        {\n            VALUE: 1,\n            STATE: 1\n        }\n    ]\n}\n\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "x": 600,
        "y": 400,
        "wires": [
            [
                "4d721d35.f1db24"
            ]
        ]
    },
    {
        "id": "4d721d35.f1db24",
        "type": "subflow:466fd2d0.e34c1c",
        "z": "8974067.04364f8",
        "name": "",
        "x": 770,
        "y": 400,
        "wires": [
            []
        ]
    },
    {
        "id": "2002bf05.ee4d5",
        "type": "function",
        "z": "8974067.04364f8",
        "name": "Y26 parameters",
        "func": "msg.params = {\n    BASE_DEVICE_ID: 'manual_bender',\n    ZONE: 'working',\n    CHANNEL_ID: 'Y26',\n    EVENT_ID: 'Y26',\n    INIT_VALUE: 0,\n    VALUE_TO_STATE : [\n        {\n            VALUE: 0,\n            STATE: 0\n        },\n        {\n            VALUE: 1,\n            STATE: 1\n        }\n    ]\n}\n\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "x": 600,
        "y": 440,
        "wires": [
            [
                "87682dd4.aa0a7"
            ]
        ]
    },
    {
        "id": "87682dd4.aa0a7",
        "type": "subflow:466fd2d0.e34c1c",
        "z": "8974067.04364f8",
        "name": "",
        "x": 770,
        "y": 440,
        "wires": [
            []
        ]
    },
    {
        "id": "c75384c0.ab3778",
        "type": "subflow:8974067.04364f8",
        "z": "d01ff20d.5cea7",
        "name": "",
        "x": 600,
        "y": 560,
        "wires": [
            [
                "b78c506a.ed659"
            ]
        ]
    },
    {
        "id": "f2bb0b65.0e49a8",
        "type": "qi-chameleon-source",
        "z": "f9c24c90.68012",
        "name": "",
        "deviceId": "manual_bender_working",
        "x": 270,
        "y": 1040,
        "wires": [
            [
                "6bdee8bd.011cb8"
            ]
        ]
    },
    {
        "id": "6bdee8bd.011cb8",
        "type": "switch",
        "z": "f9c24c90.68012",
        "name": "forward working start",
        "property": "payload.channels.Y1",
        "propertyType": "msg",
        "rules": [
            {
                "v": "1",
                "t": "eq",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 580,
        "y": 1040,
        "wires": [
            [
                "45eed1b9.d10ec"
            ]
        ]
    },
    {
        "id": "45eed1b9.d10ec",
        "type": "function",
        "z": "f9c24c90.68012",
        "name": "working start",
        "func": "// const DEVICE_ID = flow.get('DEVICE_ID')\nconst DEVICE_ID = 'manual_bender_event'\n\nconst at = msg.payload.at\n\nmsg.payload = {\n    deviceId: DEVICE_ID,\n    at: {\n        \"sec\": at.sec,\n        \"us\": at.us + 1000 // avoid manual bender working start timestamp = previous working stop timestamp\n    },\n    channels: {\n        working: 1\n    }\n}\n\nreturn msg\n",
        "outputs": 1,
        "noerr": 0,
        "x": 570,
        "y": 1080,
        "wires": [
            [
                "3dacb427.fb879c",
                "3db2ed2d.4b5d82"
            ]
        ]
    },
    {
        "id": "3dacb427.fb879c",
        "type": "delay",
        "z": "f9c24c90.68012",
        "name": "",
        "pauseType": "delay",
        "timeout": "15",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 580,
        "y": 1120,
        "wires": [
            [
                "9eb807ce.5604e8"
            ]
        ]
    },
    {
        "id": "9eb807ce.5604e8",
        "type": "function",
        "z": "f9c24c90.68012",
        "name": "parameters",
        "func": "const at = msg.payload.at\n\nconst since = new Date(at.sec * 1000 + (at.us - 1000) / 1000) // revert at.us\n\nmsg.params = {\n    BASE_DEVICE_ID: 'manual_bender',\n    QUERY_SINCE: since,\n    CHANNEL_WORKING_CODE: {\n        Y0: [\n            {\n                VALUE: 1,\n                CODE: 1\n            },\n            {\n                VALUE: 0,\n                CODE: 2\n            }\n        ],\n        Y1: [\n            {\n                VALUE: 1,\n                CODE: 3\n            },\n            {\n                VALUE: 0,\n                CODE: 4\n            }\n        ],\n        Y2: [\n            {\n                VALUE: 1,\n                CODE: 5\n            },\n            {\n                VALUE: 0,\n                CODE: 6\n            }\n        ],\n        Y3: [\n            {\n                VALUE: 1,\n                CODE: 7\n            },\n            {\n                VALUE: 0,\n                CODE: 8\n            }\n        ],\n        Y4: [\n            {\n                VALUE: 1,\n                CODE: 9\n            },\n            {\n                VALUE: 0,\n                CODE: 10\n            }\n        ],\n        Y5: [\n            {\n                VALUE: 1,\n                CODE: 11\n            },\n            {\n                VALUE: 0,\n                CODE: 12\n            }\n        ],\n        Y6: [\n            {\n                VALUE: 1,\n                CODE: 13\n            },\n            {\n                VALUE: 0,\n                CODE: 14\n            }\n        ],\n        Y20: [\n            {\n                VALUE: 1,\n                CODE: 15\n            },\n            {\n                VALUE: 0,\n                CODE: 16\n            }\n        ],\n        Y21: [\n            {\n                VALUE: 1,\n                CODE: 17\n            },\n            {\n                VALUE: 0,\n                CODE: 18\n            }\n        ],\n        Y26: [\n            {\n                VALUE: 1,\n                CODE: 19\n            },\n            {\n                VALUE: 0,\n                CODE: 20\n            }\n        ]\n    },\n    // PATTERNS: [3, 4, 12, 11, 12, 1, 2]\n    // PATTERNS: [3, 4, 12, 15, 7, 9, 16, 8, 10, 6, 18, 12, 1, 11, 2]\n    // PATTERNS: [3, 4, 12, 11, 12, 11, 1, 2]\n    PATTERNS: [3, 4, 12, 7, 11, 8, 10, 6, 12, 1, 11, 2]\n}\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "x": 610,
        "y": 1160,
        "wires": [
            [
                "354e372d.805c98"
            ]
        ]
    },
    {
        "id": "354e372d.805c98",
        "type": "subflow:82e4d436.d46858",
        "z": "f9c24c90.68012",
        "name": "",
        "x": 630,
        "y": 1200,
        "wires": [
            [
                "3db2ed2d.4b5d82",
                "2e1047f0.4699b8"
            ]
        ]
    },
    {
        "id": "3db2ed2d.4b5d82",
        "type": "qi-chameleon-sink",
        "z": "f9c24c90.68012",
        "name": "",
        "x": 860,
        "y": 1080,
        "wires": []
    },
    {
        "id": "6d4bc2cc.00edac",
        "type": "qi-chameleon-source",
        "z": "6635bf50.0f505",
        "name": "",
        "deviceId": "stamping_press_106",
        "x": 200,
        "y": 740,
        "wires": [
            [
                "fa6bcb55.2b2dd8"
            ]
        ]
    },
    {
        "id": "fa6bcb55.2b2dd8",
        "type": "subflow:1d3a3270.3d399e",
        "z": "6635bf50.0f505",
        "name": "",
        "x": 500,
        "y": 740,
        "wires": [
            [
                "13a22709.f12849"
            ]
        ]
    },
    {
        "id": "13a22709.f12849",
        "type": "function",
        "z": "6635bf50.0f505",
        "name": "parameters",
        "func": "msg.params = {\n    DEVICE_ID: 'stamping_press_106_event'\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 470,
        "y": 780,
        "wires": [
            [
                "b1981ab0.f16bf8"
            ]
        ]
    },
    {
        "id": "b1981ab0.f16bf8",
        "type": "subflow:54efa582.10a04c",
        "z": "6635bf50.0f505",
        "name": "",
        "x": 510,
        "y": 820,
        "wires": [
            [
                "c9132ad6.897988"
            ]
        ]
    },
    {
        "id": "c9132ad6.897988",
        "type": "qi-chameleon-sink",
        "z": "6635bf50.0f505",
        "name": "",
        "x": 480,
        "y": 860,
        "wires": []
    },
    {
        "id": "d21f2955.562b58",
        "type": "qi-chameleon-source",
        "z": "6635bf50.0f505",
        "name": "",
        "deviceId": "stamping_press_107",
        "x": 200,
        "y": 940,
        "wires": [
            [
                "24be0480.3f568c"
            ]
        ]
    },
    {
        "id": "24be0480.3f568c",
        "type": "subflow:1d3a3270.3d399e",
        "z": "6635bf50.0f505",
        "name": "",
        "x": 500,
        "y": 940,
        "wires": [
            [
                "74ed2505.23f9bc"
            ]
        ]
    },
    {
        "id": "74ed2505.23f9bc",
        "type": "function",
        "z": "6635bf50.0f505",
        "name": "parameters",
        "func": "msg.params = {\n    DEVICE_ID: 'stamping_press_107_event'\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 470,
        "y": 980,
        "wires": [
            [
                "d33f8707.05dd08"
            ]
        ]
    },
    {
        "id": "d33f8707.05dd08",
        "type": "subflow:54efa582.10a04c",
        "z": "6635bf50.0f505",
        "name": "",
        "x": 510,
        "y": 1020,
        "wires": [
            [
                "59ff8bfd.00f4b4"
            ]
        ]
    },
    {
        "id": "59ff8bfd.00f4b4",
        "type": "qi-chameleon-sink",
        "z": "6635bf50.0f505",
        "name": "",
        "x": 480,
        "y": 1060,
        "wires": []
    },
    {
        "id": "5d6b2faf.f9611",
        "type": "qi-chameleon-source",
        "z": "6635bf50.0f505",
        "name": "",
        "deviceId": "stamping_press_108",
        "x": 200,
        "y": 1140,
        "wires": [
            [
                "39cc9c7b.76a844"
            ]
        ]
    },
    {
        "id": "39cc9c7b.76a844",
        "type": "subflow:1d3a3270.3d399e",
        "z": "6635bf50.0f505",
        "name": "",
        "x": 500,
        "y": 1140,
        "wires": [
            [
                "4610ac46.284ae4"
            ]
        ]
    },
    {
        "id": "4610ac46.284ae4",
        "type": "function",
        "z": "6635bf50.0f505",
        "name": "parameters",
        "func": "msg.params = {\n    DEVICE_ID: 'stamping_press_108_event'\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 470,
        "y": 1180,
        "wires": [
            [
                "8cdffde6.7b044"
            ]
        ]
    },
    {
        "id": "8cdffde6.7b044",
        "type": "subflow:54efa582.10a04c",
        "z": "6635bf50.0f505",
        "name": "",
        "x": 510,
        "y": 1220,
        "wires": [
            [
                "6a7bad41.feb794"
            ]
        ]
    },
    {
        "id": "6a7bad41.feb794",
        "type": "qi-chameleon-sink",
        "z": "6635bf50.0f505",
        "name": "",
        "x": 480,
        "y": 1260,
        "wires": []
    },
    {
        "id": "f900863f.504b18",
        "type": "qi-chameleon-source",
        "z": "6635bf50.0f505",
        "name": "",
        "deviceId": "stamping_press_109",
        "x": 200,
        "y": 1340,
        "wires": [
            [
                "f417139.64e60f"
            ]
        ]
    },
    {
        "id": "f417139.64e60f",
        "type": "subflow:1d3a3270.3d399e",
        "z": "6635bf50.0f505",
        "name": "",
        "x": 500,
        "y": 1340,
        "wires": [
            [
                "7831dd1d.687094"
            ]
        ]
    },
    {
        "id": "7831dd1d.687094",
        "type": "function",
        "z": "6635bf50.0f505",
        "name": "parameters",
        "func": "msg.params = {\n    DEVICE_ID: 'stamping_press_109_event'\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 470,
        "y": 1380,
        "wires": [
            [
                "43060e69.aa2dc"
            ]
        ]
    },
    {
        "id": "43060e69.aa2dc",
        "type": "subflow:54efa582.10a04c",
        "z": "6635bf50.0f505",
        "name": "",
        "x": 510,
        "y": 1420,
        "wires": [
            [
                "2e3bf82a.ea31a8"
            ]
        ]
    },
    {
        "id": "2e3bf82a.ea31a8",
        "type": "qi-chameleon-sink",
        "z": "6635bf50.0f505",
        "name": "",
        "x": 480,
        "y": 1460,
        "wires": []
    },
    {
        "id": "e8ae650b.3e9d48",
        "type": "function",
        "z": "94b1b7f9.82aa68",
        "name": "X1 parameters",
        "func": "const MACHINE_ID = flow.get('MACHINE_ID')\nconst base_device_id = 'stamping_press_' + MACHINE_ID\n\nmsg.params = {\n    BASE_DEVICE_ID: base_device_id,\n    ZONE: 'event',\n    CHANNEL_ID: 'X1',\n    EVENT_ID: 'second_fall_detect',\n    INIT_VALUE: 0,\n    VALUE_TO_STATE : [\n        {\n            VALUE: 0,\n            STATE: 0\n        },\n        {\n            VALUE: 1,\n            STATE: 1\n        }\n    ]\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 480,
        "y": 120,
        "wires": [
            [
                "7677584.ddb02a8"
            ]
        ]
    },
    {
        "id": "7677584.ddb02a8",
        "type": "subflow:466fd2d0.e34c1c",
        "z": "94b1b7f9.82aa68",
        "name": "",
        "x": 650,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "b37cfcb9.b7baa",
        "type": "function",
        "z": "94b1b7f9.82aa68",
        "name": "X2 parameters",
        "func": "const MACHINE_ID = flow.get('MACHINE_ID')\nconst base_device_id = 'stamping_press_' + MACHINE_ID\n\nmsg.params = {\n    BASE_DEVICE_ID: base_device_id,\n    ZONE: 'event',\n    CHANNEL_ID: 'X2',\n    EVENT_ID: 'safety_chain_detect',\n    INIT_VALUE: 0,\n    VALUE_TO_STATE : [\n        {\n            VALUE: 0,\n            STATE: 0\n        },\n        {\n            VALUE: 1,\n            STATE: 1\n        }\n    ]\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 480,
        "y": 160,
        "wires": [
            [
                "86259a64.f66d58"
            ]
        ]
    },
    {
        "id": "86259a64.f66d58",
        "type": "subflow:466fd2d0.e34c1c",
        "z": "94b1b7f9.82aa68",
        "name": "",
        "x": 650,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "ea9009bf.a85bc8",
        "type": "subflow:466fd2d0.e34c1c",
        "z": "94b1b7f9.82aa68",
        "name": "",
        "x": 650,
        "y": 200,
        "wires": [
            []
        ]
    },
    {
        "id": "11af36fb.237749",
        "type": "function",
        "z": "94b1b7f9.82aa68",
        "name": "X3 parameters",
        "func": "const MACHINE_ID = flow.get('MACHINE_ID')\nconst base_device_id = 'stamping_press_' + MACHINE_ID\n\nmsg.params = {\n    BASE_DEVICE_ID: base_device_id,\n    ZONE: 'event',\n    CHANNEL_ID: 'X3',\n    EVENT_ID: 'overloading',\n    INIT_VALUE: 0,\n    VALUE_TO_STATE : [\n        {\n            VALUE: 0,\n            STATE: 0\n        },\n        {\n            VALUE: 1,\n            STATE: 1\n        }\n    ]\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 480,
        "y": 200,
        "wires": [
            [
                "ea9009bf.a85bc8"
            ]
        ]
    },
    {
        "id": "9b6003ff.cb948",
        "type": "function",
        "z": "94b1b7f9.82aa68",
        "name": "X12 parameters",
        "func": "const MACHINE_ID = flow.get('MACHINE_ID')\nconst base_device_id = 'stamping_press_' + MACHINE_ID\n\nmsg.params = {\n    BASE_DEVICE_ID: base_device_id,\n    ZONE: 'event',\n    CHANNEL_ID: 'X12',\n    EVENT_ID: 'interlocking_stop_button',\n    INIT_VALUE: 0,\n    VALUE_TO_STATE : [\n        {\n            VALUE: 0,\n            STATE: 0\n        },\n        {\n            VALUE: 1,\n            STATE: 1\n        }\n    ]\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 480,
        "y": 240,
        "wires": [
            [
                "41043533.b9035c"
            ]
        ]
    },
    {
        "id": "41043533.b9035c",
        "type": "subflow:466fd2d0.e34c1c",
        "z": "94b1b7f9.82aa68",
        "name": "",
        "x": 650,
        "y": 240,
        "wires": [
            []
        ]
    },
    {
        "id": "45039f3f.8a86",
        "type": "function",
        "z": "94b1b7f9.82aa68",
        "name": "X14 parameters",
        "func": "const MACHINE_ID = flow.get('MACHINE_ID')\nconst base_device_id = 'stamping_press_' + MACHINE_ID\n\nmsg.params = {\n    BASE_DEVICE_ID: base_device_id,\n    ZONE: 'event',\n    CHANNEL_ID: 'X14',\n    EVENT_ID: 'alarm_reset',\n    INIT_VALUE: 0,\n    VALUE_TO_STATE : [\n        {\n            VALUE: 0,\n            STATE: 0\n        },\n        {\n            VALUE: 1,\n            STATE: 1\n        }\n    ]\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 480,
        "y": 280,
        "wires": [
            [
                "a03a9b48.da2c08"
            ]
        ]
    },
    {
        "id": "a03a9b48.da2c08",
        "type": "subflow:466fd2d0.e34c1c",
        "z": "94b1b7f9.82aa68",
        "name": "",
        "x": 650,
        "y": 280,
        "wires": [
            []
        ]
    },
    {
        "id": "b349a2ad.2e5f3",
        "type": "function",
        "z": "94b1b7f9.82aa68",
        "name": "X15 parameters",
        "func": "const MACHINE_ID = flow.get('MACHINE_ID')\nconst base_device_id = 'stamping_press_' + MACHINE_ID\n\nmsg.params = {\n    BASE_DEVICE_ID: base_device_id,\n    ZONE: 'event',\n    CHANNEL_ID: 'X15',\n    EVENT_ID: 'air_pressure_detect',\n    INIT_VALUE: 0,\n    VALUE_TO_STATE : [\n        {\n            VALUE: 0,\n            STATE: 0\n        },\n        {\n            VALUE: 1,\n            STATE: 1\n        }\n    ]\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 480,
        "y": 320,
        "wires": [
            [
                "a77b7f68.6922b"
            ]
        ]
    },
    {
        "id": "a77b7f68.6922b",
        "type": "subflow:466fd2d0.e34c1c",
        "z": "94b1b7f9.82aa68",
        "name": "",
        "x": 650,
        "y": 320,
        "wires": [
            []
        ]
    },
    {
        "id": "2b83de80.368f32",
        "type": "function",
        "z": "94b1b7f9.82aa68",
        "name": "X21 parameters",
        "func": "const MACHINE_ID = flow.get('MACHINE_ID')\nconst base_device_id = 'stamping_press_' + MACHINE_ID\n\nmsg.params = {\n    BASE_DEVICE_ID: base_device_id,\n    ZONE: 'event',\n    CHANNEL_ID: 'X21',\n    EVENT_ID: 'emergency_stop',\n    INIT_VALUE: 0,\n    VALUE_TO_STATE : [\n        {\n            VALUE: 0,\n            STATE: 0\n        },\n        {\n            VALUE: 1,\n            STATE: 1\n        }\n    ]\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 480,
        "y": 360,
        "wires": [
            [
                "aeb4c244.e9958"
            ]
        ]
    },
    {
        "id": "aeb4c244.e9958",
        "type": "subflow:466fd2d0.e34c1c",
        "z": "94b1b7f9.82aa68",
        "name": "",
        "x": 650,
        "y": 360,
        "wires": [
            []
        ]
    },
    {
        "id": "cca88893.7303a8",
        "type": "function",
        "z": "94b1b7f9.82aa68",
        "name": "X25 parameters",
        "func": "const MACHINE_ID = flow.get('MACHINE_ID')\nconst base_device_id = 'stamping_press_' + MACHINE_ID\n\nmsg.params = {\n    BASE_DEVICE_ID: base_device_id,\n    ZONE: 'event',\n    CHANNEL_ID: 'X25',\n    EVENT_ID: 'lubricating_detect',\n    INIT_VALUE: 0,\n    VALUE_TO_STATE : [\n        {\n            VALUE: 0,\n            STATE: 0\n        },\n        {\n            VALUE: 1,\n            STATE: 1\n        }\n    ]\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 480,
        "y": 400,
        "wires": [
            [
                "d6aea369.8f026"
            ]
        ]
    },
    {
        "id": "d6aea369.8f026",
        "type": "subflow:466fd2d0.e34c1c",
        "z": "94b1b7f9.82aa68",
        "name": "",
        "x": 650,
        "y": 400,
        "wires": [
            []
        ]
    },
    {
        "id": "9b324f02.cda14",
        "type": "function",
        "z": "94b1b7f9.82aa68",
        "name": "X30 parameters",
        "func": "const MACHINE_ID = flow.get('MACHINE_ID')\nconst base_device_id = 'stamping_press_' + MACHINE_ID\n\nmsg.params = {\n    BASE_DEVICE_ID: base_device_id,\n    ZONE: 'event',\n    CHANNEL_ID: 'X30',\n    EVENT_ID: 'double_valve_detect',\n    INIT_VALUE: 0,\n    VALUE_TO_STATE : [\n        {\n            VALUE: 0,\n            STATE: 0\n        },\n        {\n            VALUE: 1,\n            STATE: 1\n        }\n    ]\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 480,
        "y": 440,
        "wires": [
            [
                "2e51d2c8.6bdeae"
            ]
        ]
    },
    {
        "id": "2e51d2c8.6bdeae",
        "type": "subflow:466fd2d0.e34c1c",
        "z": "94b1b7f9.82aa68",
        "name": "",
        "x": 650,
        "y": 440,
        "wires": [
            []
        ]
    },
    {
        "id": "1327934d.7580cd",
        "type": "function",
        "z": "94b1b7f9.82aa68",
        "name": "X37 parameters",
        "func": "const MACHINE_ID = flow.get('MACHINE_ID')\nconst base_device_id = 'stamping_press_' + MACHINE_ID\n\nmsg.params = {\n    BASE_DEVICE_ID: base_device_id,\n    ZONE: 'event',\n    CHANNEL_ID: 'X37',\n    EVENT_ID: 'flywheel_brake_detect',\n    INIT_VALUE: 0,\n    VALUE_TO_STATE : [\n        {\n            VALUE: 0,\n            STATE: 0\n        },\n        {\n            VALUE: 1,\n            STATE: 1\n        }\n    ]\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 480,
        "y": 480,
        "wires": [
            [
                "36c1ec18.38a454"
            ]
        ]
    },
    {
        "id": "36c1ec18.38a454",
        "type": "subflow:466fd2d0.e34c1c",
        "z": "94b1b7f9.82aa68",
        "name": "",
        "x": 650,
        "y": 480,
        "wires": [
            []
        ]
    },
    {
        "id": "1247de70.311fb2",
        "type": "function",
        "z": "94b1b7f9.82aa68",
        "name": "X62 parameters",
        "func": "const MACHINE_ID = flow.get('MACHINE_ID')\nconst base_device_id = 'stamping_press_' + MACHINE_ID\n\nmsg.params = {\n    BASE_DEVICE_ID: base_device_id,\n    ZONE: 'event',\n    CHANNEL_ID: 'X62',\n    EVENT_ID: 'interlocking_motor_alarm',\n    INIT_VALUE: 0,\n    VALUE_TO_STATE : [\n        {\n            VALUE: 0,\n            STATE: 0\n        },\n        {\n            VALUE: 1,\n            STATE: 1\n        }\n    ]\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 480,
        "y": 520,
        "wires": [
            [
                "5cc514f1.29a47c"
            ]
        ]
    },
    {
        "id": "5cc514f1.29a47c",
        "type": "subflow:466fd2d0.e34c1c",
        "z": "94b1b7f9.82aa68",
        "name": "",
        "x": 650,
        "y": 520,
        "wires": [
            []
        ]
    },
    {
        "id": "579afa32.d894f4",
        "type": "function",
        "z": "94b1b7f9.82aa68",
        "name": "X65 parameters",
        "func": "const MACHINE_ID = flow.get('MACHINE_ID')\nconst base_device_id = 'stamping_press_' + MACHINE_ID\n\nmsg.params = {\n    BASE_DEVICE_ID: base_device_id,\n    ZONE: 'event',\n    CHANNEL_ID: 'X65',\n    EVENT_ID: 'engine_oil_interlocking_detect',\n    INIT_VALUE: 0,\n    VALUE_TO_STATE : [\n        {\n            VALUE: 0,\n            STATE: 0\n        },\n        {\n            VALUE: 1,\n            STATE: 1\n        }\n    ]\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 480,
        "y": 560,
        "wires": [
            [
                "9aca4923.907a68"
            ]
        ]
    },
    {
        "id": "9aca4923.907a68",
        "type": "subflow:466fd2d0.e34c1c",
        "z": "94b1b7f9.82aa68",
        "name": "",
        "x": 650,
        "y": 560,
        "wires": [
            []
        ]
    },
    {
        "id": "b8fb4eeb.9e3b9",
        "type": "function",
        "z": "94b1b7f9.82aa68",
        "name": "Y4 parameters",
        "func": "const MACHINE_ID = flow.get('MACHINE_ID')\nconst base_device_id = 'stamping_press_' + MACHINE_ID\n\nmsg.params = {\n    BASE_DEVICE_ID: base_device_id,\n    ZONE: 'event',\n    CHANNEL_ID: 'Y4',\n    EVENT_ID: 'alarm_light',\n    INIT_VALUE: 0,\n    VALUE_TO_STATE : [\n        {\n            VALUE: 0,\n            STATE: 0\n        },\n        {\n            VALUE: 1,\n            STATE: 1\n        }\n    ]\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 480,
        "y": 600,
        "wires": [
            [
                "fd5679be.d18808"
            ]
        ]
    },
    {
        "id": "fd5679be.d18808",
        "type": "subflow:466fd2d0.e34c1c",
        "z": "94b1b7f9.82aa68",
        "name": "",
        "x": 650,
        "y": 600,
        "wires": [
            []
        ]
    },
    {
        "id": "92fe01af.132a2",
        "type": "qi-chameleon-source",
        "z": "8520e616.90ab98",
        "name": "",
        "deviceId": "stamping_press_106",
        "x": 200,
        "y": 640,
        "wires": [
            [
                "8bfeabf1.65e378"
            ]
        ]
    },
    {
        "id": "32594cbc.afad64",
        "type": "qi-chameleon-source",
        "z": "8520e616.90ab98",
        "name": "",
        "deviceId": "stamping_press_106_event",
        "x": 220,
        "y": 700,
        "wires": [
            [
                "446a6b64.785eb4"
            ]
        ]
    },
    {
        "id": "21557104.c3831e",
        "type": "subflow:94b1b7f9.82aa68",
        "z": "8520e616.90ab98",
        "name": "",
        "x": 760,
        "y": 700,
        "wires": [
            [
                "5870f897.a12848"
            ]
        ]
    },
    {
        "id": "5870f897.a12848",
        "type": "qi-chameleon-sink",
        "z": "8520e616.90ab98",
        "name": "",
        "x": 980,
        "y": 700,
        "wires": []
    },
    {
        "id": "375d0e9d.ba1a02",
        "type": "qi-chameleon-source",
        "z": "8520e616.90ab98",
        "name": "",
        "deviceId": "stamping_press_107",
        "x": 200,
        "y": 800,
        "wires": [
            [
                "ace6b929.36b098"
            ]
        ]
    },
    {
        "id": "ff5cb320.e388b",
        "type": "qi-chameleon-source",
        "z": "8520e616.90ab98",
        "name": "",
        "deviceId": "stamping_press_107_event",
        "x": 220,
        "y": 860,
        "wires": [
            [
                "dfb18fa7.6cf0b"
            ]
        ]
    },
    {
        "id": "c0efa612.1c0f78",
        "type": "subflow:94b1b7f9.82aa68",
        "z": "8520e616.90ab98",
        "name": "",
        "x": 760,
        "y": 860,
        "wires": [
            [
                "b369c51a.0235b8"
            ]
        ]
    },
    {
        "id": "b369c51a.0235b8",
        "type": "qi-chameleon-sink",
        "z": "8520e616.90ab98",
        "name": "",
        "x": 980,
        "y": 860,
        "wires": []
    },
    {
        "id": "8bfeabf1.65e378",
        "type": "subflow:1d3a3270.3d399e",
        "z": "8520e616.90ab98",
        "name": "",
        "x": 500,
        "y": 640,
        "wires": [
            [
                "446a6b64.785eb4"
            ]
        ]
    },
    {
        "id": "ace6b929.36b098",
        "type": "subflow:1d3a3270.3d399e",
        "z": "8520e616.90ab98",
        "name": "",
        "x": 500,
        "y": 800,
        "wires": [
            [
                "dfb18fa7.6cf0b"
            ]
        ]
    },
    {
        "id": "b0a8732f.b03c3",
        "type": "qi-chameleon-source",
        "z": "8520e616.90ab98",
        "name": "",
        "deviceId": "stamping_press_108",
        "x": 200,
        "y": 960,
        "wires": [
            [
                "9b9a4e23.6ea8"
            ]
        ]
    },
    {
        "id": "4de530a4.0a042",
        "type": "qi-chameleon-source",
        "z": "8520e616.90ab98",
        "name": "",
        "deviceId": "stamping_press_108_event",
        "x": 220,
        "y": 1020,
        "wires": [
            [
                "eed6eaea.2bb0f8"
            ]
        ]
    },
    {
        "id": "2e6013a7.2bfd1c",
        "type": "subflow:94b1b7f9.82aa68",
        "z": "8520e616.90ab98",
        "name": "",
        "x": 760,
        "y": 1020,
        "wires": [
            [
                "a47f3990.4fd748"
            ]
        ]
    },
    {
        "id": "a47f3990.4fd748",
        "type": "qi-chameleon-sink",
        "z": "8520e616.90ab98",
        "name": "",
        "x": 980,
        "y": 1020,
        "wires": []
    },
    {
        "id": "9b9a4e23.6ea8",
        "type": "subflow:1d3a3270.3d399e",
        "z": "8520e616.90ab98",
        "name": "",
        "x": 500,
        "y": 960,
        "wires": [
            [
                "eed6eaea.2bb0f8"
            ]
        ]
    },
    {
        "id": "c3e6b5f8.43d448",
        "type": "qi-chameleon-source",
        "z": "8520e616.90ab98",
        "name": "",
        "deviceId": "stamping_press_109",
        "x": 200,
        "y": 1120,
        "wires": [
            [
                "d47529e2.4b0058"
            ]
        ]
    },
    {
        "id": "89708a2.cf27d78",
        "type": "qi-chameleon-source",
        "z": "8520e616.90ab98",
        "name": "",
        "deviceId": "stamping_press_109_event",
        "x": 220,
        "y": 1180,
        "wires": [
            [
                "bc79431a.80047"
            ]
        ]
    },
    {
        "id": "29a703c6.840f3c",
        "type": "subflow:94b1b7f9.82aa68",
        "z": "8520e616.90ab98",
        "name": "",
        "x": 760,
        "y": 1180,
        "wires": [
            [
                "cdd825c.ce55cd8"
            ]
        ]
    },
    {
        "id": "cdd825c.ce55cd8",
        "type": "qi-chameleon-sink",
        "z": "8520e616.90ab98",
        "name": "",
        "x": 980,
        "y": 1180,
        "wires": []
    },
    {
        "id": "d47529e2.4b0058",
        "type": "subflow:1d3a3270.3d399e",
        "z": "8520e616.90ab98",
        "name": "",
        "x": 500,
        "y": 1120,
        "wires": [
            [
                "bc79431a.80047"
            ]
        ]
    },
    {
        "id": "a6177a6.88ff788",
        "type": "debug",
        "z": "82e4d436.d46858",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "working_code_list",
        "targetType": "msg",
        "x": 800,
        "y": 240,
        "wires": []
    },
    {
        "id": "bdc9c6c7.fe2548",
        "type": "debug",
        "z": "82e4d436.d46858",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 770,
        "y": 200,
        "wires": []
    },
    {
        "id": "487db400.62350c",
        "type": "function",
        "z": "94b1b7f9.82aa68",
        "name": "flow.params",
        "func": "if (typeof msg.params.MACHINE_ID === 'undefined') {\n    node.error('illegal msg.params')\n    return\n}\n\nflow.set(\n    [\n        'MACHINE_ID'\n    ],\n    [\n        msg.params.MACHINE_ID\n    ]\n)\n\ndelete msg.params\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 210,
        "y": 320,
        "wires": [
            [
                "e8ae650b.3e9d48",
                "b37cfcb9.b7baa",
                "11af36fb.237749",
                "9b6003ff.cb948",
                "45039f3f.8a86",
                "b349a2ad.2e5f3",
                "2b83de80.368f32",
                "cca88893.7303a8",
                "9b324f02.cda14",
                "1327934d.7580cd",
                "1247de70.311fb2",
                "579afa32.d894f4",
                "b8fb4eeb.9e3b9"
            ]
        ]
    },
    {
        "id": "446a6b64.785eb4",
        "type": "function",
        "z": "8520e616.90ab98",
        "name": "parameters",
        "func": "msg.params = {\n    MACHINE_ID: '106'\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 530,
        "y": 700,
        "wires": [
            [
                "21557104.c3831e"
            ]
        ]
    },
    {
        "id": "dfb18fa7.6cf0b",
        "type": "function",
        "z": "8520e616.90ab98",
        "name": "parameters",
        "func": "msg.params = {\n    MACHINE_ID: '107'\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 530,
        "y": 860,
        "wires": [
            [
                "c0efa612.1c0f78"
            ]
        ]
    },
    {
        "id": "eed6eaea.2bb0f8",
        "type": "function",
        "z": "8520e616.90ab98",
        "name": "parameters",
        "func": "msg.params = {\n    MACHINE_ID: '108'\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 530,
        "y": 1020,
        "wires": [
            [
                "2e6013a7.2bfd1c"
            ]
        ]
    },
    {
        "id": "bc79431a.80047",
        "type": "function",
        "z": "8520e616.90ab98",
        "name": "parameters",
        "func": "msg.params = {\n    MACHINE_ID: '109'\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 530,
        "y": 1180,
        "wires": [
            [
                "29a703c6.840f3c"
            ]
        ]
    },
    {
        "id": "adb477fe.8a3a68",
        "type": "function",
        "z": "e7e991f8.65c3f",
        "name": "flow.params",
        "func": "if (typeof msg.params.BASE_DEVICE_ID === 'undefined' ||\n        typeof msg.params.LAST_WORKING_STOP_AT === 'undefined' ||\n        typeof msg.params.CIRCLE_PRE_COUNT === 'undefined') {\n    node.error('illegal msg.params')\n    return\n}\n\nflow.set(\n    [\n        'BASE_DEVICE_ID',\n        'LAST_WORKING_STOP_AT',\n        'CIRCLE_PRE_COUNT'\n    ],\n    [\n        msg.params.BASE_DEVICE_ID,\n        msg.params.LAST_WORKING_STOP_AT,\n        msg.params.CIRCLE_PRE_COUNT\n    ]\n)\n\ndelete msg.params\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 390,
        "y": 100,
        "wires": [
            [
                "772ebce2.dc5994"
            ]
        ]
    },
    {
        "id": "91167102.2583e",
        "type": "qi-interval-boundary",
        "z": "e7e991f8.65c3f",
        "name": "",
        "timezone": "local",
        "intervalDuration": "86400",
        "shiftInterval": "0",
        "x": 410,
        "y": 180,
        "wires": [
            [
                "1f880e47.34a582"
            ]
        ]
    },
    {
        "id": "1f880e47.34a582",
        "type": "function",
        "z": "e7e991f8.65c3f",
        "name": "query count",
        "func": "const from = flow.get('BASE_DEVICE_ID') + '_event'\nconst since = msg.payload.begin.toISOString()\nconst until = msg.payload.end.toISOString()\n\nmsg.query = `\n    SELECT COUNT(\"working\")\n    FROM ${from}\n    WHERE working = 0 AND\n        time >= '${since}' AND\n        time <= '${until}'\n`\n\n// node.error(msg.query)\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "x": 410,
        "y": 220,
        "wires": [
            [
                "7c8a21e4.aba9b"
            ]
        ]
    },
    {
        "id": "7c8a21e4.aba9b",
        "type": "qi-query-history",
        "z": "e7e991f8.65c3f",
        "name": "",
        "query": "",
        "x": 400,
        "y": 260,
        "wires": [
            [
                "7a8d5a33.a3fab4"
            ]
        ]
    },
    {
        "id": "7a8d5a33.a3fab4",
        "type": "function",
        "z": "e7e991f8.65c3f",
        "name": "count",
        "func": "const device_id = flow.get('BASE_DEVICE_ID') + '_production_info'\nconst LAST_WORKING_STOP_AT = flow.get('LAST_WORKING_STOP_AT')\nconst CIRCLE_PRE_COUNT = flow.get('CIRCLE_PRE_COUNT')\nconst count = msg.payload[0].count / CIRCLE_PRE_COUNT\n\nif (!Number.isInteger(count))\n{\n    return\n}\n\nmsg.payload = {\n    \"deviceId\": device_id,\n    \"at\": LAST_WORKING_STOP_AT,\n    \"channels\": {\n        \"count\": count\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 390,
        "y": 300,
        "wires": [
            []
        ]
    },
    {
        "id": "772ebce2.dc5994",
        "type": "function",
        "z": "e7e991f8.65c3f",
        "name": "at to date",
        "func": "const LAST_WORKING_STOP_AT = flow.get('LAST_WORKING_STOP_AT')\nconst date = new Date(\n    LAST_WORKING_STOP_AT.sec * 1000 + Math.floor(LAST_WORKING_STOP_AT.us / 1000))\n\nmsg.payload = date\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 380,
        "y": 140,
        "wires": [
            [
                "91167102.2583e"
            ]
        ]
    },
    {
        "id": "707330fc.312e9",
        "type": "function",
        "z": "f9c24c90.68012",
        "name": "parameters",
        "func": "const last_working_stop_at = msg.payload.at\n\nmsg.params = {\n    BASE_DEVICE_ID: 'welder',\n    LAST_WORKING_STOP_AT: last_working_stop_at,\n    CIRCLE_PRE_COUNT: 1\n}           \n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "x": 390,
        "y": 900,
        "wires": [
            [
                "df0397b0.dd2c98",
                "7a2db632.c255c8"
            ]
        ]
    },
    {
        "id": "df0397b0.dd2c98",
        "type": "subflow:e7e991f8.65c3f",
        "z": "f9c24c90.68012",
        "name": "",
        "x": 600,
        "y": 900,
        "wires": [
            [
                "35130408.45c60c"
            ]
        ]
    },
    {
        "id": "5c2a7be7.58ebc4",
        "type": "qi-interval-boundary",
        "z": "144efb39.f5bc95",
        "name": "",
        "timezone": "local",
        "intervalDuration": "86400",
        "shiftInterval": "0",
        "x": 390,
        "y": 200,
        "wires": [
            [
                "f1c084e5.e091d8"
            ]
        ]
    },
    {
        "id": "f1c084e5.e091d8",
        "type": "function",
        "z": "144efb39.f5bc95",
        "name": "query working state",
        "func": "const from = flow.get('BASE_DEVICE_ID') + '_event'\nconst since = msg.payload.begin.toISOString()\nconst until = msg.payload.end.toISOString()\n\nmsg.query = `\n    SELECT working\n    FROM ${from}\n    WHERE time >= '${since}' AND\n        time <= '${until}'\n`\n\n// node.error(msg.query)\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "x": 410,
        "y": 240,
        "wires": [
            [
                "47ede9d4.c69248"
            ]
        ]
    },
    {
        "id": "47ede9d4.c69248",
        "type": "qi-query-history",
        "z": "144efb39.f5bc95",
        "name": "",
        "query": "",
        "x": 380,
        "y": 280,
        "wires": [
            [
                "7080ef8d.eb328"
            ]
        ]
    },
    {
        "id": "7080ef8d.eb328",
        "type": "qi-state-duration",
        "z": "144efb39.f5bc95",
        "name": "",
        "stateName": "working",
        "x": 380,
        "y": 320,
        "wires": [
            [
                "4c83c5f2.6f6e3c"
            ]
        ]
    },
    {
        "id": "9bee6559.6b02e8",
        "type": "function",
        "z": "144efb39.f5bc95",
        "name": "flow.params",
        "func": "if (typeof msg.params.BASE_DEVICE_ID === 'undefined' ||\n        typeof msg.params.LAST_WORKING_STOP_AT === 'undefined') {\n    node.error('illegal msg.params')\n    return\n}\n\nflow.set(\n    [\n        'BASE_DEVICE_ID',\n        'LAST_WORKING_STOP_AT'\n    ],\n    [\n        msg.params.BASE_DEVICE_ID,\n        msg.params.LAST_WORKING_STOP_AT\n    ]\n)\n\ndelete msg.params\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 370,
        "y": 120,
        "wires": [
            [
                "2fb0038a.8e498c"
            ]
        ]
    },
    {
        "id": "2fb0038a.8e498c",
        "type": "function",
        "z": "144efb39.f5bc95",
        "name": "at to date",
        "func": "const LAST_WORKING_STOP_AT = flow.get('LAST_WORKING_STOP_AT')\nconst date = new Date(\n    LAST_WORKING_STOP_AT.sec * 1000 + Math.floor(LAST_WORKING_STOP_AT.us / 1000))\n\nmsg.payload = date\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 360,
        "y": 160,
        "wires": [
            [
                "5c2a7be7.58ebc4"
            ]
        ]
    },
    {
        "id": "4c83c5f2.6f6e3c",
        "type": "function",
        "z": "144efb39.f5bc95",
        "name": "utilization",
        "func": "const device_id = flow.get('BASE_DEVICE_ID') + '_production_info'\nconst LAST_WORKING_STOP_AT = flow.get('LAST_WORKING_STOP_AT')\nconst db_payload = msg.payload\n\nlet duration = 0\ndb_payload.forEach(\n    function(item)\n    {\n        if (item.state == 1)\n        {\n            duration = item.duration\n        }\n    }\n)\n\nconst utilization_sec = Math.floor(duration / 1000)\n\nmsg.payload = {\n    \"deviceId\": device_id,\n    \"at\": LAST_WORKING_STOP_AT,\n    \"channels\": {\n        \"utilization_sec\": utilization_sec\n    }\n}\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "x": 360,
        "y": 360,
        "wires": [
            []
        ]
    },
    {
        "id": "7a2db632.c255c8",
        "type": "subflow:144efb39.f5bc95",
        "z": "f9c24c90.68012",
        "name": "",
        "x": 610,
        "y": 940,
        "wires": [
            [
                "35130408.45c60c"
            ]
        ]
    },
    {
        "id": "35130408.45c60c",
        "type": "qi-chameleon-sink",
        "z": "f9c24c90.68012",
        "name": "",
        "x": 880,
        "y": 900,
        "wires": []
    },
    {
        "id": "561cc2b9.14d6dc",
        "type": "delay",
        "z": "f9c24c90.68012",
        "name": "",
        "pauseType": "delay",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 380,
        "y": 860,
        "wires": [
            [
                "707330fc.312e9"
            ]
        ]
    },
    {
        "id": "42396c61.c40ae4",
        "type": "function",
        "z": "f9c24c90.68012",
        "name": "parameters",
        "func": "const last_working_stop_at = msg.payload.at\n\nmsg.params = {\n    BASE_DEVICE_ID: 'bender',\n    LAST_WORKING_STOP_AT: last_working_stop_at,\n    CIRCLE_PRE_COUNT: 1\n}           \n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "x": 590,
        "y": 320,
        "wires": [
            [
                "270e2467.2ff34c",
                "8737f9c4.79cea8"
            ]
        ]
    },
    {
        "id": "270e2467.2ff34c",
        "type": "subflow:e7e991f8.65c3f",
        "z": "f9c24c90.68012",
        "name": "",
        "x": 800,
        "y": 320,
        "wires": [
            [
                "ee55569c.eb60a8"
            ]
        ]
    },
    {
        "id": "8737f9c4.79cea8",
        "type": "subflow:144efb39.f5bc95",
        "z": "f9c24c90.68012",
        "name": "",
        "x": 810,
        "y": 360,
        "wires": [
            [
                "ee55569c.eb60a8"
            ]
        ]
    },
    {
        "id": "ee55569c.eb60a8",
        "type": "qi-chameleon-sink",
        "z": "f9c24c90.68012",
        "name": "",
        "x": 1080,
        "y": 320,
        "wires": []
    },
    {
        "id": "80fb9dd3.b1106",
        "type": "delay",
        "z": "f9c24c90.68012",
        "name": "",
        "pauseType": "delay",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 580,
        "y": 280,
        "wires": [
            [
                "42396c61.c40ae4"
            ]
        ]
    },
    {
        "id": "3bfb1cab.6fc604",
        "type": "function",
        "z": "f9c24c90.68012",
        "name": "parameters",
        "func": "const last_working_stop_at = msg.payload.at\n\nmsg.params = {\n    BASE_DEVICE_ID: 'manual_bender',\n    LAST_WORKING_STOP_AT: last_working_stop_at,\n    CIRCLE_PRE_COUNT: 4\n}           \n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "x": 630,
        "y": 1280,
        "wires": [
            [
                "a299a433.9057d8",
                "f9c5d8c1.5493a8"
            ]
        ]
    },
    {
        "id": "a299a433.9057d8",
        "type": "subflow:e7e991f8.65c3f",
        "z": "f9c24c90.68012",
        "name": "",
        "x": 840,
        "y": 1280,
        "wires": [
            [
                "206fa6f7.477f7a"
            ]
        ]
    },
    {
        "id": "f9c5d8c1.5493a8",
        "type": "subflow:144efb39.f5bc95",
        "z": "f9c24c90.68012",
        "name": "",
        "x": 850,
        "y": 1320,
        "wires": [
            [
                "206fa6f7.477f7a"
            ]
        ]
    },
    {
        "id": "206fa6f7.477f7a",
        "type": "qi-chameleon-sink",
        "z": "f9c24c90.68012",
        "name": "",
        "x": 1120,
        "y": 1280,
        "wires": []
    },
    {
        "id": "2e1047f0.4699b8",
        "type": "delay",
        "z": "f9c24c90.68012",
        "name": "",
        "pauseType": "delay",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 620,
        "y": 1240,
        "wires": [
            [
                "3bfb1cab.6fc604"
            ]
        ]
    },
    {
        "id": "82344719.150e18",
        "type": "http in",
        "z": "5c6c983f.192a38",
        "name": "",
        "url": "/bender/power_on/search",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 250,
        "y": 180,
        "wires": [
            [
                "75901373.574d9c",
                "c802808b.e0b1f"
            ]
        ]
    },
    {
        "id": "fe2db48.7d38248",
        "type": "http response",
        "z": "5c6c983f.192a38",
        "name": "",
        "statusCode": "200",
        "headers": {},
        "x": 940,
        "y": 180,
        "wires": []
    },
    {
        "id": "c802808b.e0b1f",
        "type": "function",
        "z": "5c6c983f.192a38",
        "name": "",
        "func": "msg.payload = [\n    'power_on'\n]\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 530,
        "y": 180,
        "wires": [
            [
                "d010fc30.11774"
            ]
        ]
    },
    {
        "id": "d010fc30.11774",
        "type": "json",
        "z": "5c6c983f.192a38",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 730,
        "y": 180,
        "wires": [
            [
                "fe2db48.7d38248"
            ]
        ]
    },
    {
        "id": "b600d75c.6f4ea8",
        "type": "http in",
        "z": "5c6c983f.192a38",
        "name": "",
        "url": "/bender/power_on/query",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 240,
        "y": 240,
        "wires": [
            [
                "9ca60c52.83441",
                "f7e0baa0.a8a818"
            ]
        ]
    },
    {
        "id": "3a974cc.6f2fbb4",
        "type": "http response",
        "z": "5c6c983f.192a38",
        "name": "",
        "statusCode": "200",
        "headers": {},
        "x": 940,
        "y": 240,
        "wires": []
    },
    {
        "id": "9ca60c52.83441",
        "type": "function",
        "z": "5c6c983f.192a38",
        "name": "",
        "func": "// msg.payload = [\n//     {\n//         'target': 'channel_1',\n//         'datapoints': [\n//             [123]\n//         ]\n//     },\n//     {\n//         'target': 'channel_2',\n//         'datapoints': [\n//             [456]\n//         ]\n//     }\n// ]\n\nmsg.payload = [\n  {\n    \"columns\":[\n      {\"text\":\"power_on\",\"type\":\"number\"},\n      {\"text\":\"power_off\",\"type\":\"number\"}\n    ],\n    \"rows\":[\n    [361]\n    //   [123, 456],\n    //   [777, 144]\n      \n    ],\n    \"type\":\"table\"\n  }\n]\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 530,
        "y": 240,
        "wires": [
            [
                "3b16a148.f8163e"
            ]
        ]
    },
    {
        "id": "3b16a148.f8163e",
        "type": "json",
        "z": "5c6c983f.192a38",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 730,
        "y": 240,
        "wires": [
            [
                "3a974cc.6f2fbb4"
            ]
        ]
    },
    {
        "id": "f7e0baa0.a8a818",
        "type": "debug",
        "z": "5c6c983f.192a38",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 540,
        "y": 320,
        "wires": []
    },
    {
        "id": "75901373.574d9c",
        "type": "debug",
        "z": "5c6c983f.192a38",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 540,
        "y": 80,
        "wires": []
    },
    {
        "id": "7930fdf7.06f904",
        "type": "function",
        "z": "5c6c983f.192a38",
        "name": "at to date",
        "func": "const LAST_WORKING_STOP_AT = flow.get('LAST_WORKING_STOP_AT')\nconst date = new Date(\n    LAST_WORKING_STOP_AT.sec * 1000 + Math.floor(LAST_WORKING_STOP_AT.us / 1000))\n\nmsg.payload = date\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 380,
        "y": 460,
        "wires": [
            [
                "16d5fe35.d357f2"
            ]
        ]
    },
    {
        "id": "16d5fe35.d357f2",
        "type": "qi-interval-boundary",
        "z": "5c6c983f.192a38",
        "name": "",
        "timezone": "local",
        "intervalDuration": "86400",
        "shiftInterval": "0",
        "x": 590,
        "y": 460,
        "wires": [
            []
        ]
    },
    {
        "id": "c114055e.214ec8",
        "type": "qi-chameleon-source",
        "z": "f9c24c90.68012",
        "name": "",
        "deviceId": "stamping_press_108",
        "x": 260,
        "y": 2180,
        "wires": [
            [
                "346e28ce.495e28"
            ]
        ]
    },
    {
        "id": "256399e6.1eaf16",
        "type": "function",
        "z": "26e982ee.cf503e",
        "name": "omit count reset",
        "func": "const is_init = msg.args.is_init\nconst count = msg.args.count\n\nif (is_init === false &&\n    count === 0)\n{\n    return\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 140,
        "y": 200,
        "wires": [
            [
                "f3f48549.c74dd8",
                "642e0701.4fa508"
            ]
        ]
    },
    {
        "id": "642e0701.4fa508",
        "type": "function",
        "z": "26e982ee.cf503e",
        "name": "punch begin",
        "func": "const pre_state_name = msg.args.pre_state_name\nconst is_init = msg.args.is_init\nconst pre_state = flow.get(pre_state_name)\n\nif (is_init === true)\n{\n    flow.set(pre_state_name, 0)\n    return\n}\n\nif (pre_state === 1)\n{\n    return\n}\n\nflow.set(pre_state_name, 1)\n\nmsg.args = {\n    \"state\": 1\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 370,
        "y": 200,
        "wires": [
            [
                "a179d0c3.73008"
            ]
        ]
    },
    {
        "id": "330708e5.626668",
        "type": "function",
        "z": "26e982ee.cf503e",
        "name": "punch end",
        "func": "flow.set(msg.args.pre_state_name, 0)\n\nmsg.args = {\n    \"state\": 0\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 370,
        "y": 240,
        "wires": [
            [
                "a179d0c3.73008"
            ]
        ]
    },
    {
        "id": "f3f48549.c74dd8",
        "type": "trigger",
        "z": "26e982ee.cf503e",
        "op1": "",
        "op2": "",
        "op1type": "nul",
        "op2type": "payl",
        "duration": "24",
        "extend": true,
        "units": "s",
        "reset": "",
        "bytopic": "all",
        "name": "",
        "x": 150,
        "y": 240,
        "wires": [
            [
                "330708e5.626668"
            ]
        ]
    },
    {
        "id": "a179d0c3.73008",
        "type": "function",
        "z": "26e982ee.cf503e",
        "name": "merge to output",
        "func": "const device_id = msg.payload.deviceId\nconst at = msg.payload.at\nconst state = msg.args.state\n\nconst pre_processing_sec = env.get(\"pre_processing_sec\")\nconst post_processing_sec = env.get(\"post_processing_sec\")\n\nlet at_sec = null\nif (state === 1)\n{\n    at_sec = at.sec - pre_processing_sec\n}\nelse if (state === 0)\n{\n    at_sec = at.sec + post_processing_sec\n}\n\nmsg.payload = {\n    \"at\": {\n        \"sec\": at_sec,\n        \"us\": at.us\n    },\n    \"deviceId\": device_id,\n    \"state\": state\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 580,
        "y": 220,
        "wires": [
            []
        ]
    },
    {
        "id": "aa03a3f1.73ba8",
        "type": "function",
        "z": "26e982ee.cf503e",
        "name": "validate env variable",
        "func": "const ENV = [\n    \"channel_id\",\n    \"pre_processing_sec\",\n    \"post_processing_sec\"\n]\n\nfor (var item in ENV)\n{\n    const v = env.get(ENV[item])\n    if (v === '' || v === undefined)\n    {\n        node.error(ENV[item] + \" env variable not set\")\n        return\n    }\n}\n\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 280,
        "y": 40,
        "wires": [
            [
                "cfccc989.9db188"
            ]
        ]
    },
    {
        "id": "cfccc989.9db188",
        "type": "function",
        "z": "26e982ee.cf503e",
        "name": "set args",
        "func": "msg.args = {\n  \"pre_state_name\": \"pre_state\",\n  \"count\": msg.payload.channels[env.get(\"channel_id\")]\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 140,
        "y": 120,
        "wires": [
            [
                "327c0ab0.3427f6"
            ]
        ]
    },
    {
        "id": "327c0ab0.3427f6",
        "type": "function",
        "z": "26e982ee.cf503e",
        "name": "check init",
        "func": "let is_init = context.get(\"nc_is_init\")\n\nif (is_init === undefined)\n{\n    is_init = true\n}\n\ncontext.set(\"nc_is_init\", false)\n\nmsg.args.is_init = is_init\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 340,
        "y": 120,
        "wires": [
            [
                "256399e6.1eaf16"
            ]
        ]
    },
    {
        "id": "60aced3a.d7f4a4",
        "type": "qi-forward-on-change",
        "z": "f9c24c90.68012",
        "name": "",
        "initialValue": "{}",
        "initialValueType": "json",
        "useInitialValue": false,
        "x": 430,
        "y": 2220,
        "wires": [
            [
                "e65efda5.cf0c",
                "bb3b561a.6d8478"
            ]
        ]
    },
    {
        "id": "346e28ce.495e28",
        "type": "qi-forward-on-match",
        "z": "f9c24c90.68012",
        "name": "",
        "schema": "{\"$schema\":\"http://json-schema.org/draft-07/schema#\",\"type\":\"object\",\"required\":[\"deviceId\",\"at\",\"channels\"],\"properties\":{\"deviceId\":{\"type\":\"string\"},\"at\":{\"type\":\"object\",\"required\":[\"sec\",\"us\"],\"properties\":{\"sec\":{\"type\":\"integer\",\"minimum\":0},\"us\":{\"type\":\"integer\",\"minimum\":0,\"maximum\":999999}}},\"channels\":{\"type\":\"object\",\"required\":[\"D205\"],\"properties\":{\"D205\":{\"type\":\"integer\"}}}}}",
        "schemaType": "json",
        "removeAdditional": true,
        "x": 280,
        "y": 2220,
        "wires": [
            [
                "60aced3a.d7f4a4"
            ]
        ]
    },
    {
        "id": "ea7aa9.503fe558",
        "type": "function",
        "z": "f9c24c90.68012",
        "name": "build reading",
        "func": "const at = msg.payload.at\nconst state = msg.payload.state\n\nmsg.payload = {\n    \"deviceId\": \"stamping_press_108_event\",\n    \"at\": at,\n    \"channels\": {\n        \"working\": state\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 490,
        "y": 2320,
        "wires": [
            [
                "922dd0e9.a01b3",
                "772d9ac8.f8d0d4"
            ]
        ]
    },
    {
        "id": "e65efda5.cf0c",
        "type": "subflow:26e982ee.cf503e",
        "z": "f9c24c90.68012",
        "name": "",
        "env": [
            {
                "name": "channel_id",
                "type": "str",
                "value": "D205"
            },
            {
                "name": "pre_processing_sec",
                "type": "num",
                "value": "2"
            },
            {
                "name": "post_processing_sec",
                "type": "num",
                "value": "2"
            }
        ],
        "x": 310,
        "y": 2320,
        "wires": [
            [
                "ea7aa9.503fe558"
            ]
        ]
    },
    {
        "id": "922dd0e9.a01b3",
        "type": "qi-chameleon-sink",
        "z": "f9c24c90.68012",
        "name": "",
        "x": 680,
        "y": 2320,
        "wires": []
    },
    {
        "id": "60026829.82fc88",
        "type": "function",
        "z": "c396c221.180cf",
        "name": "query changed",
        "func": "const begin_time = msg.args.utilization_begin_time\nconst end_time = msg.args.utilization_end_time\n\nconst device_id = env.get(\"device_id\")\nconst channel_id = env.get(\"channel_id\")\n\nmsg.query = `\n    SELECT \"${channel_id}\"\n    FROM \"${device_id}\"\n    WHERE time >= '${begin_time.toISOString()}'\n    AND time < '${end_time.toISOString()}'\n`\n\nnode.log(msg.query)\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 140,
        "y": 140,
        "wires": [
            [
                "ae8fa4b9.923b38"
            ]
        ]
    },
    {
        "id": "ae8fa4b9.923b38",
        "type": "qi-query-history",
        "z": "c396c221.180cf",
        "name": "",
        "query": "",
        "x": 340,
        "y": 140,
        "wires": [
            [
                "e6fd7a50.faa5d8"
            ]
        ]
    },
    {
        "id": "e6fd7a50.faa5d8",
        "type": "function",
        "z": "c396c221.180cf",
        "name": "save changed_list",
        "func": "msg.args.changed_list = msg.payload\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 150,
        "y": 180,
        "wires": [
            [
                "d807db21.123bb8"
            ]
        ]
    },
    {
        "id": "d807db21.123bb8",
        "type": "function",
        "z": "c396c221.180cf",
        "name": "query previous state",
        "func": "const begin_time = msg.args.utilization_begin_time\n\nconst device_id = env.get(\"device_id\")\nconst channel_id = env.get(\"channel_id\")\n\nmsg.query = `\n    SELECT \"${channel_id}\"\n    FROM \"${device_id}\"\n    WHERE time < '${begin_time.toISOString()}'\n    ORDER BY time DESC\n    LIMIT 1\n`\n\nnode.log(msg.query)\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 160,
        "y": 260,
        "wires": [
            [
                "c921bbef.ece9e8"
            ]
        ]
    },
    {
        "id": "c921bbef.ece9e8",
        "type": "qi-query-history",
        "z": "c396c221.180cf",
        "name": "",
        "query": "",
        "x": 380,
        "y": 260,
        "wires": [
            [
                "527a2087.6617b"
            ]
        ]
    },
    {
        "id": "527a2087.6617b",
        "type": "function",
        "z": "c396c221.180cf",
        "name": "append previous state",
        "func": "const pre_state_list = msg.payload\nchanged_list = msg.args.changed_list\n\nif (pre_state_list.length !== 0)\n{\n    changed_list.unshift(pre_state_list[0])\n}\n\nmsg.payload = changed_list\nmsg.changed_list = undefined\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 160,
        "y": 300,
        "wires": [
            [
                "6a5f6be2.9f1af4"
            ]
        ]
    },
    {
        "id": "6a5f6be2.9f1af4",
        "type": "function",
        "z": "c396c221.180cf",
        "name": "remove duplicated state",
        "func": "const changed_list = msg.payload\nconst channel_id = env.get(\"channel_id\")\n\nlet rtn_changed = []\nlet now_state = undefined\n\nchanged_list.forEach(function(item){\n    if (item[channel_id] !== now_state)\n    {\n        rtn_changed.push(item)\n        now_state = item[channel_id]\n    }\n})\n\nmsg.payload = rtn_changed\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 170,
        "y": 360,
        "wires": [
            [
                "4c8694e9.fb006c"
            ]
        ]
    },
    {
        "id": "4c8694e9.fb006c",
        "type": "function",
        "z": "c396c221.180cf",
        "name": "add lead/production time",
        "func": "const channel_id = env.get(\"channel_id\")\nconst pretreatment_sec = env.get(\"pretreatment_sec\")\nconst post_processing_sec = env.get(\"post_processing_sec\")\n\nconst trigger_time = msg.args.trigger_time\nconst changed_list = msg.payload\n\nlet rtn_changed_list = []\nfor (let ax = 0; ax < changed_list.length; ++ax)\n{\n    let item = changed_list[ax]\n    if (item[channel_id] === 1)\n    {\n        let with_lead_time = new Date(item.time - pretreatment_sec * 1000)\n        let pre_stop_item = rtn_changed_list[ax - 1]\n\n        if (pre_stop_item !== undefined &&\n            pre_stop_item.time >= with_lead_time)\n        {\n            rtn_changed_list.pop()\n            continue;\n        }\n\n        rtn_changed_list.push({\n            \"time\": with_lead_time,\n            \"changed\": item[channel_id]\n        })\n    }\n    else if (item[channel_id] === 0)\n    {\n        let with_production_time = item.time\n        with_production_time.setSeconds(\n            with_production_time.getSeconds() + post_processing_sec)\n\n        rtn_changed_list.push({\n            \"time\": with_production_time,\n            \"changed\": item[channel_id]\n        })\n    }\n}\n\nif (rtn_changed_list.length !== 0 &&\n    rtn_changed_list.slice(-1)[0].time > trigger_time)\n{\n    let latest = rtn_changed_list.pop()\n\n    rtn_changed_list.push({\n        \"time\": new Date(trigger_time - 1),\n        \"changed\": latest[channel_id]\n    })\n}\n\nmsg.payload = rtn_changed_list\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 170,
        "y": 400,
        "wires": [
            []
        ]
    },
    {
        "id": "9af15d78.b670b",
        "type": "function",
        "z": "c396c221.180cf",
        "name": "variable validation",
        "func": "const ENV = [\n    \"device_id\",\n    \"channel_id\",\n    \"pretreatment_sec\",\n    \"post_processing_sec\"\n]\n\nconst ARGS = [\n    \"utilization_begin_time\",\n    \"utilization_end_time\",\n    \"trigger_time\"\n]\n\nfor (let item in ENV)\n{\n    const v = env.get(ENV[item])\n    if (v === '' || v === undefined)\n    {\n        node.error(ENV[item] + \" env variable not set\")\n        return\n    }\n}\n\nfor (let item in ARGS)\n{\n    const v = msg.args[ARGS[item]]\n    if (v === undefined)\n    {\n        node.error(ARGS[item] + \" not set in msg.args\")\n        return\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 250,
        "y": 60,
        "wires": [
            [
                "60026829.82fc88"
            ]
        ]
    },
    {
        "id": "8c30d8b5.02c398",
        "type": "function",
        "z": "f9c24c90.68012",
        "name": "init args",
        "func": "msg.args = {}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 500,
        "y": 2400,
        "wires": [
            [
                "a2817d68.df664"
            ]
        ]
    },
    {
        "id": "a2817d68.df664",
        "type": "function",
        "z": "f9c24c90.68012",
        "name": "save trigger time",
        "func": "msg.payload = new Date()\nmsg.args.trigger_time = msg.payload\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 660,
        "y": 2400,
        "wires": [
            [
                "cf71ffc3.b128d"
            ]
        ]
    },
    {
        "id": "cf71ffc3.b128d",
        "type": "qi-interval-boundary",
        "z": "f9c24c90.68012",
        "name": "",
        "timezone": "local",
        "intervalDuration": "86400",
        "shiftInterval": "0",
        "x": 850,
        "y": 2400,
        "wires": [
            [
                "f55cad31.62d5f"
            ]
        ]
    },
    {
        "id": "f55cad31.62d5f",
        "type": "function",
        "z": "f9c24c90.68012",
        "name": "save being/end time",
        "func": "msg.args.utilization_begin_time = msg.payload.begin\nmsg.args.utilization_end_time = msg.payload.end\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1060,
        "y": 2400,
        "wires": [
            [
                "9d9a0056.382ca"
            ]
        ]
    },
    {
        "id": "3fb5f80b.f1b9a8",
        "type": "function",
        "z": "f9c24c90.68012",
        "name": "append since/until",
        "func": "const changed_list = msg.payload\nconst utilization_begin_time = msg.args.utilization_begin_time\nconst trigger_time = msg.args.trigger_time\n\nif (changed_list.length === 0)\n{\n    return\n}\n\nmsg.since = utilization_begin_time\nmsg.until = trigger_time\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 530,
        "y": 2460,
        "wires": [
            [
                "8b77185.b3cc0e8"
            ]
        ]
    },
    {
        "id": "8b77185.b3cc0e8",
        "type": "qi-state-duration",
        "z": "f9c24c90.68012",
        "name": "",
        "stateName": "changed",
        "x": 720,
        "y": 2460,
        "wires": [
            [
                "bfc7c911.caee68"
            ]
        ]
    },
    {
        "id": "bfc7c911.caee68",
        "type": "function",
        "z": "f9c24c90.68012",
        "name": "build utilization reading",
        "func": "const trigger_timestamp = msg.args.trigger_time.getTime()\nconst state_duration_list = msg.payload\n\nlet today_utilization_seconds = 0\nstate_duration_list.forEach(function (item){\n    if (item.state === 1)\n    {\n        today_utilization_seconds = Math.floor(item.duration / 1000);\n    }\n})\n\nmsg.payload = {\n    \"deviceId\": \"stamping_press_108_production_info\",\n    \"at\": {\n        \"sec\": Math.floor(trigger_timestamp / 1000),\n        \"us\": trigger_timestamp % 1000\n    },\n    \"channels\": {\n        \"utilization_sec\": today_utilization_seconds\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 920,
        "y": 2460,
        "wires": [
            [
                "9e50b378.7c85b"
            ]
        ]
    },
    {
        "id": "9d9a0056.382ca",
        "type": "subflow:c396c221.180cf",
        "z": "f9c24c90.68012",
        "name": "",
        "env": [
            {
                "name": "device_id",
                "type": "str",
                "value": "stamping_press_108_event"
            },
            {
                "name": "channel_id",
                "type": "str",
                "value": "working"
            }
        ],
        "x": 320,
        "y": 2460,
        "wires": [
            [
                "3fb5f80b.f1b9a8"
            ]
        ]
    },
    {
        "id": "9e50b378.7c85b",
        "type": "qi-chameleon-sink",
        "z": "f9c24c90.68012",
        "name": "",
        "x": 1140,
        "y": 2460,
        "wires": []
    },
    {
        "id": "94c74130.f0fed",
        "type": "function",
        "z": "15296a9d.2cdf05",
        "name": "validate count",
        "func": "const CHANNEL_ID = flow.get('CHANNEL_ID')\nconst LAST_COUNT_CHANGED_AT = flow.get('LAST_COUNT_CHANGED_AT')\n\nconst count = msg.payload.channels[CHANNEL_ID]\nconst date = new Date(\n    LAST_COUNT_CHANGED_AT.sec * 1000 + Math.floor(LAST_COUNT_CHANGED_AT.us / 1000))\n\nif (count === 0)\n{\n    return\n}\n\nmsg.payload = date\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 540,
        "y": 100,
        "wires": [
            [
                "3e8e3471.fa345c"
            ]
        ]
    },
    {
        "id": "3e8e3471.fa345c",
        "type": "qi-interval-boundary",
        "z": "15296a9d.2cdf05",
        "name": "",
        "timezone": "local",
        "intervalDuration": "86400",
        "shiftInterval": "0",
        "x": 570,
        "y": 140,
        "wires": [
            [
                "a864fe04.b357d"
            ]
        ]
    },
    {
        "id": "a864fe04.b357d",
        "type": "function",
        "z": "15296a9d.2cdf05",
        "name": "query production info last count",
        "func": "const from = flow.get('BASE_DEVICE_ID') + '_production_info'\nconst since = msg.payload.begin.toISOString()\nconst until = msg.payload.end.toISOString()\n\nmsg.query = `\n    SELECT \n        LAST(count)\n    FROM \n        ${from}\n    WHERE \n        time >= '${since}' AND\n        time <= '${until}'\n`\n\n// node.error(msg.query)\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "x": 590,
        "y": 180,
        "wires": [
            [
                "344eeb46.1485e4"
            ]
        ]
    },
    {
        "id": "344eeb46.1485e4",
        "type": "qi-query-history",
        "z": "15296a9d.2cdf05",
        "name": "",
        "query": "",
        "x": 560,
        "y": 220,
        "wires": [
            [
                "a194247b.db6a18"
            ]
        ]
    },
    {
        "id": "a194247b.db6a18",
        "type": "function",
        "z": "15296a9d.2cdf05",
        "name": "count",
        "func": "const LAST_COUNT_CHANGED_AT = flow.get('LAST_COUNT_CHANGED_AT')\n\nconst payload = msg.payload\nconst device_id = flow.get('BASE_DEVICE_ID') + '_production_info'\n\nlet count = 1\nif (payload.length > 0)\n{\n    count = payload[0].last + 1\n}\n\nmsg.payload = {\n    \"deviceId\": device_id,\n    \"at\": LAST_COUNT_CHANGED_AT,\n    \"channels\": {\n        \"count\": count\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 510,
        "y": 260,
        "wires": [
            []
        ]
    },
    {
        "id": "eb0eaafd.bd4f58",
        "type": "function",
        "z": "15296a9d.2cdf05",
        "name": "flow.params",
        "func": "if (typeof msg.params.BASE_DEVICE_ID === 'undefined' ||\n        typeof msg.params.CHANNEL_ID === 'undefined' ||\n        typeof msg.params.LAST_COUNT_CHANGED_AT === 'undefined') {\n    node.error('illegal msg.params')\n    return\n}\n\nflow.set(\n    [\n        'BASE_DEVICE_ID',\n        'CHANNEL_ID',\n        'LAST_COUNT_CHANGED_AT'\n    ],\n    [\n        msg.params.BASE_DEVICE_ID,\n        msg.params.CHANNEL_ID,\n        msg.params.LAST_COUNT_CHANGED_AT\n    ]\n)\n\ndelete msg.params\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "x": 530,
        "y": 60,
        "wires": [
            [
                "94c74130.f0fed"
            ]
        ]
    },
    {
        "id": "27ca12db.79a83e",
        "type": "subflow:15296a9d.2cdf05",
        "z": "f9c24c90.68012",
        "name": "",
        "env": [],
        "x": 910,
        "y": 2220,
        "wires": [
            [
                "43195920.77f548"
            ]
        ]
    },
    {
        "id": "43195920.77f548",
        "type": "qi-chameleon-sink",
        "z": "f9c24c90.68012",
        "name": "",
        "x": 1180,
        "y": 2220,
        "wires": []
    },
    {
        "id": "bb3b561a.6d8478",
        "type": "function",
        "z": "f9c24c90.68012",
        "name": "parameters",
        "func": "const last_count_changed_at = msg.payload.at\n\nmsg.params = {\n    BASE_DEVICE_ID: 'stamping_press_108',\n    CHANNEL_ID: 'D205',\n    LAST_COUNT_CHANGED_AT: last_count_changed_at\n}           \n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "x": 650,
        "y": 2220,
        "wires": [
            [
                "27ca12db.79a83e"
            ]
        ]
    },
    {
        "id": "772d9ac8.f8d0d4",
        "type": "switch",
        "z": "f9c24c90.68012",
        "name": "forward working end",
        "property": "payload.channels.working",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 320,
        "y": 2400,
        "wires": [
            [
                "8c30d8b5.02c398"
            ]
        ]
    },
    {
        "id": "f278087c.eacd68",
        "type": "qi-chameleon-source",
        "z": "f9c24c90.68012",
        "name": "",
        "deviceId": "stamping_press_107",
        "x": 260,
        "y": 1800,
        "wires": [
            [
                "85bdd3fa.1b884"
            ]
        ]
    },
    {
        "id": "8b15441c.f61328",
        "type": "qi-forward-on-change",
        "z": "f9c24c90.68012",
        "name": "",
        "initialValue": "{}",
        "initialValueType": "json",
        "useInitialValue": false,
        "x": 430,
        "y": 1840,
        "wires": [
            [
                "6376d20e.819ecc",
                "a7169908.11db38"
            ]
        ]
    },
    {
        "id": "85bdd3fa.1b884",
        "type": "qi-forward-on-match",
        "z": "f9c24c90.68012",
        "name": "",
        "schema": "{\"$schema\":\"http://json-schema.org/draft-07/schema#\",\"type\":\"object\",\"required\":[\"deviceId\",\"at\",\"channels\"],\"properties\":{\"deviceId\":{\"type\":\"string\"},\"at\":{\"type\":\"object\",\"required\":[\"sec\",\"us\"],\"properties\":{\"sec\":{\"type\":\"integer\",\"minimum\":0},\"us\":{\"type\":\"integer\",\"minimum\":0,\"maximum\":999999}}},\"channels\":{\"type\":\"object\",\"required\":[\"D205\"],\"properties\":{\"D205\":{\"type\":\"integer\"}}}}}",
        "schemaType": "json",
        "removeAdditional": true,
        "x": 280,
        "y": 1840,
        "wires": [
            [
                "8b15441c.f61328"
            ]
        ]
    },
    {
        "id": "e039b9dd.4218d8",
        "type": "function",
        "z": "f9c24c90.68012",
        "name": "build reading",
        "func": "const at = msg.payload.at\nconst state = msg.payload.state\n\nmsg.payload = {\n    \"deviceId\": \"stamping_press_107_event\",\n    \"at\": at,\n    \"channels\": {\n        \"working\": state\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 490,
        "y": 1940,
        "wires": [
            [
                "aa9e8853.f8a5e8",
                "907328e3.e91398"
            ]
        ]
    },
    {
        "id": "6376d20e.819ecc",
        "type": "subflow:26e982ee.cf503e",
        "z": "f9c24c90.68012",
        "name": "",
        "env": [
            {
                "name": "channel_id",
                "type": "str",
                "value": "D205"
            },
            {
                "name": "pre_processing_sec",
                "type": "num",
                "value": "2"
            },
            {
                "name": "post_processing_sec",
                "type": "num",
                "value": "2"
            }
        ],
        "x": 310,
        "y": 1940,
        "wires": [
            [
                "e039b9dd.4218d8"
            ]
        ]
    },
    {
        "id": "aa9e8853.f8a5e8",
        "type": "qi-chameleon-sink",
        "z": "f9c24c90.68012",
        "name": "",
        "x": 680,
        "y": 1940,
        "wires": []
    },
    {
        "id": "64cf675a.e9e448",
        "type": "function",
        "z": "f9c24c90.68012",
        "name": "init args",
        "func": "msg.args = {}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 500,
        "y": 2020,
        "wires": [
            [
                "57f05133.ebc1c"
            ]
        ]
    },
    {
        "id": "57f05133.ebc1c",
        "type": "function",
        "z": "f9c24c90.68012",
        "name": "save trigger time",
        "func": "msg.payload = new Date()\nmsg.args.trigger_time = msg.payload\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 660,
        "y": 2020,
        "wires": [
            [
                "d5901dcd.88d43"
            ]
        ]
    },
    {
        "id": "d5901dcd.88d43",
        "type": "qi-interval-boundary",
        "z": "f9c24c90.68012",
        "name": "",
        "timezone": "local",
        "intervalDuration": "86400",
        "shiftInterval": "0",
        "x": 850,
        "y": 2020,
        "wires": [
            [
                "5e5f5bb9.204d24"
            ]
        ]
    },
    {
        "id": "5e5f5bb9.204d24",
        "type": "function",
        "z": "f9c24c90.68012",
        "name": "save being/end time",
        "func": "msg.args.utilization_begin_time = msg.payload.begin\nmsg.args.utilization_end_time = msg.payload.end\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1060,
        "y": 2020,
        "wires": [
            [
                "9811cc97.a44ee"
            ]
        ]
    },
    {
        "id": "6294add3.54c7f4",
        "type": "function",
        "z": "f9c24c90.68012",
        "name": "append since/until",
        "func": "const changed_list = msg.payload\nconst utilization_begin_time = msg.args.utilization_begin_time\nconst trigger_time = msg.args.trigger_time\n\nif (changed_list.length === 0)\n{\n    return\n}\n\nmsg.since = utilization_begin_time\nmsg.until = trigger_time\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 530,
        "y": 2080,
        "wires": [
            [
                "1376c060.66d9d"
            ]
        ]
    },
    {
        "id": "1376c060.66d9d",
        "type": "qi-state-duration",
        "z": "f9c24c90.68012",
        "name": "",
        "stateName": "changed",
        "x": 720,
        "y": 2080,
        "wires": [
            [
                "c0f95562.7506d8"
            ]
        ]
    },
    {
        "id": "c0f95562.7506d8",
        "type": "function",
        "z": "f9c24c90.68012",
        "name": "build utilization reading",
        "func": "const trigger_timestamp = msg.args.trigger_time.getTime()\nconst state_duration_list = msg.payload\n\nlet today_utilization_seconds = 0\nstate_duration_list.forEach(function (item){\n    if (item.state === 1)\n    {\n        today_utilization_seconds = Math.floor(item.duration / 1000);\n    }\n})\n\nmsg.payload = {\n    \"deviceId\": \"stamping_press_107_production_info\",\n    \"at\": {\n        \"sec\": Math.floor(trigger_timestamp / 1000),\n        \"us\": trigger_timestamp % 1000\n    },\n    \"channels\": {\n        \"utilization_sec\": today_utilization_seconds\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 920,
        "y": 2080,
        "wires": [
            [
                "8b7715a7.b3c8e8"
            ]
        ]
    },
    {
        "id": "9811cc97.a44ee",
        "type": "subflow:c396c221.180cf",
        "z": "f9c24c90.68012",
        "name": "",
        "env": [
            {
                "name": "device_id",
                "type": "str",
                "value": "stamping_press_107_event"
            },
            {
                "name": "channel_id",
                "type": "str",
                "value": "working"
            }
        ],
        "x": 320,
        "y": 2080,
        "wires": [
            [
                "6294add3.54c7f4"
            ]
        ]
    },
    {
        "id": "8b7715a7.b3c8e8",
        "type": "qi-chameleon-sink",
        "z": "f9c24c90.68012",
        "name": "",
        "x": 1140,
        "y": 2080,
        "wires": []
    },
    {
        "id": "6213f1d1.c1423",
        "type": "subflow:15296a9d.2cdf05",
        "z": "f9c24c90.68012",
        "name": "",
        "env": [],
        "x": 910,
        "y": 1840,
        "wires": [
            [
                "46d9024b.38b79c"
            ]
        ]
    },
    {
        "id": "46d9024b.38b79c",
        "type": "qi-chameleon-sink",
        "z": "f9c24c90.68012",
        "name": "",
        "x": 1180,
        "y": 1840,
        "wires": []
    },
    {
        "id": "a7169908.11db38",
        "type": "function",
        "z": "f9c24c90.68012",
        "name": "parameters",
        "func": "const last_count_changed_at = msg.payload.at\n\nmsg.params = {\n    BASE_DEVICE_ID: 'stamping_press_107',\n    CHANNEL_ID: 'D205',\n    LAST_COUNT_CHANGED_AT: last_count_changed_at\n}           \n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "x": 650,
        "y": 1840,
        "wires": [
            [
                "6213f1d1.c1423"
            ]
        ]
    },
    {
        "id": "907328e3.e91398",
        "type": "switch",
        "z": "f9c24c90.68012",
        "name": "forward working end",
        "property": "payload.channels.working",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 320,
        "y": 2020,
        "wires": [
            [
                "64cf675a.e9e448"
            ]
        ]
    },
    {
        "id": "510e865.e573378",
        "type": "qi-chameleon-source",
        "z": "f9c24c90.68012",
        "name": "",
        "deviceId": "stamping_press_106",
        "x": 260,
        "y": 1420,
        "wires": [
            [
                "a64c2fe5.6fa0c"
            ]
        ]
    },
    {
        "id": "51d61b8a.194d54",
        "type": "qi-forward-on-change",
        "z": "f9c24c90.68012",
        "name": "",
        "initialValue": "{}",
        "initialValueType": "json",
        "useInitialValue": false,
        "x": 430,
        "y": 1460,
        "wires": [
            [
                "9481ce0e.1eccc",
                "1f6dad3f.df5f43"
            ]
        ]
    },
    {
        "id": "a64c2fe5.6fa0c",
        "type": "qi-forward-on-match",
        "z": "f9c24c90.68012",
        "name": "",
        "schema": "{\"$schema\":\"http://json-schema.org/draft-07/schema#\",\"type\":\"object\",\"required\":[\"deviceId\",\"at\",\"channels\"],\"properties\":{\"deviceId\":{\"type\":\"string\"},\"at\":{\"type\":\"object\",\"required\":[\"sec\",\"us\"],\"properties\":{\"sec\":{\"type\":\"integer\",\"minimum\":0},\"us\":{\"type\":\"integer\",\"minimum\":0,\"maximum\":999999}}},\"channels\":{\"type\":\"object\",\"required\":[\"D205\"],\"properties\":{\"D205\":{\"type\":\"integer\"}}}}}",
        "schemaType": "json",
        "removeAdditional": true,
        "x": 280,
        "y": 1460,
        "wires": [
            [
                "51d61b8a.194d54"
            ]
        ]
    },
    {
        "id": "34140f87.e86c",
        "type": "function",
        "z": "f9c24c90.68012",
        "name": "build reading",
        "func": "const at = msg.payload.at\nconst state = msg.payload.state\n\nmsg.payload = {\n    \"deviceId\": \"stamping_press_106_event\",\n    \"at\": at,\n    \"channels\": {\n        \"working\": state\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 490,
        "y": 1560,
        "wires": [
            [
                "baaa7634.c52528",
                "6b73df68.4d4a5"
            ]
        ]
    },
    {
        "id": "9481ce0e.1eccc",
        "type": "subflow:26e982ee.cf503e",
        "z": "f9c24c90.68012",
        "name": "",
        "env": [
            {
                "name": "channel_id",
                "type": "str",
                "value": "D205"
            },
            {
                "name": "pre_processing_sec",
                "type": "num",
                "value": "2"
            },
            {
                "name": "post_processing_sec",
                "type": "num",
                "value": "2"
            }
        ],
        "x": 310,
        "y": 1560,
        "wires": [
            [
                "34140f87.e86c"
            ]
        ]
    },
    {
        "id": "baaa7634.c52528",
        "type": "qi-chameleon-sink",
        "z": "f9c24c90.68012",
        "name": "",
        "x": 680,
        "y": 1560,
        "wires": []
    },
    {
        "id": "d5dea1f8.143f4",
        "type": "function",
        "z": "f9c24c90.68012",
        "name": "init args",
        "func": "msg.args = {}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 500,
        "y": 1640,
        "wires": [
            [
                "56394e73.45232"
            ]
        ]
    },
    {
        "id": "56394e73.45232",
        "type": "function",
        "z": "f9c24c90.68012",
        "name": "save trigger time",
        "func": "msg.payload = new Date()\nmsg.args.trigger_time = msg.payload\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 660,
        "y": 1640,
        "wires": [
            [
                "55f73fac.cb2c5"
            ]
        ]
    },
    {
        "id": "55f73fac.cb2c5",
        "type": "qi-interval-boundary",
        "z": "f9c24c90.68012",
        "name": "",
        "timezone": "local",
        "intervalDuration": "86400",
        "shiftInterval": "0",
        "x": 850,
        "y": 1640,
        "wires": [
            [
                "88076318.0a1f1"
            ]
        ]
    },
    {
        "id": "88076318.0a1f1",
        "type": "function",
        "z": "f9c24c90.68012",
        "name": "save being/end time",
        "func": "msg.args.utilization_begin_time = msg.payload.begin\nmsg.args.utilization_end_time = msg.payload.end\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1060,
        "y": 1640,
        "wires": [
            [
                "8aa34dee.97e9f"
            ]
        ]
    },
    {
        "id": "9313049e.335ae8",
        "type": "function",
        "z": "f9c24c90.68012",
        "name": "append since/until",
        "func": "const changed_list = msg.payload\nconst utilization_begin_time = msg.args.utilization_begin_time\nconst trigger_time = msg.args.trigger_time\n\nif (changed_list.length === 0)\n{\n    return\n}\n\nmsg.since = utilization_begin_time\nmsg.until = trigger_time\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 530,
        "y": 1700,
        "wires": [
            [
                "37a9e65a.436f0a"
            ]
        ]
    },
    {
        "id": "37a9e65a.436f0a",
        "type": "qi-state-duration",
        "z": "f9c24c90.68012",
        "name": "",
        "stateName": "changed",
        "x": 720,
        "y": 1700,
        "wires": [
            [
                "4a1bd3dd.f8aabc"
            ]
        ]
    },
    {
        "id": "4a1bd3dd.f8aabc",
        "type": "function",
        "z": "f9c24c90.68012",
        "name": "build utilization reading",
        "func": "const trigger_timestamp = msg.args.trigger_time.getTime()\nconst state_duration_list = msg.payload\n\nlet today_utilization_seconds = 0\nstate_duration_list.forEach(function (item){\n    if (item.state === 1)\n    {\n        today_utilization_seconds = Math.floor(item.duration / 1000);\n    }\n})\n\nmsg.payload = {\n    \"deviceId\": \"stamping_press_106_production_info\",\n    \"at\": {\n        \"sec\": Math.floor(trigger_timestamp / 1000),\n        \"us\": trigger_timestamp % 1000\n    },\n    \"channels\": {\n        \"utilization_sec\": today_utilization_seconds\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 920,
        "y": 1700,
        "wires": [
            [
                "7a1c2175.cfa25"
            ]
        ]
    },
    {
        "id": "8aa34dee.97e9f",
        "type": "subflow:c396c221.180cf",
        "z": "f9c24c90.68012",
        "name": "",
        "env": [
            {
                "name": "device_id",
                "type": "str",
                "value": "stamping_press_106_event"
            },
            {
                "name": "channel_id",
                "type": "str",
                "value": "working"
            }
        ],
        "x": 320,
        "y": 1700,
        "wires": [
            [
                "9313049e.335ae8"
            ]
        ]
    },
    {
        "id": "7a1c2175.cfa25",
        "type": "qi-chameleon-sink",
        "z": "f9c24c90.68012",
        "name": "",
        "x": 1140,
        "y": 1700,
        "wires": []
    },
    {
        "id": "47d0ca6f.938894",
        "type": "subflow:15296a9d.2cdf05",
        "z": "f9c24c90.68012",
        "name": "",
        "env": [],
        "x": 910,
        "y": 1460,
        "wires": [
            [
                "c7c24115.9fe2"
            ]
        ]
    },
    {
        "id": "c7c24115.9fe2",
        "type": "qi-chameleon-sink",
        "z": "f9c24c90.68012",
        "name": "",
        "x": 1180,
        "y": 1460,
        "wires": []
    },
    {
        "id": "1f6dad3f.df5f43",
        "type": "function",
        "z": "f9c24c90.68012",
        "name": "parameters",
        "func": "const last_count_changed_at = msg.payload.at\n\nmsg.params = {\n    BASE_DEVICE_ID: 'stamping_press_106',\n    CHANNEL_ID: 'D205',\n    LAST_COUNT_CHANGED_AT: last_count_changed_at\n}           \n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "x": 650,
        "y": 1460,
        "wires": [
            [
                "47d0ca6f.938894"
            ]
        ]
    },
    {
        "id": "6b73df68.4d4a5",
        "type": "switch",
        "z": "f9c24c90.68012",
        "name": "forward working end",
        "property": "payload.channels.working",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 320,
        "y": 1640,
        "wires": [
            [
                "d5dea1f8.143f4"
            ]
        ]
    },
    {
        "id": "831819ee.898b28",
        "type": "qi-chameleon-source",
        "z": "f9c24c90.68012",
        "name": "",
        "deviceId": "stamping_press_109",
        "x": 260,
        "y": 2560,
        "wires": [
            [
                "8d8ec5f9.406b08"
            ]
        ]
    },
    {
        "id": "f2f01835.446538",
        "type": "qi-forward-on-change",
        "z": "f9c24c90.68012",
        "name": "",
        "initialValue": "{}",
        "initialValueType": "json",
        "useInitialValue": false,
        "x": 430,
        "y": 2600,
        "wires": [
            [
                "6aadf3f.7cb2e0c",
                "1d6b588d.3e1587"
            ]
        ]
    },
    {
        "id": "8d8ec5f9.406b08",
        "type": "qi-forward-on-match",
        "z": "f9c24c90.68012",
        "name": "",
        "schema": "{\"$schema\":\"http://json-schema.org/draft-07/schema#\",\"type\":\"object\",\"required\":[\"deviceId\",\"at\",\"channels\"],\"properties\":{\"deviceId\":{\"type\":\"string\"},\"at\":{\"type\":\"object\",\"required\":[\"sec\",\"us\"],\"properties\":{\"sec\":{\"type\":\"integer\",\"minimum\":0},\"us\":{\"type\":\"integer\",\"minimum\":0,\"maximum\":999999}}},\"channels\":{\"type\":\"object\",\"required\":[\"D205\"],\"properties\":{\"D205\":{\"type\":\"integer\"}}}}}",
        "schemaType": "json",
        "removeAdditional": true,
        "x": 280,
        "y": 2600,
        "wires": [
            [
                "f2f01835.446538"
            ]
        ]
    },
    {
        "id": "1465f8d7.21cf07",
        "type": "function",
        "z": "f9c24c90.68012",
        "name": "build reading",
        "func": "const at = msg.payload.at\nconst state = msg.payload.state\n\nmsg.payload = {\n    \"deviceId\": \"stamping_press_109_event\",\n    \"at\": at,\n    \"channels\": {\n        \"working\": state\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 490,
        "y": 2700,
        "wires": [
            [
                "44f3e2ad.34a45c",
                "d77e93b3.d9f15"
            ]
        ]
    },
    {
        "id": "6aadf3f.7cb2e0c",
        "type": "subflow:26e982ee.cf503e",
        "z": "f9c24c90.68012",
        "name": "",
        "env": [
            {
                "name": "channel_id",
                "type": "str",
                "value": "D205"
            },
            {
                "name": "pre_processing_sec",
                "type": "num",
                "value": "2"
            },
            {
                "name": "post_processing_sec",
                "type": "num",
                "value": "2"
            }
        ],
        "x": 310,
        "y": 2700,
        "wires": [
            [
                "1465f8d7.21cf07"
            ]
        ]
    },
    {
        "id": "44f3e2ad.34a45c",
        "type": "qi-chameleon-sink",
        "z": "f9c24c90.68012",
        "name": "",
        "x": 680,
        "y": 2700,
        "wires": []
    },
    {
        "id": "b723e9eb.3ec698",
        "type": "function",
        "z": "f9c24c90.68012",
        "name": "init args",
        "func": "msg.args = {}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 500,
        "y": 2780,
        "wires": [
            [
                "f0de9606.2cea68"
            ]
        ]
    },
    {
        "id": "f0de9606.2cea68",
        "type": "function",
        "z": "f9c24c90.68012",
        "name": "save trigger time",
        "func": "msg.payload = new Date()\nmsg.args.trigger_time = msg.payload\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 660,
        "y": 2780,
        "wires": [
            [
                "1ef894b2.ec989b"
            ]
        ]
    },
    {
        "id": "1ef894b2.ec989b",
        "type": "qi-interval-boundary",
        "z": "f9c24c90.68012",
        "name": "",
        "timezone": "local",
        "intervalDuration": "86400",
        "shiftInterval": "0",
        "x": 850,
        "y": 2780,
        "wires": [
            [
                "6b97230b.f7162c"
            ]
        ]
    },
    {
        "id": "6b97230b.f7162c",
        "type": "function",
        "z": "f9c24c90.68012",
        "name": "save being/end time",
        "func": "msg.args.utilization_begin_time = msg.payload.begin\nmsg.args.utilization_end_time = msg.payload.end\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1060,
        "y": 2780,
        "wires": [
            [
                "3556fd48.9aa702"
            ]
        ]
    },
    {
        "id": "5d767250.d6880c",
        "type": "function",
        "z": "f9c24c90.68012",
        "name": "append since/until",
        "func": "const changed_list = msg.payload\nconst utilization_begin_time = msg.args.utilization_begin_time\nconst trigger_time = msg.args.trigger_time\n\nif (changed_list.length === 0)\n{\n    return\n}\n\nmsg.since = utilization_begin_time\nmsg.until = trigger_time\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 530,
        "y": 2840,
        "wires": [
            [
                "6f4862b3.e308ac"
            ]
        ]
    },
    {
        "id": "6f4862b3.e308ac",
        "type": "qi-state-duration",
        "z": "f9c24c90.68012",
        "name": "",
        "stateName": "changed",
        "x": 720,
        "y": 2840,
        "wires": [
            [
                "f9f92b97.944bb8"
            ]
        ]
    },
    {
        "id": "f9f92b97.944bb8",
        "type": "function",
        "z": "f9c24c90.68012",
        "name": "build utilization reading",
        "func": "const trigger_timestamp = msg.args.trigger_time.getTime()\nconst state_duration_list = msg.payload\n\nlet today_utilization_seconds = 0\nstate_duration_list.forEach(function (item){\n    if (item.state === 1)\n    {\n        today_utilization_seconds = Math.floor(item.duration / 1000);\n    }\n})\n\nmsg.payload = {\n    \"deviceId\": \"stamping_press_109_production_info\",\n    \"at\": {\n        \"sec\": Math.floor(trigger_timestamp / 1000),\n        \"us\": trigger_timestamp % 1000\n    },\n    \"channels\": {\n        \"utilization_sec\": today_utilization_seconds\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 920,
        "y": 2840,
        "wires": [
            [
                "bed790e5.31694"
            ]
        ]
    },
    {
        "id": "3556fd48.9aa702",
        "type": "subflow:c396c221.180cf",
        "z": "f9c24c90.68012",
        "name": "",
        "env": [
            {
                "name": "device_id",
                "type": "str",
                "value": "stamping_press_109_event"
            },
            {
                "name": "channel_id",
                "type": "str",
                "value": "working"
            }
        ],
        "x": 320,
        "y": 2840,
        "wires": [
            [
                "5d767250.d6880c"
            ]
        ]
    },
    {
        "id": "bed790e5.31694",
        "type": "qi-chameleon-sink",
        "z": "f9c24c90.68012",
        "name": "",
        "x": 1140,
        "y": 2840,
        "wires": []
    },
    {
        "id": "488bcec8.2caf7",
        "type": "subflow:15296a9d.2cdf05",
        "z": "f9c24c90.68012",
        "name": "",
        "env": [],
        "x": 910,
        "y": 2600,
        "wires": [
            [
                "13cd7b9e.2c4e04"
            ]
        ]
    },
    {
        "id": "13cd7b9e.2c4e04",
        "type": "qi-chameleon-sink",
        "z": "f9c24c90.68012",
        "name": "",
        "x": 1180,
        "y": 2600,
        "wires": []
    },
    {
        "id": "1d6b588d.3e1587",
        "type": "function",
        "z": "f9c24c90.68012",
        "name": "parameters",
        "func": "const last_count_changed_at = msg.payload.at\n\nmsg.params = {\n    BASE_DEVICE_ID: 'stamping_press_109',\n    CHANNEL_ID: 'D205',\n    LAST_COUNT_CHANGED_AT: last_count_changed_at\n}           \n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "x": 650,
        "y": 2600,
        "wires": [
            [
                "488bcec8.2caf7"
            ]
        ]
    },
    {
        "id": "d77e93b3.d9f15",
        "type": "switch",
        "z": "f9c24c90.68012",
        "name": "forward working end",
        "property": "payload.channels.working",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 320,
        "y": 2780,
        "wires": [
            [
                "b723e9eb.3ec698"
            ]
        ]
    },
    {
        "id": "443ef610.5d5708",
        "type": "qi-chameleon-source",
        "z": "6a71a10d.27fa1",
        "name": "",
        "deviceId": "HC_FANUC01_event",
        "x": 240,
        "y": 180,
        "wires": [
            [
                "8aa32d4a.4e37c"
            ]
        ]
    },
    {
        "id": "8aa32d4a.4e37c",
        "type": "trigger",
        "z": "6a71a10d.27fa1",
        "op1": "",
        "op2": "",
        "op1type": "nul",
        "op2type": "payl",
        "duration": "2",
        "extend": true,
        "units": "hr",
        "reset": "",
        "bytopic": "all",
        "name": "",
        "x": 530,
        "y": 180,
        "wires": [
            [
                "7331b57b.e4e0ec",
                "cfa4d321.2c675"
            ]
        ]
    },
    {
        "id": "7331b57b.e4e0ec",
        "type": "function",
        "z": "6a71a10d.27fa1",
        "name": "no new data send email",
        "func": "const a = msg.payload\nmsg.device = a.deviceId\n\nmsg.topic = '明昌CNC設備異常';\nmsg.payload = '設備沒資料' + msg.device\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "x": 790,
        "y": 180,
        "wires": [
            [
                "2ceb4fab.c66b4"
            ]
        ]
    },
    {
        "id": "2ceb4fab.c66b4",
        "type": "e-mail",
        "z": "6a71a10d.27fa1",
        "server": "smtp.gmail.com",
        "port": "465",
        "secure": true,
        "tls": true,
        "name": "eric1114473@gmail.com",
        "dname": "",
        "x": 1050,
        "y": 180,
        "wires": []
    },
    {
        "id": "cfa4d321.2c675",
        "type": "debug",
        "z": "6a71a10d.27fa1",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 750,
        "y": 260,
        "wires": []
    }
]