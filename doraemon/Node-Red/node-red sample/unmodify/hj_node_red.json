[
    {
        "id": "5606eb09.0cf1a4",
        "type": "tab",
        "label": "Test",
        "disabled": false,
        "info": ""
    },
    {
        "id": "397ce130.4f902e",
        "type": "tab",
        "label": "HJ EIM",
        "disabled": false,
        "info": ""
    },
    {
        "id": "91ec86b9.d49fe8",
        "type": "tab",
        "label": "HJ_EIM_電鍍",
        "disabled": false,
        "info": ""
    },
    {
        "id": "e4beaa17.839f48",
        "type": "tab",
        "label": "HJ_EIM_微影",
        "disabled": false,
        "info": ""
    },
    {
        "id": "c80d918.f44b27",
        "type": "tab",
        "label": "HJ_EIM_壓合",
        "disabled": false,
        "info": ""
    },
    {
        "id": "832ec745.2f9928",
        "type": "tab",
        "label": "HJ_EIM_後段",
        "disabled": false,
        "info": ""
    },
    {
        "id": "cbf34f11.3db4",
        "type": "tab",
        "label": "MSMQ Run",
        "disabled": true,
        "info": ""
    },
    {
        "id": "3b73a09.e77af6",
        "type": "subflow",
        "name": "Detect Alarm",
        "info": "Input:\n- from sub-flow Data Read output\n\nOutput:\n- `msg.alarms`\n    ```\n    {\n        \"alarm_00': 1\n    }\n    ```\n- `msg.channelNames`\n    ```\n    {\n        \"alarm_00\": \"告警_00\"\n    }\n    ```\n- `msg.equipmentInfo`\n    ```\n    {\n        \"equipmentName\": \"設備\",\n        \"machineNo\": \"DEV123\"\n    }\n    ```\n- `msg.readingIn`\n    ```\n    \"at\": 1604654363815,\n    \"reading\": {\n        \"alarm_00\": 0\n    },\n    status: {\n        \"code\": 0,\n        \"message\": \"\"\n    }\n    ```",
        "category": "",
        "in": [
            {
                "x": 80,
                "y": 180,
                "wires": [
                    {
                        "id": "1e4d6cd3.e09423"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 780,
                "y": 180,
                "wires": [
                    {
                        "id": "95c9b19a.4712",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "color": "#DDAA99"
    },
    {
        "id": "46c3b751.13e688",
        "type": "subflow",
        "name": "Query Status",
        "info": "Environment:\n- MONITOR_LIST\n  ```\n  [\"AVAIL\"]\n  ```\n\nInput:\n\n- from sub-flow Detect Alarm output\n\nOutput 1:\n- `msg.alarms`\n    ```\n    {\n        \"alarm_00': 1\n    }\n    ```\n- `msg.channelNames`\n    ```\n    {\n        \"alarm_00\": \"告警_00\"\n    }\n    ```\n- `msg.equipmentInfo`\n    ```\n    {\n        \"equipmentName\": \"設備\",\n        \"machineNo\": \"DEV123\"\n    }\n    ```\n- `msg.queryResult`\n    ```\n    {\n        \"code\": 0,\n        \"message\": \"\",\n        \"result\": [\n            {\n                \"MachineNo\": \"10PTHPNL005\",\n                \"PromisStatus\": \"AVAIL\",\n                \"PromisTime\": \"2020-11-03T04:38:03.000Z\",\n                \"LotNo\": \" 60A015607.1; .....\"\n            }\n        ]\n    }\n    ```\n- `msg.readingIn`\n    ```\n    \"at\": 1604654363815,\n    \"reading\": {\n        \"alarm_00\": 0\n    },\n    status: {\n        \"code\": 0,\n        \"message\": \"\"\n    }\n    ```\n\nOutput 2:\n- `msg.equipmentInfo`\n    ```\n    {\n        \"equipmentName\": \"設備\",\n        \"machineNo\": \"DEV123\"\n    }\n    ```\n- `msg.queryResult`\n    ```\n    {\n        \"code\": 1,\n        \"message\": \"xxxx\"\n    }\n    ```\n",
        "category": "",
        "in": [
            {
                "x": 60,
                "y": 120,
                "wires": [
                    {
                        "id": "3d19c81c.a73db8"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1080,
                "y": 160,
                "wires": [
                    {
                        "id": "f22d7a4e.a8fc68",
                        "port": 0
                    }
                ]
            },
            {
                "x": 1080,
                "y": 220,
                "wires": [
                    {
                        "id": "f22d7a4e.a8fc68",
                        "port": 1
                    }
                ]
            }
        ],
        "env": [
            {
                "name": "MONITOR_LIST",
                "type": "json",
                "value": ""
            }
        ],
        "color": "#DDAA99"
    },
    {
        "id": "3441a2ec.833a6e",
        "type": "subflow",
        "name": "Alarm Email",
        "info": "Input:\n- from sub-flow Query Status output 1\n\nOutput:\n- `msg.alarms`\n    ```\n    {\n        \"alarm_00': 1\n    }\n    ```\n- `msg.channelNames`\n    ```\n    {\n        \"alarm_00\": \"告警_00\"\n    }\n    ```\n- `msg.equipmentInfo`\n    ```\n    {\n        \"equipmentName\": \"設備\",\n        \"machineNo\": \"DEV123\"\n    }\n    ```\n- `msg.queryResult`\n    ```\n    {\n        \"code\": 0,\n        \"message\": \"\",\n        \"result\": [\n            {\n                \"MachineNo\": \"10PTHPNL005\",\n                \"PromisStatus\": \"AVAIL\",\n                \"PromisTime\": \"2020-11-03T04:38:03.000Z\",\n                \"LotNo\": \" 60A015607.1; .....\"\n            }\n        ]\n    }\n    ```\n- `msg.readingIn`\n    ```\n    \"at\": 1604654363815,\n    \"reading\": {\n        \"alarm_00\": 0\n    },\n    status: {\n        \"code\": 0,\n        \"message\": \"\"\n    }\n    ```\n",
        "category": "",
        "in": [
            {
                "x": 260,
                "y": 180,
                "wires": [
                    {
                        "id": "76fb5338.9b860c"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 920,
                "y": 180,
                "wires": [
                    {
                        "id": "cb977225.ac2f2",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "color": "#DDAA99"
    },
    {
        "id": "9c352516.1ade28",
        "type": "subflow",
        "name": "Query Failure Email",
        "info": "Input:\n- from sub-flow Query Status output 2\n\nOutput:\n- `msg.payload`\n    ```\n    {\n        \"reading\": {\n            \"message\": \"\"    \n        }\n    }\n    ```\n",
        "category": "",
        "in": [
            {
                "x": 160,
                "y": 220,
                "wires": [
                    {
                        "id": "87563846.8b2aa8"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 920,
                "y": 220,
                "wires": [
                    {
                        "id": "30e7701f.231db",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "color": "#DDAA99"
    },
    {
        "id": "8ea31ce9.488ad",
        "type": "subflow",
        "name": "Log History",
        "info": "Input:\n- from sub-flow Alarm Email output\n\nOutput:\n- `msg.payload`\n    ```\n    {\n        \"reading\": {\n            \"message\": \"\"    \n        }\n    }\n    ```\n",
        "category": "",
        "in": [
            {
                "x": 40,
                "y": 200,
                "wires": [
                    {
                        "id": "9e685c54.14375"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 820,
                "y": 240,
                "wires": [
                    {
                        "id": "5f695c42.7aa984",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "color": "#DDAA99"
    },
    {
        "id": "7a61fc3d.3aa584",
        "type": "subflow",
        "name": "Data Read",
        "info": "Environment:\n- EQUIPMENT_ID\n \nInput:\n- from reading-in node\n\nOutput:\n- `msg.channelNames`\n    ```\n    {\n        \"alarm_00\": \"告警_00\"\n    }\n    ```\n- `msg.equipmentInfo`\n    ```\n    {\n        \"equipmentName\": \"設備\",\n        \"machineNo\": \"DEV123\"\n    }\n    ```\n- `msg.readingIn`\n    ```\n    \"at\": 1604654363815,\n    \"reading\": {\n        \"alarm_00\": 0\n    },\n    status: {\n        \"code\": 0,\n        \"message\": \"\"\n    }\n    ```",
        "category": "",
        "in": [],
        "out": [
            {
                "x": 960,
                "y": 360,
                "wires": [
                    {
                        "id": "7c136db5.cbc2e4",
                        "port": 0
                    },
                    {
                        "id": "bc2e621f.4d585",
                        "port": 0
                    },
                    {
                        "id": "158abe94.70fca1",
                        "port": 0
                    },
                    {
                        "id": "a6a22d1.4fdacd",
                        "port": 0
                    },
                    {
                        "id": "a0f22d99.62fc8",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [
            {
                "name": "EQUIPMENT_ID",
                "type": "str",
                "value": ""
            }
        ],
        "color": "#DDAA99"
    },
    {
        "id": "b083bb95.861038",
        "type": "subflow",
        "name": "Alarm Email _電鍍",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 60,
                "y": 140,
                "wires": [
                    {
                        "id": "eb059a09.4aa1d8"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 800,
                "y": 140,
                "wires": [
                    {
                        "id": "2f9e356.92bd0ca",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "color": "#DDAA99"
    },
    {
        "id": "89fdc1f9.a927a",
        "type": "subflow",
        "name": "Alarm Email _微影",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 220,
                "y": 160,
                "wires": [
                    {
                        "id": "f70f63fc.f4c33"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 940,
                "y": 120,
                "wires": [
                    {
                        "id": "7246f365.880d3c",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "color": "#DDAA99"
    },
    {
        "id": "b741f1b7.19805",
        "type": "subflow",
        "name": "Alarm Email _壓合",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 240,
                "y": 160,
                "wires": [
                    {
                        "id": "801f0ec7.4ffb8"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 980,
                "y": 120,
                "wires": [
                    {
                        "id": "ae4934a2.af5d78",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "color": "#DDAA99"
    },
    {
        "id": "a1c64ce7.10946",
        "type": "subflow",
        "name": "Alarm Email _TEST",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 220,
                "y": 240,
                "wires": [
                    {
                        "id": "ff8d6796.427a98"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1000,
                "y": 200,
                "wires": [
                    {
                        "id": "c1b5938a.b9d4f",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "color": "#DDAA99"
    },
    {
        "id": "12b00dca.df6d12",
        "type": "subflow",
        "name": "Alarm Email _後段",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 240,
                "y": 140,
                "wires": [
                    {
                        "id": "2db4c273.69c41e"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1020,
                "y": 140,
                "wires": [
                    {
                        "id": "efe3e27f.f690b",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "color": "#DDAA99"
    },
    {
        "id": "e30aea47.352308",
        "type": "subflow",
        "name": "Load Equpment Info",
        "info": "Input:\n- from subflow `Env`\n\nOutput:\n- `msg.env`\n- `msg.equipmentInfo`\n    ```\n    {\n        \"equipmentId\": \"dev\",\n        \"equipmentName\": \"機台\"\n        \"properties\": {\n            \"machineName\": \"機台\",\n            \"machineNo\": \"DEV123\"\n        },\n        \"tempalte\": {\n            \"templateId\": \"template\",\n            \"commands\": [],\n            \"channels\": [],\n            \"contronSets\": []\n        },\n        \"categorizedChannels\": {\n            \"data\": [\"data_00\", \"data_01\"],\n            \"event\": [\"alarm_00\", \"alarm_01\"],\n        }\n    }\n    ```\n",
        "category": "",
        "in": [
            {
                "x": 80,
                "y": 100,
                "wires": [
                    {
                        "id": "81931b8a.cffea8"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1060,
                "y": 280,
                "wires": [
                    {
                        "id": "cc03619c.8b1ab",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "color": "#DDAA99"
    },
    {
        "id": "1524802c.2eebb",
        "type": "subflow",
        "name": "Query History",
        "info": "Input:\n- from subflow `Read Safebox`\n\nOutput:\n- msg.env\n- msg.equipmentInfo\n- msg.nextQuerySince\n- msg.forwardData\n    ```\n    {\n        \"at\": 1605856964946,\n        \"equipmentName\": \"設備\",\n        \"properties\": {\n            \"machineName\": \"machine\",\n            \"machineNo\": \"TA123\"\n        },\n        \"value\": [\n            \"name\": \"alarm_00\",\n            \"type\": \"num\",\n            \"value\": 0\n        ]\n    }\n    ```\n- msg.lastReading\n    ```\n    {\n        \"at\": 1605856964946,\n        \"reading\": {\n            \"alarm_00\": 0,\n            \"alarm_01\": 1,\n            \"data_00\": \"test-00\",\n            \"data_01\": 8\n        }\n    }\n    ```",
        "category": "",
        "in": [
            {
                "x": 120,
                "y": 140,
                "wires": [
                    {
                        "id": "8756c666.cf6e88"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1000,
                "y": 180,
                "wires": [
                    {
                        "id": "c7cb76fc.98cdb8",
                        "port": 0
                    },
                    {
                        "id": "5bcba760.4e2f98",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "color": "#DDAA99"
    },
    {
        "id": "cbbfcffb.86f5",
        "type": "subflow",
        "name": "Read Safebox",
        "info": "Input:\n- from subflow `Load Equipment Info`\n\nOutput 1:\n- msg.env\n- msg.equipmentInfo\n- msg.nextQuerySince\n    ```\n    0\n    ```\n\nOutput 2 (previous post failure):\n- msg.env\n- msg.equipmentInfo\n- msg.forwardData\n- msg.lastReading",
        "category": "",
        "in": [
            {
                "x": 80,
                "y": 180,
                "wires": [
                    {
                        "id": "716708d1.d2dfa8"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 780,
                "y": 180,
                "wires": [
                    {
                        "id": "1a9c626c.9f403e",
                        "port": 0
                    }
                ]
            },
            {
                "x": 780,
                "y": 260,
                "wires": [
                    {
                        "id": "1a9c626c.9f403e",
                        "port": 1
                    }
                ]
            }
        ],
        "env": [],
        "color": "#DDAA99"
    },
    {
        "id": "9f9d1bbb.2fa088",
        "type": "subflow",
        "name": "Wrtie Safebox",
        "info": "Input:\n- from subflow `To MSMQ Server`",
        "category": "",
        "in": [
            {
                "x": 120,
                "y": 200,
                "wires": [
                    {
                        "id": "24fce996.fd5a66"
                    }
                ]
            }
        ],
        "out": [],
        "env": [],
        "color": "#DDAA99"
    },
    {
        "id": "2d572c71.a8d6a4",
        "type": "subflow",
        "name": "To MSMQ Server",
        "info": "Input:\n- from subflow `Query History` or `Read Safebox`\n\nOutput:\n- msg.env\n- msg.equipmentInfo\n- msg.nextQuerySince\n- msg.forwardData\n- msg.lastReading\n- msg.statusCode\n    ```\n    200\n    ```",
        "category": "",
        "in": [
            {
                "x": 60,
                "y": 260,
                "wires": [
                    {
                        "id": "c7ff21f5.7796f"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 900,
                "y": 260,
                "wires": [
                    {
                        "id": "1ed08616.397a0a",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "color": "#DDAA99"
    },
    {
        "id": "99679bb5.c9aa78",
        "type": "subflow",
        "name": "Env",
        "info": "Environment:\n- TRIGGER_PERIOD_SEC\n- EQUPMENT_ID\n- READINGS_PER_UPDATE\n- ENDPOINT_URL\n- EVENT_ONLY\n\nOutput:\n- `msg.env`\n    ```\n    {\n        \"equipmentId\": \"virtual\",\n        \"readingsPerUpdate\": 5,\n        \"endpointUrl\": \"192.168.11.149/virtual/event\",\n        \"eventOnly\": false\n    }\n    ```",
        "category": "",
        "in": [],
        "out": [
            {
                "x": 700,
                "y": 260,
                "wires": [
                    {
                        "id": "c738b47.0587048",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [
            {
                "name": "TRIGGER_PERIOD_SEC",
                "type": "num",
                "value": "120"
            },
            {
                "name": "EQUPMENT_ID",
                "type": "str",
                "value": ""
            },
            {
                "name": "READINGS_PER_UPDATE",
                "type": "num",
                "value": "2"
            },
            {
                "name": "ENDPOINT_URL",
                "type": "str",
                "value": "http://10.17.66.220:12345/mq-diverter/0.1/api/tx8100"
            },
            {
                "name": "EVENT_ONLY",
                "type": "bool",
                "value": "false"
            }
        ],
        "color": "#DDAA99"
    },
    {
        "id": "edafaed6.a181f",
        "type": "subflow",
        "name": "Subflow 1",
        "info": "",
        "in": [],
        "out": []
    },
    {
        "id": "732be65a.ac2f78",
        "type": "subflow",
        "name": "Alarm Email _化學前處理",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 40,
                "y": 160,
                "wires": [
                    {
                        "id": "daeb9d8a.527d4"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 800,
                "y": 100,
                "wires": [
                    {
                        "id": "190d9f6b.911901",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "color": "#DDAA99"
    },
    {
        "id": "76d36505.df383c",
        "type": "ui_base",
        "theme": {
            "name": "theme-light",
            "lightTheme": {
                "default": "#0094CE",
                "baseColor": "#0094CE",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "edited": true,
                "reset": false
            },
            "darkTheme": {
                "default": "#097479",
                "baseColor": "#097479",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "edited": false
            },
            "customTheme": {
                "name": "Untitled Theme 1",
                "default": "#4B7930",
                "baseColor": "#4B7930",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
            },
            "themeState": {
                "base-color": {
                    "default": "#0094CE",
                    "value": "#0094CE",
                    "edited": false
                },
                "page-titlebar-backgroundColor": {
                    "value": "#0094CE",
                    "edited": false
                },
                "page-backgroundColor": {
                    "value": "#fafafa",
                    "edited": false
                },
                "page-sidebar-backgroundColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "group-textColor": {
                    "value": "#1bbfff",
                    "edited": false
                },
                "group-borderColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "group-backgroundColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "widget-textColor": {
                    "value": "#111111",
                    "edited": false
                },
                "widget-backgroundColor": {
                    "value": "#0094ce",
                    "edited": false
                },
                "widget-borderColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "base-font": {
                    "value": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
                }
            },
            "angularTheme": {
                "primary": "indigo",
                "accents": "blue",
                "warn": "red",
                "background": "grey"
            }
        },
        "site": {
            "name": "Node-RED Dashboard",
            "hideToolbar": "false",
            "allowSwipe": "false",
            "lockMenu": "false",
            "allowTempTheme": "true",
            "dateFormat": "DD/MM/YYYY",
            "sizes": {
                "sx": 48,
                "sy": 48,
                "gx": 6,
                "gy": 6,
                "cx": 6,
                "cy": 6,
                "px": 0,
                "py": 0
            }
        }
    },
    {
        "id": "e3942f62.df379",
        "type": "ui_base",
        "theme": {
            "name": "theme-light",
            "lightTheme": {
                "default": "#0094CE",
                "baseColor": "#0094CE",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "edited": true,
                "reset": false
            },
            "darkTheme": {
                "default": "#097479",
                "baseColor": "#097479",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "edited": false
            },
            "customTheme": {
                "name": "Untitled Theme 1",
                "default": "#4B7930",
                "baseColor": "#4B7930",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
            },
            "themeState": {
                "base-color": {
                    "default": "#0094CE",
                    "value": "#0094CE",
                    "edited": false
                },
                "page-titlebar-backgroundColor": {
                    "value": "#0094CE",
                    "edited": false
                },
                "page-backgroundColor": {
                    "value": "#fafafa",
                    "edited": false
                },
                "page-sidebar-backgroundColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "group-textColor": {
                    "value": "#1bbfff",
                    "edited": false
                },
                "group-borderColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "group-backgroundColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "widget-textColor": {
                    "value": "#111111",
                    "edited": false
                },
                "widget-backgroundColor": {
                    "value": "#0094ce",
                    "edited": false
                },
                "widget-borderColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "base-font": {
                    "value": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
                }
            },
            "angularTheme": {
                "primary": "indigo",
                "accents": "blue",
                "warn": "red",
                "background": "grey"
            }
        },
        "site": {
            "name": "Node-RED Dashboard",
            "hideToolbar": "false",
            "allowSwipe": "false",
            "lockMenu": "false",
            "allowTempTheme": "true",
            "dateFormat": "DD/MM/YYYY",
            "sizes": {
                "sx": 48,
                "sy": 48,
                "gx": 6,
                "gy": 6,
                "cx": 6,
                "cy": 6,
                "px": 0,
                "py": 0
            }
        }
    },
    {
        "id": "3058bb91.f42f74",
        "type": "subflow:3b73a09.e77af6",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "env": [],
        "x": 264,
        "y": 117,
        "wires": [
            [
                "cdbf988c.a840a8"
            ]
        ]
    },
    {
        "id": "476a9c04.7b5914",
        "type": "forward-on-change",
        "z": "3b73a09.e77af6",
        "name": "",
        "dropReadingUndefined": false,
        "initialValue": "",
        "initialValueType": "json",
        "useInitialValue": false,
        "x": 430,
        "y": 180,
        "wires": [
            [
                "95c9b19a.4712"
            ]
        ]
    },
    {
        "id": "1e4d6cd3.e09423",
        "type": "function",
        "z": "3b73a09.e77af6",
        "name": "validate input",
        "func": "const channel_names = msg.channelNames\nconst equipment_info = msg.equipmentInfo\nconst reading_in = msg.readingIn\n\nif (typeof channel_names === undefined ||\n        typeof reading_in === undefined ||\n        typeof equipment_info === undefined) \n{\n    node.error('input error')\n    return\n}\n\nmsg['payload'] = reading_in\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 230,
        "y": 180,
        "wires": [
            [
                "476a9c04.7b5914"
            ]
        ]
    },
    {
        "id": "95c9b19a.4712",
        "type": "function",
        "z": "3b73a09.e77af6",
        "name": "detect alarm",
        "func": "const previous_alarms = context.get('PREVIOUS_ALARMS')\nconst reading = msg.payload.reading\n\nlet new_alarms = {}\nlet current_alarms = {}\n\nif (previous_alarms !== undefined)\n{\n    // find new alarm\n    for (let [channel, value] of Object.entries(reading))\n    {\n        if (previous_alarms[channel] === undefined && value !== 0)\n        {\n            new_alarms[channel] = value\n        }\n    }\n    \n    // remove alarm\n    for (let channel in previous_alarms)\n    {\n        if (reading[channel] === 0)\n        {\n            delete previous_alarms[channel]\n        }    \n    }\n}\nelse\n{\n    for (let [channel, value] of Object.entries(reading))\n    {\n        if (value !== 0)\n        {\n            new_alarms[channel] = value\n        }\n    }\n}\n\nObject.assign(current_alarms, new_alarms, previous_alarms)\n\ncontext.set('PREVIOUS_ALARMS', current_alarms)\n\nif (Object.entries(new_alarms).length === 0)\n{\n    return\n}\n\nmsg.alarms = current_alarms\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 630,
        "y": 180,
        "wires": [
            []
        ]
    },
    {
        "id": "cdbf988c.a840a8",
        "type": "subflow:46c3b751.13e688",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "env": [
            {
                "name": "MONITOR_LIST",
                "value": "[\"AVAIL\"]",
                "type": "json"
            },
            {
                "name": "WSDL_URL",
                "value": "https://www.crcind.com/csp/samples/SOAP.Demo.CLS?WSDL=1",
                "type": "str"
            }
        ],
        "x": 429,
        "y": 117,
        "wires": [
            [
                "6f289a85.b4bde4"
            ],
            [
                "eb0cef7a.1076f"
            ]
        ]
    },
    {
        "id": "18df1c82.395413",
        "type": "function",
        "z": "46c3b751.13e688",
        "name": "validate input",
        "func": "const alarms = msg.alarms\nconst channel_names = msg.channelNames\nconst equipment_info = msg.equipmentInfo\nconst reading_in = msg.readingIn\n\nif (typeof alarms === undefined ||\n        typeof channel_names === undefined ||\n        typeof equipment_info === undefined ||\n        typeof reading_in === undefined) \n{\n    node.error('input error')\n    return\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 310,
        "y": 120,
        "wires": [
            [
                "b89b5509.a0b468"
            ]
        ]
    },
    {
        "id": "f22d7a4e.a8fc68",
        "type": "function",
        "z": "46c3b751.13e688",
        "name": "validate status",
        "func": "const MONITOR_LIST = env.get('MONITOR_LIST')\nconst query_result = msg.queryResult\nlet output = [null, msg]\n\nif (query_result.code === 0)\n{\n    const promis_status = query_result.result[0]['PromisStatus']\n    if (!MONITOR_LIST.includes(promis_status))\n    {\n        return    \n    }\n    \n    output = [msg, null]\n}\n\nreturn output",
        "outputs": 2,
        "noerr": 0,
        "x": 940,
        "y": 200,
        "wires": [
            [],
            []
        ]
    },
    {
        "id": "76fb5338.9b860c",
        "type": "function",
        "z": "3441a2ec.833a6e",
        "name": "validate input",
        "func": "const alarms = msg.alarms\nconst channel_names = msg.channelNames\nconst equipment_info = msg.equipmentInfo\nconst query_result = msg.queryResult\nconst reading_in = msg.readingIn\n\nif (typeof alarms === undefined ||\n        typeof channel_names === undefined ||\n        typeof equipment_info === undefined ||\n        typeof payload === undefined ||\n        typeof reading_in === undefined) \n{\n    node.error('input error')\n    return\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 410,
        "y": 180,
        "wires": [
            [
                "cb977225.ac2f2"
            ]
        ]
    },
    {
        "id": "eb0cef7a.1076f",
        "type": "subflow:9c352516.1ade28",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "env": [
            {
                "name": "TOPIC",
                "value": "Query MS-SQL failure",
                "type": "str"
            }
        ],
        "x": 679,
        "y": 140,
        "wires": [
            [
                "9d008da6.aa274"
            ]
        ]
    },
    {
        "id": "3d19c81c.a73db8",
        "type": "function",
        "z": "46c3b751.13e688",
        "name": "env",
        "func": "const MONITOR_LIST = env.get('MONITOR_LIST')\n\nif (MONITOR_LIST === undefined)\n{\n    node.error('env must be set')\n    return\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 170,
        "y": 120,
        "wires": [
            [
                "18df1c82.395413"
            ]
        ]
    },
    {
        "id": "783dd8e6.fdabc8",
        "type": "function",
        "z": "8ea31ce9.488ad",
        "name": "build insert",
        "func": "const alarms = msg.alarms\nconst channel_names = msg.channelNames\nconst equipment_info = msg.equipmentInfo\nconst query_result = msg.queryResult\nconst reading_in = msg.readingIn\n\nlet machine_no = equipment_info.machineNo\nlet eq_name = equipment_info.equipmentName\nlet insert_time = _to_ms_sql_datetime(reading_in.at)\nlet log_time = insert_time\nlet promis_status = query_result.result[0].PromisStatus\nlet promis_time = _to_ms_sql_datetime(\n    _offset_promis_time(query_result.result[0].PromisTime))\nlet lot_no = query_result.result[0].LotNo\n\nlet query_string = `INSERT INTO dbo.EIM_History VALUES\n`\n\nlet count = 0\nfor (let channel in alarms)\n{\n    let event_code = channel\n    let event_message = channel_names[channel]\n    \n    query_string += `(\\\n'${machine_no}', \\\n'${eq_name}', \\\n'${event_code}', \\\n'${event_message}', \\\n'${insert_time}', \\\n'${log_time}', \\\n'${promis_status}', \\\n'${promis_time}', \\\n'${lot_no}'\\\n)`\n\n    if (++count !== Object.keys(alarms).length)\n    {\n        query_string += ',\\n'\n    }\n}\n\nmsg.config = {\n    \"query\": query_string\n}\n\nreturn msg;\n\n// internal function\nfunction _offset_promis_time(from)\n{\n    const d = new Date(from)\n    \n    return d.getTime() - 28800000\n}\n\nfunction _to_ms_sql_datetime(from)\n{\n    const d = new Date(from)\n    \n    let date = (\"0\" + d.getDate()).slice(-2)\n    let month = (\"0\" + (d.getMonth() + 1)).slice(-2)\n    let year = d.getFullYear()\n    let hours = d.getHours()\n    let minutes = d.getMinutes()\n    let seconds = d.getSeconds()\n    \n    return year + \"-\" + month + \"-\" + date + \" \" + hours + \":\" + minutes + \":\" + seconds\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 350,
        "y": 200,
        "wires": [
            [
                "c057db7a.935ff8"
            ]
        ]
    },
    {
        "id": "9d008da6.aa274",
        "type": "reading-out",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "equipmentId": "logger",
        "x": 1080,
        "y": 140,
        "wires": []
    },
    {
        "id": "6192af09.fd7f3",
        "type": "e-mail",
        "z": "3441a2ec.833a6e",
        "server": "10.13.66.25",
        "port": "25",
        "secure": false,
        "tls": true,
        "name": "Kevin_Hu@unimicron.com",
        "dname": "",
        "x": 1020,
        "y": 260,
        "wires": []
    },
    {
        "id": "3614ad95.d7ce22",
        "type": "subflow:8ea31ce9.488ad",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "env": [],
        "x": 870,
        "y": 100,
        "wires": [
            [
                "9d008da6.aa274"
            ]
        ]
    },
    {
        "id": "df2096b6.5c3118",
        "type": "reading-in",
        "z": "7a61fc3d.3aa584",
        "name": "",
        "equipmentId": "${EQUIPMENT_ID}",
        "categorizedReadingRequired": true,
        "channelNamesRequired": true,
        "x": 160,
        "y": 240,
        "wires": [
            [
                "9fd58486.33a358"
            ]
        ]
    },
    {
        "id": "21cc0df.29455f2",
        "type": "subflow:7a61fc3d.3aa584",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "env": [
            {
                "name": "EQUIPMENT_ID",
                "value": "HJ10PTHPNL003",
                "type": "str"
            },
            {
                "name": "DEVICE_ID",
                "value": "virtual",
                "type": "str"
            }
        ],
        "x": 101,
        "y": 117,
        "wires": [
            [
                "3058bb91.f42f74"
            ]
        ]
    },
    {
        "id": "9fd58486.33a358",
        "type": "function",
        "z": "7a61fc3d.3aa584",
        "name": "save reading in",
        "func": "const categorized_reading = msg.categorizedReading\nconst payload = msg.payload\n\nif (typeof categorized_reading === undefined) \n{\n    node.error('input error')\n    return\n}\n\nif (typeof categorized_reading['email'] === undefined) \n{\n    node.error('no email channels')\n    return\n}\n\nmsg.readingIn = payload\nmsg.readingIn.reading = categorized_reading['email']\n\nreturn msg\n",
        "outputs": 1,
        "noerr": 0,
        "x": 440,
        "y": 240,
        "wires": [
            [
                "3965514a.1f524e"
            ]
        ]
    },
    {
        "id": "3965514a.1f524e",
        "type": "api",
        "z": "7a61fc3d.3aa584",
        "name": "fins equipments",
        "method": "GET",
        "path": "/api/v1/config/fins/equipments",
        "x": 440,
        "y": 320,
        "wires": [
            [
                "7c136db5.cbc2e4"
            ]
        ]
    },
    {
        "id": "7c136db5.cbc2e4",
        "type": "function",
        "z": "7a61fc3d.3aa584",
        "name": "fins",
        "func": "const equipment_id = env.get(\"EQUIPMENT_ID\")\nconst payload = msg.payload\nconst status_code = msg.statusCode\n\nlet output = [null, msg]\nlet equipment_info = {}\n\nif (status_code !== 200)\n{\n    node.error('unexpected error')\n    return\n}\n\n// extract equipment info\nfor (let i = 0; i < payload.length; ++i)\n{\n    let equipment = payload[i]['equipment']\n    \n    if (equipment['equipmentId'] === equipment_id)\n    {\n        equipment_info['equipmentName'] = equipment['equipmentName']\n        \n        for(let i = 0; i < equipment['properties'].length; ++i)\n        {\n            \n            let property = equipment['properties'][i]\n            if (property['key'] === \"machineNo\")\n            {\n                equipment_info['machineNo'] = property['value']\n            }\n        }\n    }    \n}\n\nif (Object.entries(equipment_info).length !== 0)\n{\n    msg.equipmentInfo = equipment_info\n    output = [msg, null]\n}\n\nreturn output;",
        "outputs": 2,
        "noerr": 0,
        "x": 430,
        "y": 360,
        "wires": [
            [],
            [
                "cfb99515.cf5cf8"
            ]
        ]
    },
    {
        "id": "cfb99515.cf5cf8",
        "type": "api",
        "z": "7a61fc3d.3aa584",
        "name": "modbus equipments",
        "method": "GET",
        "path": "/api/v1/config/modbus/equipments",
        "x": 460,
        "y": 400,
        "wires": [
            [
                "bc2e621f.4d585"
            ]
        ]
    },
    {
        "id": "bc2e621f.4d585",
        "type": "function",
        "z": "7a61fc3d.3aa584",
        "name": "modbus",
        "func": "const equipment_id = env.get(\"EQUIPMENT_ID\")\nconst payload = msg.payload\nconst status_code = msg.statusCode\n\nlet output = [null, msg]\nlet equipment_info = {}\n\nif (status_code !== 200)\n{\n    node.error('unexpected error')\n    return\n}\n\n// extract equipment info\nfor (let i = 0; i < payload.length; ++i)\n{\n    let equipments = payload[i]['equipments']\n    \n    for (let i = 0; i < equipments.length; ++i)\n    {\n        let equipment = equipments[i]\n        \n        if (equipment['equipmentId'] === equipment_id)\n        {\n            equipment_info['equipmentName'] = equipment['equipmentName']\n            \n            for(let i = 0; i < equipment['properties'].length; ++i)\n            {\n                \n                let property = equipment['properties'][i]\n                if (property['key'] === \"machineNo\")\n                {\n                    equipment_info['machineNo'] = property['value']\n                }\n            }\n        }    \n    }\n}\n\nif (Object.entries(equipment_info).length !== 0)\n{\n    msg.equipmentInfo = equipment_info\n    output = [msg, null]\n}\n\nreturn output;",
        "outputs": 2,
        "noerr": 0,
        "x": 440,
        "y": 440,
        "wires": [
            [],
            [
                "6619ce38.16a09"
            ]
        ]
    },
    {
        "id": "e067b128.0097e",
        "type": "api",
        "z": "7a61fc3d.3aa584",
        "name": "mewtocol equipments",
        "method": "GET",
        "path": "/api/v1/config/mewtocol/equipments",
        "x": 460,
        "y": 560,
        "wires": [
            [
                "158abe94.70fca1"
            ]
        ]
    },
    {
        "id": "158abe94.70fca1",
        "type": "function",
        "z": "7a61fc3d.3aa584",
        "name": "mewtocol",
        "func": "const equipment_id = env.get(\"EQUIPMENT_ID\")\nconst payload = msg.payload\nconst status_code = msg.statusCode\n\nlet output = [null, msg]\nlet equipment_info = {}\n\nif (status_code !== 200)\n{\n    node.error('unexpected error')\n    return\n}\n\n// extract equipment info\nfor (let i = 0; i < payload.length; ++i)\n{\n    let equipment = payload[i]['equipment']\n    \n    if (equipment['equipmentId'] === equipment_id)\n    {\n        equipment_info['equipmentName'] = equipment['equipmentName']\n        \n        for(let i = 0; i < equipment['properties'].length; ++i)\n        {\n            \n            let property = equipment['properties'][i]\n            if (property['key'] === \"machineNo\")\n            {\n                equipment_info['machineNo'] = property['value']\n            }\n        }\n    }    \n}\n\nif (Object.entries(equipment_info).length !== 0)\n{\n    msg.equipmentInfo = equipment_info\n    output = [msg, null]\n}\n\nreturn output;",
        "outputs": 2,
        "noerr": 0,
        "x": 440,
        "y": 600,
        "wires": [
            [],
            [
                "77cd8f04.ca26f"
            ]
        ]
    },
    {
        "id": "77cd8f04.ca26f",
        "type": "api",
        "z": "7a61fc3d.3aa584",
        "name": "step7 equipments",
        "method": "GET",
        "path": "/api/v1/config/step7/equipments",
        "x": 450,
        "y": 640,
        "wires": [
            [
                "a6a22d1.4fdacd"
            ]
        ]
    },
    {
        "id": "a6a22d1.4fdacd",
        "type": "function",
        "z": "7a61fc3d.3aa584",
        "name": "step7",
        "func": "const equipment_id = env.get(\"EQUIPMENT_ID\")\nconst payload = msg.payload\nconst status_code = msg.statusCode\n\nlet output = [null, msg]\nlet equipment_info = {}\n\nif (status_code !== 200)\n{\n    node.error('unexpected error')\n    return\n}\n\n// extract equipment info\nfor (let i = 0; i < payload.length; ++i)\n{\n    let equipment = payload[i]['equipment']\n    \n    if (equipment['equipmentId'] === equipment_id)\n    {\n        equipment_info['equipmentName'] = equipment['equipmentName']\n        \n        for(let i = 0; i < equipment['properties'].length; ++i)\n        {\n            \n            let property = equipment['properties'][i]\n            if (property['key'] === \"machineNo\")\n            {\n                equipment_info['machineNo'] = property['value']\n            }\n        }\n    }    \n}\n\nif (Object.entries(equipment_info).length !== 0)\n{\n    msg.equipmentInfo = equipment_info\n    output = [msg, null]\n}\n\nreturn output;",
        "outputs": 2,
        "noerr": 0,
        "x": 430,
        "y": 680,
        "wires": [
            [],
            [
                "20f393cd.0f32dc"
            ]
        ]
    },
    {
        "id": "6619ce38.16a09",
        "type": "api",
        "z": "7a61fc3d.3aa584",
        "name": "melsec equipments",
        "method": "GET",
        "path": "/api/v1/config/melsec/equipments",
        "x": 450,
        "y": 480,
        "wires": [
            [
                "a0f22d99.62fc8"
            ]
        ]
    },
    {
        "id": "a0f22d99.62fc8",
        "type": "function",
        "z": "7a61fc3d.3aa584",
        "name": "melsec",
        "func": "const equipment_id = env.get(\"EQUIPMENT_ID\")\nconst payload = msg.payload\nconst status_code = msg.statusCode\n\nlet output = [null, msg]\nlet equipment_info = {}\n\nif (status_code !== 200)\n{\n    node.error('unexpected error')\n    return\n}\n\n// extract equipment info\nfor (let i = 0; i < payload.length; ++i)\n{\n    let equipments = payload[i]['equipmentList']\n    \n    for (let i = 0; i < equipments.length; ++i)\n    {\n        let equipment = equipments[i]\n        \n        if (equipment['equipmentId'] === equipment_id)\n        {\n            equipment_info['equipmentName'] = equipment['equipmentName']\n            \n            for(let i = 0; i < equipment['properties'].length; ++i)\n            {\n                \n                let property = equipment['properties'][i]\n                if (property['key'] === \"machineNo\")\n                {\n                    equipment_info['machineNo'] = property['value']\n                }\n            }\n        }    \n    }\n}\n\nif (Object.entries(equipment_info).length !== 0)\n{\n    msg.equipmentInfo = equipment_info\n    output = [msg, null]\n}\n\nreturn output;",
        "outputs": 2,
        "noerr": 0,
        "x": 440,
        "y": 520,
        "wires": [
            [],
            [
                "e067b128.0097e"
            ]
        ]
    },
    {
        "id": "20f393cd.0f32dc",
        "type": "function",
        "z": "7a61fc3d.3aa584",
        "name": "unexpected",
        "func": "node.error('unexpected')",
        "outputs": 0,
        "noerr": 0,
        "x": 430,
        "y": 760,
        "wires": []
    },
    {
        "id": "1cc47f3a.6e3e41",
        "type": "mssql",
        "z": "46c3b751.13e688",
        "name": "",
        "server": "10.13.69.49",
        "port": "1433",
        "connectionTimeout": "60000",
        "requestTimeout": "60000",
        "connectionPoolSize": "1",
        "username": "Datamation",
        "password": "P@ssw0rd",
        "database": "Datamation_PCB",
        "query": "",
        "x": 510,
        "y": 160,
        "wires": [
            [
                "b3d0c889.00c5b8"
            ]
        ]
    },
    {
        "id": "b89b5509.a0b468",
        "type": "function",
        "z": "46c3b751.13e688",
        "name": "build query",
        "func": "const machine_no = msg.equipmentInfo.machineNo\n\nmsg.config = {\n    \"query\": `EXEC dbo.PCB_Promis_Status_LotNo '${machine_no}'`\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 490,
        "y": 120,
        "wires": [
            [
                "1cc47f3a.6e3e41"
            ]
        ]
    },
    {
        "id": "87563846.8b2aa8",
        "type": "function",
        "z": "9c352516.1ade28",
        "name": "validate input",
        "func": "const equipment_info = msg.equipmentInfo\nconst query_result = msg.queryResult\n\nif (typeof equipment_info === undefined ||\n        typeof query_result === undefined) \n{\n    node.error('input error')\n    return\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 330,
        "y": 220,
        "wires": [
            [
                "d21d1739.1ed138"
            ]
        ]
    },
    {
        "id": "30e7701f.231db",
        "type": "function",
        "z": "9c352516.1ade28",
        "name": "build log",
        "func": "const query_result = msg.queryResult\nconst machine_no = msg.equipmentInfo.machineNo\n\nmsg.payload = {\n    'reading': {\n        'message': `machineNo: ${machine_no}, ${query_result.message}`\n    }\n}\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "x": 780,
        "y": 220,
        "wires": [
            []
        ]
    },
    {
        "id": "9e685c54.14375",
        "type": "function",
        "z": "8ea31ce9.488ad",
        "name": "validate input",
        "func": "const alarms = msg.alarms\nconst channel_names = msg.channelNames\nconst equipment_info = msg.equipmentInfo\nconst query_result = msg.queryResult\nconst reading_in = msg.readingIn\n\nif (typeof alarms === undefined ||\n        typeof channel_names === undefined ||\n        typeof equipment_info === undefined ||\n        typeof query_result === undefined ||\n        typeof reading_in === undefined) \n{\n    node.error('input error')\n    return\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 170,
        "y": 200,
        "wires": [
            [
                "783dd8e6.fdabc8"
            ]
        ]
    },
    {
        "id": "e1ec369e.e4af28",
        "type": "function",
        "z": "46c3b751.13e688",
        "name": "save query result",
        "func": "msg.queryResult = msg.payload\n\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "x": 730,
        "y": 200,
        "wires": [
            [
                "f22d7a4e.a8fc68"
            ]
        ]
    },
    {
        "id": "5f695c42.7aa984",
        "type": "function",
        "z": "8ea31ce9.488ad",
        "name": "validate status",
        "func": "const payload = msg.payload\nconst machine_no = msg.equipmentInfo.machineNo\n\nif (payload.code === 0)\n{\n    return\n}\n\nmsg.queryResult = payload\nmsg.payload = {\n    'reading': {\n        'message': `machineNo: ${machine_no}, ${payload.message}`\n    }\n}\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "x": 560,
        "y": 240,
        "wires": [
            [
                "96c9f851.02d1b8"
            ]
        ]
    },
    {
        "id": "96c9f851.02d1b8",
        "type": "function",
        "z": "8ea31ce9.488ad",
        "name": "build email message",
        "func": "const machine_no = msg.equipmentInfo.machineNo\nconst queryResult = msg.queryResult\n\n//msg.topic = `設備 ${machine_no} insert MS-SQL failure`\nmsg.topic = `設備 ${eq_name} insert MS-SQL failure`\nmsg.payload = `machineNo: ${machine_no}, ${queryResult.message}`\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 600,
        "y": 280,
        "wires": [
            [
                "380075af.06888a"
            ]
        ]
    },
    {
        "id": "c057db7a.935ff8",
        "type": "mssql",
        "z": "8ea31ce9.488ad",
        "name": "",
        "server": "10.13.69.49",
        "port": "1433",
        "connectionTimeout": "60000",
        "requestTimeout": "60000",
        "connectionPoolSize": "1",
        "username": "Datamation",
        "password": "P@ssw0rd",
        "database": "Datamation_HJ",
        "query": "",
        "x": 550,
        "y": 200,
        "wires": [
            [
                "5f695c42.7aa984"
            ]
        ]
    },
    {
        "id": "f8a0ef48.c30e3",
        "type": "e-mail",
        "z": "9c352516.1ade28",
        "server": "10.13.66.25",
        "port": "25",
        "secure": false,
        "tls": true,
        "name": "Kevin_Hu@unimicron.com",
        "dname": "",
        "x": 620,
        "y": 320,
        "wires": []
    },
    {
        "id": "380075af.06888a",
        "type": "e-mail",
        "z": "8ea31ce9.488ad",
        "server": "10.13.66.25",
        "port": "25",
        "secure": false,
        "tls": true,
        "name": "Kevin_Hu@unimicron.com",
        "dname": "",
        "x": 620,
        "y": 320,
        "wires": []
    },
    {
        "id": "97f11602.2318c8",
        "type": "function",
        "z": "3441a2ec.833a6e",
        "name": "build email message_old",
        "func": "const alarms = msg.alarms\nconst channel_names = msg.channelNames\nconst equipment_info = msg.equipmentInfo\nconst query_result = msg.queryResult\nconst reading_in = msg.readingIn\n\nlet machine_no = equipment_info.machineNo\nlet eq_name = equipment_info.equipmentName\nlet insert_time = _to_ms_sql_datetime(reading_in.at)\nlet log_time = insert_time\nlet promis_status = query_result.result[0].PromisStatus\nlet promis_time = _to_ms_sql_datetime(\n    _offset_promis_time(query_result.result[0].PromisTime))\nlet lot_no = query_result.result[0].LotNo\n\nlet html = `\n<body>\n\n<table  style=\"border:0px #000000 solid;padding:5px;\" rules=\"all\" cellpadding='5';border='1'>\n  <tr>\n    <th>MachineNo</th>\n    <th>EQName</th> \n    <th>EventCode</th>\n    <th>EventMessage</th>\n    <th>InsertTime</th>\n    <th>LogTime</th>\n    <th>PromisStatus</th>\n    <th>PromisTime</th>\n    <th>LotNo</th>\n  </tr>\n`\n\nfor (let channel in alarms)\n{\n    let event_code = channel\n    let event_message = channel_names[channel]\n    \n    html += `\n  <tr>\n    <td>${machine_no}</td>\n    <td>${eq_name}</td>\n    <td>${event_code}</td>\n    <td>${event_message}</td>\n    <td>${insert_time}</td>\n    <td>${log_time}</td>\n    <td>${promis_status}</td>\n    <td>${promis_time}</td>\n    <td>${lot_no}</td>\n  </tr>\n`\n}\n\nhtml += `\n</table>\n\n</body>\n\n此為系統自動發送, 請勿回覆\n`\n\n//msg.topic = `設備 ${machine_no}警告`\nmsg.topic = `設備 ${eq_name} 警告`\nmsg.payload = html\n\nreturn msg;\n\n// internal function\nfunction _offset_promis_time(from)\n{\n    const d = new Date(from)\n    \n    return d.getTime() - 28800000\n}\n\nfunction _to_ms_sql_datetime(from)\n{\n    const d = new Date(from)\n    \n    let date = (\"0\" + d.getDate()).slice(-2)\n    let month = (\"0\" + (d.getMonth() + 1)).slice(-2)\n    let year = d.getFullYear()\n    let hours = d.getHours()\n    let minutes = d.getMinutes()\n    let seconds = d.getSeconds()\n    \n    return year + \"-\" + month + \"-\" + date + \" \" + hours + \":\" + minutes + \":\" + seconds\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 650,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "ad1e30bc.57852",
        "type": "comment",
        "z": "91ec86b9.d49fe8",
        "name": "10PTHPNL003 VCP#1(2F)",
        "info": "",
        "x": 150,
        "y": 56,
        "wires": []
    },
    {
        "id": "5467cf12.5ec7",
        "type": "subflow:3b73a09.e77af6",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "env": [],
        "x": 264,
        "y": 256,
        "wires": [
            [
                "3007dc15.d34aa4"
            ]
        ]
    },
    {
        "id": "3007dc15.d34aa4",
        "type": "subflow:46c3b751.13e688",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "env": [
            {
                "name": "MONITOR_LIST",
                "value": "[\"AVAIL\"]",
                "type": "json"
            },
            {
                "name": "WSDL_URL",
                "value": "https://www.crcind.com/csp/samples/SOAP.Demo.CLS?WSDL=1",
                "type": "str"
            }
        ],
        "x": 430,
        "y": 256,
        "wires": [
            [
                "c2a888fc.b00848"
            ],
            [
                "5e60a1b.2b8b76"
            ]
        ]
    },
    {
        "id": "5e60a1b.2b8b76",
        "type": "subflow:9c352516.1ade28",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "env": [
            {
                "name": "TOPIC",
                "value": "Query MS-SQL failure",
                "type": "str"
            }
        ],
        "x": 680,
        "y": 280,
        "wires": [
            [
                "918a8759.9a6858"
            ]
        ]
    },
    {
        "id": "918a8759.9a6858",
        "type": "reading-out",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "equipmentId": "logger",
        "x": 1080,
        "y": 280,
        "wires": []
    },
    {
        "id": "b3c6424f.a143f",
        "type": "subflow:8ea31ce9.488ad",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "env": [],
        "x": 870,
        "y": 240,
        "wires": [
            [
                "918a8759.9a6858"
            ]
        ]
    },
    {
        "id": "a137e707.552e48",
        "type": "subflow:7a61fc3d.3aa584",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "env": [
            {
                "name": "EQUIPMENT_ID",
                "value": "HJ10PTHPNL004",
                "type": "str"
            },
            {
                "name": "DEVICE_ID",
                "value": "virtual",
                "type": "str"
            }
        ],
        "x": 101,
        "y": 256,
        "wires": [
            [
                "5467cf12.5ec7"
            ]
        ]
    },
    {
        "id": "6f7ce86f.645d58",
        "type": "comment",
        "z": "91ec86b9.d49fe8",
        "name": "10PTHPNL004 VCP#3(1F)",
        "info": "",
        "x": 150,
        "y": 196,
        "wires": []
    },
    {
        "id": "35b5b602.f276da",
        "type": "comment",
        "z": "91ec86b9.d49fe8",
        "name": "10PTHPNL006 VCP#5P",
        "info": "",
        "x": 150,
        "y": 336,
        "wires": []
    },
    {
        "id": "b2fbcb9a.f27628",
        "type": "subflow:3b73a09.e77af6",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "env": [],
        "x": 264,
        "y": 395,
        "wires": [
            [
                "c4d6fa90.856a68"
            ]
        ]
    },
    {
        "id": "c4d6fa90.856a68",
        "type": "subflow:46c3b751.13e688",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "env": [
            {
                "name": "MONITOR_LIST",
                "value": "[\"AVAIL\"]",
                "type": "json"
            },
            {
                "name": "WSDL_URL",
                "value": "https://www.crcind.com/csp/samples/SOAP.Demo.CLS?WSDL=1",
                "type": "str"
            }
        ],
        "x": 431,
        "y": 395,
        "wires": [
            [
                "6d2c2b10.8c4334"
            ],
            [
                "a4550e50.2e11d"
            ]
        ]
    },
    {
        "id": "a4550e50.2e11d",
        "type": "subflow:9c352516.1ade28",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "env": [
            {
                "name": "TOPIC",
                "value": "Query MS-SQL failure",
                "type": "str"
            }
        ],
        "x": 679,
        "y": 422,
        "wires": [
            [
                "22074183.4f68ee"
            ]
        ]
    },
    {
        "id": "22074183.4f68ee",
        "type": "reading-out",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "equipmentId": "logger",
        "x": 1080,
        "y": 420,
        "wires": []
    },
    {
        "id": "d97a14be.76b688",
        "type": "subflow:8ea31ce9.488ad",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "env": [],
        "x": 870,
        "y": 380,
        "wires": [
            [
                "22074183.4f68ee"
            ]
        ]
    },
    {
        "id": "5246a753.24d918",
        "type": "subflow:7a61fc3d.3aa584",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "env": [
            {
                "name": "EQUIPMENT_ID",
                "value": "HJ10PTHPNL006",
                "type": "str"
            },
            {
                "name": "DEVICE_ID",
                "value": "virtual",
                "type": "str"
            }
        ],
        "x": 101,
        "y": 395,
        "wires": [
            [
                "b2fbcb9a.f27628"
            ]
        ]
    },
    {
        "id": "3118e321.45017c",
        "type": "comment",
        "z": "91ec86b9.d49fe8",
        "name": "10PTHDMP003 龍門鍍銅線",
        "info": "",
        "x": 160,
        "y": 476,
        "wires": []
    },
    {
        "id": "4f2f5d0b.3e6794",
        "type": "subflow:3b73a09.e77af6",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "env": [],
        "x": 262,
        "y": 536,
        "wires": [
            [
                "bd34b77d.f80f68"
            ]
        ]
    },
    {
        "id": "bd34b77d.f80f68",
        "type": "subflow:46c3b751.13e688",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "env": [
            {
                "name": "MONITOR_LIST",
                "value": "[\"AVAIL\"]",
                "type": "json"
            },
            {
                "name": "WSDL_URL",
                "value": "https://www.crcind.com/csp/samples/SOAP.Demo.CLS?WSDL=1",
                "type": "str"
            }
        ],
        "x": 430,
        "y": 536,
        "wires": [
            [
                "884976b4.2c5f58"
            ],
            [
                "e6015cef.19b3d"
            ]
        ]
    },
    {
        "id": "e6015cef.19b3d",
        "type": "subflow:9c352516.1ade28",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "env": [
            {
                "name": "TOPIC",
                "value": "Query MS-SQL failure",
                "type": "str"
            }
        ],
        "x": 680,
        "y": 560,
        "wires": [
            [
                "d54b083e.2b45d8"
            ]
        ]
    },
    {
        "id": "d54b083e.2b45d8",
        "type": "reading-out",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "equipmentId": "logger",
        "x": 1080,
        "y": 560,
        "wires": []
    },
    {
        "id": "74652e8e.ea626",
        "type": "subflow:8ea31ce9.488ad",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "env": [],
        "x": 870,
        "y": 520,
        "wires": [
            [
                "d54b083e.2b45d8"
            ]
        ]
    },
    {
        "id": "c42136ca.5a60a8",
        "type": "subflow:7a61fc3d.3aa584",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "env": [
            {
                "name": "EQUIPMENT_ID",
                "value": "HJ10PTHDMP003",
                "type": "str"
            },
            {
                "name": "DEVICE_ID",
                "value": "virtual",
                "type": "str"
            }
        ],
        "x": 101,
        "y": 536,
        "wires": [
            [
                "4f2f5d0b.3e6794"
            ]
        ]
    },
    {
        "id": "6cf046e3.f124f8",
        "type": "inject",
        "z": "5606eb09.0cf1a4",
        "name": "SQL Connection Test_10PTHPNL006",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "43200",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "SQL Connection Test_10PTHPNL006",
        "payload": "",
        "payloadType": "date",
        "x": 210,
        "y": 200,
        "wires": [
            []
        ]
    },
    {
        "id": "62b418ea.e679f8",
        "type": "mssql",
        "z": "5606eb09.0cf1a4",
        "name": "",
        "server": "10.13.69.49",
        "port": "1433",
        "connectionTimeout": "60000",
        "requestTimeout": "60000",
        "connectionPoolSize": "1",
        "username": "Datamation",
        "password": "P@ssw0rd",
        "database": "Datamation_PCB",
        "query": "",
        "x": 770,
        "y": 260,
        "wires": [
            [
                "3c3f31f.4e5cbce",
                "c5a7aa0c.5de6a8"
            ]
        ]
    },
    {
        "id": "3c3f31f.4e5cbce",
        "type": "debug",
        "z": "5606eb09.0cf1a4",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "x": 990,
        "y": 200,
        "wires": []
    },
    {
        "id": "c5a7aa0c.5de6a8",
        "type": "e-mail",
        "z": "5606eb09.0cf1a4",
        "server": "10.13.66.25",
        "port": "25",
        "secure": false,
        "tls": true,
        "name": "Kevin_Hu@unimicron.com",
        "dname": "",
        "x": 1040,
        "y": 260,
        "wires": []
    },
    {
        "id": "6c48e438.ca755c",
        "type": "function",
        "z": "5606eb09.0cf1a4",
        "name": "build query 10PTHPNL006",
        "func": "const machine_no = '10PTHPNL006'\n\nmsg.config = {\n    \"query\": `EXEC dbo.PCB_Promis_Status_LotNo '${machine_no}'`\n}\n\nfunction TimeZoneTest()\n{\n\n    let d = new Date()\n    \n    let date = (\"0\" + d.getDate()).slice(-2)\n    let month = (\"0\" + (d.getMonth() + 1)).slice(-2)\n    let year = (\"0\" + d.getFullYear()).slice(-2)\n    let hours = (\"0\" + d.getHours()).slice(-2)\n    let minutes = (\"0\" + d.getMinutes()).slice(-2)\n    let seconds = (\"0\" + d.getSeconds()).slice(-2)\n    \n    return year + \"-\" + month + \"-\" + date + \" \" + hours + \":\" + minutes + \":\" + seconds\n}\n\nlet DateInformation = TimeZoneTest()\nmsg.payload = DateInformation\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 520,
        "y": 200,
        "wires": [
            [
                "fe3b9614.f510b8"
            ]
        ]
    },
    {
        "id": "c9a32c44.0ee15",
        "type": "function",
        "z": "5606eb09.0cf1a4",
        "name": "build query 10PTHPNL003",
        "func": "const machine_no = '10PTHPNL003'\n\nmsg.config = {\n    \"query\": `EXEC dbo.PCB_Promis_Status_LotNo '${machine_no}'`\n}\n\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 520,
        "y": 260,
        "wires": [
            [
                "62b418ea.e679f8"
            ]
        ]
    },
    {
        "id": "42c9e2d6.2f4b4c",
        "type": "function",
        "z": "5606eb09.0cf1a4",
        "name": "build query 10PTHPNL004",
        "func": "const machine_no = '10PTHPNL004'\n\nmsg.config = {\n    \"query\": `EXEC dbo.PCB_Promis_Status_LotNo '${machine_no}'`\n}\n\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 520,
        "y": 320,
        "wires": [
            [
                "5bebdf6b.2a94"
            ]
        ]
    },
    {
        "id": "19159377.ef0c0d",
        "type": "inject",
        "z": "5606eb09.0cf1a4",
        "name": "SQL Connection Test_10PTHPNL004",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "43200",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "SQL Connection Test_10PTHPNL004",
        "payload": "",
        "payloadType": "date",
        "x": 210,
        "y": 320,
        "wires": [
            []
        ]
    },
    {
        "id": "432d64a3.a5d48c",
        "type": "inject",
        "z": "5606eb09.0cf1a4",
        "name": "SQL Connection Test_10PTHPNL003",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "43200",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "SQL Connection Test_10PTHPNL003",
        "payload": "",
        "payloadType": "date",
        "x": 210,
        "y": 260,
        "wires": [
            []
        ]
    },
    {
        "id": "64046c50.71eeb4",
        "type": "comment",
        "z": "c80d918.f44b27",
        "name": "10LAMFLB001 Flatbond #1",
        "info": "",
        "x": 160,
        "y": 56,
        "wires": []
    },
    {
        "id": "66936d28.705404",
        "type": "subflow:3b73a09.e77af6",
        "z": "c80d918.f44b27",
        "name": "",
        "env": [],
        "x": 301,
        "y": 116,
        "wires": [
            [
                "6bab9aca.3c0fb4"
            ]
        ]
    },
    {
        "id": "6bab9aca.3c0fb4",
        "type": "subflow:46c3b751.13e688",
        "z": "c80d918.f44b27",
        "name": "",
        "env": [
            {
                "name": "MONITOR_LIST",
                "value": "[\"AVAIL\"]",
                "type": "json"
            },
            {
                "name": "WSDL_URL",
                "value": "https://www.crcind.com/csp/samples/SOAP.Demo.CLS?WSDL=1",
                "type": "str"
            }
        ],
        "x": 501,
        "y": 116,
        "wires": [
            [
                "5d07469e.2bdd78"
            ],
            [
                "a1b41593.0ae648"
            ]
        ]
    },
    {
        "id": "a1b41593.0ae648",
        "type": "subflow:9c352516.1ade28",
        "z": "c80d918.f44b27",
        "name": "",
        "env": [
            {
                "name": "TOPIC",
                "value": "Query MS-SQL failure",
                "type": "str"
            }
        ],
        "x": 740,
        "y": 140,
        "wires": [
            [
                "a9fe8c16.5c7f"
            ]
        ]
    },
    {
        "id": "a9fe8c16.5c7f",
        "type": "reading-out",
        "z": "c80d918.f44b27",
        "name": "",
        "equipmentId": "logger",
        "x": 1120,
        "y": 140,
        "wires": []
    },
    {
        "id": "83e2dd17.cc9e5",
        "type": "subflow:8ea31ce9.488ad",
        "z": "c80d918.f44b27",
        "name": "",
        "env": [],
        "x": 930,
        "y": 100,
        "wires": [
            [
                "a9fe8c16.5c7f"
            ]
        ]
    },
    {
        "id": "343f2a3d.129cf6",
        "type": "subflow:7a61fc3d.3aa584",
        "z": "c80d918.f44b27",
        "name": "",
        "env": [
            {
                "name": "EQUIPMENT_ID",
                "value": "HJ10LAMFLB001",
                "type": "str"
            },
            {
                "name": "DEVICE_ID",
                "value": "virtual",
                "type": "str"
            }
        ],
        "x": 101,
        "y": 116,
        "wires": [
            [
                "66936d28.705404"
            ]
        ]
    },
    {
        "id": "4c86f54e.32c2dc",
        "type": "comment",
        "z": "e4beaa17.839f48",
        "name": "10DFPPRE003 5F超粗化前處理(聯策)",
        "info": "",
        "x": 191,
        "y": 55,
        "wires": []
    },
    {
        "id": "9cb71628.737608",
        "type": "subflow:3b73a09.e77af6",
        "z": "e4beaa17.839f48",
        "name": "",
        "env": [],
        "x": 290,
        "y": 115,
        "wires": [
            [
                "72440d45.78c824"
            ]
        ]
    },
    {
        "id": "72440d45.78c824",
        "type": "subflow:46c3b751.13e688",
        "z": "e4beaa17.839f48",
        "name": "",
        "env": [
            {
                "name": "MONITOR_LIST",
                "value": "[\"AVAIL\"]",
                "type": "json"
            },
            {
                "name": "WSDL_URL",
                "value": "https://www.crcind.com/csp/samples/SOAP.Demo.CLS?WSDL=1",
                "type": "str"
            }
        ],
        "x": 501,
        "y": 115,
        "wires": [
            [
                "13cdff04.8239d1"
            ],
            [
                "90397b45.69e758"
            ]
        ]
    },
    {
        "id": "90397b45.69e758",
        "type": "subflow:9c352516.1ade28",
        "z": "e4beaa17.839f48",
        "name": "",
        "env": [
            {
                "name": "TOPIC",
                "value": "Query MS-SQL failure",
                "type": "str"
            }
        ],
        "x": 740,
        "y": 140,
        "wires": [
            [
                "ddd1881b.f3f6e8"
            ]
        ]
    },
    {
        "id": "ddd1881b.f3f6e8",
        "type": "reading-out",
        "z": "e4beaa17.839f48",
        "name": "",
        "equipmentId": "logger",
        "x": 1120,
        "y": 140,
        "wires": []
    },
    {
        "id": "ae3c77c7.fb0838",
        "type": "subflow:8ea31ce9.488ad",
        "z": "e4beaa17.839f48",
        "name": "",
        "env": [],
        "x": 930,
        "y": 100,
        "wires": [
            [
                "ddd1881b.f3f6e8"
            ]
        ]
    },
    {
        "id": "1d7bcede.0e95e1",
        "type": "subflow:7a61fc3d.3aa584",
        "z": "e4beaa17.839f48",
        "name": "",
        "env": [
            {
                "name": "EQUIPMENT_ID",
                "value": "HJ10DFPPRE003",
                "type": "str"
            },
            {
                "name": "DEVICE_ID",
                "value": "virtual",
                "type": "str"
            }
        ],
        "x": 101,
        "y": 115,
        "wires": [
            [
                "9cb71628.737608"
            ]
        ]
    },
    {
        "id": "f48cea3a.236558",
        "type": "comment",
        "z": "e4beaa17.839f48",
        "name": "10DFPDES003 DES#C",
        "info": "",
        "x": 140,
        "y": 220,
        "wires": []
    },
    {
        "id": "29a4bbe4.659de4",
        "type": "subflow:3b73a09.e77af6",
        "z": "e4beaa17.839f48",
        "name": "",
        "env": [],
        "x": 290,
        "y": 280,
        "wires": [
            [
                "51161b1.6dac7e4"
            ]
        ]
    },
    {
        "id": "51161b1.6dac7e4",
        "type": "subflow:46c3b751.13e688",
        "z": "e4beaa17.839f48",
        "name": "",
        "env": [
            {
                "name": "MONITOR_LIST",
                "value": "[\"AVAIL\"]",
                "type": "json"
            },
            {
                "name": "WSDL_URL",
                "value": "https://www.crcind.com/csp/samples/SOAP.Demo.CLS?WSDL=1",
                "type": "str"
            }
        ],
        "x": 490,
        "y": 280,
        "wires": [
            [
                "e0a13411.8b53b8"
            ],
            [
                "f9bed42b.5cfd68"
            ]
        ]
    },
    {
        "id": "f9bed42b.5cfd68",
        "type": "subflow:9c352516.1ade28",
        "z": "e4beaa17.839f48",
        "name": "",
        "env": [
            {
                "name": "TOPIC",
                "value": "Query MS-SQL failure",
                "type": "str"
            }
        ],
        "x": 740,
        "y": 300,
        "wires": [
            [
                "d24243c.2fa7cc"
            ]
        ]
    },
    {
        "id": "d24243c.2fa7cc",
        "type": "reading-out",
        "z": "e4beaa17.839f48",
        "name": "",
        "equipmentId": "logger",
        "x": 1120,
        "y": 300,
        "wires": []
    },
    {
        "id": "b892e298.583ea",
        "type": "subflow:8ea31ce9.488ad",
        "z": "e4beaa17.839f48",
        "name": "",
        "env": [],
        "x": 930,
        "y": 260,
        "wires": [
            [
                "d24243c.2fa7cc"
            ]
        ]
    },
    {
        "id": "e0dd58aa.f6ac98",
        "type": "subflow:7a61fc3d.3aa584",
        "z": "e4beaa17.839f48",
        "name": "",
        "env": [
            {
                "name": "EQUIPMENT_ID",
                "value": "HJ10DFPDES003",
                "type": "str"
            },
            {
                "name": "DEVICE_ID",
                "value": "virtual",
                "type": "str"
            }
        ],
        "x": 101,
        "y": 280,
        "wires": [
            [
                "29a4bbe4.659de4"
            ]
        ]
    },
    {
        "id": "fd2f70b.7d13f9",
        "type": "comment",
        "z": "91ec86b9.d49fe8",
        "name": "10LDRBLK001 垂直黑化線",
        "info": "",
        "x": 150,
        "y": 616,
        "wires": []
    },
    {
        "id": "4a6b3f09.6563f",
        "type": "subflow:3b73a09.e77af6",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "env": [],
        "x": 262,
        "y": 676,
        "wires": [
            [
                "2bcaaadd.bab576"
            ]
        ]
    },
    {
        "id": "2bcaaadd.bab576",
        "type": "subflow:46c3b751.13e688",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "env": [
            {
                "name": "MONITOR_LIST",
                "value": "[\"AVAIL\"]",
                "type": "json"
            },
            {
                "name": "WSDL_URL",
                "value": "https://www.crcind.com/csp/samples/SOAP.Demo.CLS?WSDL=1",
                "type": "str"
            }
        ],
        "x": 430,
        "y": 676,
        "wires": [
            [
                "b29625b6.f498a8"
            ],
            [
                "d45ca97a.c4ea48"
            ]
        ]
    },
    {
        "id": "d45ca97a.c4ea48",
        "type": "subflow:9c352516.1ade28",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "env": [
            {
                "name": "TOPIC",
                "value": "Query MS-SQL failure",
                "type": "str"
            }
        ],
        "x": 680,
        "y": 700,
        "wires": [
            [
                "7439a3c6.0b716c"
            ]
        ]
    },
    {
        "id": "7439a3c6.0b716c",
        "type": "reading-out",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "equipmentId": "logger",
        "x": 1080,
        "y": 700,
        "wires": []
    },
    {
        "id": "a72abc0e.f8a27",
        "type": "subflow:8ea31ce9.488ad",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "env": [],
        "x": 870,
        "y": 660,
        "wires": [
            [
                "7439a3c6.0b716c"
            ]
        ]
    },
    {
        "id": "dcfe881f.fefe58",
        "type": "subflow:7a61fc3d.3aa584",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "env": [
            {
                "name": "EQUIPMENT_ID",
                "value": "HJ10LDRBLK001",
                "type": "str"
            },
            {
                "name": "DEVICE_ID",
                "value": "virtual",
                "type": "str"
            }
        ],
        "x": 101,
        "y": 676,
        "wires": [
            [
                "4a6b3f09.6563f"
            ]
        ]
    },
    {
        "id": "b856bd49.78a7e",
        "type": "comment",
        "z": "91ec86b9.d49fe8",
        "name": "10PTHDES002 DESMEAR#2",
        "info": "",
        "x": 160,
        "y": 756,
        "wires": []
    },
    {
        "id": "4edfa03c.e6ef8",
        "type": "subflow:3b73a09.e77af6",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "env": [],
        "x": 262,
        "y": 816,
        "wires": [
            [
                "c5b70266.b7118"
            ]
        ]
    },
    {
        "id": "c5b70266.b7118",
        "type": "subflow:46c3b751.13e688",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "env": [
            {
                "name": "MONITOR_LIST",
                "value": "[\"AVAIL\"]",
                "type": "json"
            },
            {
                "name": "WSDL_URL",
                "value": "https://www.crcind.com/csp/samples/SOAP.Demo.CLS?WSDL=1",
                "type": "str"
            }
        ],
        "x": 430,
        "y": 816,
        "wires": [
            [
                "890281a4.98a5b"
            ],
            [
                "ec3a82d5.a1a61"
            ]
        ]
    },
    {
        "id": "ec3a82d5.a1a61",
        "type": "subflow:9c352516.1ade28",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "env": [
            {
                "name": "TOPIC",
                "value": "Query MS-SQL failure",
                "type": "str"
            }
        ],
        "x": 680,
        "y": 840,
        "wires": [
            [
                "26e56314.02263c"
            ]
        ]
    },
    {
        "id": "26e56314.02263c",
        "type": "reading-out",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "equipmentId": "logger",
        "x": 1080,
        "y": 840,
        "wires": []
    },
    {
        "id": "7c5f756d.85841c",
        "type": "subflow:8ea31ce9.488ad",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "env": [],
        "x": 870,
        "y": 800,
        "wires": [
            [
                "26e56314.02263c"
            ]
        ]
    },
    {
        "id": "1a4e6e82.ce5d01",
        "type": "subflow:7a61fc3d.3aa584",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "env": [
            {
                "name": "EQUIPMENT_ID",
                "value": "HJ10PTHDES002",
                "type": "str"
            },
            {
                "name": "DEVICE_ID",
                "value": "virtual",
                "type": "str"
            }
        ],
        "x": 101,
        "y": 816,
        "wires": [
            [
                "4edfa03c.e6ef8"
            ]
        ]
    },
    {
        "id": "a9b846fd.9b32b8",
        "type": "comment",
        "z": "91ec86b9.d49fe8",
        "name": "10PTHECU001 導電高分子線 (DMSE)",
        "info": "",
        "x": 190,
        "y": 896,
        "wires": []
    },
    {
        "id": "92e5cc95.bd849",
        "type": "subflow:3b73a09.e77af6",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "env": [],
        "x": 262,
        "y": 956,
        "wires": [
            [
                "172dd659.c9559a"
            ]
        ]
    },
    {
        "id": "172dd659.c9559a",
        "type": "subflow:46c3b751.13e688",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "env": [
            {
                "name": "MONITOR_LIST",
                "value": "[\"AVAIL\"]",
                "type": "json"
            },
            {
                "name": "WSDL_URL",
                "value": "https://www.crcind.com/csp/samples/SOAP.Demo.CLS?WSDL=1",
                "type": "str"
            }
        ],
        "x": 430,
        "y": 956,
        "wires": [
            [
                "6c59eab3.616e04"
            ],
            [
                "3258c5b.827af3a"
            ]
        ]
    },
    {
        "id": "3258c5b.827af3a",
        "type": "subflow:9c352516.1ade28",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "env": [
            {
                "name": "TOPIC",
                "value": "Query MS-SQL failure",
                "type": "str"
            }
        ],
        "x": 680,
        "y": 980,
        "wires": [
            [
                "e5afadbf.9b93a"
            ]
        ]
    },
    {
        "id": "e5afadbf.9b93a",
        "type": "reading-out",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "equipmentId": "logger",
        "x": 1080,
        "y": 980,
        "wires": []
    },
    {
        "id": "aff0f093.45532",
        "type": "subflow:8ea31ce9.488ad",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "env": [],
        "x": 870,
        "y": 940,
        "wires": [
            [
                "e5afadbf.9b93a"
            ]
        ]
    },
    {
        "id": "a1116fd6.fb1e8",
        "type": "subflow:7a61fc3d.3aa584",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "env": [
            {
                "name": "EQUIPMENT_ID",
                "value": "HJ10PTHECU001",
                "type": "str"
            },
            {
                "name": "DEVICE_ID",
                "value": "virtual",
                "type": "str"
            }
        ],
        "x": 101,
        "y": 956,
        "wires": [
            [
                "92e5cc95.bd849"
            ]
        ]
    },
    {
        "id": "eb059a09.4aa1d8",
        "type": "function",
        "z": "b083bb95.861038",
        "name": "validate input",
        "func": "const alarms = msg.alarms\nconst channel_names = msg.channelNames\nconst equipment_info = msg.equipmentInfo\nconst query_result = msg.queryResult\nconst reading_in = msg.readingIn\n\nif (typeof alarms === undefined ||\n        typeof channel_names === undefined ||\n        typeof equipment_info === undefined ||\n        typeof payload === undefined ||\n        typeof reading_in === undefined) \n{\n    node.error('input error')\n    return\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 210,
        "y": 140,
        "wires": [
            [
                "ec4820da.533fb"
            ]
        ]
    },
    {
        "id": "4336f62e.e50428",
        "type": "e-mail",
        "z": "b083bb95.861038",
        "server": "10.13.66.25",
        "port": "25",
        "secure": false,
        "tls": false,
        "name": "",
        "dname": "",
        "x": 830,
        "y": 200,
        "wires": []
    },
    {
        "id": "2f9e356.92bd0ca",
        "type": "function",
        "z": "b083bb95.861038",
        "name": "build email message",
        "func": "const alarms = msg.alarms\nconst channel_names = msg.channelNames\nconst equipment_info = msg.equipmentInfo\nconst query_result = msg.queryResult\nconst reading_in = msg.readingIn\n\nlet machine_no = equipment_info.machineNo\nlet eq_name = equipment_info.equipmentName\nlet insert_time = _to_ms_sql_datetime(reading_in.at)\nlet log_time = insert_time\nlet promis_status = query_result.result[0].PromisStatus\nlet promis_time = _to_ms_sql_datetime(\n    _offset_promis_time(query_result.result[0].PromisTime))\nlet lot_no = query_result.result[0].LotNo\n\nlet html = `\n<body>\n\n<table  style=\"border:0px #000000 solid;padding:5px;\" rules=\"all\" cellpadding='5';border='1'>\n  <tr>\n    <th>MachineNo</th>\n    <th>EQName</th> \n    <th>EventCode</th>\n    <th>EventMessage</th>\n    <th>InsertTime</th>\n    <th>LogTime</th>\n    <th>PromisStatus</th>\n    <th>PromisTime</th>\n    <th>LotNo</th>\n  </tr>\n`\n\nfor (let channel in alarms)\n{\n    let event_code = channel\n    let event_message = channel_names[channel]\n    \n    html += `\n  <tr>\n    <td>${machine_no}</td>\n    <td>${eq_name}</td>\n    <td>${event_code}</td>\n    <td>${event_message}</td>\n    <td>${insert_time}</td>\n    <td>${log_time}</td>\n    <td>${promis_status}</td>\n    <td>${promis_time}</td>\n    <td>${lot_no}</td>\n  </tr>\n`\n}\n\nhtml += `\n</table>\n</body>\n此為系統自動發送, 請勿回覆\n`\n\nmsg.topic = `設備 ${eq_name} 警告`\nmsg.headers = '<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\">'\nmsg.payload = html\n\n\nreturn msg;\n\n// internal function\nfunction _offset_promis_time(from)\n{\n    const d = new Date(from)\n    \n    return d.getTime() - 28800000\n}\n\nfunction _to_ms_sql_datetime(from)\n{\n    const d = new Date(from)\n    \n    let date = (\"0\" + d.getDate()).slice(-2)\n    let month = (\"0\" + (d.getMonth() + 1)).slice(-2)\n    let year = d.getFullYear()\n    let hours = d.getHours()\n    let minutes = d.getMinutes()\n    let seconds = d.getSeconds()\n    \n    return year + \"-\" + month + \"-\" + date + \" \" + hours + \":\" + minutes + \":\" + seconds\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 620,
        "y": 140,
        "wires": [
            [
                "4336f62e.e50428"
            ]
        ]
    },
    {
        "id": "889749b8.5c7f18",
        "type": "comment",
        "z": "5606eb09.0cf1a4",
        "name": "SQL Connection Test",
        "info": "",
        "x": 140,
        "y": 140,
        "wires": []
    },
    {
        "id": "ec4820da.533fb",
        "type": "function",
        "z": "b083bb95.861038",
        "name": "mail reciepents",
        "func": "msg.to = 'A1919@unimicron.com,04181@unimicron.com,joelin2@unimicron.com,010182@unimicron.com,C.L_Lin@unimicron.com,vincent.lu@unimicron.com,jackson_lee@unimicron.com,34853@unimicron.com,A0899@unimicron.com,A0841@unimicron.com,33844@unimicron.com,Leon_Lin@unimicron.com,25613@unimicron.com,Jimmy_Yang@unimicron.com,jerryliu@unimicron.com,A1348@unimicron.com,34518@unimicron.com,jkde@unimicron.com,cccho@unimicron.com,jerry_chin@unimicron.com,09975@unimicron.com,32240@unimicron.com,patrick_huang@unimicron.com,ballliu@unimicron.com,A0359@unimicron.com,Max_Kuo@unimicron.com,A0968@unimicron.com,25613@unimicron.com,A0065@unimicron.com,desung_lin@unimicron.com,A1021@unimicron.com,A0030@unimicron.com,55383@unimicron.com,01595@unimicron.com'\nmsg.cc = 'cpl@unimicron.com,darren_chen@unimicron.com'\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 400,
        "y": 140,
        "wires": [
            [
                "2f9e356.92bd0ca"
            ]
        ]
    },
    {
        "id": "6f289a85.b4bde4",
        "type": "subflow:b083bb95.861038",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "env": [],
        "x": 670,
        "y": 100,
        "wires": [
            [
                "3614ad95.d7ce22"
            ]
        ]
    },
    {
        "id": "c2a888fc.b00848",
        "type": "subflow:b083bb95.861038",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "x": 670,
        "y": 240,
        "wires": [
            [
                "b3c6424f.a143f"
            ]
        ]
    },
    {
        "id": "6d2c2b10.8c4334",
        "type": "subflow:b083bb95.861038",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "env": [],
        "x": 670,
        "y": 380,
        "wires": [
            [
                "d97a14be.76b688"
            ]
        ]
    },
    {
        "id": "884976b4.2c5f58",
        "type": "subflow:b083bb95.861038",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "x": 670,
        "y": 520,
        "wires": [
            [
                "74652e8e.ea626"
            ]
        ]
    },
    {
        "id": "b29625b6.f498a8",
        "type": "subflow:b083bb95.861038",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "x": 670,
        "y": 660,
        "wires": [
            [
                "a72abc0e.f8a27"
            ]
        ]
    },
    {
        "id": "890281a4.98a5b",
        "type": "subflow:b083bb95.861038",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "x": 670,
        "y": 800,
        "wires": [
            [
                "7c5f756d.85841c"
            ]
        ]
    },
    {
        "id": "6c59eab3.616e04",
        "type": "subflow:b083bb95.861038",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "x": 670,
        "y": 940,
        "wires": [
            [
                "aff0f093.45532"
            ]
        ]
    },
    {
        "id": "f70f63fc.f4c33",
        "type": "function",
        "z": "89fdc1f9.a927a",
        "name": "validate input",
        "func": "const alarms = msg.alarms\nconst channel_names = msg.channelNames\nconst equipment_info = msg.equipmentInfo\nconst query_result = msg.queryResult\nconst reading_in = msg.readingIn\n\nif (typeof alarms === undefined ||\n        typeof channel_names === undefined ||\n        typeof equipment_info === undefined ||\n        typeof payload === undefined ||\n        typeof reading_in === undefined) \n{\n    node.error('input error')\n    return\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 350,
        "y": 160,
        "wires": [
            [
                "62a7ec50.492644"
            ]
        ]
    },
    {
        "id": "3734da94.555ac6",
        "type": "e-mail",
        "z": "89fdc1f9.a927a",
        "server": "10.13.66.25",
        "port": "25",
        "secure": false,
        "tls": false,
        "name": "",
        "dname": "",
        "x": 970,
        "y": 220,
        "wires": []
    },
    {
        "id": "7246f365.880d3c",
        "type": "function",
        "z": "89fdc1f9.a927a",
        "name": "build email message",
        "func": "const alarms = msg.alarms\nconst channel_names = msg.channelNames\nconst equipment_info = msg.equipmentInfo\nconst query_result = msg.queryResult\nconst reading_in = msg.readingIn\n\nlet machine_no = equipment_info.machineNo\nlet eq_name = equipment_info.equipmentName\nlet insert_time = _to_ms_sql_datetime(reading_in.at)\nlet log_time = insert_time\nlet promis_status = query_result.result[0].PromisStatus\nlet promis_time = _to_ms_sql_datetime(\n    _offset_promis_time(query_result.result[0].PromisTime))\nlet lot_no = query_result.result[0].LotNo\n\nlet html = `\n<body>\n\n<table  style=\"border:0px #000000 solid;padding:5px;\" rules=\"all\" cellpadding='5';border='1'>\n  <tr>\n    <th>MachineNo</th>\n    <th>EQName</th> \n    <th>EventCode</th>\n    <th>EventMessage</th>\n    <th>InsertTime</th>\n    <th>LogTime</th>\n    <th>PromisStatus</th>\n    <th>PromisTime</th>\n    <th>LotNo</th>\n  </tr>\n`\n\nfor (let channel in alarms)\n{\n    let event_code = channel\n    let event_message = channel_names[channel]\n    \n    html += `\n  <tr>\n    <td>${machine_no}</td>\n    <td>${eq_name}</td>\n    <td>${event_code}</td>\n    <td>${event_message}</td>\n    <td>${insert_time}</td>\n    <td>${log_time}</td>\n    <td>${promis_status}</td>\n    <td>${promis_time}</td>\n    <td>${lot_no}</td>\n  </tr>\n`\n}\n\nhtml += `\n</table>\n</body>\n此為系統自動發送, 請勿回覆\n`\n\nmsg.topic = `設備 ${eq_name} 警告`\nmsg.headers = '<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\">'\nmsg.payload = html\n\n\nreturn msg;\n\n// internal function\nfunction _offset_promis_time(from)\n{\n    const d = new Date(from)\n    \n    return d.getTime() - 28800000\n}\n\nfunction _to_ms_sql_datetime(from)\n{\n    const d = new Date(from)\n    \n    let date = (\"0\" + d.getDate()).slice(-2)\n    let month = (\"0\" + (d.getMonth() + 1)).slice(-2)\n    let year = d.getFullYear()\n    let hours = d.getHours()\n    let minutes = d.getMinutes()\n    let seconds = d.getSeconds()\n    \n    return year + \"-\" + month + \"-\" + date + \" \" + hours + \":\" + minutes + \":\" + seconds\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 760,
        "y": 160,
        "wires": [
            [
                "3734da94.555ac6"
            ]
        ]
    },
    {
        "id": "62a7ec50.492644",
        "type": "function",
        "z": "89fdc1f9.a927a",
        "name": "mail reciepents",
        "func": "msg.to = 'A1919@unimicron.com,04181@unimicron.com,joelin2@unimicron.com,010182@unimicron.com,C.L_Lin@unimicron.com,vincent.lu@unimicron.com,jackson_lee@unimicron.com,32860@unimicron.com,A0899@unimicron.com,A0841@unimicron.com,Olivia_Wang@unimicron.com,Leon_Lin@unimicron.com,25613@unimicron.com,A0006@unimicron.com,jerryliu@unimicron.com,A1348@unimicron.com,33844@unimicron.com,jkde@unimicron.com,cccho@unimicron.com,34518@unimicron.com,09975@unimicron.com,32240@unimicron.com,jerry_chin@unimicron.com,ballliu@unimicron.com,A0359@unimicron.com,patrick_huang@unimicron.com,A0968@unimicron.com,25613@unimicron.com,desung_lin@unimicron.com,A1021@unimicron.com,A0030@unimicron.com,55383@unimicron.com,01595@unimicron.com'\nmsg.cc = 'cpl@unimicron.com,darren_chen@unimicron.com'\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 540,
        "y": 160,
        "wires": [
            [
                "7246f365.880d3c"
            ]
        ]
    },
    {
        "id": "801f0ec7.4ffb8",
        "type": "function",
        "z": "b741f1b7.19805",
        "name": "validate input",
        "func": "const alarms = msg.alarms\nconst channel_names = msg.channelNames\nconst equipment_info = msg.equipmentInfo\nconst query_result = msg.queryResult\nconst reading_in = msg.readingIn\n\nif (typeof alarms === undefined ||\n        typeof channel_names === undefined ||\n        typeof equipment_info === undefined ||\n        typeof payload === undefined ||\n        typeof reading_in === undefined) \n{\n    node.error('input error')\n    return\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 390,
        "y": 160,
        "wires": [
            [
                "6c846d7b.fecb84"
            ]
        ]
    },
    {
        "id": "7f789690.cd6c38",
        "type": "e-mail",
        "z": "b741f1b7.19805",
        "server": "10.13.66.25",
        "port": "25",
        "secure": false,
        "tls": false,
        "name": "",
        "dname": "",
        "x": 1010,
        "y": 220,
        "wires": []
    },
    {
        "id": "ae4934a2.af5d78",
        "type": "function",
        "z": "b741f1b7.19805",
        "name": "build email message",
        "func": "const alarms = msg.alarms\nconst channel_names = msg.channelNames\nconst equipment_info = msg.equipmentInfo\nconst query_result = msg.queryResult\nconst reading_in = msg.readingIn\n\nlet machine_no = equipment_info.machineNo\nlet eq_name = equipment_info.equipmentName\nlet insert_time = _to_ms_sql_datetime(reading_in.at)\nlet log_time = insert_time\nlet promis_status = query_result.result[0].PromisStatus\nlet promis_time = _to_ms_sql_datetime(\n    _offset_promis_time(query_result.result[0].PromisTime))\nlet lot_no = query_result.result[0].LotNo\n\nlet html = `\n<body>\n\n<table  style=\"border:0px #000000 solid;padding:5px;\" rules=\"all\" cellpadding='5';border='1'>\n  <tr>\n    <th>MachineNo</th>\n    <th>EQName</th> \n    <th>EventCode</th>\n    <th>EventMessage</th>\n    <th>InsertTime</th>\n    <th>LogTime</th>\n    <th>PromisStatus</th>\n    <th>PromisTime</th>\n    <th>LotNo</th>\n  </tr>\n`\n\nfor (let channel in alarms)\n{\n    let event_code = channel\n    let event_message = channel_names[channel]\n    \n    html += `\n  <tr>\n    <td>${machine_no}</td>\n    <td>${eq_name}</td>\n    <td>${event_code}</td>\n    <td>${event_message}</td>\n    <td>${insert_time}</td>\n    <td>${log_time}</td>\n    <td>${promis_status}</td>\n    <td>${promis_time}</td>\n    <td>${lot_no}</td>\n  </tr>\n`\n}\n\nhtml += `\n</table>\n</body>\n此為系統自動發送, 請勿回覆\n`\n\nmsg.topic = `設備 ${eq_name} 警告`\nmsg.headers = '<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\">'\nmsg.payload = html\n\n\nreturn msg;\n\n// internal function\nfunction _offset_promis_time(from)\n{\n    const d = new Date(from)\n    \n    return d.getTime() - 28800000\n}\n\nfunction _to_ms_sql_datetime(from)\n{\n    const d = new Date(from)\n    \n    let date = (\"0\" + d.getDate()).slice(-2)\n    let month = (\"0\" + (d.getMonth() + 1)).slice(-2)\n    let year = d.getFullYear()\n    let hours = d.getHours()\n    let minutes = d.getMinutes()\n    let seconds = d.getSeconds()\n    \n    return year + \"-\" + month + \"-\" + date + \" \" + hours + \":\" + minutes + \":\" + seconds\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 800,
        "y": 160,
        "wires": [
            [
                "7f789690.cd6c38"
            ]
        ]
    },
    {
        "id": "6c846d7b.fecb84",
        "type": "function",
        "z": "b741f1b7.19805",
        "name": "mail reciepents",
        "func": "msg.to = 'A1919@unimicron.com,04181@unimicron.com,joelin2@unimicron.com,010182@unimicron.com,C.L_Lin@unimicron.com,vincent.lu@unimicron.com,jackson_lee@unimicron.com,A1350@unimicron.com,A0899@unimicron.com,A0841@unimicron.com,33844@unimicron.com,Leon_Lin@unimicron.com,25613@unimicron.com,34518@unimicron.com,jerryliu@unimicron.com,A1348@unimicron.com,jerry_chin@unimicron.com,jkde@unimicron.com,cccho@unimicron.com,A1444@unimicron.com,09975@unimicron.com,32240@unimicron.com,patrick_huang@unimicron.com,ballliu@unimicron.com,A0359@unimicron.com,A0968@unimicron.com,25613@unimicron.com,desung_lin@unimicron.com,A1021@unimicron.com,A0030@unimicron.com,55383@unimicron.com,01595@unimicron.com'\nmsg.cc = 'cpl@unimicron.com,darren_chen@unimicron.com'\n//msg.to = 'Kevin_Hu@unimicron.com'\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 580,
        "y": 160,
        "wires": [
            [
                "ae4934a2.af5d78"
            ]
        ]
    },
    {
        "id": "13cdff04.8239d1",
        "type": "subflow:89fdc1f9.a927a",
        "z": "e4beaa17.839f48",
        "name": "",
        "env": [],
        "x": 730,
        "y": 100,
        "wires": [
            [
                "ae3c77c7.fb0838"
            ]
        ]
    },
    {
        "id": "e0a13411.8b53b8",
        "type": "subflow:89fdc1f9.a927a",
        "z": "e4beaa17.839f48",
        "name": "",
        "env": [],
        "x": 730,
        "y": 260,
        "wires": [
            [
                "b892e298.583ea"
            ]
        ]
    },
    {
        "id": "b63d40ca.f6b8b",
        "type": "comment",
        "z": "e4beaa17.839f48",
        "name": "10DFPLAM004 自動壓膜機#4",
        "info": "",
        "x": 160,
        "y": 380,
        "wires": []
    },
    {
        "id": "a1ec960e.0e4cc8",
        "type": "subflow:3b73a09.e77af6",
        "z": "e4beaa17.839f48",
        "name": "",
        "env": [],
        "x": 290,
        "y": 440,
        "wires": [
            [
                "22bbe86b.b1aee8"
            ]
        ]
    },
    {
        "id": "22bbe86b.b1aee8",
        "type": "subflow:46c3b751.13e688",
        "z": "e4beaa17.839f48",
        "name": "",
        "env": [
            {
                "name": "MONITOR_LIST",
                "value": "[\"AVAIL\"]",
                "type": "json"
            },
            {
                "name": "WSDL_URL",
                "value": "https://www.crcind.com/csp/samples/SOAP.Demo.CLS?WSDL=1",
                "type": "str"
            }
        ],
        "x": 490,
        "y": 440,
        "wires": [
            [
                "2f3ec26b.5c9a9e"
            ],
            [
                "81925a06.093928"
            ]
        ]
    },
    {
        "id": "81925a06.093928",
        "type": "subflow:9c352516.1ade28",
        "z": "e4beaa17.839f48",
        "name": "",
        "env": [
            {
                "name": "TOPIC",
                "value": "Query MS-SQL failure",
                "type": "str"
            }
        ],
        "x": 740,
        "y": 460,
        "wires": [
            [
                "c1ae8ec5.4d2ba"
            ]
        ]
    },
    {
        "id": "c1ae8ec5.4d2ba",
        "type": "reading-out",
        "z": "e4beaa17.839f48",
        "name": "",
        "equipmentId": "logger",
        "x": 1120,
        "y": 460,
        "wires": []
    },
    {
        "id": "6613164c.f9b228",
        "type": "subflow:8ea31ce9.488ad",
        "z": "e4beaa17.839f48",
        "name": "",
        "env": [],
        "x": 930,
        "y": 420,
        "wires": [
            [
                "c1ae8ec5.4d2ba"
            ]
        ]
    },
    {
        "id": "7c6835b8.2f95bc",
        "type": "subflow:7a61fc3d.3aa584",
        "z": "e4beaa17.839f48",
        "name": "",
        "env": [
            {
                "name": "EQUIPMENT_ID",
                "value": "HJ10DFPLAM004",
                "type": "str"
            },
            {
                "name": "DEVICE_ID",
                "value": "virtual",
                "type": "str"
            }
        ],
        "x": 101,
        "y": 440,
        "wires": [
            [
                "a1ec960e.0e4cc8"
            ]
        ]
    },
    {
        "id": "2f3ec26b.5c9a9e",
        "type": "subflow:89fdc1f9.a927a",
        "z": "e4beaa17.839f48",
        "name": "",
        "x": 730,
        "y": 420,
        "wires": [
            [
                "6613164c.f9b228"
            ]
        ]
    },
    {
        "id": "5d07469e.2bdd78",
        "type": "subflow:b741f1b7.19805",
        "z": "c80d918.f44b27",
        "name": "",
        "env": [],
        "x": 730,
        "y": 100,
        "wires": [
            [
                "83e2dd17.cc9e5"
            ]
        ]
    },
    {
        "id": "f9f23197.de442",
        "type": "comment",
        "z": "c80d918.f44b27",
        "name": "10LAMLAM001 壓合機#1",
        "info": "",
        "x": 150,
        "y": 220,
        "wires": []
    },
    {
        "id": "acdcf18f.eff5f",
        "type": "subflow:3b73a09.e77af6",
        "z": "c80d918.f44b27",
        "name": "",
        "env": [],
        "x": 301,
        "y": 280,
        "wires": [
            [
                "b3a4afcd.60e62"
            ]
        ]
    },
    {
        "id": "b3a4afcd.60e62",
        "type": "subflow:46c3b751.13e688",
        "z": "c80d918.f44b27",
        "name": "",
        "env": [
            {
                "name": "MONITOR_LIST",
                "value": "[\"AVAIL\"]",
                "type": "json"
            },
            {
                "name": "WSDL_URL",
                "value": "https://www.crcind.com/csp/samples/SOAP.Demo.CLS?WSDL=1",
                "type": "str"
            }
        ],
        "x": 501,
        "y": 280,
        "wires": [
            [
                "7f3073dc.ef89fc"
            ],
            [
                "4f949ca2.8a0644"
            ]
        ]
    },
    {
        "id": "4f949ca2.8a0644",
        "type": "subflow:9c352516.1ade28",
        "z": "c80d918.f44b27",
        "name": "",
        "env": [
            {
                "name": "TOPIC",
                "value": "Query MS-SQL failure",
                "type": "str"
            }
        ],
        "x": 740,
        "y": 304,
        "wires": [
            [
                "693b0f2a.ad498"
            ]
        ]
    },
    {
        "id": "693b0f2a.ad498",
        "type": "reading-out",
        "z": "c80d918.f44b27",
        "name": "",
        "equipmentId": "logger",
        "x": 1120,
        "y": 304,
        "wires": []
    },
    {
        "id": "e05ddf8e.0460b",
        "type": "subflow:8ea31ce9.488ad",
        "z": "c80d918.f44b27",
        "name": "",
        "env": [],
        "x": 930,
        "y": 264,
        "wires": [
            [
                "693b0f2a.ad498"
            ]
        ]
    },
    {
        "id": "715ab9f1.0700f8",
        "type": "subflow:7a61fc3d.3aa584",
        "z": "c80d918.f44b27",
        "name": "",
        "env": [
            {
                "name": "EQUIPMENT_ID",
                "value": "HJ10LAMLAM001",
                "type": "str"
            },
            {
                "name": "DEVICE_ID",
                "value": "virtual",
                "type": "str"
            }
        ],
        "x": 101,
        "y": 280,
        "wires": [
            [
                "acdcf18f.eff5f"
            ]
        ]
    },
    {
        "id": "7f3073dc.ef89fc",
        "type": "subflow:b741f1b7.19805",
        "z": "c80d918.f44b27",
        "name": "",
        "x": 730,
        "y": 264,
        "wires": [
            [
                "e05ddf8e.0460b"
            ]
        ]
    },
    {
        "id": "6a760fd9.a012a",
        "type": "comment",
        "z": "c80d918.f44b27",
        "name": "10LAMLAM002 壓合機#2",
        "info": "",
        "x": 150,
        "y": 380,
        "wires": []
    },
    {
        "id": "1a50d7a1.c9cca8",
        "type": "subflow:3b73a09.e77af6",
        "z": "c80d918.f44b27",
        "name": "",
        "env": [],
        "x": 301,
        "y": 440,
        "wires": [
            [
                "f2836b05.589368"
            ]
        ]
    },
    {
        "id": "f2836b05.589368",
        "type": "subflow:46c3b751.13e688",
        "z": "c80d918.f44b27",
        "name": "",
        "env": [
            {
                "name": "MONITOR_LIST",
                "value": "[\"AVAIL\"]",
                "type": "json"
            },
            {
                "name": "WSDL_URL",
                "value": "https://www.crcind.com/csp/samples/SOAP.Demo.CLS?WSDL=1",
                "type": "str"
            }
        ],
        "x": 501,
        "y": 440,
        "wires": [
            [
                "2866e0fc.83b3b"
            ],
            [
                "e97fdc03.6eaa"
            ]
        ]
    },
    {
        "id": "e97fdc03.6eaa",
        "type": "subflow:9c352516.1ade28",
        "z": "c80d918.f44b27",
        "name": "",
        "env": [
            {
                "name": "TOPIC",
                "value": "Query MS-SQL failure",
                "type": "str"
            }
        ],
        "x": 740,
        "y": 464,
        "wires": [
            [
                "358dee5d.ad1b42"
            ]
        ]
    },
    {
        "id": "358dee5d.ad1b42",
        "type": "reading-out",
        "z": "c80d918.f44b27",
        "name": "",
        "equipmentId": "logger",
        "x": 1120,
        "y": 464,
        "wires": []
    },
    {
        "id": "7ae4510.f8d93b",
        "type": "subflow:8ea31ce9.488ad",
        "z": "c80d918.f44b27",
        "name": "",
        "env": [],
        "x": 930,
        "y": 424,
        "wires": [
            [
                "358dee5d.ad1b42"
            ]
        ]
    },
    {
        "id": "521e826b.15c83c",
        "type": "subflow:7a61fc3d.3aa584",
        "z": "c80d918.f44b27",
        "name": "",
        "env": [
            {
                "name": "EQUIPMENT_ID",
                "value": "HJ10LAMLAM002",
                "type": "str"
            },
            {
                "name": "DEVICE_ID",
                "value": "virtual",
                "type": "str"
            }
        ],
        "x": 101,
        "y": 440,
        "wires": [
            [
                "1a50d7a1.c9cca8"
            ]
        ]
    },
    {
        "id": "2866e0fc.83b3b",
        "type": "subflow:b741f1b7.19805",
        "z": "c80d918.f44b27",
        "name": "",
        "x": 730,
        "y": 424,
        "wires": [
            [
                "7ae4510.f8d93b"
            ]
        ]
    },
    {
        "id": "9e886316.d80a4",
        "type": "comment",
        "z": "c80d918.f44b27",
        "name": "10LAMLAM003 冷壓機#1",
        "info": "",
        "x": 150,
        "y": 540,
        "wires": []
    },
    {
        "id": "ccdaa73f.8de6e8",
        "type": "subflow:3b73a09.e77af6",
        "z": "c80d918.f44b27",
        "name": "",
        "env": [],
        "x": 301,
        "y": 600,
        "wires": [
            [
                "189edc96.7fc463"
            ]
        ]
    },
    {
        "id": "189edc96.7fc463",
        "type": "subflow:46c3b751.13e688",
        "z": "c80d918.f44b27",
        "name": "",
        "env": [
            {
                "name": "MONITOR_LIST",
                "value": "[\"AVAIL\"]",
                "type": "json"
            },
            {
                "name": "WSDL_URL",
                "value": "https://www.crcind.com/csp/samples/SOAP.Demo.CLS?WSDL=1",
                "type": "str"
            }
        ],
        "x": 501,
        "y": 600,
        "wires": [
            [
                "6fafca72.f72e54"
            ],
            [
                "b367b8ce.93eac8"
            ]
        ]
    },
    {
        "id": "b367b8ce.93eac8",
        "type": "subflow:9c352516.1ade28",
        "z": "c80d918.f44b27",
        "name": "",
        "env": [
            {
                "name": "TOPIC",
                "value": "Query MS-SQL failure",
                "type": "str"
            }
        ],
        "x": 740,
        "y": 624,
        "wires": [
            [
                "e23e7c93.ac5bb"
            ]
        ]
    },
    {
        "id": "e23e7c93.ac5bb",
        "type": "reading-out",
        "z": "c80d918.f44b27",
        "name": "",
        "equipmentId": "logger",
        "x": 1120,
        "y": 624,
        "wires": []
    },
    {
        "id": "e6e2756f.9050c8",
        "type": "subflow:8ea31ce9.488ad",
        "z": "c80d918.f44b27",
        "name": "",
        "env": [],
        "x": 930,
        "y": 584,
        "wires": [
            [
                "e23e7c93.ac5bb"
            ]
        ]
    },
    {
        "id": "b07efb69.956288",
        "type": "subflow:7a61fc3d.3aa584",
        "z": "c80d918.f44b27",
        "name": "",
        "env": [
            {
                "name": "EQUIPMENT_ID",
                "value": "HJ10LAMLAM003",
                "type": "str"
            },
            {
                "name": "DEVICE_ID",
                "value": "virtual",
                "type": "str"
            }
        ],
        "x": 101,
        "y": 600,
        "wires": [
            [
                "ccdaa73f.8de6e8"
            ]
        ]
    },
    {
        "id": "6fafca72.f72e54",
        "type": "subflow:b741f1b7.19805",
        "z": "c80d918.f44b27",
        "name": "",
        "x": 730,
        "y": 584,
        "wires": [
            [
                "e6e2756f.9050c8"
            ]
        ]
    },
    {
        "id": "a97cf321.22d38",
        "type": "comment",
        "z": "c80d918.f44b27",
        "name": "10LAMTCU001 TCU溫控系統",
        "info": "",
        "x": 160,
        "y": 700,
        "wires": []
    },
    {
        "id": "1f51e884.e62a77",
        "type": "subflow:3b73a09.e77af6",
        "z": "c80d918.f44b27",
        "name": "",
        "env": [],
        "x": 301,
        "y": 760,
        "wires": [
            [
                "43fa517.d04c5b"
            ]
        ]
    },
    {
        "id": "43fa517.d04c5b",
        "type": "subflow:46c3b751.13e688",
        "z": "c80d918.f44b27",
        "name": "",
        "env": [
            {
                "name": "MONITOR_LIST",
                "value": "[\"AVAIL\"]",
                "type": "json"
            },
            {
                "name": "WSDL_URL",
                "value": "https://www.crcind.com/csp/samples/SOAP.Demo.CLS?WSDL=1",
                "type": "str"
            }
        ],
        "x": 501,
        "y": 760,
        "wires": [
            [
                "946f1156.64701"
            ],
            [
                "7a3b4a5a.1c23c4"
            ]
        ]
    },
    {
        "id": "7a3b4a5a.1c23c4",
        "type": "subflow:9c352516.1ade28",
        "z": "c80d918.f44b27",
        "name": "",
        "env": [
            {
                "name": "TOPIC",
                "value": "Query MS-SQL failure",
                "type": "str"
            }
        ],
        "x": 740,
        "y": 784,
        "wires": [
            [
                "423b8479.3c6ccc"
            ]
        ]
    },
    {
        "id": "423b8479.3c6ccc",
        "type": "reading-out",
        "z": "c80d918.f44b27",
        "name": "",
        "equipmentId": "logger",
        "x": 1120,
        "y": 784,
        "wires": []
    },
    {
        "id": "9509d55a.7d04f8",
        "type": "subflow:8ea31ce9.488ad",
        "z": "c80d918.f44b27",
        "name": "",
        "env": [],
        "x": 930,
        "y": 744,
        "wires": [
            [
                "423b8479.3c6ccc"
            ]
        ]
    },
    {
        "id": "ab9ab4f9.a58208",
        "type": "subflow:7a61fc3d.3aa584",
        "z": "c80d918.f44b27",
        "name": "",
        "env": [
            {
                "name": "EQUIPMENT_ID",
                "value": "HJ10LAMTCU001",
                "type": "str"
            },
            {
                "name": "DEVICE_ID",
                "value": "virtual",
                "type": "str"
            }
        ],
        "x": 101,
        "y": 760,
        "wires": [
            [
                "1f51e884.e62a77"
            ]
        ]
    },
    {
        "id": "946f1156.64701",
        "type": "subflow:b741f1b7.19805",
        "z": "c80d918.f44b27",
        "name": "",
        "x": 730,
        "y": 744,
        "wires": [
            [
                "9509d55a.7d04f8"
            ]
        ]
    },
    {
        "id": "b9668179.a16d2",
        "type": "comment",
        "z": "c80d918.f44b27",
        "name": "10LAMSBW001 鋼板水洗機",
        "info": "",
        "x": 160,
        "y": 860,
        "wires": []
    },
    {
        "id": "a3cff276.aeff6",
        "type": "subflow:3b73a09.e77af6",
        "z": "c80d918.f44b27",
        "name": "",
        "env": [],
        "x": 301,
        "y": 920,
        "wires": [
            [
                "50485296.72116c"
            ]
        ]
    },
    {
        "id": "50485296.72116c",
        "type": "subflow:46c3b751.13e688",
        "z": "c80d918.f44b27",
        "name": "",
        "env": [
            {
                "name": "MONITOR_LIST",
                "value": "[\"AVAIL\"]",
                "type": "json"
            },
            {
                "name": "WSDL_URL",
                "value": "https://www.crcind.com/csp/samples/SOAP.Demo.CLS?WSDL=1",
                "type": "str"
            }
        ],
        "x": 501,
        "y": 920,
        "wires": [
            [
                "1e0a1ae7.0783f5"
            ],
            [
                "6865d538.5bb22c"
            ]
        ]
    },
    {
        "id": "6865d538.5bb22c",
        "type": "subflow:9c352516.1ade28",
        "z": "c80d918.f44b27",
        "name": "",
        "env": [
            {
                "name": "TOPIC",
                "value": "Query MS-SQL failure",
                "type": "str"
            }
        ],
        "x": 740,
        "y": 944,
        "wires": [
            [
                "14f2aa5a.a97136"
            ]
        ]
    },
    {
        "id": "14f2aa5a.a97136",
        "type": "reading-out",
        "z": "c80d918.f44b27",
        "name": "",
        "equipmentId": "logger",
        "x": 1120,
        "y": 944,
        "wires": []
    },
    {
        "id": "afd4e1a6.d76c2",
        "type": "subflow:8ea31ce9.488ad",
        "z": "c80d918.f44b27",
        "name": "",
        "env": [],
        "x": 930,
        "y": 904,
        "wires": [
            [
                "14f2aa5a.a97136"
            ]
        ]
    },
    {
        "id": "c2cc0af4.116d58",
        "type": "subflow:7a61fc3d.3aa584",
        "z": "c80d918.f44b27",
        "name": "",
        "env": [
            {
                "name": "EQUIPMENT_ID",
                "value": "HJ10LAMSBW001",
                "type": "str"
            },
            {
                "name": "DEVICE_ID",
                "value": "virtual",
                "type": "str"
            }
        ],
        "x": 101,
        "y": 920,
        "wires": [
            [
                "a3cff276.aeff6"
            ]
        ]
    },
    {
        "id": "1e0a1ae7.0783f5",
        "type": "subflow:b741f1b7.19805",
        "z": "c80d918.f44b27",
        "name": "",
        "x": 730,
        "y": 904,
        "wires": [
            [
                "afd4e1a6.d76c2"
            ]
        ]
    },
    {
        "id": "5559320f.8fc06c",
        "type": "comment",
        "z": "c80d918.f44b27",
        "name": "10LAMLNL001 疊板迴流線(191003USB)",
        "info": "",
        "x": 200,
        "y": 1020,
        "wires": []
    },
    {
        "id": "d06a224f.2a909",
        "type": "subflow:3b73a09.e77af6",
        "z": "c80d918.f44b27",
        "name": "",
        "env": [],
        "x": 301,
        "y": 1080,
        "wires": [
            [
                "a5ab5c41.8a71f"
            ]
        ]
    },
    {
        "id": "a5ab5c41.8a71f",
        "type": "subflow:46c3b751.13e688",
        "z": "c80d918.f44b27",
        "name": "",
        "env": [
            {
                "name": "MONITOR_LIST",
                "value": "[\"AVAIL\"]",
                "type": "json"
            },
            {
                "name": "WSDL_URL",
                "value": "https://www.crcind.com/csp/samples/SOAP.Demo.CLS?WSDL=1",
                "type": "str"
            }
        ],
        "x": 501,
        "y": 1080,
        "wires": [
            [
                "457347a7.83e088"
            ],
            [
                "e8842d3a.a24fc"
            ]
        ]
    },
    {
        "id": "e8842d3a.a24fc",
        "type": "subflow:9c352516.1ade28",
        "z": "c80d918.f44b27",
        "name": "",
        "env": [
            {
                "name": "TOPIC",
                "value": "Query MS-SQL failure",
                "type": "str"
            }
        ],
        "x": 740,
        "y": 1104,
        "wires": [
            [
                "1b9040ae.629eaf"
            ]
        ]
    },
    {
        "id": "1b9040ae.629eaf",
        "type": "reading-out",
        "z": "c80d918.f44b27",
        "name": "",
        "equipmentId": "logger",
        "x": 1120,
        "y": 1104,
        "wires": []
    },
    {
        "id": "d4f1e44f.f6eeb8",
        "type": "subflow:8ea31ce9.488ad",
        "z": "c80d918.f44b27",
        "name": "",
        "env": [],
        "x": 930,
        "y": 1064,
        "wires": [
            [
                "1b9040ae.629eaf"
            ]
        ]
    },
    {
        "id": "42e6411b.cc1eb",
        "type": "subflow:7a61fc3d.3aa584",
        "z": "c80d918.f44b27",
        "name": "",
        "env": [
            {
                "name": "EQUIPMENT_ID",
                "value": "HJ10LAMLNL001",
                "type": "str"
            },
            {
                "name": "DEVICE_ID",
                "value": "virtual",
                "type": "str"
            }
        ],
        "x": 101,
        "y": 1080,
        "wires": [
            [
                "d06a224f.2a909"
            ]
        ]
    },
    {
        "id": "457347a7.83e088",
        "type": "subflow:b741f1b7.19805",
        "z": "c80d918.f44b27",
        "name": "",
        "env": [],
        "x": 730,
        "y": 1064,
        "wires": [
            [
                "d4f1e44f.f6eeb8"
            ]
        ]
    },
    {
        "id": "144872eb.4bab9d",
        "type": "comment",
        "z": "c80d918.f44b27",
        "name": "10LAMLNL001_2 S1吸吊機",
        "info": "",
        "x": 160,
        "y": 1180,
        "wires": []
    },
    {
        "id": "a4352dc1.3f306",
        "type": "subflow:3b73a09.e77af6",
        "z": "c80d918.f44b27",
        "name": "",
        "env": [],
        "x": 301,
        "y": 1240,
        "wires": [
            [
                "34bd250a.4b873a"
            ]
        ]
    },
    {
        "id": "34bd250a.4b873a",
        "type": "subflow:46c3b751.13e688",
        "z": "c80d918.f44b27",
        "name": "",
        "env": [
            {
                "name": "MONITOR_LIST",
                "value": "[\"AVAIL\"]",
                "type": "json"
            },
            {
                "name": "WSDL_URL",
                "value": "https://www.crcind.com/csp/samples/SOAP.Demo.CLS?WSDL=1",
                "type": "str"
            }
        ],
        "x": 501,
        "y": 1240,
        "wires": [
            [
                "f46cf685.f1b1c8"
            ],
            [
                "f3ff54c6.fa2928"
            ]
        ]
    },
    {
        "id": "f3ff54c6.fa2928",
        "type": "subflow:9c352516.1ade28",
        "z": "c80d918.f44b27",
        "name": "",
        "env": [
            {
                "name": "TOPIC",
                "value": "Query MS-SQL failure",
                "type": "str"
            }
        ],
        "x": 740,
        "y": 1264,
        "wires": [
            [
                "c86a9a1e.88a5f8"
            ]
        ]
    },
    {
        "id": "c86a9a1e.88a5f8",
        "type": "reading-out",
        "z": "c80d918.f44b27",
        "name": "",
        "equipmentId": "logger",
        "x": 1120,
        "y": 1264,
        "wires": []
    },
    {
        "id": "6f2d47b.c71bdb8",
        "type": "subflow:8ea31ce9.488ad",
        "z": "c80d918.f44b27",
        "name": "",
        "env": [],
        "x": 930,
        "y": 1224,
        "wires": [
            [
                "c86a9a1e.88a5f8"
            ]
        ]
    },
    {
        "id": "b06d76fe.3a5228",
        "type": "subflow:7a61fc3d.3aa584",
        "z": "c80d918.f44b27",
        "name": "",
        "env": [
            {
                "name": "EQUIPMENT_ID",
                "value": "HJ10LAMLNL001s1",
                "type": "str"
            },
            {
                "name": "DEVICE_ID",
                "value": "virtual",
                "type": "str"
            }
        ],
        "x": 101,
        "y": 1240,
        "wires": [
            [
                "a4352dc1.3f306"
            ]
        ]
    },
    {
        "id": "f46cf685.f1b1c8",
        "type": "subflow:b741f1b7.19805",
        "z": "c80d918.f44b27",
        "name": "",
        "x": 730,
        "y": 1224,
        "wires": [
            [
                "6f2d47b.c71bdb8"
            ]
        ]
    },
    {
        "id": "bb173026.1352c",
        "type": "comment",
        "z": "c80d918.f44b27",
        "name": "10LAMLNL001_3 S5吸吊機",
        "info": "",
        "x": 160,
        "y": 1340,
        "wires": []
    },
    {
        "id": "a51dff8c.1f9bb",
        "type": "subflow:3b73a09.e77af6",
        "z": "c80d918.f44b27",
        "name": "",
        "env": [],
        "x": 301,
        "y": 1400,
        "wires": [
            [
                "f23677d8.873838"
            ]
        ]
    },
    {
        "id": "f23677d8.873838",
        "type": "subflow:46c3b751.13e688",
        "z": "c80d918.f44b27",
        "name": "",
        "env": [
            {
                "name": "MONITOR_LIST",
                "value": "[\"AVAIL\"]",
                "type": "json"
            },
            {
                "name": "WSDL_URL",
                "value": "https://www.crcind.com/csp/samples/SOAP.Demo.CLS?WSDL=1",
                "type": "str"
            }
        ],
        "x": 501,
        "y": 1400,
        "wires": [
            [
                "2d8364da.24ec6c"
            ],
            [
                "4927383c.d01048"
            ]
        ]
    },
    {
        "id": "4927383c.d01048",
        "type": "subflow:9c352516.1ade28",
        "z": "c80d918.f44b27",
        "name": "",
        "env": [
            {
                "name": "TOPIC",
                "value": "Query MS-SQL failure",
                "type": "str"
            }
        ],
        "x": 740,
        "y": 1424,
        "wires": [
            [
                "9dc3c64e.07e498"
            ]
        ]
    },
    {
        "id": "9dc3c64e.07e498",
        "type": "reading-out",
        "z": "c80d918.f44b27",
        "name": "",
        "equipmentId": "logger",
        "x": 1120,
        "y": 1424,
        "wires": []
    },
    {
        "id": "c84caa39.882f88",
        "type": "subflow:8ea31ce9.488ad",
        "z": "c80d918.f44b27",
        "name": "",
        "env": [],
        "x": 930,
        "y": 1384,
        "wires": [
            [
                "9dc3c64e.07e498"
            ]
        ]
    },
    {
        "id": "8966d9ba.49d798",
        "type": "subflow:7a61fc3d.3aa584",
        "z": "c80d918.f44b27",
        "name": "",
        "env": [
            {
                "name": "EQUIPMENT_ID",
                "value": "HJ10LAMLNL001S5",
                "type": "str"
            },
            {
                "name": "DEVICE_ID",
                "value": "virtual",
                "type": "str"
            }
        ],
        "x": 101,
        "y": 1400,
        "wires": [
            [
                "a51dff8c.1f9bb"
            ]
        ]
    },
    {
        "id": "2d8364da.24ec6c",
        "type": "subflow:b741f1b7.19805",
        "z": "c80d918.f44b27",
        "name": "",
        "x": 730,
        "y": 1384,
        "wires": [
            [
                "c84caa39.882f88"
            ]
        ]
    },
    {
        "id": "80bfd34c.5c961",
        "type": "function",
        "z": "5606eb09.0cf1a4",
        "name": "build query 10DFPPRE003",
        "func": "const machine_no = '10DFPPRE003'\n\nmsg.config = {\n    \"query\": `EXEC dbo.PCB_Promis_Status_LotNo '${machine_no}'`\n}\n\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 520,
        "y": 380,
        "wires": [
            [
                "c77ec55f.8bc378"
            ]
        ]
    },
    {
        "id": "b7b0b868.6eab68",
        "type": "inject",
        "z": "5606eb09.0cf1a4",
        "name": "SQL Connection Test_10DFPPRE003",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "43200",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "SQL Connection Test_10DFPPRE003",
        "payload": "",
        "payloadType": "date",
        "x": 210,
        "y": 380,
        "wires": [
            []
        ]
    },
    {
        "id": "ff8d6796.427a98",
        "type": "function",
        "z": "a1c64ce7.10946",
        "name": "validate input",
        "func": "const alarms = msg.alarms\nconst channel_names = msg.channelNames\nconst equipment_info = msg.equipmentInfo\nconst query_result = msg.queryResult\nconst reading_in = msg.readingIn\n\nif (typeof alarms === undefined ||\n        typeof channel_names === undefined ||\n        typeof equipment_info === undefined ||\n        typeof payload === undefined ||\n        typeof reading_in === undefined) \n{\n    node.error('input error')\n    return\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 390,
        "y": 240,
        "wires": [
            [
                "e722e6a.76b5218"
            ]
        ]
    },
    {
        "id": "fb053323.c9a4c",
        "type": "e-mail",
        "z": "a1c64ce7.10946",
        "server": "10.13.66.25",
        "port": "25",
        "secure": false,
        "tls": true,
        "name": "",
        "dname": "",
        "x": 1010,
        "y": 300,
        "wires": []
    },
    {
        "id": "c1b5938a.b9d4f",
        "type": "function",
        "z": "a1c64ce7.10946",
        "name": "build email message",
        "func": "const alarms = msg.alarms\nconst channel_names = msg.channelNames\nconst equipment_info = msg.equipmentInfo\nconst query_result = msg.queryResult\nconst reading_in = msg.readingIn\n\nlet machine_no = equipment_info.machineNo\nlet eq_name = equipment_info.equipmentName\nlet insert_time = _to_ms_sql_datetime(reading_in.at)\nlet log_time = insert_time\nlet promis_status = query_result.result[0].PromisStatus\nlet promis_time = _to_ms_sql_datetime(\n    _offset_promis_time(query_result.result[0].PromisTime))\nlet lot_no = query_result.result[0].LotNo\n\nlet html = `\n<body>\n\n<table  style=\"border:0px #000000 solid;padding:5px;\" rules=\"all\" cellpadding='5';border='1'>\n  <tr>\n    <th>MachineNo</th>\n    <th>EQName</th> \n    <th>EventCode</th>\n    <th>EventMessage</th>\n    <th>InsertTime</th>\n    <th>LogTime</th>\n    <th>PromisStatus</th>\n    <th>PromisTime</th>\n    <th>LotNo</th>\n  </tr>\n`\n\nfor (let channel in alarms)\n{\n    let event_code = channel\n    let event_message = channel_names[channel]\n    \n    html += `\n  <tr>\n    <td>${machine_no}</td>\n    <td>${eq_name}</td>\n    <td>${event_code}</td>\n    <td>${event_message}</td>\n    <td>${insert_time}</td>\n    <td>${log_time}</td>\n    <td>${promis_status}</td>\n    <td>${promis_time}</td>\n    <td>${lot_no}</td>\n  </tr>\n`\n}\n\nhtml += `\n</table>\n</body>\n此為系統自動發送, 請勿回覆\n`\n\nmsg.topic = `設備 ${eq_name} 警告`\nmsg.headers = '<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\">'\nmsg.payload = html\n\n\nreturn msg;\n\n// internal function\nfunction _offset_promis_time(from)\n{\n    const d = new Date(from)\n    \n    return d.getTime() - 28800000\n}\n\nfunction _to_ms_sql_datetime(from)\n{\n    const d = new Date(from)\n    \n    let date = (\"0\" + d.getDate()).slice(-2)\n    let month = (\"0\" + (d.getMonth() + 1)).slice(-2)\n    let year = d.getFullYear()\n    let hours = d.getHours()\n    let minutes = d.getMinutes()\n    let seconds = d.getSeconds()\n    \n    return year + \"-\" + month + \"-\" + date + \" \" + hours + \":\" + minutes + \":\" + seconds\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 800,
        "y": 240,
        "wires": [
            [
                "fb053323.c9a4c"
            ]
        ]
    },
    {
        "id": "e722e6a.76b5218",
        "type": "function",
        "z": "a1c64ce7.10946",
        "name": "mail reciepents",
        "func": "msg.to = 'Kevin_Hu@unimicron.com'\nmsg.cc = 'Chris_Liao@unimicron.com'\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 580,
        "y": 240,
        "wires": [
            [
                "c1b5938a.b9d4f"
            ]
        ]
    },
    {
        "id": "a6aa1660.2905a8",
        "type": "e-mail",
        "z": "5606eb09.0cf1a4",
        "server": "10.13.66.25",
        "port": "25",
        "secure": false,
        "tls": true,
        "name": "Kevin_Hu@unimicron.com",
        "dname": "",
        "x": 540,
        "y": 680,
        "wires": []
    },
    {
        "id": "da43ca5f.5017d8",
        "type": "inject",
        "z": "5606eb09.0cf1a4",
        "name": "TEST",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "TEST",
        "payload": "10PTHPNL003",
        "payloadType": "str",
        "x": 110,
        "y": 560,
        "wires": [
            [
                "f4e6df02.a0d65"
            ]
        ]
    },
    {
        "id": "f4e6df02.a0d65",
        "type": "function",
        "z": "5606eb09.0cf1a4",
        "name": "build query",
        "func": "const machine_no = msg.payload\n\nmsg.config = {\n    \"query\": `EXEC dbo.PCB_Promis_Status_LotNo '${machine_no}'`\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 290,
        "y": 560,
        "wires": [
            [
                "dfefba9c.04a418"
            ]
        ]
    },
    {
        "id": "dfefba9c.04a418",
        "type": "mssql",
        "z": "5606eb09.0cf1a4",
        "name": "",
        "server": "10.13.69.49",
        "port": "1433",
        "connectionTimeout": "60000",
        "requestTimeout": "60000",
        "connectionPoolSize": "1",
        "username": "Datamation",
        "password": "P@ssw0rd",
        "database": "Datamation_PCB",
        "query": "",
        "x": 490,
        "y": 560,
        "wires": [
            [
                "a6aa1660.2905a8",
                "60a6429e.f49c5c"
            ]
        ]
    },
    {
        "id": "efe5a95b.a09e48",
        "type": "e-mail",
        "z": "5606eb09.0cf1a4",
        "server": "10.13.66.25",
        "port": "25",
        "secure": false,
        "tls": true,
        "name": "",
        "dname": "",
        "x": 1250,
        "y": 620,
        "wires": []
    },
    {
        "id": "dd5b596.b5034a8",
        "type": "function",
        "z": "5606eb09.0cf1a4",
        "name": "build email message_資策會",
        "func": "const alarms = 'TEST'\nconst channel_names = 'TEST'\n//const equipment_info = msg.equipmentInfo\nconst query_result = msg.queryResult\n//const reading_in = msg.readingIn\n\nlet machine_no = msg.machine_no\nlet eq_name = 'TEST'\nlet insert_time = _to_ms_sql_datetime(new Date())\nlet log_time = insert_time\nlet promis_status = query_result.result[0].PromisStatus\nlet promis_time = _to_ms_sql_datetime(query_result.result[0].PromisTime)\nlet lot_no = query_result.result[0].LotNo\n\nlet html = `\n<body>\n\n<table  style=\"border:0px #000000 solid;padding:5px;\" rules=\"all\" cellpadding='5';border='1'>\n  <tr>\n    <th>MachineNo</th>\n    <th>EQName</th> \n    <th>EventCode</th>\n    <th>EventMessage</th>\n    <th>InsertTime</th>\n    <th>LogTime</th>\n    <th>PromisStatus</th>\n    <th>PromisTime</th>\n    <th>LotNo</th>\n  </tr>\n`\n\n//for (let channel in alarms)\n//{\n    let event_code = 'DXXX'\n    let event_message = 'Time Testing'\n    \n    html += `\n  <tr>\n    <td>${machine_no}</td>\n    <td>${eq_name}</td>\n    <td>${event_code}</td>\n    <td>${event_message}</td>\n    <td>${insert_time}</td>\n    <td>${log_time}</td>\n    <td>${promis_status}</td>\n    <td>${promis_time}</td>\n    <td>${lot_no}</td>\n  </tr>\n`\n//}\n\nhtml += `\n</table>\n</body>\n此為系統自動發送, 請勿回覆\n`\n\nmsg.topic = `設備 ${eq_name} 警告_資策會`\nmsg.headers = '<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\">'\nmsg.payload = html\n\n\nreturn msg;\n\nfunction _to_ms_sql_datetime(from)\n{\n    let d = new Date(from)\n    \n    let date = (\"0\" + d.getUTCDate()).slice(-2)\n    let month = (\"0\" + (d.getUTCMonth() + 1)).slice(-2)\n    let year = d.getUTCFullYear()\n    let hours = d.getUTCHours()\n    let minutes = d.getUTCMinutes()\n    let seconds = d.getUTCSeconds()\n    \n    return year + \"-\" + month + \"-\" + date + \" \" + hours + \":\" + minutes + \":\" + seconds\n}\n",
        "outputs": 1,
        "noerr": 0,
        "x": 1060,
        "y": 620,
        "wires": [
            [
                "efe5a95b.a09e48"
            ]
        ]
    },
    {
        "id": "4cf7c35e.42654c",
        "type": "function",
        "z": "5606eb09.0cf1a4",
        "name": "mail reciepents",
        "func": "msg.to = 'Kevin_Hu@unimicron.com'\nmsg.cc = 'Chris_Liao@unimicron.com'\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 920,
        "y": 560,
        "wires": [
            [
                "dd5b596.b5034a8",
                "7806500e.c4b68"
            ]
        ]
    },
    {
        "id": "60a6429e.f49c5c",
        "type": "function",
        "z": "5606eb09.0cf1a4",
        "name": "save query result",
        "func": "msg.queryResult = msg.payload\n\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "x": 710,
        "y": 560,
        "wires": [
            [
                "4cf7c35e.42654c"
            ]
        ]
    },
    {
        "id": "32296401.b5002c",
        "type": "comment",
        "z": "5606eb09.0cf1a4",
        "name": "Time Test",
        "info": "",
        "x": 100,
        "y": 500,
        "wires": []
    },
    {
        "id": "7806500e.c4b68",
        "type": "function",
        "z": "5606eb09.0cf1a4",
        "name": "build email message_Mine",
        "func": "const alarms = 'TEST'\nconst channel_names = 'TEST'\n//const equipment_info = msg.equipmentInfo\nconst query_result = msg.queryResult\n//const reading_in = msg.readingIn\n\nlet machine_no = msg.machine_no\nlet eq_name = 'TEST'\nlet insert_time = _to_ms_sql_datetime(new Date())\nlet log_time = insert_time\nlet promis_status = query_result.result[0].PromisStatus\n//let promis_time = _to_ms_sql_datetime(query_result.result[0].PromisTime)\nlet promis_time = query_result.result[0].PromisTime\nlet lot_no = query_result.result[0].LotNo\n\nlet html = `\n<body>\n\n<table  style=\"border:0px #000000 solid;padding:5px;\" rules=\"all\" cellpadding='5';border='1'>\n  <tr>\n    <th>MachineNo</th>\n    <th>EQName</th> \n    <th>EventCode</th>\n    <th>EventMessage</th>\n    <th>InsertTime</th>\n    <th>LogTime</th>\n    <th>PromisStatus</th>\n    <th>PromisTime</th>\n    <th>LotNo</th>\n  </tr>\n`\n\n//for (let channel in alarms)\n//{\n    let event_code = 'DXXX'\n    let event_message = 'Time Testing'\n    \n    html += `\n  <tr>\n    <td>${machine_no}</td>\n    <td>${eq_name}</td>\n    <td>${event_code}</td>\n    <td>${event_message}</td>\n    <td>${insert_time}</td>\n    <td>${log_time}</td>\n    <td>${promis_status}</td>\n    <td>${promis_time}</td>\n    <td>${lot_no}</td>\n  </tr>\n`\n//}\n\nhtml += `\n</table>\n</body>\n此為系統自動發送, 請勿回覆\n`\n\nmsg.topic = `設備 ${eq_name} 警告_Mine`\nmsg.headers = '<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\">'\nmsg.payload = html\n\n\nreturn msg;\n\nfunction _to_ms_sql_datetime(from)\n{\n    let d = new Date(from)\n    \n    let date = (\"0\" + d.getDate()).slice(-2)\n    let month = (\"0\" + (d.getMonth() + 1)).slice(-2)\n    let year = (\"0\" + d.getFullYear()).slice(-2)\n    let hours = (\"0\" + d.getHours()).slice(-2)\n    let minutes = (\"0\" + d.getMinutes()).slice(-2)\n    let seconds = (\"0\" + d.getSeconds()).slice(-2)\n    \n    return year + \"-\" + month + \"-\" + date + \" \" + hours + \":\" + minutes + \":\" + seconds\n}\n",
        "outputs": 1,
        "noerr": 0,
        "x": 1060,
        "y": 680,
        "wires": [
            [
                "d71bb9bf.7c5778"
            ]
        ]
    },
    {
        "id": "d71bb9bf.7c5778",
        "type": "e-mail",
        "z": "5606eb09.0cf1a4",
        "server": "10.13.66.25",
        "port": "25",
        "secure": false,
        "tls": true,
        "name": "",
        "dname": "",
        "x": 1250,
        "y": 680,
        "wires": []
    },
    {
        "id": "c21a7e83.a7d55",
        "type": "subflow:3b73a09.e77af6",
        "z": "832ec745.2f9928",
        "name": "",
        "env": [],
        "x": 270,
        "y": 120,
        "wires": [
            [
                "259fda36.239736"
            ]
        ]
    },
    {
        "id": "259fda36.239736",
        "type": "subflow:46c3b751.13e688",
        "z": "832ec745.2f9928",
        "name": "",
        "env": [
            {
                "name": "MONITOR_LIST",
                "value": "[\"AVAIL\"]",
                "type": "json"
            },
            {
                "name": "WSDL_URL",
                "value": "https://www.crcind.com/csp/samples/SOAP.Demo.CLS?WSDL=1",
                "type": "str"
            }
        ],
        "x": 435,
        "y": 120,
        "wires": [
            [
                "14e6cd6e.482513"
            ],
            [
                "7ceddf37.5322b"
            ]
        ]
    },
    {
        "id": "7ceddf37.5322b",
        "type": "subflow:9c352516.1ade28",
        "z": "832ec745.2f9928",
        "name": "",
        "env": [
            {
                "name": "TOPIC",
                "value": "Query MS-SQL failure",
                "type": "str"
            }
        ],
        "x": 685,
        "y": 143,
        "wires": [
            [
                "2dc4e8ea.3fbda8"
            ]
        ]
    },
    {
        "id": "2dc4e8ea.3fbda8",
        "type": "reading-out",
        "z": "832ec745.2f9928",
        "name": "",
        "equipmentId": "logger",
        "x": 1086,
        "y": 143,
        "wires": []
    },
    {
        "id": "f42c9b4a.16db78",
        "type": "subflow:8ea31ce9.488ad",
        "z": "832ec745.2f9928",
        "name": "",
        "env": [],
        "x": 876,
        "y": 103,
        "wires": [
            [
                "2dc4e8ea.3fbda8"
            ]
        ]
    },
    {
        "id": "377313dd.fea64c",
        "type": "subflow:7a61fc3d.3aa584",
        "z": "832ec745.2f9928",
        "name": "",
        "env": [
            {
                "name": "EQUIPMENT_ID",
                "value": "HJ10GFPNAP001",
                "type": "str"
            },
            {
                "name": "DEVICE_ID",
                "value": "virtual",
                "type": "str"
            }
        ],
        "x": 107,
        "y": 120,
        "wires": [
            [
                "c21a7e83.a7d55"
            ]
        ]
    },
    {
        "id": "9821ceb7.642d3",
        "type": "comment",
        "z": "832ec745.2f9928",
        "name": "10GFPNAP001 化金#A線",
        "info": "",
        "x": 156,
        "y": 59,
        "wires": []
    },
    {
        "id": "2db4c273.69c41e",
        "type": "function",
        "z": "12b00dca.df6d12",
        "name": "validate input",
        "func": "const alarms = msg.alarms\nconst channel_names = msg.channelNames\nconst equipment_info = msg.equipmentInfo\nconst query_result = msg.queryResult\nconst reading_in = msg.readingIn\n\nif (typeof alarms === undefined ||\n        typeof channel_names === undefined ||\n        typeof equipment_info === undefined ||\n        typeof payload === undefined ||\n        typeof reading_in === undefined) \n{\n    node.error('input error')\n    return\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 390,
        "y": 140,
        "wires": [
            [
                "e8081ff4.b705a"
            ]
        ]
    },
    {
        "id": "fda47277.50651",
        "type": "e-mail",
        "z": "12b00dca.df6d12",
        "server": "10.13.66.25",
        "port": "25",
        "secure": false,
        "tls": false,
        "name": "",
        "dname": "",
        "x": 1010,
        "y": 200,
        "wires": []
    },
    {
        "id": "efe3e27f.f690b",
        "type": "function",
        "z": "12b00dca.df6d12",
        "name": "build email message",
        "func": "const alarms = msg.alarms\nconst channel_names = msg.channelNames\nconst equipment_info = msg.equipmentInfo\nconst query_result = msg.queryResult\nconst reading_in = msg.readingIn\n\nlet machine_no = equipment_info.machineNo\nlet eq_name = equipment_info.equipmentName\nlet insert_time = _to_ms_sql_datetime(reading_in.at)\nlet log_time = insert_time\nlet promis_status = query_result.result[0].PromisStatus\nlet promis_time = _to_ms_sql_datetime(\n    _offset_promis_time(query_result.result[0].PromisTime))\nlet lot_no = query_result.result[0].LotNo\n\nlet html = `\n<body>\n\n<table  style=\"border:0px #000000 solid;padding:5px;\" rules=\"all\" cellpadding='5';border='1'>\n  <tr>\n    <th>MachineNo</th>\n    <th>EQName</th> \n    <th>EventCode</th>\n    <th>EventMessage</th>\n    <th>InsertTime</th>\n    <th>LogTime</th>\n    <th>PromisStatus</th>\n    <th>PromisTime</th>\n    <th>LotNo</th>\n  </tr>\n`\n\nfor (let channel in alarms)\n{\n    let event_code = channel\n    let event_message = channel_names[channel]\n    \n    html += `\n  <tr>\n    <td>${machine_no}</td>\n    <td>${eq_name}</td>\n    <td>${event_code}</td>\n    <td>${event_message}</td>\n    <td>${insert_time}</td>\n    <td>${log_time}</td>\n    <td>${promis_status}</td>\n    <td>${promis_time}</td>\n    <td>${lot_no}</td>\n  </tr>\n`\n}\n\nhtml += `\n</table>\n</body>\n此為系統自動發送, 請勿回覆\n`\n\nmsg.topic = `設備 ${eq_name} 警告`\nmsg.headers = '<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\">'\nmsg.payload = html\n\n\nreturn msg;\n\n// internal function\nfunction _offset_promis_time(from)\n{\n    const d = new Date(from)\n    \n    return d.getTime() - 28800000\n}\n\nfunction _to_ms_sql_datetime(from)\n{\n    const d = new Date(from)\n    \n    let date = (\"0\" + d.getDate()).slice(-2)\n    let month = (\"0\" + (d.getMonth() + 1)).slice(-2)\n    let year = d.getFullYear()\n    let hours = d.getHours()\n    let minutes = d.getMinutes()\n    let seconds = d.getSeconds()\n    \n    return year + \"-\" + month + \"-\" + date + \" \" + hours + \":\" + minutes + \":\" + seconds\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 800,
        "y": 140,
        "wires": [
            [
                "fda47277.50651"
            ]
        ]
    },
    {
        "id": "e8081ff4.b705a",
        "type": "function",
        "z": "12b00dca.df6d12",
        "name": "mail reciepents",
        "func": "msg.to = 'swwang@unimicron.com,A1919@unimicron.com,04181@unimicron.com,joelin2@unimicron.com,tony_lau@unimicron.com,010182@unimicron.com,C.L_Lin@unimicron.com,vincent.lu@unimicron.com,08213@unimicron.com,jackson_lee@unimicron.com,ricky_huang@unimicron.com,A0899@unimicron.com,Sam_Lo@unimicron.com,A0841@unimicron.com,33844@unimicron.com,Leon_Lin@unimicron.com,A0576@unimicron.com,25613@unimicron.com,A1172@unimicron.com,jerryliu@unimicron.com,A0791@unimicron.com,A1348@unimicron.com,34518@unimicron.com,jkde@unimicron.com,west_wang@unimicron.com,cccho@unimicron.com,jerry_chin@unimicron.com,09975@unimicron.com,A1492@unimicron.com,32240@unimicron.com,A1172@unimicron.com,ballliu@unimicron.com,01595@unimicron.com,A0359@unimicron.com,Roba_Lo@unimicron.com,A0968@unimicron.com,A1493@unimicron.com,25613@unimicron.com,A0356@unimicron.com,desung_lin@unimicron.com,A1403@unimicron.com,A1021@unimicron.com,A0030@unimicron.com,08194@unimicron.com,55383@unimicron.com,01595@unimicron.com,Small_Shih@unimicron.com,A1304@unimicron.com'\nmsg.cc = 'cpl@unimicron.com,darren_chen@unimicron.com'\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 580,
        "y": 140,
        "wires": [
            [
                "efe3e27f.f690b"
            ]
        ]
    },
    {
        "id": "14e6cd6e.482513",
        "type": "subflow:12b00dca.df6d12",
        "z": "832ec745.2f9928",
        "name": "",
        "env": [],
        "x": 675,
        "y": 103,
        "wires": [
            [
                "f42c9b4a.16db78"
            ]
        ]
    },
    {
        "id": "6e59a344.027dac",
        "type": "subflow:3b73a09.e77af6",
        "z": "397ce130.4f902e",
        "name": "",
        "env": [],
        "x": 290,
        "y": 120,
        "wires": [
            [
                "9124f4fd.3f7f08"
            ]
        ]
    },
    {
        "id": "9124f4fd.3f7f08",
        "type": "subflow:46c3b751.13e688",
        "z": "397ce130.4f902e",
        "name": "",
        "env": [
            {
                "name": "MONITOR_LIST",
                "value": "[\"AVAIL\"]",
                "type": "json"
            },
            {
                "name": "WSDL_URL",
                "value": "https://www.crcind.com/csp/samples/SOAP.Demo.CLS?WSDL=1",
                "type": "str"
            }
        ],
        "x": 455,
        "y": 120,
        "wires": [
            [
                "aa2cb46b.8ffbb8"
            ],
            [
                "da0ec64b.0dce08"
            ]
        ]
    },
    {
        "id": "da0ec64b.0dce08",
        "type": "subflow:9c352516.1ade28",
        "z": "397ce130.4f902e",
        "name": "",
        "env": [
            {
                "name": "TOPIC",
                "value": "Query MS-SQL failure",
                "type": "str"
            }
        ],
        "x": 705,
        "y": 143,
        "wires": [
            [
                "27e576da.76de1a"
            ]
        ]
    },
    {
        "id": "27e576da.76de1a",
        "type": "reading-out",
        "z": "397ce130.4f902e",
        "name": "",
        "equipmentId": "logger",
        "x": 1106,
        "y": 143,
        "wires": []
    },
    {
        "id": "9af2b4ce.980288",
        "type": "subflow:8ea31ce9.488ad",
        "z": "397ce130.4f902e",
        "name": "",
        "env": [],
        "x": 896,
        "y": 103,
        "wires": [
            [
                "27e576da.76de1a"
            ]
        ]
    },
    {
        "id": "41f93ffa.9b4d4",
        "type": "subflow:7a61fc3d.3aa584",
        "z": "397ce130.4f902e",
        "name": "",
        "env": [
            {
                "name": "DEVICE_ID",
                "value": "virtual",
                "type": "str"
            }
        ],
        "x": 127,
        "y": 120,
        "wires": [
            [
                "6e59a344.027dac"
            ]
        ]
    },
    {
        "id": "aa2cb46b.8ffbb8",
        "type": "subflow:3441a2ec.833a6e",
        "z": "397ce130.4f902e",
        "name": "",
        "env": [],
        "x": 670,
        "y": 100,
        "wires": [
            [
                "9af2b4ce.980288"
            ]
        ]
    },
    {
        "id": "7b0ac41c.49a9bc",
        "type": "api",
        "z": "e30aea47.352308",
        "name": "fins equipments",
        "method": "GET",
        "path": "/api/v1/config/fins/equipments",
        "x": 440,
        "y": 100,
        "wires": [
            [
                "6947a9fc.1aea88"
            ]
        ]
    },
    {
        "id": "6947a9fc.1aea88",
        "type": "function",
        "z": "e30aea47.352308",
        "name": "fins",
        "func": "const equipment_id = msg.env.equipmentId\nconst payload = msg.payload\nconst status_code = msg.statusCode\n\nlet output = [null, msg]\nlet equipment_info = {}\n\nif (status_code !== 200)\n{\n    node.error(`unexpected status code: ${status_code}`)\n    return\n}\n\n// extract equipment info\nfor (let i = 0; i < payload.length; ++i)\n{\n    let equipment = payload[i]['equipment']\n    \n    if (equipment['equipmentId'] === equipment_id)\n    {\n        equipment_info['equipmentId'] = equipment_id\n        equipment_info['equipmentName'] = equipment['equipmentName']\n        equipment_info['properties'] = {}\n        \n        for(let i = 0; i < equipment['properties'].length; ++i)\n        {\n            let property = equipment['properties'][i]\n            \n            if (property['key'] === \"machineName\")\n            {\n                equipment_info.properties['machineName'] = property['value']\n            }\n            if (property['key'] === \"machineNo\")\n            {\n                equipment_info.properties['machineNo'] = property['value']\n            }\n        }\n    }    \n}\n\nif (Object.entries(equipment_info).length !== 0)\n{\n    msg.config = {\n        'path': `/api/v1/config/fins/templates/${equipment_id}`\n    }\n    msg.equipmentInfo = equipment_info\n    output = [msg, null]\n}\n\nreturn output;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 430,
        "y": 140,
        "wires": [
            [
                "d189d5d2.148418"
            ],
            [
                "d96c6596.689628"
            ]
        ]
    },
    {
        "id": "d96c6596.689628",
        "type": "api",
        "z": "e30aea47.352308",
        "name": "modbus equipments",
        "method": "GET",
        "path": "/api/v1/config/modbus/equipments",
        "x": 460,
        "y": 180,
        "wires": [
            [
                "2fd19340.c43d4c"
            ]
        ]
    },
    {
        "id": "2fd19340.c43d4c",
        "type": "function",
        "z": "e30aea47.352308",
        "name": "modbus",
        "func": "const equipment_id = msg.env.equipmentId\nconst payload = msg.payload\nconst status_code = msg.statusCode\n\nlet output = [null, msg]\nlet equipment_info = {}\n\nif (status_code !== 200)\n{\n    node.error(`unexpected status code: ${status_code}`)\n    return\n}\n\n// extract equipment info\nfor (let i = 0; i < payload.length; ++i)\n{\n    let equipments = payload[i]['equipments']\n    \n    for (let i = 0; i < equipments.length; ++i)\n    {\n        let equipment = equipments[i]\n        \n        if (equipment['equipmentId'] === equipment_id)\n        {\n            equipment_info['equipmentId'] = equipment_id\n            equipment_info['equipmentName'] = equipment['equipmentName']\n            equipment_info['properties'] = {}\n        \n            for(let i = 0; i < equipment['properties'].length; ++i)\n            {\n                let property = equipment['properties'][i]\n                \n                if (property['key'] === \"machineName\")\n                {\n                    equipment_info.properties['machineName'] = property['value']\n                }\n                if (property['key'] === \"machineNo\")\n                {\n                    equipment_info.properties['machineNo'] = property['value']\n                }\n            }\n        }    \n    }\n}\n\nif (Object.entries(equipment_info).length !== 0)\n{\n    msg.config = {\n        'path': `/api/v1/config/modbus/templates/${equipment_id}`\n    }\n    msg.equipmentInfo = equipment_info\n    output = [msg, null]\n}\n\nreturn output;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 440,
        "y": 220,
        "wires": [
            [
                "d189d5d2.148418"
            ],
            [
                "bf6297c.f52a368"
            ]
        ]
    },
    {
        "id": "b6334681.6763a8",
        "type": "api",
        "z": "e30aea47.352308",
        "name": "mewtocol equipments",
        "method": "GET",
        "path": "/api/v1/config/mewtocol/equipments",
        "x": 460,
        "y": 340,
        "wires": [
            [
                "14108c09.4e17d4"
            ]
        ]
    },
    {
        "id": "3c5a535.4ab2fac",
        "type": "api",
        "z": "e30aea47.352308",
        "name": "step7 equipments",
        "method": "GET",
        "path": "/api/v1/config/step7/equipments",
        "x": 450,
        "y": 420,
        "wires": [
            [
                "a06d72d1.1e691"
            ]
        ]
    },
    {
        "id": "bf6297c.f52a368",
        "type": "api",
        "z": "e30aea47.352308",
        "name": "melsec equipments",
        "method": "GET",
        "path": "/api/v1/config/melsec/equipments",
        "x": 450,
        "y": 260,
        "wires": [
            [
                "eadbf5c5.e61f28"
            ]
        ]
    },
    {
        "id": "eadbf5c5.e61f28",
        "type": "function",
        "z": "e30aea47.352308",
        "name": "melsec",
        "func": "const equipment_id = msg.env.equipmentId\nconst payload = msg.payload\nconst status_code = msg.statusCode\n\nlet output = [null, msg]\nlet equipment_info = {}\n\nif (status_code !== 200)\n{\n    node.error(`unexpected status code: ${status_code}`)\n    return\n}\n\n// extract equipment info\nfor (let i = 0; i < payload.length; ++i)\n{\n    let equipments = payload[i]['equipmentList']\n    \n    for (let i = 0; i < equipments.length; ++i)\n    {\n        let equipment = equipments[i]\n        \n        if (equipment['equipmentId'] === equipment_id)\n        {\n            equipment_info['equipmentId'] = equipment_id\n            equipment_info['equipmentName'] = equipment['equipmentName']\n            equipment_info['properties'] = {}\n        \n            for(let i = 0; i < equipment['properties'].length; ++i)\n            {\n                let property = equipment['properties'][i]\n                \n                if (property['key'] === \"machineName\")\n                {\n                    equipment_info.properties['machineName'] = property['value']\n                }\n                if (property['key'] === \"machineNo\")\n                {\n                    equipment_info.properties['machineNo'] = property['value']\n                }\n            }\n        }    \n    }\n}\n\nif (Object.entries(equipment_info).length !== 0)\n{\n    msg.config = {\n        'path': `/api/v1/config/melsec/templates/${equipment_id}`\n    }\n    msg.equipmentInfo = equipment_info\n    output = [msg, null]\n}\n\nreturn output;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 440,
        "y": 300,
        "wires": [
            [
                "d189d5d2.148418"
            ],
            [
                "b6334681.6763a8"
            ]
        ]
    },
    {
        "id": "d3a13a65.458ba8",
        "type": "function",
        "z": "e30aea47.352308",
        "name": "unexpected",
        "func": "node.error('unexpected')",
        "outputs": 0,
        "noerr": 0,
        "x": 430,
        "y": 560,
        "wires": []
    },
    {
        "id": "d189d5d2.148418",
        "type": "api",
        "z": "e30aea47.352308",
        "name": "template",
        "method": "GET",
        "path": "",
        "x": 920,
        "y": 240,
        "wires": [
            [
                "cc03619c.8b1ab"
            ]
        ]
    },
    {
        "id": "cc03619c.8b1ab",
        "type": "function",
        "z": "e30aea47.352308",
        "name": "template",
        "func": "const template = msg.payload\nconst channels = msg.payload.channels\n\nlet data = []\nlet event = []\nfor(let i = 0; i < channels.length; ++i)\n{\n    let channel = channels[i]\n    \n    if (channel['category'].includes('msmq_data'))\n    {\n        data.push(channel['channelId'])\n    }\n    \n    if (channel['category'].includes('msmq_event'))\n    {\n        event.push(channel['channelId'])\n    }\n}\n\nmsg.equipmentInfo.template = template\nmsg.equipmentInfo.categorizedChannels = {\n    'data': data,\n    'event': event\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 940,
        "y": 280,
        "wires": [
            []
        ]
    },
    {
        "id": "dc22f183.74738",
        "type": "subflow:e30aea47.352308",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [
            {
                "name": "EQUIPMENT_ID",
                "value": "step7",
                "type": "str"
            }
        ],
        "x": 300,
        "y": 120,
        "wires": [
            [
                "99be2005.c86a6"
            ]
        ]
    },
    {
        "id": "14108c09.4e17d4",
        "type": "function",
        "z": "e30aea47.352308",
        "name": "mewtocol",
        "func": "const equipment_id = msg.env.equipmentId\nconst payload = msg.payload\nconst status_code = msg.statusCode\n\nlet output = [null, msg]\nlet equipment_info = {}\n\nif (status_code !== 200)\n{\n    node.error(`unexpected status code: ${status_code}`)\n    return\n}\n\n// extract equipment info\nfor (let i = 0; i < payload.length; ++i)\n{\n    let equipment = payload[i]['equipment']\n    \n    if (equipment['equipmentId'] === equipment_id)\n    {\n        equipment_info['equipmentId'] = equipment_id\n        equipment_info['equipmentName'] = equipment['equipmentName']\n        equipment_info['properties'] = {}\n        \n        for(let i = 0; i < equipment['properties'].length; ++i)\n        {\n            let property = equipment['properties'][i]\n            \n            if (property['key'] === \"machineName\")\n            {\n                equipment_info.properties['machineName'] = property['value']\n            }\n            if (property['key'] === \"machineNo\")\n            {\n                equipment_info.properties['machineNo'] = property['value']\n            }\n        }\n    }    \n}\n\nif (Object.entries(equipment_info).length !== 0)\n{\n    msg.config = {\n        'path': `/api/v1/config/mewtocol/templates/${equipment_id}`\n    }\n    msg.equipmentInfo = equipment_info\n    output = [msg, null]\n}\n\nreturn output;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 440,
        "y": 380,
        "wires": [
            [
                "d189d5d2.148418"
            ],
            [
                "3c5a535.4ab2fac"
            ]
        ]
    },
    {
        "id": "a06d72d1.1e691",
        "type": "function",
        "z": "e30aea47.352308",
        "name": "step7",
        "func": "const equipment_id = msg.env.equipmentId\nconst payload = msg.payload\nconst status_code = msg.statusCode\n\nlet output = [null, msg]\nlet equipment_info = {}\n\nif (status_code !== 200)\n{\n    node.error(`unexpected status code: ${status_code}`)\n    return\n}\n\n// extract equipment info\nfor (let i = 0; i < payload.length; ++i)\n{\n    let equipment = payload[i]['equipment']\n    \n    if (equipment['equipmentId'] === equipment_id)\n    {\n        equipment_info['equipmentId'] = equipment_id\n        equipment_info['equipmentName'] = equipment['equipmentName']\n        equipment_info['properties'] = {}\n        \n        for(let i = 0; i < equipment['properties'].length; ++i)\n        {\n            let property = equipment['properties'][i]\n            \n            if (property['key'] === \"machineName\")\n            {\n                equipment_info.properties['machineName'] = property['value']\n            }\n            if (property['key'] === \"machineNo\")\n            {\n                equipment_info.properties['machineNo'] = property['value']\n            }\n        }\n    }    \n}\n\nif (Object.entries(equipment_info).length !== 0)\n{\n    msg.config = {\n        'path': `/api/v1/config/step7/templates/${equipment_id}`\n    }\n    msg.equipmentInfo = equipment_info\n    output = [msg, null]\n}\n\nreturn output;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 430,
        "y": 460,
        "wires": [
            [
                "d189d5d2.148418"
            ],
            [
                "d3a13a65.458ba8"
            ]
        ]
    },
    {
        "id": "8756c666.cf6e88",
        "type": "function",
        "z": "1524802c.2eebb",
        "name": "validate input",
        "func": "if (!msg.hasOwnProperty('env') ||\n        !msg.hasOwnProperty('equipmentInfo') ||\n        !msg.hasOwnProperty('nextQuerySince'))\n{\n    node.error('input error')\n    return\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 270,
        "y": 140,
        "wires": [
            [
                "6a4cb906.bfb1c8"
            ]
        ]
    },
    {
        "id": "6e0ef492.fc983c",
        "type": "query-history",
        "z": "1524802c.2eebb",
        "name": "",
        "equipmentId": "",
        "since": "",
        "until": "",
        "ascending": false,
        "maxReadings": "",
        "x": 480,
        "y": 180,
        "wires": [
            [
                "6da100eb.aacda",
                "94e7ff1d.da8dc"
            ]
        ]
    },
    {
        "id": "6a4cb906.bfb1c8",
        "type": "function",
        "z": "1524802c.2eebb",
        "name": "build query",
        "func": "const readings_per_update = msg.env.readingsPerUpdate\nconst event_only = msg.env.eventOnly\nconst equipment_id = msg.env.equipmentId\nconst next_query_since = msg.nextQuerySince\n\nmsg.config = {\n    'equipmentId': equipment_id,\n    'ascending': true,\n    'maxReadings': readings_per_update,\n    'since': event_only ? next_query_since : next_query_since + 1 \n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 450,
        "y": 140,
        "wires": [
            [
                "6e0ef492.fc983c"
            ]
        ]
    },
    {
        "id": "d3b7dfb0.17682",
        "type": "subflow:1524802c.2eebb",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 760,
        "y": 80,
        "wires": [
            [
                "38cae85b.bfe778"
            ]
        ]
    },
    {
        "id": "c7cb76fc.98cdb8",
        "type": "function",
        "z": "1524802c.2eebb",
        "name": "event",
        "func": "const payload = msg.payload\nconst equipment_id = msg.env.equipmentId\nconst properties = msg.equipmentInfo.properties\nconst event_channels = msg.equipmentInfo.categorizedChannels.event\n\nconst last_reading = payload[payload.length - 1]\n\nlet events = _event_init(payload[0]['reading'])\nlet forward_data = []\n\nif (payload.length === 1)\n{\n    return\n}\n\nfor (let i = 1; i < payload.length; ++i)\n{\n    let reading = payload[i]['reading']\n    let change = {\n        'at': _to_iso_string(payload[i]['at']),\n        'equipmentName': equipment_id,\n        'properties': properties,\n        'values': []\n    }\n    \n    for (let [channel, value] of Object.entries(reading))\n    {\n        if (event_channels.includes(channel))\n        {\n            if(events[channel] !== value)\n            {\n                change['values'].push(\n                    {\n                        'name': channel,\n                        'type': isNaN(value) ? 'str' : 'num',\n                        'value': value\n                    }\n                )\n                \n                events[channel] = value\n            }\n        }\n    }\n    \n    if (change.values.length !== 0)\n    {\n        forward_data.push(change)\n    }\n}\n\nmsg.forwardData = forward_data\nmsg.lastReading = last_reading\n\nreturn msg;\n\n\nfunction _event_init(reading)\n{\n    let events = {}\n    for (let [channel, value] of Object.entries(reading))\n    {\n        if (event_channels.includes(channel))\n        {\n            events[channel] = value\n        }\n    }\n    \n    return events\n}\n\n\nfunction _to_iso_string(from)\n{\n    const d = new Date(from)\n    return d.toISOString()\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 850,
        "y": 140,
        "wires": [
            []
        ]
    },
    {
        "id": "1ed08616.397a0a",
        "type": "http request",
        "z": "2d572c71.a8d6a4",
        "name": "",
        "method": "POST",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "x": 630,
        "y": 260,
        "wires": [
            []
        ]
    },
    {
        "id": "b663da5.efdd428",
        "type": "function",
        "z": "2d572c71.a8d6a4",
        "name": "build payload",
        "func": "const endpoint_url = msg.env.endpointUrl\nconst evnet_only = msg.env.eventOnly\nconst forward_data = msg.forwardData\n\ndelete msg.headers\nmsg.url = evnet_only ? endpoint_url + '/event' : endpoint_url + '/data'\nmsg.payload = forward_data\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 430,
        "y": 260,
        "wires": [
            [
                "1ed08616.397a0a"
            ]
        ]
    },
    {
        "id": "38cae85b.bfe778",
        "type": "subflow:2d572c71.a8d6a4",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 770,
        "y": 140,
        "wires": [
            [
                "935ce74a.d95ac8",
                "92518020.1cc2f"
            ]
        ]
    },
    {
        "id": "1572604e.a7e67",
        "type": "function",
        "z": "99679bb5.c9aa78",
        "name": "env",
        "func": "const EQUPMENT_ID = env.get('EQUPMENT_ID')\nconst READINGS_PER_UPDATE = env.get('READINGS_PER_UPDATE')\nconst ENDPOINT_URL = env.get('ENDPOINT_URL')\nconst EVENT_ONLY = env.get('EVENT_ONLY')\n\nmsg.env = {\n    'equipmentId': EQUPMENT_ID,\n    'readingsPerUpdate': READINGS_PER_UPDATE,\n    'endpointUrl': ENDPOINT_URL,\n    'eventOnly': EVENT_ONLY\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 370,
        "y": 260,
        "wires": [
            [
                "c738b47.0587048"
            ]
        ]
    },
    {
        "id": "2812940c.2c02ec",
        "type": "inject",
        "z": "99679bb5.c9aa78",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "${TRIGGER_PERIOD_SEC}",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{}",
        "payloadType": "json",
        "x": 210,
        "y": 260,
        "wires": [
            [
                "1572604e.a7e67"
            ]
        ]
    },
    {
        "id": "c7ff21f5.7796f",
        "type": "function",
        "z": "2d572c71.a8d6a4",
        "name": "validate input",
        "func": "if (!msg.hasOwnProperty('env') ||\n        !msg.hasOwnProperty('equipmentInfo') ||\n        !msg.hasOwnProperty('forwardData') ||\n        !msg.hasOwnProperty('lastReading'))\n{\n    node.error('input error')\n    return\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 230,
        "y": 260,
        "wires": [
            [
                "b663da5.efdd428"
            ]
        ]
    },
    {
        "id": "24fce996.fd5a66",
        "type": "function",
        "z": "9f9d1bbb.2fa088",
        "name": "validate input",
        "func": "if (!msg.hasOwnProperty('env') ||\n        !msg.hasOwnProperty('equipmentInfo') ||\n        !msg.hasOwnProperty('forwardData') ||\n        !msg.hasOwnProperty('lastReading') ||\n        !msg.hasOwnProperty('statusCode'))\n{\n    node.error('input error')\n    return\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 270,
        "y": 200,
        "wires": [
            [
                "a3277e80.a6675"
            ]
        ]
    },
    {
        "id": "a3277e80.a6675",
        "type": "function",
        "z": "9f9d1bbb.2fa088",
        "name": "build payload",
        "func": "const event_only = msg.env.eventOnly\nconst forward_data = msg.forwardData\nconst equipment_info = msg.equipmentInfo\nconst equipment_id = msg.env.equipmentId\nconst last_reading = msg.lastReading\nconst post_status_code = msg.statusCode\n\nlet code = 0\nlet message = `updated ${forward_data.length} readings`\n\nif (post_status_code !== 200)\n{\n    code = 1\n    message = `post failure, status code: ${post_status_code}`\n}\n\nmsg.config = {\n    'key': event_only ? `${equipment_id}.event` : `${equipment_id}.data`\n}\nmsg.payload = {\n    'code': code,\n    'message': message,\n    'equipmentInfo': equipment_info,\n    'postStatusCode': post_status_code,\n    'forwardData': forward_data,\n    'lastReading': last_reading\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 470,
        "y": 200,
        "wires": [
            [
                "d06e316.ad689d"
            ]
        ]
    },
    {
        "id": "d06e316.ad689d",
        "type": "safebox-out",
        "z": "9f9d1bbb.2fa088",
        "name": "",
        "key": "",
        "x": 690,
        "y": 200,
        "wires": [
            [
                "3b1de65c.bb017a"
            ]
        ]
    },
    {
        "id": "3b1de65c.bb017a",
        "type": "function",
        "z": "9f9d1bbb.2fa088",
        "name": "validate status code",
        "func": "const payload = msg.payload\n\nif (payload.code !== 0)\n{\n    node.error(`unexpected code: ${payload.code}, message: ${payload.message}`)\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 720,
        "y": 260,
        "wires": [
            []
        ]
    },
    {
        "id": "98a8f509.6fabc8",
        "type": "subflow:99679bb5.c9aa78",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [
            {
                "name": "TRIGGER_PERIOD_SEC",
                "value": "10",
                "type": "num"
            },
            {
                "name": "EQUPMENT_ID",
                "value": "HJ10PTHPNL005",
                "type": "str"
            },
            {
                "name": "READINGS_PER_UPDATE",
                "value": "200",
                "type": "num"
            }
        ],
        "x": 110,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "816dd246.2fb4",
        "type": "safebox-in",
        "z": "cbbfcffb.86f5",
        "name": "",
        "key": "",
        "x": 430,
        "y": 220,
        "wires": [
            [
                "1a9c626c.9f403e"
            ]
        ]
    },
    {
        "id": "716708d1.d2dfa8",
        "type": "function",
        "z": "cbbfcffb.86f5",
        "name": "validate input",
        "func": "if (!msg.hasOwnProperty('env') ||\n        !msg.hasOwnProperty('equipmentInfo'))\n{\n    node.error('input error')\n    return\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 210,
        "y": 180,
        "wires": [
            [
                "5e27935c.fc3c0c"
            ]
        ]
    },
    {
        "id": "5e27935c.fc3c0c",
        "type": "function",
        "z": "cbbfcffb.86f5",
        "name": "build key",
        "func": "const equipment_id = msg.env.equipmentId\nconst event_only = msg.env.eventOnly\n\nmsg.config = {\n    'key': event_only ? `${equipment_id}.event` : `${equipment_id}.data`\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 400,
        "y": 180,
        "wires": [
            [
                "816dd246.2fb4"
            ]
        ]
    },
    {
        "id": "1a9c626c.9f403e",
        "type": "function",
        "z": "cbbfcffb.86f5",
        "name": "extract",
        "func": "const payload = msg.payload\nlet next_query_since = 0\nlet output = [msg, null]\n\nif (typeof payload !== \"undefined\")\n{\n    if (payload.postStatusCode !== 200)\n    {\n        msg.forwardData = payload.forwardData\n        msg.lastReading = payload.lastReading\n        output = [null, msg]\n    }\n    else\n    {\n        next_query_since = payload.lastReading.at\n    }\n}\n\nmsg.nextQuerySince = next_query_since\n\n\nreturn output;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 610,
        "y": 220,
        "wires": [
            [],
            []
        ]
    },
    {
        "id": "81931b8a.cffea8",
        "type": "function",
        "z": "e30aea47.352308",
        "name": "validate input",
        "func": "if (!msg.hasOwnProperty('env'))\n{\n    node.error('input error')\n    return\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 230,
        "y": 100,
        "wires": [
            [
                "7b0ac41c.49a9bc"
            ]
        ]
    },
    {
        "id": "99be2005.c86a6",
        "type": "subflow:cbbfcffb.86f5",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 520,
        "y": 120,
        "wires": [
            [
                "d3b7dfb0.17682"
            ],
            [
                "38cae85b.bfe778"
            ]
        ]
    },
    {
        "id": "6da100eb.aacda",
        "type": "function",
        "z": "1524802c.2eebb",
        "name": "switch",
        "func": "const payload = msg.payload\nconst event_only = msg.env.eventOnly\nlet output = [null, msg]\n\nif (payload.length === 0)\n{\n    return\n}\n\nif (event_only)\n{\n    output = [msg, null]\n}\n\nreturn output",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 670,
        "y": 180,
        "wires": [
            [
                "c7cb76fc.98cdb8"
            ],
            [
                "5bcba760.4e2f98"
            ]
        ]
    },
    {
        "id": "5bcba760.4e2f98",
        "type": "function",
        "z": "1524802c.2eebb",
        "name": "data",
        "func": "const payload = msg.payload\nconst equipment_id = msg.env.equipmentId\n// const equipment_name = msg.equipmentInfo.equipmentName\nconst properties = msg.equipmentInfo.properties\nconst data_channels = msg.equipmentInfo.categorizedChannels.data\n\nlet forward_data = []\n\nfor (let i = 0; i < payload.length; ++i)\n{\n    let reading = payload[i]['reading']\n    \n    let data = {\n        'at': _to_iso_string(payload[i]['at']),\n        'equipmentName': equipment_id,\n        'properties': properties,\n        'values': []\n    }\n    \n    for (let [channel, value] of Object.entries(reading))\n    {\n        if (data_channels.includes(channel))\n        {\n            \n            data['values'].push(\n                {\n                    'name': channel,\n                    'type': isNaN(value) ? 'str' : 'num',\n                    'value': value\n                }\n            )\n        }\n    }\n    \n    forward_data.push(data)\n}\n\nif (forward_data.length === 0)\n{\n    return\n}\n\nmsg.forwardData = forward_data\nmsg.lastReading = payload[payload.length - 1]\n\nreturn msg;\n\n\nfunction _to_iso_string(from)\n{\n    const d = new Date(from)\n    return d.toISOString()\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 850,
        "y": 220,
        "wires": [
            []
        ]
    },
    {
        "id": "935ce74a.d95ac8",
        "type": "subflow:9f9d1bbb.2fa088",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 1020,
        "y": 140,
        "wires": []
    },
    {
        "id": "c738b47.0587048",
        "type": "function",
        "z": "99679bb5.c9aa78",
        "name": "validate",
        "func": "const readings_per_update = msg.env.readingsPerUpdate\n\nif (readings_per_update < 2)\n{\n    node.error('readingsPerUpdate must > 2')\n    return\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 560,
        "y": 260,
        "wires": [
            []
        ]
    },
    {
        "id": "e04853f1.b29df",
        "type": "subflow:e30aea47.352308",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [
            {
                "name": "EQUIPMENT_ID",
                "value": "step7",
                "type": "str"
            }
        ],
        "x": 300,
        "y": 218,
        "wires": [
            [
                "f619fa73.b14188"
            ]
        ]
    },
    {
        "id": "8cef4a93.4d63a8",
        "type": "subflow:1524802c.2eebb",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 760,
        "y": 178,
        "wires": [
            [
                "1d7e18e4.94f1c7"
            ]
        ]
    },
    {
        "id": "1d7e18e4.94f1c7",
        "type": "subflow:2d572c71.a8d6a4",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 770,
        "y": 238,
        "wires": [
            [
                "e227478d.32e6d8",
                "c506778.040fd88"
            ]
        ]
    },
    {
        "id": "d2b42886.77b048",
        "type": "subflow:99679bb5.c9aa78",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [
            {
                "name": "TRIGGER_PERIOD_SEC",
                "value": "10",
                "type": "num"
            },
            {
                "name": "EQUPMENT_ID",
                "value": "HJ10PTHPNL005",
                "type": "str"
            },
            {
                "name": "READINGS_PER_UPDATE",
                "value": "200",
                "type": "num"
            },
            {
                "name": "EVENT_ONLY",
                "value": "true",
                "type": "bool"
            }
        ],
        "x": 110,
        "y": 218,
        "wires": [
            []
        ]
    },
    {
        "id": "f619fa73.b14188",
        "type": "subflow:cbbfcffb.86f5",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 520,
        "y": 218,
        "wires": [
            [
                "8cef4a93.4d63a8"
            ],
            [
                "1d7e18e4.94f1c7"
            ]
        ]
    },
    {
        "id": "e227478d.32e6d8",
        "type": "subflow:9f9d1bbb.2fa088",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 1020,
        "y": 238,
        "wires": []
    },
    {
        "id": "c67103a4.d8f7f",
        "type": "comment",
        "z": "cbf34f11.3db4",
        "name": "10PTHPNL005(VCP#3(1F)) data",
        "info": "",
        "x": 190,
        "y": 80,
        "wires": []
    },
    {
        "id": "2ab81177.7467ae",
        "type": "comment",
        "z": "cbf34f11.3db4",
        "name": "10PTHPNL005(VCP#3(1F)) event",
        "info": "",
        "x": 200,
        "y": 179,
        "wires": []
    },
    {
        "id": "5bebdf6b.2a94",
        "type": "mssql",
        "z": "5606eb09.0cf1a4",
        "name": "",
        "server": "10.13.69.49",
        "port": "1433",
        "connectionTimeout": "60000",
        "requestTimeout": "60000",
        "connectionPoolSize": "1",
        "username": "Datamation",
        "password": "P@ssw0rd",
        "database": "Datamation_PCB",
        "query": "",
        "x": 770,
        "y": 320,
        "wires": [
            [
                "c5a7aa0c.5de6a8"
            ]
        ]
    },
    {
        "id": "c77ec55f.8bc378",
        "type": "mssql",
        "z": "5606eb09.0cf1a4",
        "name": "",
        "server": "10.13.69.49",
        "port": "1433",
        "connectionTimeout": "60000",
        "requestTimeout": "60000",
        "connectionPoolSize": "1",
        "username": "Datamation",
        "password": "P@ssw0rd",
        "database": "Datamation_PCB",
        "query": "",
        "x": 770,
        "y": 380,
        "wires": [
            [
                "c5a7aa0c.5de6a8"
            ]
        ]
    },
    {
        "id": "fe3b9614.f510b8",
        "type": "mssql",
        "z": "5606eb09.0cf1a4",
        "name": "",
        "server": "10.13.69.49",
        "port": "1433",
        "connectionTimeout": "60000",
        "requestTimeout": "60000",
        "connectionPoolSize": "1",
        "username": "Datamation",
        "password": "P@ssw0rd",
        "database": "Datamation_PCB",
        "query": "",
        "x": 770,
        "y": 200,
        "wires": [
            [
                "c5a7aa0c.5de6a8"
            ]
        ]
    },
    {
        "id": "b3d0c889.00c5b8",
        "type": "function",
        "z": "46c3b751.13e688",
        "name": "retry",
        "func": "const payload = msg.payload\nconst retry = context.get('RETRY')\nlet output = [msg, null]\n\nif (payload.code !== 0)\n{\n    output = [null, msg]\n\n    if (retry === undefined)\n    {\n        context.set(\n            'RETRY',\n            1\n        )\n    }\n    else if(retry < 3)\n    {\n        context.set(\n            'RETRY',\n            retry + 1\n        )    \n    }\n    else\n    {\n        output = [msg, null]\n    }\n}\nelse\n{\n    context.set(\n        'RETRY',\n        0\n    )\n}\n\nreturn output;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 510,
        "y": 220,
        "wires": [
            [
                "e1ec369e.e4af28"
            ],
            [
                "1cc47f3a.6e3e41"
            ]
        ]
    },
    {
        "id": "d21d1739.1ed138",
        "type": "function",
        "z": "9c352516.1ade28",
        "name": "build email message",
        "func": "const alarms = msg.alarms\nconst channel_names = msg.channelNames\nconst equipment_info = msg.equipmentInfo\nconst query_result = msg.queryResult\nconst reading_in = msg.readingIn\n\nlet machine_no = equipment_info.machineNo\nlet eq_name = equipment_info.equipmentName\nlet insert_time = _to_ms_sql_datetime(reading_in.at)\nlet log_time = insert_time\n\nlet html = `\nmachineNo: ${machine_no}, ${query_result.message}\n\n<body>\n\n<table  style=\"border:0px #000000 solid;padding:5px;\" rules=\"all\" cellpadding='5';border='1'>\n  <tr>\n    <th>MachineNo</th>\n    <th>EQName</th> \n    <th>EventCode</th>\n    <th>EventMessage</th>\n    <th>InsertTime</th>\n    <th>LogTime</th>\n  </tr>\n`\n\nfor (let channel in alarms)\n{\n    let event_code = channel\n    let event_message = channel_names[channel]\n    \n    html += `\n  <tr>\n    <td>${machine_no}</td>\n    <td>${eq_name}</td>\n    <td>${event_code}</td>\n    <td>${event_message}</td>\n    <td>${insert_time}</td>\n    <td>${log_time}</td>\n  </tr>\n`\n}\n\nhtml += `\n</table>\n\n</body>\n\n此為系統自動發送, 請勿回覆\n`\n\nmsg.topic = `設備 ${machine_no} query MS-SQL failure`\nmsg.payload = html\n\nreturn msg;\n\n// internal function\nfunction _to_ms_sql_datetime(from)\n{\n    const d = new Date(from)\n    \n    let date = (\"0\" + d.getDate()).slice(-2)\n    let month = (\"0\" + (d.getMonth() + 1)).slice(-2)\n    let year = d.getFullYear()\n    let hours = d.getHours()\n    let minutes = d.getMinutes()\n    let seconds = d.getSeconds()\n    \n    return year + \"-\" + month + \"-\" + date + \" \" + hours + \":\" + minutes + \":\" + seconds\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 560,
        "y": 220,
        "wires": [
            [
                "30e7701f.231db",
                "f8a0ef48.c30e3"
            ]
        ]
    },
    {
        "id": "cb977225.ac2f2",
        "type": "function",
        "z": "3441a2ec.833a6e",
        "name": "build email message",
        "func": "const alarms = msg.alarms\nconst channel_names = msg.channelNames\nconst equipment_info = msg.equipmentInfo\nconst query_result = msg.queryResult\nconst reading_in = msg.readingIn\n\nlet machine_no = equipment_info.machineNo\nlet eq_name = equipment_info.equipmentName\nlet insert_time = _to_ms_sql_datetime(reading_in.at)\nlet log_time = insert_time\n\nlet html = `\nmachineNo: ${machine_no}, ${query_result.message}\n\n<body>\n\n<table  style=\"border:0px #000000 solid;padding:5px;\" rules=\"all\" cellpadding='5';border='1'>\n  <tr>\n    <th>MachineNo</th>\n    <th>EQName</th> \n    <th>EventCode</th>\n    <th>EventMessage</th>\n    <th>InsertTime</th>\n    <th>LogTime</th>\n  </tr>\n`\n\nfor (let channel in alarms)\n{\n    let event_code = channel\n    let event_message = channel_names[channel]\n    \n    html += `\n  <tr>\n    <td>${machine_no}</td>\n    <td>${eq_name}</td>\n    <td>${event_code}</td>\n    <td>${event_message}</td>\n    <td>${insert_time}</td>\n    <td>${log_time}</td>\n  </tr>\n`\n}\n\nhtml += `\n</table>\n\n</body>\n\n此為系統自動發送, 請勿回覆\n`\n\nmsg.topic = `設備 ${machine_no} query MS-SQL failure`\nmsg.payload = html\n\nreturn msg;\n\n// internal function\nfunction _to_ms_sql_datetime(from)\n{\n    const d = new Date(from)\n    \n    let date = (\"0\" + d.getDate()).slice(-2)\n    let month = (\"0\" + (d.getMonth() + 1)).slice(-2)\n    let year = d.getFullYear()\n    let hours = d.getHours()\n    let minutes = d.getMinutes()\n    let seconds = d.getSeconds()\n    \n    return year + \"-\" + month + \"-\" + date + \" \" + hours + \":\" + minutes + \":\" + seconds\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 640,
        "y": 180,
        "wires": [
            [
                "6192af09.fd7f3"
            ]
        ]
    },
    {
        "id": "92518020.1cc2f",
        "type": "debug",
        "z": "cbf34f11.3db4",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1010,
        "y": 80,
        "wires": []
    },
    {
        "id": "c506778.040fd88",
        "type": "debug",
        "z": "cbf34f11.3db4",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1010,
        "y": 178,
        "wires": []
    },
    {
        "id": "86538944.c033c8",
        "type": "comment",
        "z": "e4beaa17.839f48",
        "name": "HJ10DFPPRE002 化學前處理",
        "info": "",
        "x": 160,
        "y": 540,
        "wires": []
    },
    {
        "id": "a59fdcca.4b853",
        "type": "subflow:3b73a09.e77af6",
        "z": "e4beaa17.839f48",
        "name": "",
        "env": [],
        "x": 290,
        "y": 600,
        "wires": [
            [
                "29d3e43.a056c1c"
            ]
        ]
    },
    {
        "id": "29d3e43.a056c1c",
        "type": "subflow:46c3b751.13e688",
        "z": "e4beaa17.839f48",
        "name": "",
        "env": [
            {
                "name": "MONITOR_LIST",
                "value": "[\"AVAIL\"]",
                "type": "json"
            },
            {
                "name": "WSDL_URL",
                "value": "https://www.crcind.com/csp/samples/SOAP.Demo.CLS?WSDL=1",
                "type": "str"
            }
        ],
        "x": 490,
        "y": 600,
        "wires": [
            [
                "82419f6d.e4cb1"
            ],
            [
                "d5c8bce5.be531"
            ]
        ]
    },
    {
        "id": "d5c8bce5.be531",
        "type": "subflow:9c352516.1ade28",
        "z": "e4beaa17.839f48",
        "name": "",
        "env": [
            {
                "name": "TOPIC",
                "value": "Query MS-SQL failure",
                "type": "str"
            }
        ],
        "x": 740,
        "y": 620,
        "wires": [
            [
                "64eb4768.187168"
            ]
        ]
    },
    {
        "id": "64eb4768.187168",
        "type": "reading-out",
        "z": "e4beaa17.839f48",
        "name": "",
        "equipmentId": "logger",
        "x": 1120,
        "y": 620,
        "wires": []
    },
    {
        "id": "da6daad6.c1a608",
        "type": "subflow:8ea31ce9.488ad",
        "z": "e4beaa17.839f48",
        "name": "",
        "env": [],
        "x": 930,
        "y": 580,
        "wires": [
            [
                "64eb4768.187168"
            ]
        ]
    },
    {
        "id": "343f9116.3e080e",
        "type": "subflow:7a61fc3d.3aa584",
        "z": "e4beaa17.839f48",
        "name": "",
        "env": [
            {
                "name": "EQUIPMENT_ID",
                "value": "HJ10DFPPRE002",
                "type": "str"
            },
            {
                "name": "DEVICE_ID",
                "value": "virtual",
                "type": "str"
            }
        ],
        "x": 101,
        "y": 600,
        "wires": [
            [
                "a59fdcca.4b853"
            ]
        ]
    },
    {
        "id": "72f96d39.e34a44",
        "type": "subflow:89fdc1f9.a927a",
        "z": "e4beaa17.839f48",
        "name": "",
        "x": 730,
        "y": 580,
        "wires": [
            []
        ]
    },
    {
        "id": "b5c13a9d.2df418",
        "type": "comment",
        "z": "91ec86b9.d49fe8",
        "name": "HJ10PTHDES001 減銅線#1(2F)",
        "info": "",
        "x": 170,
        "y": 1040,
        "wires": []
    },
    {
        "id": "5cb2e03.9ff522",
        "type": "subflow:3b73a09.e77af6",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "env": [],
        "x": 262,
        "y": 1100,
        "wires": [
            [
                "1d12b55b.14e0cb"
            ]
        ]
    },
    {
        "id": "1d12b55b.14e0cb",
        "type": "subflow:46c3b751.13e688",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "env": [
            {
                "name": "MONITOR_LIST",
                "value": "[\"AVAIL\"]",
                "type": "json"
            },
            {
                "name": "WSDL_URL",
                "value": "https://www.crcind.com/csp/samples/SOAP.Demo.CLS?WSDL=1",
                "type": "str"
            }
        ],
        "x": 430,
        "y": 1100,
        "wires": [
            [
                "667474fb.a95e8c"
            ],
            [
                "4144d4b3.f9422c"
            ]
        ]
    },
    {
        "id": "4144d4b3.f9422c",
        "type": "subflow:9c352516.1ade28",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "env": [
            {
                "name": "TOPIC",
                "value": "Query MS-SQL failure",
                "type": "str"
            }
        ],
        "x": 680,
        "y": 1124,
        "wires": [
            [
                "91ef5b9b.e03938"
            ]
        ]
    },
    {
        "id": "91ef5b9b.e03938",
        "type": "reading-out",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "equipmentId": "logger",
        "x": 1080,
        "y": 1124,
        "wires": []
    },
    {
        "id": "19710d94.9c6482",
        "type": "subflow:8ea31ce9.488ad",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "env": [],
        "x": 870,
        "y": 1084,
        "wires": [
            [
                "91ef5b9b.e03938"
            ]
        ]
    },
    {
        "id": "2829d15.369c02e",
        "type": "subflow:7a61fc3d.3aa584",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "env": [
            {
                "name": "EQUIPMENT_ID",
                "value": "HJ10PTHDES001",
                "type": "str"
            },
            {
                "name": "DEVICE_ID",
                "value": "virtual",
                "type": "str"
            }
        ],
        "x": 101,
        "y": 1100,
        "wires": [
            [
                "5cb2e03.9ff522"
            ]
        ]
    },
    {
        "id": "667474fb.a95e8c",
        "type": "subflow:b083bb95.861038",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "x": 670,
        "y": 1084,
        "wires": [
            [
                "19710d94.9c6482"
            ]
        ]
    },
    {
        "id": "1e96c5e5.a5034a",
        "type": "comment",
        "z": "91ec86b9.d49fe8",
        "name": "10XCUXCU002 減銅線#2(2F)",
        "info": "",
        "x": 160,
        "y": 1180,
        "wires": []
    },
    {
        "id": "c2706977.3389b8",
        "type": "subflow:3b73a09.e77af6",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "env": [],
        "x": 262,
        "y": 1240,
        "wires": [
            [
                "16eb8b95.03a6f4"
            ]
        ]
    },
    {
        "id": "16eb8b95.03a6f4",
        "type": "subflow:46c3b751.13e688",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "env": [
            {
                "name": "MONITOR_LIST",
                "value": "[\"AVAIL\"]",
                "type": "json"
            },
            {
                "name": "WSDL_URL",
                "value": "https://www.crcind.com/csp/samples/SOAP.Demo.CLS?WSDL=1",
                "type": "str"
            }
        ],
        "x": 430,
        "y": 1240,
        "wires": [
            [
                "9cc51cc2.45737"
            ],
            [
                "4106a72b.f95858"
            ]
        ]
    },
    {
        "id": "4106a72b.f95858",
        "type": "subflow:9c352516.1ade28",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "env": [
            {
                "name": "TOPIC",
                "value": "Query MS-SQL failure",
                "type": "str"
            }
        ],
        "x": 680,
        "y": 1264,
        "wires": [
            [
                "d7cbe300.75fcd"
            ]
        ]
    },
    {
        "id": "d7cbe300.75fcd",
        "type": "reading-out",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "equipmentId": "logger",
        "x": 1080,
        "y": 1264,
        "wires": []
    },
    {
        "id": "f690a6c0.c4c2c8",
        "type": "subflow:8ea31ce9.488ad",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "env": [],
        "x": 870,
        "y": 1224,
        "wires": [
            [
                "d7cbe300.75fcd"
            ]
        ]
    },
    {
        "id": "aa4d858.f475278",
        "type": "subflow:7a61fc3d.3aa584",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "env": [
            {
                "name": "EQUIPMENT_ID",
                "value": "HJ10XCUXCU002",
                "type": "str"
            },
            {
                "name": "DEVICE_ID",
                "value": "virtual",
                "type": "str"
            }
        ],
        "x": 101,
        "y": 1240,
        "wires": [
            [
                "c2706977.3389b8"
            ]
        ]
    },
    {
        "id": "9cc51cc2.45737",
        "type": "subflow:b083bb95.861038",
        "z": "91ec86b9.d49fe8",
        "name": "",
        "x": 670,
        "y": 1224,
        "wires": [
            [
                "f690a6c0.c4c2c8"
            ]
        ]
    },
    {
        "id": "4166e8b0.cd3fd8",
        "type": "subflow:e30aea47.352308",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [
            {
                "name": "EQUIPMENT_ID",
                "value": "step7",
                "type": "str"
            }
        ],
        "x": 300,
        "y": 1380,
        "wires": [
            [
                "e834980e.d33d78"
            ]
        ]
    },
    {
        "id": "c43ce21c.b9bae",
        "type": "subflow:1524802c.2eebb",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 760,
        "y": 1340,
        "wires": [
            [
                "f4f630e3.63fb7"
            ]
        ]
    },
    {
        "id": "f4f630e3.63fb7",
        "type": "subflow:2d572c71.a8d6a4",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 770,
        "y": 1400,
        "wires": [
            [
                "af012cb9.a654e",
                "c6cec573.2e1f48"
            ]
        ]
    },
    {
        "id": "1b9f6657.8fba7a",
        "type": "subflow:99679bb5.c9aa78",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [
            {
                "name": "TRIGGER_PERIOD_SEC",
                "value": "60",
                "type": "num"
            },
            {
                "name": "EQUPMENT_ID",
                "value": "P10SMKDEV004",
                "type": "str"
            },
            {
                "name": "READINGS_PER_UPDATE",
                "value": "100",
                "type": "num"
            }
        ],
        "x": 110,
        "y": 1380,
        "wires": [
            []
        ]
    },
    {
        "id": "e834980e.d33d78",
        "type": "subflow:cbbfcffb.86f5",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 520,
        "y": 1380,
        "wires": [
            [
                "c43ce21c.b9bae"
            ],
            [
                "f4f630e3.63fb7"
            ]
        ]
    },
    {
        "id": "af012cb9.a654e",
        "type": "subflow:9f9d1bbb.2fa088",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 1020,
        "y": 1400,
        "wires": []
    },
    {
        "id": "d0b5a12f.2fb6b",
        "type": "comment",
        "z": "cbf34f11.3db4",
        "name": "10SMKDEV004(印刷顯影線#1(厚板)) data",
        "info": "",
        "x": 220,
        "y": 1320,
        "wires": []
    },
    {
        "id": "c6cec573.2e1f48",
        "type": "debug",
        "z": "cbf34f11.3db4",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1010,
        "y": 1340,
        "wires": []
    },
    {
        "id": "81499fb.a5b246",
        "type": "subflow:e30aea47.352308",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [
            {
                "name": "EQUIPMENT_ID",
                "value": "step7",
                "type": "str"
            }
        ],
        "x": 300,
        "y": 1500,
        "wires": [
            [
                "487f5bf6.a3b7a4"
            ]
        ]
    },
    {
        "id": "42507dee.d4d494",
        "type": "subflow:1524802c.2eebb",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 760,
        "y": 1460,
        "wires": [
            [
                "33ce76f3.e1a12a"
            ]
        ]
    },
    {
        "id": "33ce76f3.e1a12a",
        "type": "subflow:2d572c71.a8d6a4",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 770,
        "y": 1520,
        "wires": [
            [
                "a800dac2.c913d8",
                "3593c5c3.fbf87a"
            ]
        ]
    },
    {
        "id": "81476fe2.3171",
        "type": "subflow:99679bb5.c9aa78",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [
            {
                "name": "TRIGGER_PERIOD_SEC",
                "value": "60",
                "type": "num"
            },
            {
                "name": "EQUPMENT_ID",
                "value": "P10SMKDEV003",
                "type": "str"
            },
            {
                "name": "READINGS_PER_UPDATE",
                "value": "100",
                "type": "num"
            },
            {
                "name": "EVENT_ONLY",
                "value": "true",
                "type": "bool"
            }
        ],
        "x": 110,
        "y": 1500,
        "wires": [
            []
        ]
    },
    {
        "id": "487f5bf6.a3b7a4",
        "type": "subflow:cbbfcffb.86f5",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 520,
        "y": 1500,
        "wires": [
            [
                "42507dee.d4d494"
            ],
            [
                "33ce76f3.e1a12a"
            ]
        ]
    },
    {
        "id": "a800dac2.c913d8",
        "type": "subflow:9f9d1bbb.2fa088",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 1020,
        "y": 1520,
        "wires": []
    },
    {
        "id": "7c0bb339.6c787c",
        "type": "comment",
        "z": "cbf34f11.3db4",
        "name": "10SMKDEV003(印刷顯影線#1(厚板)) event",
        "info": "",
        "x": 220,
        "y": 1440,
        "wires": []
    },
    {
        "id": "3593c5c3.fbf87a",
        "type": "debug",
        "z": "cbf34f11.3db4",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1010,
        "y": 1460,
        "wires": []
    },
    {
        "id": "b2535d7b.b30ab",
        "type": "subflow:e30aea47.352308",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [
            {
                "name": "EQUIPMENT_ID",
                "value": "step7",
                "type": "str"
            }
        ],
        "x": 300,
        "y": 1620,
        "wires": [
            [
                "8cb8824d.97dd3"
            ]
        ]
    },
    {
        "id": "33f146bc.5b2cfa",
        "type": "subflow:1524802c.2eebb",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 760,
        "y": 1580,
        "wires": [
            [
                "d62cd4af.46f288"
            ]
        ]
    },
    {
        "id": "d62cd4af.46f288",
        "type": "subflow:2d572c71.a8d6a4",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 770,
        "y": 1640,
        "wires": [
            [
                "9a4880d6.521f2",
                "9984276e.5c3ea8"
            ]
        ]
    },
    {
        "id": "7c064934.3b4da8",
        "type": "subflow:99679bb5.c9aa78",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [
            {
                "name": "TRIGGER_PERIOD_SEC",
                "value": "60",
                "type": "num"
            },
            {
                "name": "EQUPMENT_ID",
                "value": "HJ10PTHDES002",
                "type": "str"
            },
            {
                "name": "READINGS_PER_UPDATE",
                "value": "100",
                "type": "num"
            }
        ],
        "x": 110,
        "y": 1620,
        "wires": [
            []
        ]
    },
    {
        "id": "8cb8824d.97dd3",
        "type": "subflow:cbbfcffb.86f5",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 520,
        "y": 1620,
        "wires": [
            [
                "33f146bc.5b2cfa"
            ],
            [
                "d62cd4af.46f288"
            ]
        ]
    },
    {
        "id": "9a4880d6.521f2",
        "type": "subflow:9f9d1bbb.2fa088",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 1020,
        "y": 1640,
        "wires": []
    },
    {
        "id": "b5365147.d77ab",
        "type": "comment",
        "z": "cbf34f11.3db4",
        "name": "10PTHDES002(DESMEAR#2) data",
        "info": "",
        "x": 200,
        "y": 1560,
        "wires": []
    },
    {
        "id": "9984276e.5c3ea8",
        "type": "debug",
        "z": "cbf34f11.3db4",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1010,
        "y": 1580,
        "wires": []
    },
    {
        "id": "ef92ed31.b2df6",
        "type": "debug",
        "z": "cbf34f11.3db4",
        "name": "TEST",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 70,
        "y": 1260,
        "wires": []
    },
    {
        "id": "98196d28.aaa9a",
        "type": "subflow:e30aea47.352308",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [
            {
                "name": "EQUIPMENT_ID",
                "value": "step7",
                "type": "str"
            }
        ],
        "x": 300,
        "y": 1740,
        "wires": [
            [
                "dd0eda4a.cf0ef8"
            ]
        ]
    },
    {
        "id": "6f69169d.759ce8",
        "type": "subflow:1524802c.2eebb",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 760,
        "y": 1700,
        "wires": [
            [
                "3eef0593.ff1bfa"
            ]
        ]
    },
    {
        "id": "3eef0593.ff1bfa",
        "type": "subflow:2d572c71.a8d6a4",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 770,
        "y": 1760,
        "wires": [
            [
                "1d271a0e.1f99e6",
                "284bc396.2ad58c"
            ]
        ]
    },
    {
        "id": "c6b7ad2e.9c762",
        "type": "subflow:99679bb5.c9aa78",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [
            {
                "name": "TRIGGER_PERIOD_SEC",
                "value": "60",
                "type": "num"
            },
            {
                "name": "EQUPMENT_ID",
                "value": "HJ10PTHDES002",
                "type": "str"
            },
            {
                "name": "READINGS_PER_UPDATE",
                "value": "100",
                "type": "num"
            },
            {
                "name": "EVENT_ONLY",
                "value": "true",
                "type": "bool"
            }
        ],
        "x": 110,
        "y": 1740,
        "wires": [
            []
        ]
    },
    {
        "id": "dd0eda4a.cf0ef8",
        "type": "subflow:cbbfcffb.86f5",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 520,
        "y": 1740,
        "wires": [
            [
                "6f69169d.759ce8"
            ],
            [
                "3eef0593.ff1bfa"
            ]
        ]
    },
    {
        "id": "1d271a0e.1f99e6",
        "type": "subflow:9f9d1bbb.2fa088",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 1020,
        "y": 1760,
        "wires": []
    },
    {
        "id": "ffc5387f.d96b18",
        "type": "comment",
        "z": "cbf34f11.3db4",
        "name": "10PTHDES002(DESMEAR#2) event",
        "info": "",
        "x": 200,
        "y": 1680,
        "wires": []
    },
    {
        "id": "284bc396.2ad58c",
        "type": "debug",
        "z": "cbf34f11.3db4",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1010,
        "y": 1700,
        "wires": []
    },
    {
        "id": "9d384e33.1a32f",
        "type": "subflow:e30aea47.352308",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [
            {
                "name": "EQUIPMENT_ID",
                "value": "step7",
                "type": "str"
            }
        ],
        "x": 300,
        "y": 1860,
        "wires": [
            [
                "30b9b7dc.59d968"
            ]
        ]
    },
    {
        "id": "72d3447c.5e42bc",
        "type": "subflow:1524802c.2eebb",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 760,
        "y": 1820,
        "wires": [
            [
                "270c4392.a7701c"
            ]
        ]
    },
    {
        "id": "270c4392.a7701c",
        "type": "subflow:2d572c71.a8d6a4",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 770,
        "y": 1880,
        "wires": [
            [
                "2d447bcf.edafc4",
                "6ffe00b.cdb8e"
            ]
        ]
    },
    {
        "id": "fa70d35f.658bd",
        "type": "subflow:99679bb5.c9aa78",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [
            {
                "name": "TRIGGER_PERIOD_SEC",
                "value": "60",
                "type": "num"
            },
            {
                "name": "EQUPMENT_ID",
                "value": "HJ10XCUXCU002",
                "type": "str"
            },
            {
                "name": "READINGS_PER_UPDATE",
                "value": "100",
                "type": "num"
            }
        ],
        "x": 110,
        "y": 1860,
        "wires": [
            []
        ]
    },
    {
        "id": "30b9b7dc.59d968",
        "type": "subflow:cbbfcffb.86f5",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 520,
        "y": 1860,
        "wires": [
            [
                "72d3447c.5e42bc"
            ],
            [
                "270c4392.a7701c"
            ]
        ]
    },
    {
        "id": "2d447bcf.edafc4",
        "type": "subflow:9f9d1bbb.2fa088",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 1020,
        "y": 1880,
        "wires": []
    },
    {
        "id": "2ed1c667.29373a",
        "type": "comment",
        "z": "cbf34f11.3db4",
        "name": "10XCUXCU002(減銅線#2(2F)) data",
        "info": "",
        "x": 200,
        "y": 1800,
        "wires": []
    },
    {
        "id": "6ffe00b.cdb8e",
        "type": "debug",
        "z": "cbf34f11.3db4",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1010,
        "y": 1820,
        "wires": []
    },
    {
        "id": "c6c837a.eae0ac8",
        "type": "subflow:e30aea47.352308",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [
            {
                "name": "EQUIPMENT_ID",
                "value": "step7",
                "type": "str"
            }
        ],
        "x": 300,
        "y": 1980,
        "wires": [
            [
                "cbd51b7a.26fdb8"
            ]
        ]
    },
    {
        "id": "941a31b7.ccf23",
        "type": "subflow:1524802c.2eebb",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 760,
        "y": 1940,
        "wires": [
            [
                "a0dcac71.b3c89"
            ]
        ]
    },
    {
        "id": "a0dcac71.b3c89",
        "type": "subflow:2d572c71.a8d6a4",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 770,
        "y": 2000,
        "wires": [
            [
                "8501bf32.c39d9",
                "e48a1a56.8c1728"
            ]
        ]
    },
    {
        "id": "d7f0e5c6.94d3a8",
        "type": "subflow:99679bb5.c9aa78",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [
            {
                "name": "TRIGGER_PERIOD_SEC",
                "value": "60",
                "type": "num"
            },
            {
                "name": "EQUPMENT_ID",
                "value": "HJ10XCUXCU002",
                "type": "str"
            },
            {
                "name": "READINGS_PER_UPDATE",
                "value": "100",
                "type": "num"
            },
            {
                "name": "EVENT_ONLY",
                "value": "true",
                "type": "bool"
            }
        ],
        "x": 110,
        "y": 1980,
        "wires": [
            []
        ]
    },
    {
        "id": "cbd51b7a.26fdb8",
        "type": "subflow:cbbfcffb.86f5",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 520,
        "y": 1980,
        "wires": [
            [
                "941a31b7.ccf23"
            ],
            [
                "a0dcac71.b3c89"
            ]
        ]
    },
    {
        "id": "8501bf32.c39d9",
        "type": "subflow:9f9d1bbb.2fa088",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 1020,
        "y": 2000,
        "wires": []
    },
    {
        "id": "4ab39209.836e7c",
        "type": "comment",
        "z": "cbf34f11.3db4",
        "name": "10XCUXCU002(減銅線#2(2F)) event",
        "info": "",
        "x": 200,
        "y": 1920,
        "wires": []
    },
    {
        "id": "e48a1a56.8c1728",
        "type": "debug",
        "z": "cbf34f11.3db4",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1010,
        "y": 1940,
        "wires": []
    },
    {
        "id": "5e63f52a.225e1c",
        "type": "subflow:3b73a09.e77af6",
        "z": "832ec745.2f9928",
        "name": "",
        "env": [],
        "x": 270,
        "y": 280,
        "wires": [
            [
                "8ce9e2e1.3b3ef"
            ]
        ]
    },
    {
        "id": "8ce9e2e1.3b3ef",
        "type": "subflow:46c3b751.13e688",
        "z": "832ec745.2f9928",
        "name": "",
        "env": [
            {
                "name": "MONITOR_LIST",
                "value": "[\"AVAIL\"]",
                "type": "json"
            },
            {
                "name": "WSDL_URL",
                "value": "https://www.crcind.com/csp/samples/SOAP.Demo.CLS?WSDL=1",
                "type": "str"
            }
        ],
        "x": 435,
        "y": 280,
        "wires": [
            [
                "d254ea63.1acce8"
            ],
            [
                "f1459c47.ae803"
            ]
        ]
    },
    {
        "id": "f1459c47.ae803",
        "type": "subflow:9c352516.1ade28",
        "z": "832ec745.2f9928",
        "name": "",
        "env": [
            {
                "name": "TOPIC",
                "value": "Query MS-SQL failure",
                "type": "str"
            }
        ],
        "x": 685,
        "y": 303,
        "wires": [
            [
                "79e91609.10c368"
            ]
        ]
    },
    {
        "id": "79e91609.10c368",
        "type": "reading-out",
        "z": "832ec745.2f9928",
        "name": "",
        "equipmentId": "logger",
        "x": 1086,
        "y": 303,
        "wires": []
    },
    {
        "id": "5c1a99aa.1094b8",
        "type": "subflow:8ea31ce9.488ad",
        "z": "832ec745.2f9928",
        "name": "",
        "env": [],
        "x": 876,
        "y": 263,
        "wires": [
            [
                "79e91609.10c368"
            ]
        ]
    },
    {
        "id": "8d65c5b.42abc38",
        "type": "subflow:7a61fc3d.3aa584",
        "z": "832ec745.2f9928",
        "name": "",
        "env": [
            {
                "name": "EQUIPMENT_ID",
                "value": "HJ10SMKDEV003",
                "type": "str"
            },
            {
                "name": "DEVICE_ID",
                "value": "virtual",
                "type": "str"
            }
        ],
        "x": 107,
        "y": 280,
        "wires": [
            [
                "5e63f52a.225e1c"
            ]
        ]
    },
    {
        "id": "ebf4577e.857d78",
        "type": "comment",
        "z": "832ec745.2f9928",
        "name": "HJ10SMKDEV003 印刷顯影線#2",
        "info": "",
        "x": 176,
        "y": 219,
        "wires": []
    },
    {
        "id": "d254ea63.1acce8",
        "type": "subflow:12b00dca.df6d12",
        "z": "832ec745.2f9928",
        "name": "",
        "env": [],
        "x": 675,
        "y": 263,
        "wires": [
            [
                "5c1a99aa.1094b8"
            ]
        ]
    },
    {
        "id": "7da2006b.7631c",
        "type": "subflow:3b73a09.e77af6",
        "z": "832ec745.2f9928",
        "name": "",
        "env": [],
        "x": 270,
        "y": 440,
        "wires": [
            [
                "e913e182.3d821"
            ]
        ]
    },
    {
        "id": "e913e182.3d821",
        "type": "subflow:46c3b751.13e688",
        "z": "832ec745.2f9928",
        "name": "",
        "env": [
            {
                "name": "MONITOR_LIST",
                "value": "[\"AVAIL\"]",
                "type": "json"
            },
            {
                "name": "WSDL_URL",
                "value": "https://www.crcind.com/csp/samples/SOAP.Demo.CLS?WSDL=1",
                "type": "str"
            }
        ],
        "x": 435,
        "y": 440,
        "wires": [
            [
                "b32144a4.116f08"
            ],
            [
                "8f321637.784958"
            ]
        ]
    },
    {
        "id": "8f321637.784958",
        "type": "subflow:9c352516.1ade28",
        "z": "832ec745.2f9928",
        "name": "",
        "env": [
            {
                "name": "TOPIC",
                "value": "Query MS-SQL failure",
                "type": "str"
            }
        ],
        "x": 685,
        "y": 463,
        "wires": [
            [
                "25d4d088.c4533"
            ]
        ]
    },
    {
        "id": "25d4d088.c4533",
        "type": "reading-out",
        "z": "832ec745.2f9928",
        "name": "",
        "equipmentId": "logger",
        "x": 1086,
        "y": 463,
        "wires": []
    },
    {
        "id": "c39392d3.266ea",
        "type": "subflow:8ea31ce9.488ad",
        "z": "832ec745.2f9928",
        "name": "",
        "env": [],
        "x": 876,
        "y": 423,
        "wires": [
            [
                "25d4d088.c4533"
            ]
        ]
    },
    {
        "id": "2b35479b.b9b868",
        "type": "subflow:7a61fc3d.3aa584",
        "z": "832ec745.2f9928",
        "name": "",
        "env": [
            {
                "name": "EQUIPMENT_ID",
                "value": "P10SMKDEV004",
                "type": "str"
            },
            {
                "name": "DEVICE_ID",
                "value": "virtual",
                "type": "str"
            }
        ],
        "x": 107,
        "y": 440,
        "wires": [
            [
                "7da2006b.7631c"
            ]
        ]
    },
    {
        "id": "c9f63a42.d74068",
        "type": "comment",
        "z": "832ec745.2f9928",
        "name": "10SMKDEV004 印刷顯影線#1(厚板)",
        "info": "",
        "x": 186,
        "y": 379,
        "wires": []
    },
    {
        "id": "b32144a4.116f08",
        "type": "subflow:12b00dca.df6d12",
        "z": "832ec745.2f9928",
        "name": "",
        "env": [],
        "x": 675,
        "y": 423,
        "wires": [
            [
                "c39392d3.266ea"
            ]
        ]
    },
    {
        "id": "d3d10eea.9822",
        "type": "subflow:3b73a09.e77af6",
        "z": "832ec745.2f9928",
        "name": "",
        "env": [],
        "x": 270,
        "y": 600,
        "wires": [
            [
                "88c35920.e4fad8"
            ]
        ]
    },
    {
        "id": "88c35920.e4fad8",
        "type": "subflow:46c3b751.13e688",
        "z": "832ec745.2f9928",
        "name": "",
        "env": [
            {
                "name": "MONITOR_LIST",
                "value": "[\"AVAIL\"]",
                "type": "json"
            },
            {
                "name": "WSDL_URL",
                "value": "https://www.crcind.com/csp/samples/SOAP.Demo.CLS?WSDL=1",
                "type": "str"
            }
        ],
        "x": 435,
        "y": 600,
        "wires": [
            [
                "add4644b.49fad8"
            ],
            [
                "91256f94.dd067"
            ]
        ]
    },
    {
        "id": "91256f94.dd067",
        "type": "subflow:9c352516.1ade28",
        "z": "832ec745.2f9928",
        "name": "",
        "env": [
            {
                "name": "TOPIC",
                "value": "Query MS-SQL failure",
                "type": "str"
            }
        ],
        "x": 685,
        "y": 623,
        "wires": [
            [
                "cc4585ab.7b3a08"
            ]
        ]
    },
    {
        "id": "cc4585ab.7b3a08",
        "type": "reading-out",
        "z": "832ec745.2f9928",
        "name": "",
        "equipmentId": "logger",
        "x": 1086,
        "y": 623,
        "wires": []
    },
    {
        "id": "cc0e7123.115cc",
        "type": "subflow:8ea31ce9.488ad",
        "z": "832ec745.2f9928",
        "name": "",
        "env": [],
        "x": 876,
        "y": 583,
        "wires": [
            [
                "cc4585ab.7b3a08"
            ]
        ]
    },
    {
        "id": "9ae4d735.c36278",
        "type": "subflow:7a61fc3d.3aa584",
        "z": "832ec745.2f9928",
        "name": "",
        "env": [
            {
                "name": "EQUIPMENT_ID",
                "value": "P10SMKCUR001",
                "type": "str"
            },
            {
                "name": "DEVICE_ID",
                "value": "virtual",
                "type": "str"
            }
        ],
        "x": 107,
        "y": 600,
        "wires": [
            [
                "d3d10eea.9822"
            ]
        ]
    },
    {
        "id": "124b108a.30f07f",
        "type": "comment",
        "z": "832ec745.2f9928",
        "name": "10SMKCUR001 預烤連續熱風烤箱#1",
        "info": "",
        "x": 196,
        "y": 539,
        "wires": []
    },
    {
        "id": "add4644b.49fad8",
        "type": "subflow:12b00dca.df6d12",
        "z": "832ec745.2f9928",
        "name": "",
        "env": [],
        "x": 675,
        "y": 583,
        "wires": [
            [
                "cc0e7123.115cc"
            ]
        ]
    },
    {
        "id": "8fd07eef.fcff4",
        "type": "subflow:3b73a09.e77af6",
        "z": "832ec745.2f9928",
        "name": "",
        "env": [],
        "x": 270,
        "y": 760,
        "wires": [
            [
                "6f9e1616.04fae8"
            ]
        ]
    },
    {
        "id": "6f9e1616.04fae8",
        "type": "subflow:46c3b751.13e688",
        "z": "832ec745.2f9928",
        "name": "",
        "env": [
            {
                "name": "MONITOR_LIST",
                "value": "[\"AVAIL\"]",
                "type": "json"
            },
            {
                "name": "WSDL_URL",
                "value": "https://www.crcind.com/csp/samples/SOAP.Demo.CLS?WSDL=1",
                "type": "str"
            }
        ],
        "x": 435,
        "y": 760,
        "wires": [
            [
                "26aac7b2.32edf8"
            ],
            [
                "91f940e3.dcb7"
            ]
        ]
    },
    {
        "id": "91f940e3.dcb7",
        "type": "subflow:9c352516.1ade28",
        "z": "832ec745.2f9928",
        "name": "",
        "env": [
            {
                "name": "TOPIC",
                "value": "Query MS-SQL failure",
                "type": "str"
            }
        ],
        "x": 685,
        "y": 783,
        "wires": [
            [
                "6c30ed25.435894"
            ]
        ]
    },
    {
        "id": "6c30ed25.435894",
        "type": "reading-out",
        "z": "832ec745.2f9928",
        "name": "",
        "equipmentId": "logger",
        "x": 1086,
        "y": 783,
        "wires": []
    },
    {
        "id": "c7139c75.ed8af",
        "type": "subflow:8ea31ce9.488ad",
        "z": "832ec745.2f9928",
        "name": "",
        "env": [],
        "x": 876,
        "y": 743,
        "wires": [
            [
                "6c30ed25.435894"
            ]
        ]
    },
    {
        "id": "f90820a4.5d008",
        "type": "subflow:7a61fc3d.3aa584",
        "z": "832ec745.2f9928",
        "name": "",
        "env": [
            {
                "name": "EQUIPMENT_ID",
                "value": "P10SMKCUR002",
                "type": "str"
            },
            {
                "name": "DEVICE_ID",
                "value": "virtual",
                "type": "str"
            }
        ],
        "x": 107,
        "y": 760,
        "wires": [
            [
                "8fd07eef.fcff4"
            ]
        ]
    },
    {
        "id": "70e5473.24e0cb8",
        "type": "comment",
        "z": "832ec745.2f9928",
        "name": "10SMKCUR002 預烤連續熱風烤箱#2",
        "info": "",
        "x": 196,
        "y": 699,
        "wires": []
    },
    {
        "id": "26aac7b2.32edf8",
        "type": "subflow:12b00dca.df6d12",
        "z": "832ec745.2f9928",
        "name": "",
        "env": [],
        "x": 675,
        "y": 743,
        "wires": [
            [
                "c7139c75.ed8af"
            ]
        ]
    },
    {
        "id": "b4a07aa0.e3b7d8",
        "type": "subflow:3b73a09.e77af6",
        "z": "832ec745.2f9928",
        "name": "",
        "env": [],
        "x": 270,
        "y": 920,
        "wires": [
            [
                "a3545bfc.40a3c8"
            ]
        ]
    },
    {
        "id": "a3545bfc.40a3c8",
        "type": "subflow:46c3b751.13e688",
        "z": "832ec745.2f9928",
        "name": "",
        "env": [
            {
                "name": "MONITOR_LIST",
                "value": "[\"AVAIL\"]",
                "type": "json"
            },
            {
                "name": "WSDL_URL",
                "value": "https://www.crcind.com/csp/samples/SOAP.Demo.CLS?WSDL=1",
                "type": "str"
            }
        ],
        "x": 435,
        "y": 920,
        "wires": [
            [
                "fa68eeeb.bccc4"
            ],
            [
                "c5fd53a4.4cf5"
            ]
        ]
    },
    {
        "id": "c5fd53a4.4cf5",
        "type": "subflow:9c352516.1ade28",
        "z": "832ec745.2f9928",
        "name": "",
        "env": [
            {
                "name": "TOPIC",
                "value": "Query MS-SQL failure",
                "type": "str"
            }
        ],
        "x": 685,
        "y": 943,
        "wires": [
            [
                "1f159af4.5a2df5"
            ]
        ]
    },
    {
        "id": "1f159af4.5a2df5",
        "type": "reading-out",
        "z": "832ec745.2f9928",
        "name": "",
        "equipmentId": "logger",
        "x": 1086,
        "y": 943,
        "wires": []
    },
    {
        "id": "6871aea0.d511a",
        "type": "subflow:8ea31ce9.488ad",
        "z": "832ec745.2f9928",
        "name": "",
        "env": [],
        "x": 876,
        "y": 903,
        "wires": [
            [
                "1f159af4.5a2df5"
            ]
        ]
    },
    {
        "id": "8eb01e68.4069e",
        "type": "subflow:7a61fc3d.3aa584",
        "z": "832ec745.2f9928",
        "name": "",
        "env": [
            {
                "name": "EQUIPMENT_ID",
                "value": "P10LGNBAK001",
                "type": "str"
            },
            {
                "name": "DEVICE_ID",
                "value": "virtual",
                "type": "str"
            }
        ],
        "x": 107,
        "y": 920,
        "wires": [
            [
                "b4a07aa0.e3b7d8"
            ]
        ]
    },
    {
        "id": "1032dd0.84d9623",
        "type": "comment",
        "z": "832ec745.2f9928",
        "name": "10LGNBAK001 終烤夾式連續式烤箱#1",
        "info": "",
        "x": 196,
        "y": 859,
        "wires": []
    },
    {
        "id": "fa68eeeb.bccc4",
        "type": "subflow:12b00dca.df6d12",
        "z": "832ec745.2f9928",
        "name": "",
        "env": [],
        "x": 675,
        "y": 903,
        "wires": [
            [
                "6871aea0.d511a"
            ]
        ]
    },
    {
        "id": "a75acf27.d19b7",
        "type": "subflow:3b73a09.e77af6",
        "z": "832ec745.2f9928",
        "name": "",
        "env": [],
        "x": 270,
        "y": 1080,
        "wires": [
            [
                "6315a6a.6c11258"
            ]
        ]
    },
    {
        "id": "6315a6a.6c11258",
        "type": "subflow:46c3b751.13e688",
        "z": "832ec745.2f9928",
        "name": "",
        "env": [
            {
                "name": "MONITOR_LIST",
                "value": "[\"AVAIL\"]",
                "type": "json"
            },
            {
                "name": "WSDL_URL",
                "value": "https://www.crcind.com/csp/samples/SOAP.Demo.CLS?WSDL=1",
                "type": "str"
            }
        ],
        "x": 435,
        "y": 1080,
        "wires": [
            [
                "4492ae71.6287b"
            ],
            [
                "864c8a4e.c852d8"
            ]
        ]
    },
    {
        "id": "864c8a4e.c852d8",
        "type": "subflow:9c352516.1ade28",
        "z": "832ec745.2f9928",
        "name": "",
        "env": [
            {
                "name": "TOPIC",
                "value": "Query MS-SQL failure",
                "type": "str"
            }
        ],
        "x": 685,
        "y": 1103,
        "wires": [
            [
                "4c8f219a.98d42"
            ]
        ]
    },
    {
        "id": "4c8f219a.98d42",
        "type": "reading-out",
        "z": "832ec745.2f9928",
        "name": "",
        "equipmentId": "logger",
        "x": 1086,
        "y": 1103,
        "wires": []
    },
    {
        "id": "26d2fdd8.fb93f2",
        "type": "subflow:8ea31ce9.488ad",
        "z": "832ec745.2f9928",
        "name": "",
        "env": [],
        "x": 876,
        "y": 1063,
        "wires": [
            [
                "4c8f219a.98d42"
            ]
        ]
    },
    {
        "id": "ba1aada0.d46ed",
        "type": "subflow:7a61fc3d.3aa584",
        "z": "832ec745.2f9928",
        "name": "",
        "env": [
            {
                "name": "EQUIPMENT_ID",
                "value": "P10LGNBAK002",
                "type": "str"
            },
            {
                "name": "DEVICE_ID",
                "value": "virtual",
                "type": "str"
            }
        ],
        "x": 107,
        "y": 1080,
        "wires": [
            [
                "a75acf27.d19b7"
            ]
        ]
    },
    {
        "id": "c6dbb0b4.60815",
        "type": "comment",
        "z": "832ec745.2f9928",
        "name": "10LGNBAK002 終烤隧道式連續式烤箱#2",
        "info": "",
        "x": 206,
        "y": 1019,
        "wires": []
    },
    {
        "id": "4492ae71.6287b",
        "type": "subflow:12b00dca.df6d12",
        "z": "832ec745.2f9928",
        "name": "",
        "env": [],
        "x": 675,
        "y": 1063,
        "wires": [
            [
                "26d2fdd8.fb93f2"
            ]
        ]
    },
    {
        "id": "988ffc15.a889d",
        "type": "subflow:3b73a09.e77af6",
        "z": "832ec745.2f9928",
        "name": "",
        "env": [],
        "x": 270,
        "y": 1240,
        "wires": [
            [
                "619dd371.fdfdac"
            ]
        ]
    },
    {
        "id": "619dd371.fdfdac",
        "type": "subflow:46c3b751.13e688",
        "z": "832ec745.2f9928",
        "name": "",
        "env": [
            {
                "name": "MONITOR_LIST",
                "value": "[\"AVAIL\"]",
                "type": "json"
            },
            {
                "name": "WSDL_URL",
                "value": "https://www.crcind.com/csp/samples/SOAP.Demo.CLS?WSDL=1",
                "type": "str"
            }
        ],
        "x": 435,
        "y": 1240,
        "wires": [
            [
                "3ad599e1.60cf46"
            ],
            [
                "9bd95e2.55ce8a"
            ]
        ]
    },
    {
        "id": "9bd95e2.55ce8a",
        "type": "subflow:9c352516.1ade28",
        "z": "832ec745.2f9928",
        "name": "",
        "env": [
            {
                "name": "TOPIC",
                "value": "Query MS-SQL failure",
                "type": "str"
            }
        ],
        "x": 685,
        "y": 1263,
        "wires": [
            [
                "d70ceb7e.822708"
            ]
        ]
    },
    {
        "id": "d70ceb7e.822708",
        "type": "reading-out",
        "z": "832ec745.2f9928",
        "name": "",
        "equipmentId": "logger",
        "x": 1086,
        "y": 1263,
        "wires": []
    },
    {
        "id": "2dddefe7.ac1e3",
        "type": "subflow:8ea31ce9.488ad",
        "z": "832ec745.2f9928",
        "name": "",
        "env": [],
        "x": 876,
        "y": 1223,
        "wires": [
            [
                "d70ceb7e.822708"
            ]
        ]
    },
    {
        "id": "643d9d3e.758be4",
        "type": "subflow:7a61fc3d.3aa584",
        "z": "832ec745.2f9928",
        "name": "",
        "env": [
            {
                "name": "EQUIPMENT_ID",
                "value": "P10OSPOSP001",
                "type": "str"
            },
            {
                "name": "DEVICE_ID",
                "value": "virtual",
                "type": "str"
            }
        ],
        "x": 107,
        "y": 1240,
        "wires": [
            [
                "988ffc15.a889d"
            ]
        ]
    },
    {
        "id": "aea5b3ce.dd264",
        "type": "comment",
        "z": "832ec745.2f9928",
        "name": "10OSPOSP001 OSP",
        "info": "",
        "x": 146,
        "y": 1179,
        "wires": []
    },
    {
        "id": "3ad599e1.60cf46",
        "type": "subflow:12b00dca.df6d12",
        "z": "832ec745.2f9928",
        "name": "",
        "env": [],
        "x": 675,
        "y": 1223,
        "wires": [
            [
                "2dddefe7.ac1e3"
            ]
        ]
    },
    {
        "id": "5ed2c241.73136c",
        "type": "subflow:3b73a09.e77af6",
        "z": "832ec745.2f9928",
        "name": "",
        "env": [],
        "x": 270,
        "y": 1420,
        "wires": [
            [
                "2c6c017f.1e8ebe"
            ]
        ]
    },
    {
        "id": "2c6c017f.1e8ebe",
        "type": "subflow:46c3b751.13e688",
        "z": "832ec745.2f9928",
        "name": "",
        "env": [
            {
                "name": "MONITOR_LIST",
                "value": "[\"AVAIL\"]",
                "type": "json"
            },
            {
                "name": "WSDL_URL",
                "value": "https://www.crcind.com/csp/samples/SOAP.Demo.CLS?WSDL=1",
                "type": "str"
            }
        ],
        "x": 435,
        "y": 1420,
        "wires": [
            [
                "eefdb4c.b76fe48"
            ],
            [
                "32b76e80.e07262"
            ]
        ]
    },
    {
        "id": "32b76e80.e07262",
        "type": "subflow:9c352516.1ade28",
        "z": "832ec745.2f9928",
        "name": "",
        "env": [
            {
                "name": "TOPIC",
                "value": "Query MS-SQL failure",
                "type": "str"
            }
        ],
        "x": 685,
        "y": 1443,
        "wires": [
            [
                "94be4315.3588d"
            ]
        ]
    },
    {
        "id": "94be4315.3588d",
        "type": "reading-out",
        "z": "832ec745.2f9928",
        "name": "",
        "equipmentId": "logger",
        "x": 1086,
        "y": 1443,
        "wires": []
    },
    {
        "id": "d465ace5.053ef",
        "type": "subflow:8ea31ce9.488ad",
        "z": "832ec745.2f9928",
        "name": "",
        "env": [],
        "x": 876,
        "y": 1403,
        "wires": [
            [
                "94be4315.3588d"
            ]
        ]
    },
    {
        "id": "aa4461d5.95189",
        "type": "subflow:7a61fc3d.3aa584",
        "z": "832ec745.2f9928",
        "name": "",
        "env": [
            {
                "name": "EQUIPMENT_ID",
                "value": "P10SMKPRE005",
                "type": "str"
            },
            {
                "name": "DEVICE_ID",
                "value": "virtual",
                "type": "str"
            }
        ],
        "x": 107,
        "y": 1420,
        "wires": [
            [
                "5ed2c241.73136c"
            ]
        ]
    },
    {
        "id": "148c0ff.d11d1f",
        "type": "comment",
        "z": "832ec745.2f9928",
        "name": "10SMKPRE005 超粗化線#1",
        "info": "",
        "x": 166,
        "y": 1359,
        "wires": []
    },
    {
        "id": "eefdb4c.b76fe48",
        "type": "subflow:12b00dca.df6d12",
        "z": "832ec745.2f9928",
        "name": "",
        "env": [],
        "x": 675,
        "y": 1403,
        "wires": [
            [
                "d465ace5.053ef"
            ]
        ]
    },
    {
        "id": "daeb9d8a.527d4",
        "type": "function",
        "z": "732be65a.ac2f78",
        "name": "validate input",
        "func": "const alarms = msg.alarms\nconst channel_names = msg.channelNames\nconst equipment_info = msg.equipmentInfo\nconst query_result = msg.queryResult\nconst reading_in = msg.readingIn\n\nif (typeof alarms === undefined ||\n        typeof channel_names === undefined ||\n        typeof equipment_info === undefined ||\n        typeof payload === undefined ||\n        typeof reading_in === undefined) \n{\n    node.error('input error')\n    return\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 190,
        "y": 160,
        "wires": [
            [
                "48e7c24f.69732c"
            ]
        ]
    },
    {
        "id": "76b34781.a5cf78",
        "type": "e-mail",
        "z": "732be65a.ac2f78",
        "server": "10.13.66.25",
        "port": "25",
        "secure": false,
        "tls": false,
        "name": "",
        "dname": "",
        "x": 810,
        "y": 220,
        "wires": []
    },
    {
        "id": "190d9f6b.911901",
        "type": "function",
        "z": "732be65a.ac2f78",
        "name": "build email message",
        "func": "const alarms = msg.alarms\nconst channel_names = msg.channelNames\nconst equipment_info = msg.equipmentInfo\nconst query_result = msg.queryResult\nconst reading_in = msg.readingIn\n\nlet machine_no = equipment_info.machineNo\nlet eq_name = equipment_info.equipmentName\nlet insert_time = _to_ms_sql_datetime(reading_in.at)\nlet log_time = insert_time\nlet promis_status = query_result.result[0].PromisStatus\nlet promis_time = _to_ms_sql_datetime(\n    _offset_promis_time(query_result.result[0].PromisTime))\nlet lot_no = query_result.result[0].LotNo\n\nlet html = `\n<body>\n\n<table  style=\"border:0px #000000 solid;padding:5px;\" rules=\"all\" cellpadding='5';border='1'>\n  <tr>\n    <th>MachineNo</th>\n    <th>EQName</th> \n    <th>EventCode</th>\n    <th>EventMessage</th>\n    <th>InsertTime</th>\n    <th>LogTime</th>\n    <th>PromisStatus</th>\n    <th>PromisTime</th>\n    <th>LotNo</th>\n  </tr>\n`\n\nfor (let channel in alarms)\n{\n    let event_code = channel\n    let event_message = channel_names[channel]\n    \n    html += `\n  <tr>\n    <td>${machine_no}</td>\n    <td>${eq_name}</td>\n    <td>${event_code}</td>\n    <td>${event_message}</td>\n    <td>${insert_time}</td>\n    <td>${log_time}</td>\n    <td>${promis_status}</td>\n    <td>${promis_time}</td>\n    <td>${lot_no}</td>\n  </tr>\n`\n}\n\nhtml += `\n</table>\n</body>\n此為系統自動發送, 請勿回覆\n`\n\nmsg.topic = `設備 ${eq_name} 警告`\nmsg.headers = '<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\">'\nmsg.payload = html\n\n\nreturn msg;\n\n// internal function\nfunction _offset_promis_time(from)\n{\n    const d = new Date(from)\n    \n    return d.getTime() - 28800000\n}\n\nfunction _to_ms_sql_datetime(from)\n{\n    const d = new Date(from)\n    \n    let date = (\"0\" + d.getDate()).slice(-2)\n    let month = (\"0\" + (d.getMonth() + 1)).slice(-2)\n    let year = d.getFullYear()\n    let hours = d.getHours()\n    let minutes = d.getMinutes()\n    let seconds = d.getSeconds()\n    \n    return year + \"-\" + month + \"-\" + date + \" \" + hours + \":\" + minutes + \":\" + seconds\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 600,
        "y": 160,
        "wires": [
            [
                "76b34781.a5cf78"
            ]
        ]
    },
    {
        "id": "48e7c24f.69732c",
        "type": "function",
        "z": "732be65a.ac2f78",
        "name": "mail reciepents",
        "func": "msg.to = 'vincent.lu@unimicron.com,010182@unimicron.com,jackson_lee@unimicron.com,A0841@unimicron.com,A1348@unimicron.com,cccho@unimicron.com,32240@unimicron.com,A0359@unimicron.com,A2579@unimicron.com'\nmsg.cc = 'cpl@unimicron.com,darren_chen@unimicron.com'\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 380,
        "y": 160,
        "wires": [
            [
                "190d9f6b.911901"
            ]
        ]
    },
    {
        "id": "82419f6d.e4cb1",
        "type": "subflow:732be65a.ac2f78",
        "z": "e4beaa17.839f48",
        "name": "",
        "x": 730,
        "y": 520,
        "wires": [
            [
                "da6daad6.c1a608"
            ]
        ]
    },
    {
        "id": "cf93665.f170198",
        "type": "subflow:e30aea47.352308",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [
            {
                "name": "EQUIPMENT_ID",
                "value": "step7",
                "type": "str"
            }
        ],
        "x": 300,
        "y": 920,
        "wires": [
            [
                "6298fa06.f35a64"
            ]
        ]
    },
    {
        "id": "4adb858f.960bac",
        "type": "subflow:1524802c.2eebb",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 760,
        "y": 881,
        "wires": [
            [
                "ce8b5d11.85109"
            ]
        ]
    },
    {
        "id": "ce8b5d11.85109",
        "type": "subflow:2d572c71.a8d6a4",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 770,
        "y": 940,
        "wires": [
            [
                "8a4f8690.529898",
                "c60c898d.3ce348"
            ]
        ]
    },
    {
        "id": "af396e57.24b03",
        "type": "subflow:99679bb5.c9aa78",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [
            {
                "name": "TRIGGER_PERIOD_SEC",
                "value": "10",
                "type": "num"
            },
            {
                "name": "EQUPMENT_ID",
                "value": "HJ10PTHDMP003",
                "type": "str"
            },
            {
                "name": "READINGS_PER_UPDATE",
                "value": "200",
                "type": "num"
            }
        ],
        "x": 110,
        "y": 920,
        "wires": [
            []
        ]
    },
    {
        "id": "6298fa06.f35a64",
        "type": "subflow:cbbfcffb.86f5",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 520,
        "y": 920,
        "wires": [
            [
                "4adb858f.960bac"
            ],
            [
                "ce8b5d11.85109"
            ]
        ]
    },
    {
        "id": "8a4f8690.529898",
        "type": "subflow:9f9d1bbb.2fa088",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 1020,
        "y": 940,
        "wires": []
    },
    {
        "id": "21b90593.ba619a",
        "type": "subflow:e30aea47.352308",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [
            {
                "name": "EQUIPMENT_ID",
                "value": "step7",
                "type": "str"
            }
        ],
        "x": 300,
        "y": 1018,
        "wires": [
            [
                "50b0d988.bd6598"
            ]
        ]
    },
    {
        "id": "e7c2f498.8081e8",
        "type": "subflow:1524802c.2eebb",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 760,
        "y": 978,
        "wires": [
            [
                "cb10e01b.0bd34"
            ]
        ]
    },
    {
        "id": "cb10e01b.0bd34",
        "type": "subflow:2d572c71.a8d6a4",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 770,
        "y": 1038,
        "wires": [
            [
                "4fbef082.02edf",
                "dfb8fea1.ac5f7"
            ]
        ]
    },
    {
        "id": "5fa778e7.8b4cf8",
        "type": "subflow:99679bb5.c9aa78",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [
            {
                "name": "TRIGGER_PERIOD_SEC",
                "value": "10",
                "type": "num"
            },
            {
                "name": "EQUPMENT_ID",
                "value": "HJ10PTHDMP003",
                "type": "str"
            },
            {
                "name": "READINGS_PER_UPDATE",
                "value": "200",
                "type": "num"
            },
            {
                "name": "EVENT_ONLY",
                "value": "true",
                "type": "bool"
            }
        ],
        "x": 110,
        "y": 1018,
        "wires": [
            []
        ]
    },
    {
        "id": "50b0d988.bd6598",
        "type": "subflow:cbbfcffb.86f5",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 520,
        "y": 1018,
        "wires": [
            [
                "e7c2f498.8081e8"
            ],
            [
                "cb10e01b.0bd34"
            ]
        ]
    },
    {
        "id": "4fbef082.02edf",
        "type": "subflow:9f9d1bbb.2fa088",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 1020,
        "y": 1038,
        "wires": []
    },
    {
        "id": "49ffc2ae.99c89c",
        "type": "comment",
        "z": "cbf34f11.3db4",
        "name": "10PTHDMP003(龍門鍍銅線) data",
        "info": "",
        "x": 190,
        "y": 880,
        "wires": []
    },
    {
        "id": "49723c9f.1ca8c4",
        "type": "comment",
        "z": "cbf34f11.3db4",
        "name": "10PTHDMP003(龍門鍍銅線) event",
        "info": "",
        "x": 200,
        "y": 978,
        "wires": []
    },
    {
        "id": "c60c898d.3ce348",
        "type": "debug",
        "z": "cbf34f11.3db4",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1010,
        "y": 881,
        "wires": []
    },
    {
        "id": "dfb8fea1.ac5f7",
        "type": "debug",
        "z": "cbf34f11.3db4",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1010,
        "y": 978,
        "wires": []
    },
    {
        "id": "65a8693e.689218",
        "type": "comment",
        "z": "cbf34f11.3db4",
        "name": "HJ CPV",
        "info": "",
        "x": 50,
        "y": 40,
        "wires": []
    },
    {
        "id": "846a9bdc.ec15e8",
        "type": "subflow:e30aea47.352308",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [
            {
                "name": "EQUIPMENT_ID",
                "value": "step7",
                "type": "str"
            }
        ],
        "x": 300,
        "y": 320,
        "wires": [
            [
                "c4467827.626438"
            ]
        ]
    },
    {
        "id": "e1c75dde.7f429",
        "type": "subflow:1524802c.2eebb",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 760,
        "y": 280,
        "wires": [
            [
                "2d6e0cf.f3515f4"
            ]
        ]
    },
    {
        "id": "2d6e0cf.f3515f4",
        "type": "subflow:2d572c71.a8d6a4",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 770,
        "y": 340,
        "wires": [
            [
                "373b504d.c5d1d",
                "fda6c118.e30d5"
            ]
        ]
    },
    {
        "id": "d503a66c.4fd238",
        "type": "subflow:99679bb5.c9aa78",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [
            {
                "name": "TRIGGER_PERIOD_SEC",
                "value": "30",
                "type": "num"
            },
            {
                "name": "EQUPMENT_ID",
                "value": "HJ10PTHPNL006",
                "type": "str"
            },
            {
                "name": "READINGS_PER_UPDATE",
                "value": "10",
                "type": "num"
            }
        ],
        "x": 110,
        "y": 320,
        "wires": [
            [
                "846a9bdc.ec15e8"
            ]
        ]
    },
    {
        "id": "c4467827.626438",
        "type": "subflow:cbbfcffb.86f5",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 520,
        "y": 320,
        "wires": [
            [
                "e1c75dde.7f429"
            ],
            [
                "2d6e0cf.f3515f4"
            ]
        ]
    },
    {
        "id": "373b504d.c5d1d",
        "type": "subflow:9f9d1bbb.2fa088",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 1020,
        "y": 340,
        "wires": []
    },
    {
        "id": "eb4c5e30.76d37",
        "type": "subflow:e30aea47.352308",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [
            {
                "name": "EQUIPMENT_ID",
                "value": "step7",
                "type": "str"
            }
        ],
        "x": 300,
        "y": 418,
        "wires": [
            [
                "59584b84.0954a4"
            ]
        ]
    },
    {
        "id": "653db9.24564248",
        "type": "subflow:1524802c.2eebb",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 760,
        "y": 378,
        "wires": [
            [
                "b2de24b4.3b8728"
            ]
        ]
    },
    {
        "id": "b2de24b4.3b8728",
        "type": "subflow:2d572c71.a8d6a4",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 770,
        "y": 438,
        "wires": [
            [
                "ad4c69bc.9990e8",
                "46af0c13.9c17b4"
            ]
        ]
    },
    {
        "id": "2a377531.ee331a",
        "type": "subflow:99679bb5.c9aa78",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [
            {
                "name": "TRIGGER_PERIOD_SEC",
                "value": "30",
                "type": "num"
            },
            {
                "name": "EQUPMENT_ID",
                "value": "HJ10PTHPNL006",
                "type": "str"
            },
            {
                "name": "READINGS_PER_UPDATE",
                "value": "10",
                "type": "num"
            },
            {
                "name": "EVENT_ONLY",
                "value": "true",
                "type": "bool"
            }
        ],
        "x": 110,
        "y": 418,
        "wires": [
            [
                "eb4c5e30.76d37"
            ]
        ]
    },
    {
        "id": "59584b84.0954a4",
        "type": "subflow:cbbfcffb.86f5",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 520,
        "y": 418,
        "wires": [
            [
                "653db9.24564248"
            ],
            [
                "b2de24b4.3b8728"
            ]
        ]
    },
    {
        "id": "ad4c69bc.9990e8",
        "type": "subflow:9f9d1bbb.2fa088",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 1020,
        "y": 438,
        "wires": []
    },
    {
        "id": "c3ae2a6f.b136b8",
        "type": "comment",
        "z": "cbf34f11.3db4",
        "name": "10PTHPNL006(VCP#5P) data",
        "info": "",
        "x": 180,
        "y": 280,
        "wires": []
    },
    {
        "id": "b27889b9.8381c8",
        "type": "comment",
        "z": "cbf34f11.3db4",
        "name": "10PTHPNL006(VCP#5P) event",
        "info": "",
        "x": 190,
        "y": 379,
        "wires": []
    },
    {
        "id": "fda6c118.e30d5",
        "type": "debug",
        "z": "cbf34f11.3db4",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1010,
        "y": 280,
        "wires": []
    },
    {
        "id": "46af0c13.9c17b4",
        "type": "debug",
        "z": "cbf34f11.3db4",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1010,
        "y": 378,
        "wires": []
    },
    {
        "id": "9f130fa.195e6f",
        "type": "subflow:e30aea47.352308",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [
            {
                "name": "EQUIPMENT_ID",
                "value": "step7",
                "type": "str"
            }
        ],
        "x": 300,
        "y": 520,
        "wires": [
            [
                "24e7f20d.ea444e"
            ]
        ]
    },
    {
        "id": "b3125a61.303268",
        "type": "subflow:1524802c.2eebb",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 760,
        "y": 480,
        "wires": [
            [
                "b430081d.f24fa8"
            ]
        ]
    },
    {
        "id": "b430081d.f24fa8",
        "type": "subflow:2d572c71.a8d6a4",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 770,
        "y": 540,
        "wires": [
            [
                "69fa4db7.313d44",
                "6600d2e6.bfeccc"
            ]
        ]
    },
    {
        "id": "96507d23.4e094",
        "type": "subflow:99679bb5.c9aa78",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [
            {
                "name": "TRIGGER_PERIOD_SEC",
                "value": "10",
                "type": "num"
            },
            {
                "name": "EQUPMENT_ID",
                "value": "HJ10PTHECU001",
                "type": "str"
            },
            {
                "name": "READINGS_PER_UPDATE",
                "value": "200",
                "type": "num"
            }
        ],
        "x": 110,
        "y": 520,
        "wires": [
            []
        ]
    },
    {
        "id": "24e7f20d.ea444e",
        "type": "subflow:cbbfcffb.86f5",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 520,
        "y": 520,
        "wires": [
            [
                "b3125a61.303268"
            ],
            [
                "b430081d.f24fa8"
            ]
        ]
    },
    {
        "id": "69fa4db7.313d44",
        "type": "subflow:9f9d1bbb.2fa088",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 1020,
        "y": 540,
        "wires": []
    },
    {
        "id": "130016bd.281f09",
        "type": "subflow:e30aea47.352308",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [
            {
                "name": "EQUIPMENT_ID",
                "value": "step7",
                "type": "str"
            }
        ],
        "x": 300,
        "y": 618,
        "wires": [
            [
                "1ec25617.65623a"
            ]
        ]
    },
    {
        "id": "6ead2c29.3fe784",
        "type": "subflow:1524802c.2eebb",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 760,
        "y": 578,
        "wires": [
            [
                "4014727c.32d7cc"
            ]
        ]
    },
    {
        "id": "4014727c.32d7cc",
        "type": "subflow:2d572c71.a8d6a4",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 770,
        "y": 638,
        "wires": [
            [
                "d6c3713b.53b97",
                "df55ffe1.3cd0e"
            ]
        ]
    },
    {
        "id": "55943cf7.055794",
        "type": "subflow:99679bb5.c9aa78",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [
            {
                "name": "TRIGGER_PERIOD_SEC",
                "value": "10",
                "type": "num"
            },
            {
                "name": "EQUPMENT_ID",
                "value": "HJ10PTHECU001",
                "type": "str"
            },
            {
                "name": "READINGS_PER_UPDATE",
                "value": "200",
                "type": "num"
            },
            {
                "name": "EVENT_ONLY",
                "value": "true",
                "type": "bool"
            }
        ],
        "x": 110,
        "y": 618,
        "wires": [
            []
        ]
    },
    {
        "id": "1ec25617.65623a",
        "type": "subflow:cbbfcffb.86f5",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 520,
        "y": 618,
        "wires": [
            [
                "6ead2c29.3fe784"
            ],
            [
                "4014727c.32d7cc"
            ]
        ]
    },
    {
        "id": "d6c3713b.53b97",
        "type": "subflow:9f9d1bbb.2fa088",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 1020,
        "y": 638,
        "wires": []
    },
    {
        "id": "5cc9072a.33bf58",
        "type": "comment",
        "z": "cbf34f11.3db4",
        "name": "10PTHECU001(導電高分子線 (DMSE)) data",
        "info": "",
        "x": 230,
        "y": 480,
        "wires": []
    },
    {
        "id": "49db2988.5859d8",
        "type": "comment",
        "z": "cbf34f11.3db4",
        "name": "10PTHECU001(導電高分子線 (DMSE)) event",
        "info": "",
        "x": 230,
        "y": 579,
        "wires": []
    },
    {
        "id": "6600d2e6.bfeccc",
        "type": "debug",
        "z": "cbf34f11.3db4",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1010,
        "y": 480,
        "wires": []
    },
    {
        "id": "df55ffe1.3cd0e",
        "type": "debug",
        "z": "cbf34f11.3db4",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1010,
        "y": 578,
        "wires": []
    },
    {
        "id": "8b10e7d2.dc3f48",
        "type": "subflow:e30aea47.352308",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [
            {
                "name": "EQUIPMENT_ID",
                "value": "step7",
                "type": "str"
            }
        ],
        "x": 300,
        "y": 720,
        "wires": [
            [
                "7f2747e.7a30eb8"
            ]
        ]
    },
    {
        "id": "12892ac.d4545d5",
        "type": "subflow:1524802c.2eebb",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 760,
        "y": 680,
        "wires": [
            [
                "1fb7ad2b.ff82e3"
            ]
        ]
    },
    {
        "id": "1fb7ad2b.ff82e3",
        "type": "subflow:2d572c71.a8d6a4",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 770,
        "y": 740,
        "wires": [
            [
                "581b26f3.831158",
                "9806f61a.03ec18"
            ]
        ]
    },
    {
        "id": "2684d471.11449c",
        "type": "subflow:99679bb5.c9aa78",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [
            {
                "name": "TRIGGER_PERIOD_SEC",
                "value": "10",
                "type": "num"
            },
            {
                "name": "EQUPMENT_ID",
                "value": "HJ10PTHPNL003",
                "type": "str"
            },
            {
                "name": "READINGS_PER_UPDATE",
                "value": "200",
                "type": "num"
            }
        ],
        "x": 110,
        "y": 720,
        "wires": [
            []
        ]
    },
    {
        "id": "7f2747e.7a30eb8",
        "type": "subflow:cbbfcffb.86f5",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 520,
        "y": 720,
        "wires": [
            [
                "12892ac.d4545d5"
            ],
            [
                "1fb7ad2b.ff82e3"
            ]
        ]
    },
    {
        "id": "581b26f3.831158",
        "type": "subflow:9f9d1bbb.2fa088",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 1020,
        "y": 740,
        "wires": []
    },
    {
        "id": "c3a3c538.d1ccd8",
        "type": "subflow:e30aea47.352308",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [
            {
                "name": "EQUIPMENT_ID",
                "value": "step7",
                "type": "str"
            }
        ],
        "x": 300,
        "y": 818,
        "wires": [
            [
                "bd26be1a.91867"
            ]
        ]
    },
    {
        "id": "d21f12e.259c1f",
        "type": "subflow:1524802c.2eebb",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 760,
        "y": 778,
        "wires": [
            [
                "202adfde.30ee3"
            ]
        ]
    },
    {
        "id": "202adfde.30ee3",
        "type": "subflow:2d572c71.a8d6a4",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 770,
        "y": 838,
        "wires": [
            [
                "d3f823fe.17d04",
                "77bcdd47.173234"
            ]
        ]
    },
    {
        "id": "902b6f7a.b0829",
        "type": "subflow:99679bb5.c9aa78",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [
            {
                "name": "TRIGGER_PERIOD_SEC",
                "value": "10",
                "type": "num"
            },
            {
                "name": "EQUPMENT_ID",
                "value": "HJ10PTHPNL003",
                "type": "str"
            },
            {
                "name": "READINGS_PER_UPDATE",
                "value": "200",
                "type": "num"
            },
            {
                "name": "EVENT_ONLY",
                "value": "true",
                "type": "bool"
            }
        ],
        "x": 110,
        "y": 818,
        "wires": [
            []
        ]
    },
    {
        "id": "bd26be1a.91867",
        "type": "subflow:cbbfcffb.86f5",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 520,
        "y": 818,
        "wires": [
            [
                "d21f12e.259c1f"
            ],
            [
                "202adfde.30ee3"
            ]
        ]
    },
    {
        "id": "d3f823fe.17d04",
        "type": "subflow:9f9d1bbb.2fa088",
        "z": "cbf34f11.3db4",
        "name": "",
        "env": [],
        "x": 1020,
        "y": 838,
        "wires": []
    },
    {
        "id": "d836736d.f97d3",
        "type": "comment",
        "z": "cbf34f11.3db4",
        "name": "10PTHPNL003(VCP#1(2F)) data",
        "info": "",
        "x": 190,
        "y": 680,
        "wires": []
    },
    {
        "id": "4cfd368f.19ca58",
        "type": "comment",
        "z": "cbf34f11.3db4",
        "name": "10PTHPNL003(VCP#1(2F)) event",
        "info": "",
        "x": 200,
        "y": 779,
        "wires": []
    },
    {
        "id": "9806f61a.03ec18",
        "type": "debug",
        "z": "cbf34f11.3db4",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1010,
        "y": 680,
        "wires": []
    },
    {
        "id": "77bcdd47.173234",
        "type": "debug",
        "z": "cbf34f11.3db4",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1010,
        "y": 778,
        "wires": []
    },
    {
        "id": "94e7ff1d.da8dc",
        "type": "debug",
        "z": "1524802c.2eebb",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 690,
        "y": 60,
        "wires": []
    }
]